
package fire.pb.team;
import java.util.ArrayList;
import java.util.List;
import java.util.Set;

import fire.pb.PropRole;
import fire.pb.StateCommon;
import fire.pb.battle.PlayPKManage;
import fire.pb.buff.BuffAgent;
import fire.pb.buff.BuffRoleImpl;
import fire.pb.clan.ClanUtils;
import fire.pb.event.ArriveTeamSpecialQuestEvent;
import fire.pb.main.ConfigManager;
import fire.pb.map.MapConfig;
import fire.pb.talk.MessageMgr;




// {{{ RPCGEN_IMPORT_BEGIN
// {{{ DO NOT EDIT THIS
import com.locojoy.base.Marshal.OctetsStream;
import com.locojoy.base.Marshal.MarshalException;

abstract class __CRespondInvite__ extends mkio.Protocol { }

// DO NOT EDIT THIS }}}
// RPCGEN_IMPORT_END }}}

/***
 * 闂傚倸鍊搁崐鎼佸磹閻戣姤鍊块柨鏇炲�哥粻鏍煕椤愶絾绀�缁炬儳娼￠弻鐔煎箚閻楀牜妫勭紒鎯у⒔缁垳鎹㈠☉銏犵闁绘劙顣︾�涒晜绻濆▓鍨灍濠电偛锕濠氭晬閸曨亝鍕冮柣鐘叉处瑜板啯鎱ㄩ弴銏♀拺缂備焦锚闁叉粓鏌熼崙銈嗗?闂傚倸鍊搁崐宄懊归崶褏鏆﹂柛顭戝亜閸ㄦ棃鏌熺紒銏犳灈缂佺媭鍨堕弻銊╂偆閸屾稑顏�?
 * @author changhao
 *
 */
public class CRespondInvite extends __CRespondInvite__ {
		
	//final static int MEMBER_MAX_COUNT = 4;//4濠电姷鏁告慨鐑藉极閹间礁纾婚柣鎰惈閸ㄥ倿鏌涢锝嗙缂佺姴缍婇弻宥夊传閸曨偓鎷锋繝姘ワ拷鍛村箵閹烘繃瀵岄柣搴秵娴滄粓顢楅姀掳浜滄い鎰剁稻缁�鍐磼缂佹绠炴俊顐㈠暙閳藉鈻庤箛锝喰熸繝鐢靛У椤旀牠宕规导瀛樺仱闁靛ě鍕簥濠电娀娼уú銊у姬閿熶粙姊虹粙鎸庢拱缂佸鍨甸埢宥夊Χ婢跺鎷洪梺鍛婄箓鐎氼參藟濠婂懐纾肩紓浣姑慨宥嗙節閿熻姤鎷呯化鏇熸杸闂佺粯顭堥婊冾啅閵夆晜鐓曢柣鏂挎啞鐏忥妇锟借娲╃紞浣哥暦閻旂⒈鏁勯悹鎭掑妿閻ｉ箖姊洪懡銈呅㈡繛澹洤鐐婃い顓熷煀閹峰嘲顓兼径瀣幗闁硅壈鎻徊楣冨汲閳哄懏鐓曟俊顖滃Т濞村倿寮崶褉鏀介柛灞剧矤閻掔偓顨ラ悙顏勭仾濞ｅ洤锕俊鍫曞川椤撶喐顓挎繝鐢靛仜椤曨參宕楀Ο渚綎缂備焦蓱婵挳鏌涘☉姗堝伐闁哄棗鐗忕槐鎾存媴閸撴彃鍓遍柣銏╁灣閸嬫盯鏁冮姀鈩冨缂侇垱娲橀弬锟芥俊鐐�栧濠氬磻閹捐鍚归柨鐔绘椤啴濡惰箛鏇犳殼濠电偘鍖犻崶鑸垫櫔闂佹寧绻傞ˇ浠嬪极閸愵喗鐓忛柛顐ｇ箖椤ョ偞绻涢崼鐔哥凡妞ゎ亜鍟存俊鍫曞幢濡厧寮冲┑鐘媰閸屾粎鐓撻柦妯荤箞閺屽秹宕崟顐嫹閼姐倗涓嶅Δ锝呭暞閻撴瑩鎮楅悽娈跨劸濞寸媴绠撻幃妯跨疀閿濆懎绠荤紓浣介哺鐢顕ラ崟顒傜瘈閹肩补鍓濋宥夋⒒娴ｈ姤纭堕柛鐘虫礀铻為柛鏇ㄥ灡閸婅埖鎱ㄥΟ鍨厫闁哄懏绻堥弻鏇＄疀鐎ｎ亷鎷峰Δ锟介悾鍨瑹閿熶粙鎮￠锕�鐐婇柕濞垮�楃换渚�姊烘潪鎵槮婵☆偅绻堝璇测槈閵忕姴宓嗛梺闈涱焾閸庤鲸鎱ㄦ导瀛樷拺闁告繂瀚崒銊╂煕閵婏附銇濋柛鈺傜洴楠炴帒螖娴ｅ搫寮抽梻浣虹帛閺屻劍鏅舵惔銊﹀剹婵炲棙鍩婇幏椋庢喆閸曨剛顦繝鐢靛剳閹风兘姊烘潪鎵槮缂佸鎳撻悾鐑芥偄绾拌鲸鏅ｉ悷婊冮閻☆參姊婚崒姘拷鎼佸磹閻戣姤鍊块柨鏃�鎷濋幏椋庣箔濞戞ɑ鍣介柣顓熺懇閺岀喐娼忔ィ鍐╊�嶉梺鎼炲�栭崝鏍Φ閸曨垰鍐�妞ゆ劦婢�缁墎绱撴担鍝勑ｉ柣妤冨█瀵鎮㈤悡搴ｎ唹闂侀�涘嵆濞佳冣枔椤撶姷纾藉〒姘搐娴滄粎绱掓径濠勭Ш妤犵偛鍟抽妵鎰板箳閹存粎鐐婇梻浣告啞濞诧箓宕滃璺虹？闁规儳澧庣壕钘壝归敐鍥剁劸缂佺嫏鍕箚闁绘劖澹嗛惌娆戯拷娈垮枦椤曆囧煡婢舵劕顫呴柣妯活問閸氬懘姊绘担鐟邦嚋缂佽鍊歌灋妞ゆ挾鍠撻々鐑芥煃鏉炴媽顔夐柡锟芥禒瀣厽闁归偊鍨伴惃鍝勵熆瑜庨惄顖炲蓟濞戙垹惟闁靛绠戞禒鎾倵濞堝灝鏋涙い顓犲厴瀵偊骞樼紒妯绘闂佽法鍣﹂幏锟�?闂傚倸鍊搁崐宄懊归崶褏鏆﹂柛顭戝亝閸欏繘鏌℃径瀣婵炲樊浜滈悡娑樏归敐鍥舵殰闁归鍏橀獮鎺楀即濡鐫忛梻浣告贡閸庛倝骞愭ィ鍐ㄥ偍闁圭儤鍨熼弨浠嬫煟濡鍤嬬�规悶鍎甸弻锝呂旈敓钘壩涘┑鍡╁殨闁归棿鐒﹂弲鎼佹煥閻曞倹瀚�?
	
	//final static long MAX_INVITE_TIMEOUT = 30*1000;//30s,濠电姷鏁告慨鐑藉极閹间礁纾婚柣妯款嚙缁犲灚銇勮箛鎾搭棞缂佽翰鍊濋弻娑㈠箻濡わ拷閸燁偊鎮樻繝鍥ㄧ厵闁稿繗鍋愰弳姗�鏌涢弬璺ㄧ劯鐎殿喖鎲＄粭鐔兼晸娴犲钃熼柡鍥ュ灩闁卞洦绻濋棃娑欑ォ婵☆偁鍊曢—鍐Χ閸屾稒鐝曢梺缁樻惈缁绘繈鎮伴锟藉浠嬧�栭妷銉╁弰妞ゃ垺顨婇弫鎾绘嚍閵夈倗绠氭繝闈涘�搁幉锟犳偂閵夆晜鐓熼柡鍐ㄥ�荤敮娑欍亜閵夈儺妲归柕鍥у楠炲鈹戦崶褎鐏庢俊銈囧Х閸嬫稓鎹㈠锟介獮鍐煛閸愵亞锛滃┑鈽嗗灥濡椼劑鎯�椤忓懍绻嗛柣鎰典簻閿熻姤鐗犻幃褍螖閸愵厼小婵炲濮撮鍛达綖閸涘瓨鐓忛柛顐ｇ箖椤ョ娀鏌涘Ο缁樺�愭慨濠冩そ瀹曘劍绻濋崒姣挎洟姊洪崨濠勬噧闂佸府绲介悾鐑筋敍閻愯尙鍊為梺鍐叉惈閸熶即鏁嶅鍫熺厸濠㈣泛锕︽晶鎴︽煕閺傛寧鎹ｇ紒顔碱煼閹瑧鍠婃径瀣伓闁荤喐鐟ョ�氼厾澹曢幖浣圭厱閹兼番鍊栭悵顏嗙磼閸屾稑娴柡浣稿暣瀹曟帒鈽夊Ο鑽ゆ殶闂傚倷绀侀崯鍧楀箹椤愶附鏅濋柨婵嗘处椤洘鎱ㄥΔ瀣濠殿喖锕ら…宄扮暦閹烘垟鏋庨柟瀵稿Х閹藉矂姊绘担鐑樺殌闁搞倖鐗犻獮蹇涙晸閿燂拷?闂傚倸鍊搁崐宄懊归崶褏鏆﹂柛顭戝亝閸欏繘鏌℃径瀣婵炲樊浜滄儫闂佸疇妗ㄩ懗鍫曀囪閳规垿鍩ラ崱妤冧户闁荤媴鎷烽柨鏇炲�归崐鐢告煠閸濄儲鏆╃紒鐘插⒔閿熺晫鎳撴竟濠囧窗閺囩姾濮抽柤濮愬�楃壕濂告煥閻斿墎鐭欑�规洖宕埥澶娾枎閹存繂绠荤紓鍌氬�风粈渚�顢栭崼婵冩灃闁哄洨鍠撻々閿嬬箾閹寸偟鎳�濞存粍绮撻弫搴㈢節濮橆剛鍊為梺闈涱焾閸ㄨ櫣锟芥矮绮欏缁樻媴閼恒儳銆婇梺闈╃秶缁犳捇鐛箛娑欐櫢闁跨噦鎷�?
	private long now = 0L;//procedure闂傚倸鍊峰ù鍥敋瑜嶉湁闁绘垵顫曢敓钘夊�块、姘舵晸娴犲宓侀煫鍥ㄧ♁閺呮悂鏌ㄩ悤鍌涘?濠电姷鏁告慨鐑藉极閸涘﹥鍙忛柣銏犲閺佸﹪鏌″搴″箹缂佹劖顨婇弻鈥愁吋鎼粹�冲闂佽桨绀佺�氫即寮诲☉銏犵労闁告劗鍋撻鐟扳攽閻愬瓨灏い顓犲厴瀵鈽夊顐ｅ媰闂佸憡鎸嗘笟濠冨闁圭儤顨嗛悡鍐煟閻旂顥嬮弽锛勭磽娴ｈ櫣甯涚紒璇茬墕铻為柛鎰╁妷濡插牊绻涢崱妯曟垿鏁撻妷鈺傗拻濞达絽鎲＄拹锟犳煛閸滀礁浜濋柟渚垮姂楠炴﹢顢欓懖鈺佸绩濠电姰鍨奸崺鏍礉閺嶎厼鐤鹃柟闂寸劍閻撱儵鏌ｉ弴鐐诧拷鍦拷姘炬嫹?濠电姷鏁告慨鐑藉极閹间礁纾婚柣鎰惈閸ㄥ倿鏌涢锝嗙缂佺姴缍婇弻宥夊传閸曨偓鎷锋繝姘ワ拷鍛村蓟閵夛妇鍙嗛梺缁樻礀閸婂湱锟芥熬鎷�?缂傚倸鍊搁崐鐑芥嚄閸洘鎯為幖娣妼閻鏌涢幇闈涙殙濠㈣埖鍔曠粻濠氭煕閹捐尪鍏岄柣鎺戝悑缁绘繈濮�閿濆棛銆愬銈庡墲婵倝骞嗛弮鍫澪╅柕澹喛鎷烽悙鐑樷拺闂傚牊涓瑰☉銏犲窛妞ゆ牗绋掗惁鐐烘⒒閸屾艾锟藉嘲顪冮幒鏃�顫曟い鏂垮⒔娑撳秹鏌熷▎陇顕уú顓€�佸☉銏″�婚柛銉㈡櫇閳笺倝姊绘笟锟藉褏鎹㈤崼鐔奉嚤闁跨喍绮欓弻娑㈠Ψ椤旂厧顫╃紓浣哄珡閸曨厾顔曢悗鐧告嫹闁跨喍绮欓垾锕傚Υ閸濈窅re濠电姷鏁告慨鐑藉极閹间礁纾婚柣鎰惈閸ㄥ倿鏌涢锝嗙缂佺姴缍婇弻宥夊传閸曨剙娅ｉ梺绋胯閸旀垿寮婚敃锟借灒濞撴凹鍨遍埢鎾斥攽閻愬瓨灏い顓犲厴瀵鈽夊Ο鍏兼畷闂佽法鍠嶇划娆忕暦閹达附鍊烽柛婵嗗閸橀亶姊洪崷顓炲妺妞ゃ劌妫濆畷鎰版偨閸涘ň鎷婚梺鍓插亞閸犳捇鍩︽笟锟介弻娑㈡偄閸濆嫪妲愰梺鍝勭焿缂嶄線寮幇鏉块唶婵犲﹤鍟崕鎾剁磽閸屾瑦绁板瀛樻倐楠炴劖绻濆顒傤唵闂佸憡绋掑娆愬閻樼粯鐓曢柡鍥ュ妼婢т即鏌ㄩ悢鍑ゆ嫹閻斿壊浠╃紓浣介哺閹稿骞忛崨顖涘枂闁告洏鍔嶇�氬姊绘担鐑樺殌闁规祴鍓濈换娑欑節閸ャ劌浠掑銈嗘穿閹风兘鏌℃担瑙勫磳闁轰焦鎹囬弫鎾绘晸閿燂拷?
	Team team;
	
	@Override
	protected void process() {
		// protocol handle
		TeamManager.logger.debug("Enter: " + this.getClass());
		final long invitedRoleId = gnet.link.Onlines.getInstance().findRoleid(this);
		if (invitedRoleId < 0)
			return;	
		
		mkdb.Procedure resInviteP = new mkdb.Procedure()
		{

			@Override
			protected boolean process()
			{
				now = System.currentTimeMillis();
				//lock start
				//濠电姷鏁告慨鎾儉婢舵劕绾ч柛鏍ゅ墲鐎氳淇婇妶鍕妽闁告瑥绻橀弻鐔虹磼閵忕姵鐏嶉梺绋垮椤ㄥ懘濡撮幒鎴僵闁绘劦鍓欓鍫曟⒒娴ｇ瓔鍤冮柛顭戝灦閹偤鏁冮敓浠嬵敋閵夆晛绀嬫い鏍ㄦ皑閻わ拷婵＄偑鍊栫敮顏堝箯妞嬪函鎷峰▓鍨灈闁搞垺鐓￠垾鏃堝礃椤斿槈褔鏌涢埄鍐噧妞ゎ値鍛＜闁绘劦鍓氱欢鑼磼婢跺本鍤�闁伙絿鍏樺鎾偄閾忓湱妲囬梻浣规偠閸庮垶宕濈仦鍓ь浄闁宠桨璁查弨鑺ャ亜閺冨倻鎽傞柣鎺嶇矙閺屾稑螣閻樻彃顏い鈺傚絻闇夐柣鎾虫捣閹界娀鏌ｉ幘瀛樼闁宠鍨块幃鈺呭箵閹哄秶鏁栭梻浣侯焾鐎涒晠宕归崸妤�钃熼柣鏃傚帶缁�鍕煏閸繃顥滄い蹇ユ嫹?
				try
				{
				xbean.InviteInfo inviteInfo = xtable.Teaminvite.select(invitedRoleId);
				if(inviteInfo == null)
					return true;
				else if(!inviteInfo.getBeinginvited())
					return true;
				else if((now - inviteInfo.getInviting().getInvitetime()) > TeamManager.MAX_INVITE_TIMEOUT)
				{   //闂傚倸鍊搁崐鎼佸磹閹间礁纾瑰瀣椤愪粙鏌曢崼婵愭Ц缂佺媭鍨堕弻銊╂偆閸屾稑顏�?闂傚倸鍊搁崐宄懊归崶褏鏆﹂柛顭戝亝閸欏繘鏌℃径瀣婵炲樊浜滄儫闂佸疇妗ㄥù鍥箺閺囩喓绡�闁靛骏绲剧涵楣冩煟椤掞拷閵堟悂骞嗗畝鍕缂備焦顭囬崢鐢电磽閸屾瑩妾烽柛銊ョ秺瀵鈽夊杈╋紲濡炪倖鍔﹂崜姘憋拷姘炬嫹?
					inviteInfo.setBeinginvited(false);
					return true;
				}
				
				xbean.TeamInvite inviting = inviteInfo.getInviting();
				long inviterRoleId = inviting.getRoleid();
				Long inviterTeamId = null;
				if(inviting.getTeamid() > -1)
					inviterTeamId = inviting.getTeamid();
				int lockState = 0;
				if(agree == 1)
				{
					Long inviterclanfightid = xtable.Roleid2clanfightid.select(inviterRoleId);//濠电姷鏁告慨鐑藉极閸涘﹥鍙忛柣鎴濐潟閿熻棄鍊圭粋鎺旓拷锝庡亝濞呫垽姊洪懞銉冾亪藝椤栫偛姹查梺顒�绉甸悡銉╂煟閺冨倻甯涙い銉ヮ槺缁辨挸顓奸崪鍐惈濡ょ姷鍋涢崯顐ョ亽闁荤姴娲╃亸娆戠玻閻愮儤鈷戠憸鐗堝笒娴滀即鏌涘锟界粻鏍х暦濠靛鏅搁柨鐕傛嫹?闂傚倸鍊搁崐宄懊归崶褏鏆﹂柛顭戝亝閸欏繘鏌℃径瀣婵炲樊浜滄儫闂佸疇妗ㄥù鍥箺閺囥垺鈷戦悹鎭掑妼濞呮劙鏌熼崙銈嗗?闂傚倸鍊搁崐椋庣矆娓氾拷楠炲鍩勯崘顏嗘嚌濠德板�曢幊搴ㄥ磼閵娿儍褰掓偐瀹割喖鍓抽梺鍛婄懄濞叉﹢濡甸崟顖氱闁瑰瓨绻嶆禒楣冩⒑缂佹ɑ灏版繛鑼枛閹繝顢曢敃锟介悙濠傤渻鐎ｎ亪顎楅柛鈺佺焸濮婃椽宕ㄦ繛鎺濅邯楠炴顭ㄩ崨顕呮綗闂佸湱鍎ら〃鍛存儗濡や椒绻嗘い鏍ㄧ閹牏绱掓笟鍥ф灈閾绘牠鏌ｅ锟藉褎绂掑鍕╀簻闁瑰瓨绻冮崵锟介梺璇茬箲鐢�愁潖閾忓湱纾兼俊顖濇娴犵顪冮妶搴″箹婵炲樊鍙冮獮鍡涘礃椤忓棛锛滃┑鈽嗗灥閸嬫劙顢欓弴銏♀拺閻熸瑥瀚崕妤呮煕閵娿劋鍚柨鐔诲Г閻旑剟骞忛敓锟�? by changhao
					if (inviterclanfightid != null)
					{
						Long invitedclanfightid = xtable.Roleid2clanfightid.select(invitedRoleId);//濠电姷鏁告慨鐑藉极閸涘﹥鍙忛柣鎴濐潟閿熻棄鍊圭粋鎺旓拷锝庡亝濞呫垽姊洪懞銉冾亪藝椤栫偛姹查梺顒�绉甸悡銉╂煟閺冨倻甯涙い銉ヮ槺缁辨挸顓奸崪鍐惈濡ょ姷鍋涢崯顐ョ亽闁荤姴娲╃亸娆戠玻閻愮儤鐓熼煫鍥ㄦ礀娴狅箓鏌涙惔銈嗙彧缂佸倹甯熺粻娑㈠箼閸愨晛鐦滈梻渚�娼ч悧鍡椢涘Δ浣瑰弿鐟滃繒妲愰幒妤佸亹闁告劘灏欐导宀勬⒑鏉炴壆鍔嶉柟鐟版喘楠炴劖绻濋崘銊х獮濠碘槅鍨伴幖顐ｇ珶鐎ｎ喗鈷掑ù锝呮憸缁夌儤銇勯妷锔藉鞍缂佺粯鐩弫鎾寸鐎ｎ偆鍘靛銈嗘煥閸氬宕戦妷鈺傜厸濞达綀顫夊畷宀勬煛娴ｈ宕岄柡浣规崌閺佹捇鏁撻敓锟�?闂傚倸鍊搁崐椋庣矆娓氾拷楠炲鍩勯崘顏嗘嚌濠德板�曢幊搴ㄥ磼閵娿儍褰掓偐瀹割喖鍓抽梺鍛婄懄濞叉﹢濡甸崟顖氱闁瑰瓨绻嶆禒楣冩⒑缂佹ɑ灏版繛鑼枛閹繝顢曢敃锟介悙濠傤渻鐎ｎ亪顎楅柛鈺佺焸濮婃椽宕ㄦ繛鎺濅邯楠炴顭ㄩ崨顕呮綗闂佸湱鍎ら〃鍛存儗濡や椒绻嗘い鏍ㄧ閹牏绱掓笟鍥ф灈閾绘牠鏌ｅ锟藉褎绂掑鍕╀簻闁瑰瓨绻冮崵锟介梺璇茬箲鐢�愁潖閾忓湱纾兼俊顖濇娴犵顪冮妶搴″箹婵炲樊鍙冮獮鍡涘礃椤忓棛锛滃┑鈽嗗灥閸嬫劙顢欓弴銏♀拺閻熸瑥瀚崕妤呮煕閵娿劋鍚柨鐔诲Г閻旑剟骞忛敓锟�? by changhao
						if (!inviterclanfightid.equals(invitedclanfightid))
						{
			 			    MessageMgr.sendMsgNotify(inviterRoleId, 410022,  null);
			 			    MessageMgr.sendMsgNotify(invitedRoleId, 410031,  null);
			 			    return true;
						}
						else
						{
							xbean.ClanInfo claninfo = ClanUtils.getClanInfoById(inviterRoleId, true);
							if (claninfo == null)
							{
								return true;
							}
							
							xbean.ClanMemberInfo memberinfo = claninfo.getMembers().get(invitedRoleId);
							if (memberinfo == null)
							{
				 			    MessageMgr.sendMsgNotify(inviterRoleId, 410023,  null);
				 			    MessageMgr.sendMsgNotify(invitedRoleId, 410029,  null);
								return true;
							}
						}
					}
					else
					{
						Long invitedclanfightid = xtable.Roleid2clanfightid.select(invitedRoleId);//濠电姷鏁告慨鐑藉极閸涘﹥鍙忛柣鎴濐潟閿熻棄鍊圭粋鎺旓拷锝庡亝濞呫垽姊洪懞銉冾亪藝椤栫偛姹查梺顒�绉甸悡銉╂煟閺冨倻甯涙い銉ヮ槺缁辨挸顓奸崪鍐惈濡ょ姷鍋涢崯顐ョ亽闁荤姴娲╃亸娆戠玻閻愮儤鐓熼煫鍥ㄦ礀娴狅箓鏌涙惔銈嗙彧缂佸倹甯熺粻娑㈠箼閸愨晛鐦滈梻渚�娼ч悧鍡椢涘Δ浣瑰弿鐟滃繒妲愰幒妤佸亹闁告劘灏欐导宀勬⒑鏉炴壆鍔嶉柟鐟版喘楠炴劖绻濋崘銊х獮濠碘槅鍨伴幖顐ｇ珶鐎ｎ喗鈷掑ù锝呮憸缁夌儤銇勯妷锔藉鞍缂佺粯鐩弫鎾寸鐎ｎ偆鍘靛銈嗘煥閸氬宕戦妷鈺傜厸濞达綀顫夊畷宀勬煛娴ｈ宕岄柡浣规崌閺佹捇鏁撻敓锟�?闂傚倸鍊搁崐椋庣矆娓氾拷楠炲鍩勯崘顏嗘嚌濠德板�曢幊搴ㄥ磼閵娿儍褰掓偐瀹割喖鍓抽梺鍛婄懄濞叉﹢濡甸崟顖氱闁瑰瓨绻嶆禒楣冩⒑缂佹ɑ灏版繛鑼枛閹繝顢曢敃锟介悙濠傤渻鐎ｎ亪顎楅柛鈺佺焸濮婃椽宕ㄦ繛鎺濅邯楠炴顭ㄩ崨顕呮綗闂佸湱鍎ら〃鍛存儗濡や椒绻嗘い鏍ㄧ閹牏绱掓笟鍥ф灈閾绘牠鏌ｅ锟藉褎绂掑鍕╀簻闁瑰瓨绻冮崵锟介梺璇茬箲鐢�愁潖閾忓湱纾兼俊顖濇娴犵顪冮妶搴″箹婵炲樊鍙冮獮鍡涘礃椤忓棛锛滃┑鈽嗗灥閸嬫劙顢欓弴銏♀拺閻熸瑥瀚崕妤呮煕閵娿劋鍚柨鐔诲Г閻旑剟骞忛敓锟�? by changhao
						if (invitedclanfightid != null)
						{
							if (!invitedclanfightid.equals(inviterclanfightid))
							{
				 			    MessageMgr.sendMsgNotify(inviterRoleId, 410024,  null);
				 			    MessageMgr.sendMsgNotify(invitedRoleId, 410032,  null);	
				 			    return true;
							}				
						}
					}						
					
					PropRole inviterprop = new PropRole(inviterRoleId, true);
					if(inviterprop.getProperties().getCruise() > 0)
					{
						MessageMgr.sendMsgNotify(invitedRoleId, 162026, null);
						MessageMgr.sendMsgNotify(inviterRoleId, 162027, null);
						TeamManager.logger.info("CRespondInvite1:闂傚倸鍊搁崐鎼佸磹閹间礁纾瑰瀣椤愪粙鏌曢崼婵愭Ц缂佺媭鍨堕弻銊╂偆閸屾稑顏�?闂傚倸鍊搁崐宄懊归崶褏鏆﹂柛顭戝亝閸欏繘鏌℃径瀣婵炲樊浜滈悡娑樏归敐鍥舵殰闁归鍏橀獮鎺懳旀担闀愮敾闂傚倸鍊搁悧鍡涙偉閵忋倕鐐婇柕濠忛檮椤忕喖姊绘担鑺ョ《闁革綇绠撻獮蹇涙晸閿燂拷" + inviterRoleId + "闂傚倸鍊搁崐宄懊归崶褏鏆﹂柣銏㈩焾绾惧鏌ｉ幇顒佹儓缂侊拷閸曨厽鍠愰柣妤�鐗嗙粭鎺旂棯閹规劦鍤欓柍瑙勫灴閹晠宕ｆ径瀣�风紓浣哄亾閸庡磭绱炴繝鍥х畺婵°倕鎳忛弲鏌ュ箹缁櫢鎷烽幇浣规祰闂備浇顕х�涒晝鍠婂鍛殕闁归棿绀侀拑鐔烘喐瀹ュ缍栨繝闈涱儛閺佸棝鏌ㄩ悢鍓佺煓闁轰焦鎹囬幐濠冨緞瀹�锟芥闂備浇顕栭崹鏉棵洪銏犳瀬闁瑰墽绮弲鎼佹煥閻曞倹瀚�" + invitedRoleId + ",闂傚倸鍊搁崐鎼佸磹閹间礁纾瑰瀣椤愪粙鏌曢崼婵愭Ц缂佺媭鍨堕弻銊╂偆閸屾稑顏�?闂傚倸鍊搁崐宄懊归崶褏鏆﹂柛顭戝亝閸欏繘鏌℃径瀣婵炲樊浜滈悡娑樏归敐鍥舵殰闁归鍏橀獮鎺懳旀担闀愮敾闂傚倸鍊搁悧鍡涙偉閵忋倕绀嬫い鎰╁�楅悰顕�姊绘担鍝ョШ闁稿锕畷婊冾潩椤掑倹娈奸悗骞垮劚椤︿即鍩涢幋锔解拻闁割偆鍠嶇欢閬嶆煟閹烘鐣洪柡灞剧♁閹棃鍩ラ崱妤侇啀缂傚倷绶￠崳顖滃緤閸婄喓浜欏┑鐐舵彧缂嶏拷婵炲拑缍侀、娆撳即閵忊檧鎷洪柣鐔哥懃鐎氼剛绮堥崘鈺冪闁告侗鍠楃粈瀣殽閻愬樊妲虹紒顔界懄閹棃骞樼�涙ɑ婢戝┑锛勫亼閸婃牕螞娴ｈ鍙忛柕鍫濐槸绾惧綊鏌熼柇锕�寮炬繛鍫滅矙閺岋綁骞嬪┑鍥ь槱闁诲孩鐔幏锟�?,濠电姷鏁告慨鐑藉极閹间礁纾婚柣鎰惈閸ㄥ倿鏌涢锝嗙缂佺姳鍗抽弻娑樷攽閸曨偄濮㈤梺娲诲幗閹瑰洭寮婚敐澶婄闁挎繂妫Λ鍕磽娓氬﹥瀚归梺绋挎湰缁嬫帡宕ｈ箛鏂剧箚闁靛牆鎷嬮崕鎰版倵濮橆剛绉烘慨濠冩そ瀹曨偊宕熼鐘插Ы闂備胶鎳撻崵鏍箯閿燂拷?闂傚倸鍊搁崐宄懊归崶褏鏆﹂柛顭戝亝閸欏繘鏌℃径瀣婵炲樊浜堕弫鍥煏韫囨洖啸闁告繃顨婂缁樼瑹閸パ冾潻缂備礁顦遍弫璇茬暦閹达箑纾奸柣鎰嚟閸橀亶姊洪棃娑辨缂佽尪濮ゆ穱濠囧箰鎼存稐绨婚梺鍐叉惈椤戝棛锟芥熬鎷�?");
						return true;
					}
					
					PropRole invitedprop = new PropRole(invitedRoleId, true);
					if(invitedprop.getProperties().getCruise() > 0)
					{
						MessageMgr.sendMsgNotify(invitedRoleId, 162027, null);
						MessageMgr.sendMsgNotify(inviterRoleId, 162026, null);
						TeamManager.logger.info("CRespondInvite2:闂傚倸鍊搁崐鎼佸磹閹间礁纾瑰瀣椤愪粙鏌曢崼婵愭Ц缂佺媭鍨堕弻銊╂偆閸屾稑顏�?闂傚倸鍊搁崐宄懊归崶褏鏆﹂柛顭戝亝閸欏繘鏌℃径瀣婵炲樊浜滈悡娑樏归敐鍥舵殰闁归鍏橀獮鎺懳旀担闀愮敾闂傚倸鍊搁悧鍡涙偉閵忋倕鐐婇柕濠忛檮椤忕喖姊绘担鑺ョ《闁革綇绠撻獮蹇涙晸閿燂拷" + inviterRoleId + "闂傚倸鍊搁崐宄懊归崶褏鏆﹂柣銏㈩焾绾惧鏌ｉ幇顒佹儓缂侊拷閸曨厽鍠愰柣妤�鐗嗙粭鎺旂棯閹规劦鍤欓柍瑙勫灴閹晠宕ｆ径瀣�风紓浣哄亾閸庡磭绱炴繝鍥х畺婵°倕鎳忛弲鏌ュ箹缁櫢鎷烽幇浣规祰闂備浇顕х�涒晝鍠婂鍛殕闁归棿绀侀拑鐔烘喐瀹ュ缍栨繝闈涱儛閺佸棝鏌ㄩ悢鍓佺煓闁轰焦鎹囬幐濠冨緞瀹�锟芥闂備浇顕栭崹鏉棵洪銏犳瀬闁瑰墽绮弲鎼佹煥閻曞倹瀚�" + invitedRoleId + ",闂傚倸鍊搁崐鎼佸磹閹间礁纾瑰瀣椤愪粙鏌曢崼婵愭Ц缂佺媭鍨堕弻銊╂偆閸屾稑顏�?闂傚倸鍊搁崐宄懊归崶褏鏆﹂柛顭戝亝閸欏繘鏌℃径瀣婵炲樊浜滈悡娑樏归敐鍥舵殰闁归鍏橀獮鎺懳旀担闀愮敾闂傚倸鍊搁悧鍡涙偉閵忋倕绀嬫い鎰╁�楅悰顕�姊绘担鍝ョШ闁稿锕畷婊冾潩椤掑倹娈奸悗骞垮劚椤︿即鍩涢幋锔解拻闁割偆鍠嶇欢閬嶆煟閹烘鐣洪柡灞剧♁閹棃鍩ラ崱妤侇啀缂傚倷绶￠崳顖滃緤閸婄喓浜欏┑鐐舵彧缂嶏拷婵炲拑缍侀、娆撳即閵忊檧鎷洪柣鐔哥懃鐎氼剛绮堥崘鈺冪闁告侗鍠楃粈瀣殽閻愬樊妲虹紒顔界懄閹棃骞樼�涙ɑ婢戝┑锛勫亼閸婃牕螞娴ｈ鍙忛柕鍫濐槸绾惧綊鏌熼柇锕�寮炬繛鍫滅矙閺岋綁骞嬪┑鍥ь槱闁诲孩鐔幏锟�?,濠电姷鏁告慨鐑藉极閹间礁纾婚柣鎰惈閸ㄥ倿鏌涢锝嗙缂佺姳鍗抽弻娑樷攽閸曨偄濮㈤梺娲诲幗閹瑰洭寮婚敐澶婄闁挎繂妫Λ鍕磽娓氬﹥瀚归梺绋挎湰缁嬫帡宕ｈ箛鏂剧箚闁靛牆鎷嬮崕鎰版倵濮橆剛绉烘慨濠冩そ瀹曨偊宕熼鐘插Ы闂備胶鎳撻崵鏍箯閿燂拷?闂傚倸鍊搁崐宄懊归崶褏鏆﹂柛顭戝亝閸欏繘鏌℃径瀣婵炲樊浜堕弫鍥煏韫囨洖啸闁告繃顨婂缁樼瑹閸パ冾潻缂備礁顦遍弫璇茬暦閹达箑纾奸柣鎰嚟閸橀亶姊洪棃娑辨缂佽尪濮ゆ穱濠囧箰鎼存稐绨婚梺鍐叉惈椤戝棛锟芥熬鎷�?");
						return true;
					}
					
					if(checkInviteFromTeam(inviterTeamId))
					{
						//闂傚倸鍊搁崐鎼佸磹妞嬪海鐭嗗〒姘炬嫹妤犵偞鐗犻、鏇氱秴闁搞儺鍓﹂弫鍥煏韫囨洖啸闁挎稓鍠栧娲捶椤撯剝顎楅梺鍝ュУ閻楃姴鐣烽妷褎鍠嗛柛鏇ㄥ幘閻﹀牊绻濋悽闈浶㈤柛濠勭帛閺呰泛鈽夐姀锛勫帗闂備礁鐏濋鍡楃暦瀹�鍕厸鐎癸拷鐎ｎ剛袦閻庢鍣崜鐔风暦瑜版帩鏁嬮柛娑卞枟椤旀垹绱撻崒姘拷椋庢閵堝绠�瑰嫭澹嬮弨浠嬫煟濡搫绾у璺哄閺岋綁骞樼捄鐑樼亪闂佸搫鏈ú妯兼崲濞戙垹鍨傛い鏃傚帶椤挻淇婇悙顏勶拷鏇灻瑰璺虹煑闁告劦鍠栭拑鐔哥箾閹寸偟鎳呯紒鈽呮嫹闂備胶顭堢悮顐﹀磹閺囥垹绀堥柟鎯板Г閳锋垹鎲搁悧鍫濅刊婵☆偅鍨甸埞鎴︽倻閸ャ劌顏堕梺璇叉唉椤煤濮楋拷閹兘鍩￠崒娆戠畾闂佸壊鍋呭ú鏍倷婵犲洦鐓冮柛婵嗗閺�濠氬疮閹间焦鈷掗柛灞捐壘閿熻姤鎮傚畷鎰槹鎼达絿鐒兼繛鎾寸啲閹峰嘲鈹戦敓鐘虫锭閾伙絿绱撴担璇＄劷缂佸娉涢埞鎴︽倷鐎涙ê纰嶉梺鍦櫕閻椾粙姊婚崒姘拷鎼佸磹閻戣姤鍊块柨鏃�鎷濋幏椋庣箔濞戞ɑ鍣介柣顓熺懇閺岀喐娼忔ィ鍐╊�嶉梺绋垮椤ㄥ﹪寮诲☉姘勃缂備降鍨瑰▓濂告⒑閹稿海绠撴い锔垮嵆瀵彃鈹戠�ｎ偆鍘遍柣蹇曞仜婢т粙鍩㈤幘缁樼厵鐎瑰嫭澹嗙粔鐑樻叏婵犲啯銇濈�规洘绮撻幊鐘活敆閿熺晫鏁妷鈺傗拺闁告縿鍎辨牎濡炪們鍔岄悧鎾诲极閹剧粯鍤嶉柕澹本娈归梻浣虹帛閹碱偆鎹㈠┑瀣祦闁告劦浜濆畷澶娿�掑鐓庣仭闁稿秶鏁诲铏圭磼濡纰嶇紓浣靛妼閵堢鐣烽悧鍫㈢瘈闁搞儯鍔夐幏铏圭磽娴ｅ壊鍎忛悘蹇撴噹椤斿繘濡烽敂杞扮盎闂佺懓鐡ㄧ换鍐窗濡椿娈介柣鎰皺缁犲鏌熼瑙勬珖缂佽鲸甯掕灒閺夌偞澹嗗Λ顖炴⒒閸屾瑦绁版繛澶嬫礋瀹曟娊鏁冮崒姘鳖唵闂佽法鍣﹂幏锟�??
						lockState = 3;
					}
					else
					{
						//闂傚倸鍊搁崐鎼佸磹妞嬪海鐭嗗〒姘炬嫹妤犵偞鐗犻、鏇氱秴闁搞儺鍓﹂弫鍥煏韫囨洖啸闁挎稓鍠栧娲捶椤撯剝顎楅梺鍝ュУ閻楃姴鐣烽妷褎鍠嗛柛鏇ㄥ幘閻﹀牊绻濋悽闈浶㈤柛濠冩倐椤㈡棃顢曢敂鐣屽帗缂傚倷鐒﹁摫闁抽攱鍔欓弻鏇㈠炊瑜嶉顒傜磼閻樺磭娲存鐐达耿閹煎綊顢曢敐搴℃暭闂傚倸鍊烽悞锕�顪冮幐搴ｎ洸婵炲棙鍨甸崹婵囩箾閸℃ɑ灏柦鍐枛閺屻劌鈹戦崱鈺傂﹂柟顖滃枛濮婃椽妫冨☉杈ㄐら梺绋挎捣閸庛倗锟介潧銈稿畷姗�顢欑憴锝嗗缂傚倷绀侀鍛焊閸涱収鍟呴柕澶涜礋娴滄粓鏌熺�涙绠栭柛鐘成戦〃銉╂倷閼碱剛顔掗梺璇″枓閺呮繈骞忛悩缁樺殤妞ゆ帒顦拌ⅸ闂傚倸鍊风欢姘焽瑜旈幃褔宕卞鏇熸そ婵℃悂鍩炶濞差參銆佸鑸垫櫢闁芥ê顦藉鏍煕濠靛棗鈻曢柧蹇氼潐婵偐锟借娲栧ú銊モ枖閹稿簼绻嗛柣鎰典簻閿熻姤鐗犲畷褰掓濞淬垺妞介、姗�濮�閳ュ厖绮ф俊鐐�栧ú鈺呭箯妞嬪函鎷风憴鍕闁绘牕銈搁妴浣肝旈崨顔芥婵炲濮撮鍛不閺屻儲鐓曟い鎰剁稻缁�鍐煟閹惧磭绠伴柍瑙勫灴閹晠鎳犻鍌ゅ晪婵犵绱曢搹搴ㄥ窗濮樿鲸顫曢柟鐑橆殕閸嬫劙鏌涢幇顒�绾ч悹鍥╁仱濮婃椽宕崟顓犲姽缂備胶绮换鍌炴偩瀹勯偊娼ㄩ柨鐔剁矙閵嗕線寮崼婵堫槹闂侀潧顭俊鍥晸閻ｅ苯顣肩紒缁樼箓椤曘儵寮搁顫嫹閵堝鍚归悗锝庡枟閳锋帡鏌涢弴銊ヤ簻妞ゅ浚鍋婇弻銊╂偄閻戞ɑ鐝銈忕秵閸ｏ綁鐛箛娑欐櫢闁跨噦鎷�?
						inviterTeamId = xtable.Roleid2teamid.select(inviterRoleId);
						if(inviterTeamId!= null)
						{//闂傚倸鍊搁崐鎼佸磹妞嬪海鐭嗗〒姘炬嫹妤犵偞鐗犻、鏇㈡晜閽樺缃曢梻浣虹《閸撴繈鎽傜�ｎ喖鐐婃い鎺嶇贰濡啫鈹戦悙宸殶妞ゆ帟灏欑槐鐐寸瑹閿熻棄顕ｉ锕�纾奸柣鎰綑閻у嫭绻濋姀锝呯厫闁挎碍绻涢崼婵勫仮闁哄矉绲鹃幆鏃堟晬閸曨厽娈梻浣侯焾濮橈附绂嶉鍕闁靛繈鍊曠粻鎶芥煛閸愩劌锟藉鎮為崗鑲╃瘈闁靛骏绲介悡鎰版煕閺冿拷閻楃娀骞冮敓鐘冲亜闁硅偐鍋樼花濠氭椤愩垺澶勯柟鍛婃倐椤㈡棃骞橀鐣屽幈闁瑰吋鐣崹瑙勬叏閸劲搴ㄥ炊瑜濋煬顒傦拷瑙勬穿缁叉儳顕ラ崟顓ㄦ嫹閿濆簼鎮嶉柟椋庡厴楠炲洭顢氶崱妯侯伓闁荤喐鐟ョ�氼厾澹曢幖浣圭厱閹艰揪绲鹃弳顒傦拷娈垮櫘閸嬪﹤鐣烽幒妤佸�烽柡澶嬪灦閻ゅ懘姊绘笟锟藉褔藝娴兼潙绀夌憸蹇曞垝婵犳艾绠婚柟棰佺劍缂嶅孩绻濋悽闈浶ｉ柤鐟板⒔缁牓宕橀埞澶哥盎闂婎偄娲﹂幐鎼侇敂椤忓牊鐓熼煫鍥ㄦ尵婢э附鎱ㄦ繝鍐┿仢鐎规洦鍋婂畷鐔碱敆婵犲嫬绐涢梻鍌欒兌閹虫捇宕甸弽顓炵闁跨噦鎷�
							lockState = 3;//闂傚倸鍊搁崐鎼佸磹閹间礁纾瑰瀣捣閻棗銆掑鐐婵犵绻濆褑鐏掔紓鍌欑劍椤洨绮旂捄琛℃斀闁绘劕鐡ㄧ亸顓㈡煙閻ｅ瞼澹楅梻鍌氬�搁崐鎼佸磹閻戣姤鍊块柨鏃�鎷濋幏椋庣箔濞戞ɑ鍣介柣顓熺懇閺岀喐娼忔ィ鍐╊�嶉梺绋垮椤ㄥ﹪寮诲☉姘勃缂備降鍨瑰▓濂告⒑閹稿海绠撴い锔垮嵆瀵彃鈹戠�ｎ偆鍘遍柣蹇曞仜婢т粙鍩㈤幘缁樼厵鐎瑰嫭澹嗙粔鐑樻叏婵犲啯銇濈�规洘绮撻幊鐘活敆閿熺晫鏁妷鈺傗拺闁告縿鍎辨牎濡炪們鍔岄悧鎾诲极閹剧粯鍤嶉柕澹本娈归梻浣虹帛閹碱偆鎹㈠┑瀣祦闁告劦浜濆畷澶娿�掑鐓庣仭闁稿秶鏁诲铏圭磼濡纰嶇紓浣靛妼閵堢鐣烽悧鍫㈢瘈闁搞儯鍔夐幏铏圭磽娴ｅ壊鍎忛悘蹇撴噹椤斿繘濡烽敂杞扮盎闂佺懓鐡ㄧ换鍐窗濡椿娈介柣鎰皺缁犲鏌熼瑙勬珖缂佽鲸甯掕灒閺夌偞澹嗗Λ顖炴⒒閸屾瑦绁版繛澶嬫礋瀹曟娊鏁冮崒姘鳖唵闂佽法鍣﹂幏锟�??
						}
						else
						{//闂傚倸鍊搁崐鎼佸磹妞嬪海鐭嗗〒姘炬嫹妤犵偞鐗犻、鏇㈡晝閿熶粙鎮块锟介弻锝呂旈敓浠嬫偋韫囨洜涓嶅Δ锝呭暞閻撱儵鏌ｉ弮鍥跺殭鐞氭碍绻涢敐鍛悙闁挎洩绠撻獮蹇涙偐娓氼垱鈻屾繝纰夌磿閾忓酣宕抽敐澶婄畺婵°倕鎳忛崑銊╂⒒閸喓鈽夊ù鐘趁—鍐Χ閸℃ê纾╂繝銏㈡嚀閻楀繒鍒掔拠娴嬫闁靛繒濮村畵鍡涙⒑缂佹鎳曢柟鐑芥敱娣囧﹪鎳犻锟介崢瀛樻叏婵犲偆鐓肩�规洘甯掗埢搴ㄥ箣椤撶啘婊堟⒒娓氾拷濞佳兠洪敃鍌楋拷锕傚炊瑜夐弸搴ㄦ煏韫囨洖顎屾繛灏栨櫊閹銈﹂幐搴哗闂佹寧绋掗悷鈺呭蓟閿濆棙鍎熸い鏍ㄧ矌鏍￠梻浣告啞閹歌顫濋妸鈺傛櫢闁兼亽鍎抽。鑼拷鐧告嫹闁归棿绀侀拑鐔兼煥濠靛棭妲搁崶鎾椤愩垺澶勯柡灞诲姂椤㈡棃鏁撻敓锟�?闂傚倸鍊搁崐椋庣矆娓氾拷楠炲鍩勯崘顏嗘嚌濠德板�曢幊搴ㄥ磼閵娾晜鐓熼柨婵嗘噽閻掑潡鏌熷畡鏉挎Щ妞ゎ偅绻堥、姗�鎮╅幓鎺斿摋闂傚倷娴囬鏍窗濞戞ǚ鏋栨繛鎴緛缂嶆牗绻濋棃娑卞剱闁稿鍊块獮鏍拷娑欘焽缁犳捇鏌＄�ｎ亞澧︽慨濠勭帛閹峰懏绗熼婊冨Ъ闂備焦瀵уú蹇涘磹濠靛锟戒線寮介鐐靛�炲銈嗗釜閹烽绱掗悪锟介崹鍫曞蓟閿濆憘鐔兼嚃閳轰胶顐奸梻浣侯焾椤戞劖绂嶉鍫濊摕闁靛ň鏅滈崑鍡涙煕鐏炲墽鈽夋い蹇ユ嫹??
							lockState = 2;
						}
					}
				}
				else
				{//闂傚倸鍊搁崐鎼佸磹妞嬪海鐭嗗〒姘炬嫹妤犵偛顦甸弫鎾绘偐閸愯弓鐢绘俊鐐�栭悧妤冪矙閹炬眹锟藉懘宕ｆ径鍫滅盎闂婎偄娲﹂幐鐐櫠閺囩姷纾藉ù锝呭级濞呭﹪鏌＄仦璇插闁宠鍨垮畷鍗炍熸笟顖浶熼梻鍌欒兌椤牓顢栭崱娑欏亱婵°倕鎳庢闂佸憡娲﹂崹鎵不濞戙垺鐓曢柟鎹愬蔼閸忓矂鏌￠崱娆忊枅婵﹨娅ｉ幑鍕Ω閵夛妇浜炴繝纰樻閸嬪嫮锟芥矮鍗抽妴渚�寮介鐐靛�炲銈嗗釜閹烽绱掗悪锟介崹鍫曞蓟閿濆憘鐔兼嚃閳轰胶顐奸梻浣侯焾椤戞劖绂嶉鍫濊摕闁靛ň鏅滈崑鍡涙煕鐏炲墽鈽夋い蹇ユ嫹?闂傚倸鍊搁崐椋庣矆娓氾拷楠炲鍩勯崘顏嗘嚌濠德板�曢幊搴ㄥ垂閸岀偞鈷戞い鎺炴嫹缂佸鏁诲畷鎴﹀煛閸涱喚鍘藉銈呯箰閹峰寮搁敓绲lock
					lockState = 1;
				}
				
				switch (lockState)
				{
				case 1://闂傚倸鍊搁崐鎼佸磹妞嬪海鐭嗗〒姘炬嫹妤犵偛顦甸弫鎾绘偐閸愯弓鐢绘俊鐐�栭悧妤冪矙閹炬眹锟藉懘宕ｆ径鍫滅盎闂婎偄娲﹂幐鐐櫠閺囩姷纾藉ù锝呭级濞呭﹪鏌＄仦璇插闁宠鍨垮畷鍗炍熸笟顖浶熼梻鍌欒兌椤牓顢栭崱娑欏亱婵°倕鎳庢闂佸憡娲﹂崹鎵不濞戙垺鐓曢柟鎹愬蔼閸忓矂鏌￠崱娆忊枅婵﹨娅ｉ幑鍕Ω閵夛妇浜炴繝纰樻閸嬪嫮锟芥矮鍗抽妴渚�寮介鐐靛�炲銈嗗釜閹烽绱掗悪锟介崹鍫曞蓟閿濆憘鐔兼嚃閳轰胶顐奸梻浣侯焾椤戞劖绂嶉鍫濊摕闁靛ň鏅滈崑鍡涙煕鐏炲墽鈽夋い蹇ユ嫹?闂傚倸鍊搁崐椋庣矆娓氾拷楠炲鍩勯崘顏嗘嚌濠德板�曢幊搴ㄥ垂閸岀偞鈷戞い鎺炴嫹缂佸鏁诲畷鎴﹀煛閸涱喚鍘藉銈呯箰閹峰寮搁敓绲lock
					Long[] roleids1 = new Long[1];
					roleids1[0] = invitedRoleId;
					this.lock(mkdb.Lockeys.get(xtable.Locks.ROLELOCK,(Object[])roleids1));
					break;
				case 2://闂傚倸鍊搁崐鎼佸磹妞嬪海鐭嗗〒姘炬嫹妤犵偞鐗犻、鏇㈡晝閿熶粙鎮块锟介弻锝呂旈敓浠嬫偋韫囨洜涓嶅Δ锝呭暞閻撱儵鏌ｉ弮鍥跺殭鐞氭碍绻涢敐鍛悙闁挎洩绠撻獮蹇涙偐娓氼垱鈻屾繝纰夌磿閾忓酣宕抽敐澶婄畺婵°倕鎳忛崑銊╂⒒閸喓鈽夊ù鐘趁—鍐Χ閸℃ê纾╂繝銏㈡嚀閻楀繒鍒掔拠娴嬫闁靛繒濮村畵鍡涙⒑缂佹鎳曢柟鐑芥敱娣囧﹪鎳犻锟介崢瀛樻叏婵犲偆鐓肩�规洘甯掗埢搴ㄥ箣椤撶啘婊堟⒒娓氾拷濞佳兠洪敃鍌楋拷锕傚炊瑜夐弸搴ㄦ煏韫囨洖顎屾繛灏栨櫊閹銈﹂幐搴哗闂佹寧绋掗悷鈺呭蓟閿濆棙鍎熸い鏍ㄧ矌鏍￠梻浣告啞閹歌顫濋妸鈺傛櫢闁兼亽鍎抽。鑼拷鐧告嫹闁归棿绀侀拑鐔兼煥濠靛棭妲搁崶鎾椤愩垺澶勯柡灞诲姂椤㈡棃鏁撻敓锟�?闂傚倸鍊搁崐椋庣矆娓氾拷楠炲鍩勯崘顏嗘嚌濠德板�曢幊搴ㄥ磼閵娾晜鐓熼柨婵嗘噽閻掑潡鏌熷畡鏉挎Щ妞ゎ偅绻堥、姗�鎮╅幓鎺斿摋闂傚倷娴囬鏍窗濞戞ǚ鏋栨繛鎴緛缂嶆牗绻濋棃娑卞剱闁稿鍊块獮鏍拷娑欘焽缁犳捇鏌＄�ｎ亞澧︽慨濠勭帛閹峰懏绗熼婊冨Ъ闂備焦瀵уú蹇涘磹濠靛锟戒線寮介鐐靛�炲銈嗗釜閹烽绱掗悪锟介崹鍫曞蓟閿濆憘鐔兼嚃閳轰胶顐奸梻浣侯焾椤戞劖绂嶉鍫濊摕闁靛ň鏅滈崑鍡涙煕鐏炲墽鈽夋い蹇ユ嫹??
					Object[] roleids2 = new Object[2];
					if(inviterRoleId < invitedRoleId)
					{
						roleids2[0] = inviterRoleId;
						roleids2[1] = invitedRoleId;
					}
					else
					{
						roleids2[0] = invitedRoleId;
						roleids2[1] = inviterRoleId;
					}
					this.lock(mkdb.Lockeys.get(xtable.Locks.ROLELOCK, roleids2));
					break;

				case 3://闂傚倸鍊搁崐鎼佸磹閹间礁纾瑰瀣捣閻棗銆掑鐐婵犵绻濆褑鐏掔紓鍌欑劍椤洨绮旂捄琛℃斀闁绘劕鐡ㄧ亸顓㈡煙閻ｅ瞼澹楅梻鍌氬�搁崐鎼佸磹閻戣姤鍊块柨鏃�鎷濋幏椋庣箔濞戞ɑ鍣介柣顓熺懇閺岀喐娼忔ィ鍐╊�嶉梺鎼炲�栭崝鏍Φ閸曨垰鍐�妞ゆ劦婢�缁墎绱撴担鍝勵�岄柛銊ゅ嵆濠�渚�姊虹粙璺ㄧ闁告艾顑囩槐鐐哄箣閻樼數锛滈梺缁樼懃閹冲繒锟芥熬鎷�?闂傚倸鍊搁崐鎼佸磹妞嬪海鐭嗗〒姘炬嫹妤犵偞鐗犻、鏇㈡晜閽樺缃曢梻浣虹《閸撴繈鎽傜�ｎ喖鐐婃い鎺戭槹閺呪晜绻濋姀锝嗙【妞ゆ洘鐗犲畷鍫曞Ω閿旂瓔浠ч梻鍌欐祰濞夋洟宕抽敃鍌氱闁跨噦鎷�
					xbean.TeamInfo teamInfo = xtable.Team.get(inviterTeamId);
					if(teamInfo == null)
					{
						psend(invitedRoleId, new STeamError(TeamError.InviterTeamNotExist));
						TeamManager.logger.debug("FAIL:闂傚倸鍊搁崐鎼佸磹閹间礁纾瑰瀣椤愪粙鏌曢崼婵愭Ц缂佺媭鍨堕弻銊╂偆閸屾稑顏�?闂傚倸鍊搁崐宄懊归崶褏鏆﹂柛顭戝亝閸欏繘鏌℃径瀣婵炲樊浜堕弫鍥煏韫囨洖啸闁告繃顨婂缁樼瑹閸パ冾潻缂備礁顦顓熺珶閺囥垺鍤掗柕鍫濈箲鐎氳顨ラ悙鑼虎闁告梹纰嶉妵鍕晜閸喖绁悗瑙勬礃濞叉牠顢橀崗鐓庣窞閻庯綆鍓欓獮鍫ユ⒒娴ｅ憡鎯堟繛灞傚灲瀹曟繂鐣濋崟顒�锟藉爼鏌ㄥ☉妯侯仾闁稿鐗楃换婵嬫濞戞瑥绐涚紓浣哄█缁犳牠骞冨Δ鍛仺婵炲牐娉曢崝鎼佹煟閵忊晛鐏犲褍娴峰Σ鎰板箳閹惧磭绐為柣搴秵閸嬪嫰宕径鎰�甸悷娆忓缁�鍐煟閻斿弶娅婄�殿噮鍋勯鍏煎緞婵犲嫷妲规俊鐐�栭幐鐐垔鐎靛憡顫曢柡灞诲劜閳锋帒鈹戦悩鏌ヮ�楀ù婊勭矋缁绘稓鎷犺閻ｅ灚銇勯姀鈥冲摵妤犵偞锕㈤、娆撴嚃閳哄﹤鏁藉┑鐘茬棄閺夊尅鎷疯楠炲繘鎮滈懞銉у幐闁诲函缍�閸╂牜锟芥熬鎷�?,TeamId: "+inviterTeamId);
						return true;
					}
					team = new Team(inviterTeamId,false);
					Set<Long> roleids = team.getAllMemberIdSet();
					roleids.add(invitedRoleId);
					this.lock(mkdb.Lockeys.get(xtable.Locks.ROLELOCK, roleids));
					break;
				default:
					return true;
				}
				if(agree == 1){
				}
				PropRole prole = new PropRole(invitedRoleId, true);
				String invitedName = prole.getName();
				
				Long invitedTeamId = xtable.Roleid2teamid.get(invitedRoleId);
				if(!checkInviteExist(invitedRoleId))
				{
					//闂傚倸鍊搁崐鎼佸磹閹间礁纾瑰瀣椤愪粙鏌曢崼婵愭Ц缂佺媭鍨堕弻銊╂偆閸屾稑顏�?闂傚倸鍊搁崐宄懊归崶褏鏆﹂柛顭戝亝閸欏繘鏌℃径瀣婵炲樊浜滃洿婵犮垼娉涢敃銈囪姳閵夆晜鈷戦柛婵嗗椤箓鏌涙惔銈勫惈缂侇喖鐗撳畷鐔碱敍濞戞艾寮虫繝鐢靛仦閸ㄥ爼鏁嬪銈呮禋閸嬪棝鎯�椤忓牆绠氱憸瀣磻閵忋倖鐓熼柟鍨暙娴滄壆锟借娲栭悥鍏间繆閹间焦鏅滈柣鎰靛墻閸氬洭姊虹拠鎻掝劉缂佸甯為幑銏ゅ醇濠垫劖缍庡┑鐐叉▕娴滄粍瀵奸悩缁樼厱闁哄洢鍔屾禍婵囩箾閸喐銇濇慨濠呮閸栨牠寮撮悢鍝ュ絾闂備胶绮〃鍫熸叏閹绢喗鍋╅柣銈庡灛娴滃綊鏌熼悜妯烘闁冲搫鎳忛悡鍐煕濠靛棗顏╅柨鐔烘櫕椤牓鍩㈤幘宕囨殕闁告洦鍏橀幏娲⒑閸涘﹦鈽夐柨鏇畵閸╋附鎷呴崷顓狀啎闂佺绻楅崑鎰板箠閸ヮ剚鐓涘ù锝堫潐瀹曞矂鏌熺粙鍖℃敾鐎垫澘瀚灒闁告繂瀚ˉ鎰版⒒閸屾瑧顦︾紓宥咃躬钘熼柟鎯ь嚟缁犻箖鏌ㄩ悢鍓佺煓闁哄瞼鍠栭幐濠冨緞閹邦剙鍙婇柣搴ゎ潐濞叉鏁幒妞伙拷锕傚Ω閳轰礁绐涘銈嗘煥閸氬鎮橀敓浠嬫⒒閸屾艾锟藉嘲霉閸ヮ剦鏁嬬憸蹇涙晸閼恒儳鈻撻柡鍛箘閸掓帒鈻庨幘宕囶唺濠德板�撻悞锕�鈻嶉弬搴撴斀闁绘ê鐏氶弳鈺佲攽椤栨稒灏︽鐐茬箻閺屻劎锟斤絻鍔嬬花濠氭椤愩垺澶勯柟鍝ュ亾閺呰泛鈽夐姀锛勫幐闂佸憡绮堢粈浣规櫠閹绢喗鐓涢悘鐐插⒔椤吋銇勯敃浣圭彧濞ｅ洤锕、娑橆潩椤掑倸甯gal闂傚倸鍊搁崐鎼佸磹妞嬪海鐭嗗ù锝堟〃閻掑﹪鏌涘☉娆愮稇缂佺媭鍨堕弻銊╂偆閸屾稑顏�?
					TeamManager.logger.debug("FAIL:闂傚倸鍊搁崐鎼佸磹閹间礁纾瑰瀣椤愪粙鏌曢崼婵愭Ц缂佺媭鍨堕弻銊╂偆閸屾稑顏�?闂傚倸鍊搁崐宄懊归崶褏鏆﹂柛顭戝亝閸欏繘鏌℃径瀣婵炲樊浜滃洿婵犮垼娉涢敃銈囪姳閵夆晜鈷戦柛婵嗗椤箓鏌涙惔銈勫惈缂侇喖鐗撳畷鐔碱敍濞戞艾寮虫繝鐢靛仦閸ㄥ爼鏁嬪銈呮禋閸嬪棝鎯�椤忓牆绠氱憸瀣磻閵忋倖鐓熼柟鍨暙娴滄壆锟借娲栭悥鍏间繆閹间焦鏅滈柣鎰靛墻閸氬洭姊虹拠鎻掝劉缂佸甯為幑銏ゅ醇濠垫劖缍庡┑鐐叉▕娴滄粍瀵奸悩缁樼厱闁哄洢鍔屾禍婵囩箾閸喐銇濇慨濠呮閸栨牠寮撮悢鍝ュ絾闂備胶绮〃鍫熸叏閹绢喗鍋╅柣銈庡灛娴滃綊鏌熼悜妯烘闁冲搫鎳忛悡鍐煕濠靛棗顏╅柨鐔烘櫕椤牓鍩㈤幘宕囨殕闁告洦鍏橀幏娲⒑閸涘﹦鈽夐柨鏇畵閸╋附鎷呴崷顓狀啎闂佺绻楅崑鎰板箠閸ヮ剚鐓涘ù锝堫潐瀹曞矂鏌熺粙鍖℃敾鐎垫澘瀚灒闁告繂瀚ˉ鎰版⒒閸屾瑧顦︾紓宥咃躬钘熼柟鎯ь嚟缁犻箖鏌ㄩ悢鍓佺煓闁哄瞼鍠栭幐濠冨緞閹邦剙鍙婇柣搴ゎ潐濞叉鏁幒妞伙拷锕傚Ω閳轰礁绐涘銈嗘煥閸氬鎮橀敓浠嬫⒒閸屾艾锟藉嘲霉閸ヮ剦鏁嬬憸蹇涙晸閼恒儳鈻撻柡鍛箘閸掓帒鈻庨幘宕囶唺濠德板�撻悞锕�鈻嶉弬搴撴斀闁绘ê鐏氶弳鈺佲攽椤栨稒灏︽鐐茬箻閹粓鎳為妷褍寮抽梻浣虹帛濞叉牠宕愰崷顓ㄦ嫹濮樼偓瀚�,RoleId: "+invitedRoleId);
					return true;
				}
				if(agree == 1)
				{
					if (checkPvP(inviterRoleId, invitedRoleId) != 0) {
						return true;
					}

					if(!checkOnline(invitedRoleId))
					{
						//闂傚倸鍊搁崐宄懊归崶褏鏆﹂柣銏㈩焾绾惧鏌ｉ幇顒佹儓缂侊拷閸曨厽鍠愰柣妤�鐗嗙粭鎺旂棯閹规劦鍤欓柍瑙勫灴閹晠宕ｆ径瀣�风紓浣哄亾閸庡磭绱炴繝鍥х畺婵°倕鎳忛弲鏌ュ箹缁櫢鎷烽幇浣规祰闂備浇顕х�涒晝鍠婂鍛殕闁归棿绀侀拑鐔兼煥濠靛棭妲搁崶鎾椤愩垺澶勯柡灞诲姂椤㈡棃鏁撻敓锟�?闂傚倸鍊搁崐椋庣矆娓氾拷楠炲鍩勯崘顏嗘嚌濠德板�曢幊搴ｇ矆閸喓绠鹃柟瀛樼懃閻忣亪鏌涚�Ｑ冨⒉缂佺粯绻堝Λ鍐ㄢ槈閸楃偛澹夐梻浣虹帛閹歌煤閻旂厧钃熼柕濞炬櫅濡﹢鏌熺粙鍨劉闁稿孩鎸荤换婵堝枈濮楀牊瀚归柧蹇ｅ亜娴犳挳姊洪崫鍕拱闁烩晩鍨辨穱濠囧箚閹殿喚鏉搁梺鍝勫�归娆愬閿燂拷,闂傚倸鍊搁崐鎼佸磹瀹勬噴褰掑炊椤掑﹦绋忔繝銏ｆ硾椤戝洭銆呴幓鎹楀綊鎮╁顔煎壈缂佺偓鍎冲鈥愁嚕閸洖閱囨い鎰垫線缁ㄥ瓨绻涚�涙鐭婄紓宥咃躬瀵鈽夐姀鈺傛櫇闂佺粯蓱瑜板啯鎱ㄩ弴銏♀拺缂備焦锚闁叉粓鏌熼崙銈嗗?闂傚倸鍊搁崐宄懊归崶褏鏆﹂柛顭戝亝閸欏繘鏌℃径瀣婵炲樊浜滃洿婵犮垼娉涢敃銈囪姳閵夆晜鈷戦柛婵嗗椤箓鏌涙惔銈勫惈缂侇喖顭峰浠嬪Ω閵堝洨鐣鹃梻渚�娼ч悧鍡涘箠韫囨稑闂憸鐗堝笚閻撶喐銇勯幘璺烘珡婵炲牊绮撻弻锛勪沪閸撗勫垱濡炪們鍨哄ú鐔煎极閹版澘鐐婇柍鍝勫暙鐢捇姊婚崒娆愮グ鐎规洜鏁诲畷浼村箛閺夎法顔囬梺鍛婃寙閸曞灚缍楅梻浣告贡閸庛倝銆冮崨顖滀笉婵椴搁崰鎰版倵閿濆骸浜炴い鈺冨厴閺岀喖鎮滃Ο鐑╂嫽缂佺偓鍎抽崥瀣Φ閸曨垼鏁囬柣鏃堫棑椤戝倻绱撴担鍙夘潐闁归鍏樺缁樻媴閼恒儯锟藉啰绱掗敓鑺ユ媴閾忓湱鐓嬮悷婊呭鐢帞绮婚弽顓熺厪闁割偅绻嶅Σ鍝ョ棯閹冩倯缂佺粯绻冪换婵嬪磼濞戞﹩锟芥稑鈹戦檱鐏忔瑥锕㈤崸妾抏gal闂傚倸鍊搁崐鎼佸磹妞嬪海鐭嗗ù锝堟〃閻掑﹪鏌涘☉娆愮稇缂佺媭鍨堕弻銊╂偆閸屾稑顏�?
						TeamManager.logger.debug("FAIL:闂傚倸鍊搁崐宄懊归崶褏鏆﹂柣銏㈩焾绾惧鏌ｉ幇顒佹儓缂侊拷閸曨厽鍠愰柣妤�鐗嗙粭鎺旂棯閹规劦鍤欓柍瑙勫灴閹晠宕ｆ径瀣�风紓浣哄亾閸庡磭绱炴繝鍥х畺婵°倕鎳忛弲鏌ュ箹缁櫢鎷烽幇浣规祰闂備浇顕х�涒晝鍠婂鍛殕闁归棿绀侀拑鐔兼煥濠靛棭妲搁崶鎾椤愩垺澶勯柡灞诲姂椤㈡棃鏁撻敓锟�?闂傚倸鍊搁崐椋庣矆娓氾拷楠炲鍩勯崘顏嗘嚌濠德板�曢幊搴ｇ矆閸喓绠鹃柟瀛樼懃閻忣亪鏌涚�Ｑ冨⒉缂佺粯绻堝Λ鍐ㄢ槈閸楃偛澹夐梻浣虹帛閹歌煤閻旂厧钃熼柕濞炬櫅濡﹢鏌熺粙鍨劉闁稿孩鎸荤换婵堝枈濮楀牊瀚归柧蹇ｅ亜娴犳挳姊洪崫鍕拱闁烩晩鍨辨穱濠囧箚閹殿喚鏉搁梺鍝勫�归娆愬閿燂拷,闂傚倸鍊搁崐鎼佸磹瀹勬噴褰掑炊椤掑﹦绋忔繝銏ｆ硾椤戝洭銆呴幓鎹楀綊鎮╁顔煎壈缂佺偓鍎冲鈥愁嚕閸洖閱囨い鎰垫線缁ㄥ瓨绻涚�涙鐭婄紓宥咃躬瀵鈽夐姀鈺傛櫇闂佺粯蓱瑜板啯鎱ㄩ弴銏♀拺缂備焦锚闁叉粓鏌熼崙銈嗗?闂傚倸鍊搁崐宄懊归崶褏鏆﹂柛顭戝亝閸欏繘鏌℃径瀣婵炲樊浜滃洿婵犮垼娉涢敃銈囪姳閵夆晜鈷戦柛婵嗗椤箓鏌涙惔銈勫惈缂侇喖顭峰浠嬪Ω閵堝洨鐣鹃梻渚�娼ч悧鍡涘箠韫囨稑闂憸鐗堝笚閻撶喐銇勯幘璺烘珡婵炲牊绮撻弻锛勪沪閸撗勫垱濡炪們鍨哄ú鐔煎极閹版澘鐐婇柍鍝勫暙鐢捇姊婚崒娆愮グ鐎规洜鏁诲畷浼村箛閺夎法顔囬梺鍛婃寙閸曞灚缍楅梻浣告贡閸庛倝銆冮崨顖滀笉婵椴搁崰鎰版倵閿濆骸浜炴い鈺冨厴閺岀喖鎮滃Ο鐑╂嫽缂佺偓鍎抽崥瀣Φ閸曨垼鏁囬柣鏃堫棑椤戝倻绱撴担鍙夘潐闁归鍏樺缁樻媴閼恒儯锟藉啰绱掗煬鎻掞拷婵嬬嵁韫囨稒鏅搁柨鐕傛嫹?,RoleId: "+invitedRoleId);
					}
					/*else if(!checkInvitedStatus(invitedRoleId))
					{
						//闂傚倸鍊搁崐宄懊归崶褏鏆﹂柣銏㈩焾绾惧鏌ｉ幇顒佹儓缂侊拷閸曨厽鍠愰柣妤�鐗嗙粭鎺旂棯閹规劦鍤欓柍瑙勫灴閹晠宕ｆ径瀣�风紓浣哄亾閸庡磭绱炴繝鍥х畺婵°倕鎳忛弲鏌ュ箹缁櫢鎷烽幇浣规祰闂備浇顕х�涒晝鍠婂鍛殕闁归棿绀侀拑鐔兼煥濠靛棭妲搁崶鎾椤愩垺澶勯柡灞诲姂椤㈡棃鏁撻敓锟�?闂傚倸鍊搁崐椋庣矆娓氾拷楠炲鍩勯崘顏嗘嚌濠德板�曢幊搴ㄦ儗濡ゅ懎绠圭紒顔炬嚀閻忔娊鏌ㄥ┑鍡╂Ц缁绢叏鎷烽梻浣筋嚙缁绘鐣烽悽绋跨疇闁瑰墽鍎甸敓鏂ょ畵婵℃悂鍩℃担渚О婵＄偑鍊曠换鎰拷姘煎墮琚欓柛顐犲灮绾句粙鏌涚仦鍓ф噮闁告柨绉甸妵鍕Ω閵夛箑娈楅柦妯荤箞閺岋綁濮�閵忊晝鍔哥紓浣哄Х婵灚绌辨繝鍥ч柛娑卞枛濞呫倝姊虹粙娆惧剬闁哄懏绻堥弫鎾绘偩鐏炵虎浠ч梺褰掝棑閸忔﹢寮婚妸鈺傚亜闁告挷鑳堕悡鎾绘⒑鐠団�崇仩闁活剙銈搁弫鎾诲棘閵堝洨校闂佸摜濮甸〃濠囧春濞戙垹绠虫俊銈勮兌閸橀亶姊虹憴鍕凡闁告熬鎷风紓浣靛妼椤兘寮婚敍鍕舵嫹閿濆骸浜濋柍閿嬪姉缁辨帞绱掑Ο鍏煎垱閻庤娲栭妶鎼佸箖閵忊槅妲归幖瀛樼箘缁�澶愭⒒閸屾瑦绁版い鏇熺墵瀹曚即骞掑Δ锟介悿楣冩煟濡鍤欑紒鐘靛У缁绘繃绻濋崒婊冾杸闂佸搫鎳忛幃鍌炲蓟閵娾晜鍋嗛柛灞剧☉椤忥拷??
						//psend(invitedRoleId, new STeamError(TeamError.SelfInUnteamState));
						Message.psendMsgNotify(invitedRoleId, TeamManager.ERROR_MSG_SELF_CANT_IN_TEAM, null);
						TeamManager.logger.debug("FAIL:闂傚倸鍊搁崐宄懊归崶褏鏆﹂柣銏㈩焾绾惧鏌ｉ幇顒佹儓缂侊拷閸曨厽鍠愰柣妤�鐗嗙粭鎺旂棯閹规劦鍤欓柍瑙勫灴閹晠宕ｆ径瀣�风紓浣哄亾閸庡磭绱炴繝鍥х畺婵°倕鎳忛弲鏌ュ箹缁櫢鎷烽幇浣规祰闂備浇顕х�涒晝鍠婂鍛殕闁归棿绀侀拑鐔兼煥濠靛棭妲搁崶鎾椤愩垺澶勯柡灞诲姂椤㈡棃鏁撻敓锟�?闂傚倸鍊搁崐椋庣矆娓氾拷楠炲鍩勯崘顏嗘嚌濠德板�曢幊搴ㄦ儗濡ゅ懎绠圭紒顔炬嚀閻忔娊鏌ㄥ┑鍡╂Ц缁绢叏鎷烽梻浣筋嚙缁绘鐣烽悽绋跨疇闁瑰墽鍎甸敓鏂ょ畵婵℃悂鍩℃担渚О婵＄偑鍊曠换鎰拷姘煎墮琚欓柛顐犲灮绾句粙鏌涚仦鍓ф噮闁告柨绉甸妵鍕Ω閵夛箑娈楅柦妯荤箞閺岋綁濮�閵忊晝鍔哥紓浣哄Х婵灚绌辨繝鍥ч柛娑卞枛濞呫倝姊虹粙娆惧剬闁哄懏绻堥弫鎾绘偩鐏炵虎浠ч梺褰掝棑閸忔﹢寮婚妸鈺傚亜闁告挷鑳堕悡鎾绘⒑鐠団�崇仩闁活剙銈搁弫鎾诲棘閵堝洨校闂佸摜濮甸〃濠囧春濞戙垹绠虫俊銈勮兌閸橀亶姊虹憴鍕凡闁告熬鎷风紓浣靛妼椤兘寮婚敍鍕舵嫹閿濆骸浜濋柍閿嬪姉缁辨帞绱掑Ο鍏煎垱閻庤娲栭妶鎼佸箖閵忊槅妲归幖瀛樼箘缁�澶愭⒒閸屾瑦绁版い鏇熺墵瀹曚即骞掑Δ锟介悿楣冩煟濡鍤欑紒鐘靛У缁绘繃绻濋崒婊冾杸闂佸搫鎳忛幃鍌炲蓟閵娾晜鍋嗛柛灞剧☉椤忥拷??,RoleId: "+invitedRoleId);
					}*/
					else if(!checkInvitedTeamFuctionEnable(invitedRoleId))
					{
						//闂傚倸鍊搁崐宄懊归崶褏鏆﹂柣銏㈩焾绾惧鏌ｉ幇顒佹儓缂侊拷閸曨厽鍠愰柣妤�鐗嗙粭鎺旂棯閹规劦鍤欓柍瑙勫灴閹晠宕ｆ径瀣�风紓浣哄亾閸庡磭绱炴繝鍥х畺婵°倕鎳忛弲鏌ュ箹缁櫢鎷烽幇浣规祰闂備浇顕х�涒晝鍠婂鍛殕闁归棿绀侀拑鐔兼煥濠靛棭妲搁崶鎾椤愩垺澶勯柡灞诲姂椤㈡棃鏁撻敓锟�?闂傚倸鍊搁崐椋庣矆娓氾拷楠炲鍩勯崘顏嗘嚌濠德板�曢幊搴ㄥ垂閸岀偞鈷戞い鎺炴嫹缂佸鏁诲畷鎴﹀煛閸涱厾楠囬梺鍓插亝绾板秴鈻嶉崶鈺冩／闁硅鍔栭ˉ澶愭婢舵劖鐓ユ繝闈涙缁佲晠鏌ｉ幒鏂夸壕闁靛洤瀚粻娑㈡晲閸涱厾顔戝┑鐑囩到濞层倝鏁冮敃鍌氱闁绘ü璀﹀Σ楣冩⒑娴兼瑧鎮奸柡浣规倐閺佹捇宕愰悤浣圭秷濠电偛寮堕…鍥箲閵忋倕閱囬柕澶堝劤閻ｆ椽姊洪棃娑氱疄闁搞劏娅ｉ敓鑺ョ瀹�鎼佸蓟閻旇櫣纾兼俊顖濇閻熴劎绱撴担鍝勵�撶紒鎻掑⒔閹广垹鈹戠�ｎ偄浠洪梻鍌氱墛缁嬫劗鍒掗懜鐢电瘈闁靛骏绲剧涵鐐箾瀹割喖骞栭柣锝呭槻椤劑宕橀敐鍡樻澑闂備胶纭跺Σ鍛村矗閿熶粙鏌ㄩ悢缁橆棄闁诲繑绻堟俊鎾箳閹搭厽鍍甸梺缁樺姦閸撴瑩顢旈懜鍏哥箚闁靛牆娲ゅ暩闂佺顑嗙粙鎾跺垝閺冨洢浜归柟鐑樻煥缁侊箑鈹戦埥鍡楃仴婵炲拑缍佸鎶芥晝閸屾稓鍘遍梺闈涱槶閸ㄥ搫鈻嶉弮鍌滅＜闁规彃顑嗙�氾拷
						psend(invitedRoleId, new STeamError(TeamError.SelfTeamFunctionClose));
						TeamManager.logger.debug("FAIL:闂傚倸鍊搁崐宄懊归崶褏鏆﹂柣銏㈩焾绾惧鏌ｉ幇顒佹儓缂侊拷閸曨厽鍠愰柣妤�鐗嗙粭鎺旂棯閹规劦鍤欓柍瑙勫灴閹晠宕ｆ径瀣�风紓浣哄亾閸庡磭绱炴繝鍥х畺婵°倕鎳忛弲鏌ュ箹缁櫢鎷烽幇浣规祰闂備浇顕х�涒晝鍠婂鍛殕闁归棿绀侀拑鐔兼煥濠靛棭妲搁崶鎾椤愩垺澶勯柡灞诲姂椤㈡棃鏁撻敓锟�?闂傚倸鍊搁崐椋庣矆娓氾拷楠炲鍩勯崘顏嗘嚌濠德板�曢幊搴ㄥ垂閸岀偞鈷戞い鎺炴嫹缂佸鏁诲畷鎴﹀煛閸涱厾楠囬梺鍓插亝绾板秴鈻嶉崶鈺冩／闁硅鍔栭ˉ澶愭婢舵劖鐓ユ繝闈涙缁佲晠鏌ｉ幒鏂夸壕闁靛洤瀚粻娑㈡晲閸涱厾顔戝┑鐑囩到濞层倝鏁冮敃鍌氱闁绘ü璀﹀Σ楣冩⒑娴兼瑧鎮奸柡浣规倐閺佹捇宕愰悤浣圭秷濠电偛寮堕…鍥箲閵忋倕閱囬柕澶堝劤閻ｆ椽姊洪棃娑氱疄闁搞劏娅ｉ敓鑺ョ瀹�鎼佸蓟閻旇櫣纾兼俊顖濇閻熴劎绱撴担鍝勵�撶紒鎻掑⒔閹广垹鈹戠�ｎ偄浠洪梻鍌氱墛缁嬫劗鍒掗懜鐢电瘈闁靛骏绲剧涵鐐箾瀹割喖骞栭柣锝呭槻椤劑宕橀敐鍡樻澑闂備胶纭跺Σ鍛村矗閿熶粙鏌ㄩ悢缁橆棄闁诲繑绻堟俊鎾箳閹搭厽鍍甸梺缁樺姦閸撴瑩顢旈懜鍏哥箚闁靛牆娲ゅ暩闂佺顑嗙粙鎾跺垝閺冨洢浜归柟鐑樻煥缁侊箑鈹戦埥鍡楃仴婵炲拑缍佸鎶芥晝閸屾稓鍘遍梺闈涱槶閸ㄥ搫鈻嶉弮鍌滅＜闁规彃顑嗙�氾拷,RoleId: "+invitedRoleId);
					}
					else if(!checkInvitedInNoTeam(invitedTeamId))
					{
						//闂傚倸鍊搁崐宄懊归崶褏鏆﹂柣銏㈩焾绾惧鏌ｉ幇顒佹儓缂侊拷閸曨厽鍠愰柣妤�鐗嗙粭鎺旂棯閹规劦鍤欓柍瑙勫灴閹晠宕ｆ径瀣�风紓浣哄亾閸庡磭绱炴繝鍥х畺婵°倕鎳忛弲鏌ュ箹缁櫢鎷烽幇浣规祰闂備浇顕х�涒晝鍠婂鍛殕闁归棿绀侀拑鐔兼煥濠靛棭妲搁崶鎾椤愩垺澶勯柡灞诲姂椤㈡棃鏁撻敓锟�?闂傚倸鍊搁崐椋庣矆娓氾拷楠炲鍩勯崘顏嗘嚌濠德板�曢幊搴ㄥ磼閵娿儍褰掓偐瀹割喖鍓抽梺鍛婄懄濞叉﹢濡甸崟顖氱闁瑰瓨绻嶆禒楣冩⒑閹惰姤鏁遍悽顖ょ節瀵鈽夐姀鐘电杸闂佺绻愰幗婊堟儎鎼淬劍鈷戦柛婵嗗閸庡繒绱掓径濠傤暢婵″弶鍔欓獮鎺楀箻鐎靛摜肖闂備礁鐤囧銊ヮ渻閹烘垟鏌︽い蹇撴绾捐棄霉閿濆懎顥忛柛搴＄箲閵囧嫰鏁傞悙顒佹瘓闂侀潧妫旂粈渚�锝炲鍫熸櫢闁兼亽鍎扮换鍡樻叏濠靛棛鐒炬俊鍙夊劤椤啴濡惰箛姘煎悈缂備胶濮烽崹鎭杄gal闂傚倸鍊搁崐鎼佸磹妞嬪海鐭嗗ù锝堟〃閻掑﹪鏌涘☉娆愮稇缂佺媭鍨堕弻銊╂偆閸屾稑顏�?
						TeamManager.logger.debug("FAIL:闂傚倸鍊搁崐宄懊归崶褏鏆﹂柣銏㈩焾绾惧鏌ｉ幇顒佹儓缂侊拷閸曨厽鍠愰柣妤�鐗嗙粭鎺旂棯閹规劦鍤欓柍瑙勫灴閹晠宕ｆ径瀣�风紓浣哄亾閸庡磭绱炴繝鍥х畺婵°倕鎳忛弲鏌ュ箹缁櫢鎷烽幇浣规祰闂備浇顕х�涒晝鍠婂鍛殕闁归棿绀侀拑鐔兼煥濠靛棭妲搁崶鎾椤愩垺澶勯柡灞诲姂椤㈡棃鏁撻敓锟�?闂傚倸鍊搁崐椋庣矆娓氾拷楠炲鍩勯崘顏嗘嚌濠德板�曢幊搴ㄥ磼閵娿儍褰掓偐瀹割喖鍓抽梺鍛婄懄濞叉﹢濡甸崟顖氱闁瑰瓨绻嶆禒楣冩⒑閹惰姤鏁遍悽顖ょ節瀵鈽夐姀鐘电杸闂佺绻愰幗婊堟儎鎼淬劍鈷戦柛婵嗗閸庡繒绱掓径濠傤暢婵″弶鍔欓獮鎺楀箻鐎靛摜肖闂備礁鐤囧銊ヮ渻閹烘垟鏌︽い蹇撴绾捐棄霉閿濆懎顥忛柛搴㈢矒閺岀喖宕欓妶鍡楊伓?,RoleId: "+invitedTeamId);
					}
//					else if (fire.pb.buff.Module.existState(inviterRoleId, BuffConstant.StateType.STATE_INSTANCE_ZONE)) {
//						MessageMgr.sendMsgNotify(invitedRoleId, 160202, null);
//						TeamManager.logger.debug("CRespondInvite:闂傚倸鍊搁崐鎼佸磹閻戣姤鍤勯柛鎾茬閸ㄦ繃銇勯弽銊с�掗柣婵嗙埣閺岋繝宕堕妷銉т患闂佹眹鍊楅崑鎾舵崲濞戙垹绠ｆ繛鍡楃箳閸旀挳姊烘潪鎵槮闁挎洦浜濠氬Ω閳哄倸浜為梺绋挎湰缁嬫垿顢旈敓锟�(roleId=" + inviterRoleId+")invite濠电姷鏁告慨鐑藉极閸涘﹥鍙忓ù鍏兼綑閸ㄥ倿鏌ｉ幘宕囧哺闁哄鐗楃换娑㈠箣閻愰潧鏆￠梺鐟板槻閸㈡煡锝炲┑瀣拻閻庨潧鎲￠弲濂告⒒娴ｇ鎮戞俊鐐跺Г缁傚秹宕奸弴姗堟嫹娴ｈ倽鏃堝川椤撶媭妲规俊鐐�栭崝鎴﹀磹閵堝憘锝夋嚋閸忓摜绠氶梺缁樺姦娴滄粓鏁撻懞銉у⒌闁诡啫鍏炬棃宕橀鍡欏幆闂備礁婀遍崕銈夈�冮崨顖滀笉妞ゆ牜鍋為悡鏇熶繆閵堝懎鏆欏ù婊嗩潐娣囧﹪骞撻幒鏂库叺闂佸搫琚崝鎴﹀箖閵堝纾兼繛鎴烇供娴硷拷?,濠电姷鏁告慨鐑藉极閹间礁纾婚柣鎰惈閸ㄥ倿鏌涢锝嗙缂佺姳鍗抽弻娑樷攽閸曨偄濮㈤梺娲诲幗閹瑰洭寮婚敐澶婄闁挎繂妫Λ鍕磽娓氬﹥瀚归梺绋挎湰缁嬫劗鎹㈤崱妯镐簻闁哄秲鍔庣粻鎾趁瑰鍐╄础闁汇儺浜獮鍡氼槹闁稿鍨介弻锛勪沪閸撗勫垱閻庢鍠楅幐铏繆閹间礁唯鐟滃矂鎮芥繝姘厽闁绘劕顕崯鏌ユ煙閸戙倖瀚�");
//					}
					else if(inviting.getTeamid() > -1)
					{
						TeamManager.logger.debug("INFO:闂傚倸鍊搁崐鎼佸磹妞嬪海鐭嗗〒姘炬嫹妤犵偞鐗犻、鏇氱秴闁搞儺鍓﹂弫鍥煏韫囨洖啸闁挎稓鍠栧娲捶椤撯剝顎楅梺鍝ュУ閻楃姴鐣烽妷褎鍠嗛柛鏇ㄥ幘閻﹀牊绻濋悽闈浶㈤柛濠勭帛閺呰泛鈽夐姀锛勫帗闂備礁鐏濋鍡楃暦瀹�鍕厸鐎癸拷鐎ｎ剛袦閻庢鍣崜鐔风暦瑜版帩鏁嬮柛娑卞枟椤旀垹绱撻崒姘拷椋庢閵堝绠�瑰嫭澹嬮弨浠嬫煟濡搫绾у璺哄閺岋綁骞樼捄鐑樼亪闂佸搫鏈ú妯兼崲濞戙垹鍨傛い鏃傚帶椤挻淇婇悙顏勶拷鏇灻瑰璺虹煑闁告劦鍠栭拑鐔哥箾閹寸偟鎳呯紒鈽呮嫹闂備胶顭堢悮顐﹀磹閺囥垹绀堥柟鎯板Г閳锋垿鏌ｉ悢鍛婄凡婵炲牃鏅犻弻鐔煎礄閵堝棗顏�?,TeamId: "+inviterTeamId);
						//闂傚倸鍊搁崐鎼佸磹妞嬪海鐭嗗〒姘炬嫹妤犵偞鐗犻、鏇氱秴闁搞儺鍓﹂弫鍥煏韫囨洖啸闁挎稓鍠栧娲捶椤撯剝顎楅梺鍝ュУ閻楃姴鐣烽妷褎鍠嗛柛鏇ㄥ幘閻﹀牊绻濋悽闈浶㈤柛濠勭帛閺呰泛鈽夐姀锛勫帗闂備礁鐏濋鍡楃暦瀹�鍕厸鐎癸拷鐎ｎ剛袦閻庢鍣崜鐔风暦瑜版帩鏁嬮柛娑卞枟椤旀垹绱撻崒姘拷椋庢閵堝绠�瑰嫭澹嬮弨浠嬫煟濡搫绾у璺哄閺岋綁骞樼捄鐑樼亪闂佸搫鏈ú妯兼崲濞戙垹鍨傛い鏃傚帶椤挻淇婇悙顏勶拷鏇灻瑰璺虹煑闁告劦鍠栭拑鐔哥箾閹寸偟鎳呯紒鈽呮嫹闂備胶顭堢悮顐﹀磹閺囥垹绀堥柟鎯板Г閳锋垿鏌ｉ悢鍛婄凡婵炲牃鏅犻弻鐔煎礄閵堝棗顏�?
						xbean.TeamInfo teamInfo = xtable.Team.get(inviterTeamId);
						if(!checkInviterTeamExist(teamInfo))
						{
							//闂傚倸鍊搁崐鎼佸磹閹间礁纾瑰瀣椤愪粙鏌曢崼婵愭Ц缂佺媭鍨堕弻銊╂偆閸屾稑顏�?闂傚倸鍊搁崐宄懊归崶褏鏆﹂柛顭戝亝閸欏繘鏌℃径瀣婵炲樊浜堕弫鍥煏韫囨洖啸闁告繃顨婂缁樼瑹閸パ冾潻缂備礁顦顓熺珶閺囥垺鍤掗柕鍫濈箲鐎氳顨ラ悙鑼虎闁告梹纰嶉妵鍕晜閸喖绁悗瑙勬礃濞叉牠顢橀崗鐓庣窞閻庯綆鍓欓獮鍫ユ⒒娴ｅ憡鎯堟繛灞傚灲瀹曟繂鐣濋崟顒�锟藉爼鏌ㄥ☉妯侯仾闁稿鐗楃换婵嬫濞戞瑥绐涚紓浣哄█缁犳牠骞冨Δ鍛仺婵炲牐娉曢崝鎼佹煟閵忊晛鐏犲褍娴峰Σ鎰板箳閹惧磭绐為柣搴秵閸嬪嫰宕径鎰�甸悷娆忓缁�鍐煟閻斿弶娅婄�殿噮鍋勯鍏煎緞婵犲嫷妲规俊鐐�栭幐鐐垔鐎靛憡顫曢柡灞诲劜閳锋帒鈹戦悩鏌ヮ�楀ù婊勭矋缁绘稓鎷犺閻ｅ灚銇勯姀鈥冲摵妤犵偞锕㈤、娆撴嚃閳哄﹤鏁藉┑鐘茬棄閺夊尅鎷疯楠炲繘鎮滈懞銉у幐闁诲函缍�閸╂牜锟芥熬鎷�?
							psend(invitedRoleId, new STeamError(TeamError.InviterTeamNotExist));
							TeamManager.logger.debug("FAIL:闂傚倸鍊搁崐鎼佸磹閹间礁纾瑰瀣椤愪粙鏌曢崼婵愭Ц缂佺媭鍨堕弻銊╂偆閸屾稑顏�?闂傚倸鍊搁崐宄懊归崶褏鏆﹂柛顭戝亝閸欏繘鏌℃径瀣婵炲樊浜堕弫鍥煏韫囨洖啸闁告繃顨婂缁樼瑹閸パ冾潻缂備礁顦顓熺珶閺囥垺鍤掗柕鍫濈箲鐎氳顨ラ悙鑼虎闁告梹纰嶉妵鍕晜閸喖绁悗瑙勬礃濞叉牠顢橀崗鐓庣窞閻庯綆鍓欓獮鍫ユ⒒娴ｅ憡鎯堟繛灞傚灲瀹曟繂鐣濋崟顒�锟藉爼鏌ㄥ☉妯侯仾闁稿鐗楃换婵嬫濞戞瑥绐涚紓浣哄█缁犳牠骞冨Δ鍛仺婵炲牐娉曢崝鎼佹煟閵忊晛鐏犲褍娴峰Σ鎰板箳閹惧磭绐為柣搴秵閸嬪嫰宕径鎰�甸悷娆忓缁�鍐煟閻斿弶娅婄�殿噮鍋勯鍏煎緞婵犲嫷妲规俊鐐�栭幐鐐垔鐎靛憡顫曢柡灞诲劜閳锋帒鈹戦悩鏌ヮ�楀ù婊勭矋缁绘稓鎷犺閻ｅ灚銇勯姀鈥冲摵妤犵偞锕㈤、娆撴嚃閳哄﹤鏁藉┑鐘茬棄閺夊尅鎷疯楠炲繘鎮滈懞銉у幐闁诲函缍�閸╂牜锟芥熬鎷�?,TeamId: "+inviterTeamId);
						}
						else if(!checkTeamInvitingValid(teamInfo, invitedRoleId))
						{
							//闂傚倸鍊搁崐鎼佸磹閹间礁纾归柟闂寸绾惧綊鏌熼梻瀵割槮闁汇値鍠栭湁闁稿繐鍚嬬紞鎴犵磼閹邦収娈橀柨鐔绘缁犲秹宕曢崡鐏绘椽鏁冮崒锔剧◤闂佸搫娲㈤崹娲偂閻斿吋鐓欓梺顓ㄧ畱閺嬫盯鏌涢弬娆惧剶闁哄矉缍侀獮鎺楁倷閺夋埈浼�?闂傚倸鍊搁崐宄懊归崶褏鏆﹂柛顭戝亝閸欏繘鏌℃径瀣婵炲樊浜滃洿婵犮垼娉涢敃銈囪姳閵夆晜鈷戦柛婵嗗椤箓鏌涙惔銈勫惈缂侇喖鐗撳畷鐔碱敍濞戞艾寮虫繝鐢靛仦閸ㄥ爼鏁嬪銈呮禋閸嬪棝鎯�椤忓牆绠氱憸瀣磻閵忋倖鐓熼柟鍨暙娴滄壆锟借娲栭悥鍏间繆閹间焦鏅滈柣鎰靛墻閸氬洭姊虹拠鎻掝劉缂佸甯為幑銏ゅ醇濠垫劖缍庡┑鐐叉▕娴滄粍瀵奸悩缁樼厱闁哄洢鍔屾禍婵囩箾閸繃鎯堟い顏勫暣婵″爼宕卞Ο閿嬪闂備礁鎲″褰掋�冮崨顓炵カ闂備礁缍婇崑濠囧礈閿曞倹鍊甸柛顐ｆ礃閸婄敻鏌涢敂璇插箺閻忓繒娅漡al闂傚倸鍊搁崐鎼佸磹妞嬪海鐭嗗ù锝堟〃閻掑﹪鏌涘☉娆愮稇缂佺媭鍨堕弻銊╂偆閸屾稑顏�?
							TeamManager.logger.debug("FAIL:闂傚倸鍊搁崐鎼佸磹閹间礁纾归柟闂寸绾惧綊鏌熼梻瀵割槮闁汇値鍠栭湁闁稿繐鍚嬬紞鎴犵磼閹邦収娈橀柨鐔绘缁犲秹宕曢崡鐏绘椽鏁冮崒锔剧◤闂佸搫娲㈤崹娲偂閻斿吋鐓欓梺顓ㄧ畱閺嬫盯鏌涢弬娆惧剶闁哄矉缍侀獮鎺楁倷閺夋埈浼�?闂傚倸鍊搁崐宄懊归崶褏鏆﹂柛顭戝亝閸欏繘鏌℃径瀣婵炲樊浜滃洿婵犮垼娉涢敃銈囪姳閵夆晜鈷戦柛婵嗗椤箓鏌涙惔銈勫惈缂侇喖鐗撳畷鐔碱敍濞戞艾寮虫繝鐢靛仦閸ㄥ爼鏁嬪銈呮禋閸嬪棝鎯�椤忓牆绠氱憸瀣磻閵忋倖鐓熼柟鍨暙娴滄壆锟借娲栭悥鍏间繆閹间焦鏅滈柣鎰靛墻閸氬洭姊虹拠鎻掝劉缂佸甯為幑銏ゅ醇濠垫劖缍庡┑鐐叉▕娴滄繈宕戦弽顓熷�垫繛鎴烆仾椤忓牜鏁傞柨鐕傛嫹?,TeamId: "+inviterTeamId);
						}
						
						else if(!checkTeamNotFull(teamInfo)){
							MessageMgr.psendMsgNotify(invitedRoleId, 145740, null);
							//闂傚倸鍊搁崐宄懊归崶顒夋晪鐟滃繘鎳為柆宥嗗殐闁宠桨鑳剁粵蹇旂節閻㈤潧校闁绘棏鍓涚槐鐐哄冀瑜滈悢鍡涙煠閹间焦娑у┑顔兼喘閺岋箓宕橀鍕亪闂佸搫鐭夌紞浣割嚕椤掑嫬鍨傛い鏃囨閿熺瓔鍨跺娲箮閼恒儲鏆犻梺鍦嚀濞差厼顕ｆ繝姘櫜濠㈣泛锕ラˉ婵嬫⒑閸撹尙鍘涢柛锝庡櫍瀵娊濮�閵忋垻锛濇繛鎾磋壘閿曘儳锟芥俺顫夌换婵嬫偨闂堟刀銏犆归悡搴㈠殗闁诡喚鍏橀弻鍥晜閹冩辈闂傚倷绀侀幉鈩冪瑹濡ゅ懎鍌ㄩ柛蹇涙？缁诲棙绻涘顔荤凹闁抽攱鍨块弻娑樷攽閸℃浠惧銈冨劤婵烇拷闁哄本鐩幃鈺呭蓟閵夈儱鍙婃俊鐐�戦崹娲偡閵娧呬笉婵炴垶菤濡插牊淇婇婵嗕汗闁告﹩鍓欓埞鎴︽偐椤旇偐浼囧┑鐐差槹閻╊垶寮崘顔嘉ч柛顐ｈ壘瑜帮拷
							psend(invitedRoleId, new STeamError(TeamError.TeamFull));
							TeamManager.logger.debug("FAIL:闂傚倸鍊搁崐宄懊归崶顒夋晪鐟滃繘鎳為柆宥嗗殐闁宠桨鑳剁粵蹇旂節閻㈤潧校闁绘棏鍓涚槐鐐哄冀瑜滈悢鍡涙煠閹间焦娑у┑顔兼喘閺岋箓宕橀鍕亪闂佸搫鐭夌紞浣割嚕椤掑嫬鍨傛い鏃囨閿熺瓔鍨跺娲箮閼恒儲鏆犻梺鍦嚀濞差厼顕ｆ繝姘櫜濠㈣泛锕ラˉ婵嬫⒑閸撹尙鍘涢柛锝庡櫍瀵娊濮�閵忋垻锛濇繛鎾磋壘閿曘儳锟芥俺顫夌换婵嬫偨闂堟刀銏犆归悡搴㈠殗闁诡喚鍏橀弻鍥晜閹冩辈闂傚倷绀侀幉鈩冪瑹濡ゅ懎鍌ㄩ柛蹇涙？缁诲棙绻涘顔荤凹闁抽攱鍨块弻娑樷攽閸℃浠惧銈冨劤婵烇拷闁哄本鐩幃鈺呭蓟閵夈儱鍙婃俊鐐�戦崹娲偡閵娧呬笉婵炴垶菤濡插牊淇婇婵嗕汗闁告﹩鍓欓埞鎴︽偐椤旇偐浼囧┑鐐差槹閻╊垶寮崘顔嘉ч柛顐ｈ壘瑜帮拷,TeamId: "+inviterTeamId);
						}
						else if(isLeaderInDuel(teamInfo.getTeamleaderid()))
						{
							// 闂傚倸鍊搁崐鎼佸磹閹间礁纾归柟闂寸绾惧綊鏌熼梻瀵割槮闁汇値鍠栭湁闁稿繐鍚嬬紞鎴犵磼閹邦収娈滈柡灞革拷鎰佸悑閹肩补锟藉磭顔愭繝娈垮枦椤鎮￠垾鎰佹綎婵炲樊浜堕弫鍡涙煥閻旂儤娅曠紒顔芥楠炴﹢顢欓懖鈺婂敼闂備礁澹婇崑鍛哄锟介幃陇绠涢幘顖涙杸闂佺粯鍔樼亸娆愮閵忋倖鐓曢柡鍐挎嫹鐎癸拷閹间礁钃熼柨娑樺閹风兘鏁愰崼婵堝帿闁诲孩鑹剧紞濠傤潖婵犳艾纾兼繛鍡樺笒閸橈繝鏌ｈ箛鎾剁疄闁告梹鍨块悰顔跨疀濞戞瑦娅㈤梺璺ㄥ櫐閹凤拷? by changhao
							TeamManager.logger.debug("FAIL:闂傚倸鍊搁崐鎼佸磹閹间礁纾归柟闂寸绾惧綊鏌熼梻瀵割槮闁汇値鍠栭湁闁稿繐鍚嬬紞鎴犵磼閹邦収娈滈柡灞革拷鎰佸悑閹肩补锟藉磭顔愭繝娈垮枦椤鎮￠垾鎰佹綎婵炲樊浜堕弫鍡涙煥閻旂儤娅曠紒顔芥楠炴﹢顢欓懖鈺婂敼闂備礁澹婇崑鍛哄锟介幃陇绠涢幘顖涙杸闂佺粯鍔樼亸娆愮閵忋倖鐓曢柡鍐挎嫹鐎癸拷閹间礁钃熼柨娑樺閹风兘鏁愰崼婵堝帿闁诲孩鑹剧紞濠傤潖婵犳艾纾兼繛鍡樺笒閸橈繝鏌ｈ箛鎾剁疄闁告梹鍨块悰顔跨疀濞戞瑦娅㈤梺璺ㄥ櫐閹凤拷?,TeamId: "+inviterTeamId);
						}else if(checkMap(teamInfo.getTeamleaderid(), invitedRoleId)){
							//闂傚倸鍊搁崐鎼佸磹閹间礁纾归柟闂寸绾惧綊鏌熼梻瀵割槮闁汇値鍠栭湁闁稿繐鍚嬬紞鎴犵磼閹邦収娈橀柨鐔绘缁犲秹宕曢崡鐏绘椽鏁冮崒锔剧◤闂佸搫娲㈤崹娲偂閻斿吋鐓欓梺顓ㄧ畱婢ь垶鏌熼姘卞ⅵ闁哄矉缍侀、姗�鎮ゆ担鍦殾闂備線娼уú銈囷拷姘緲椤曪絾绂掔�ｎ�晝鎲告惔銊ラ棷闁靛／鍛紳婵炶揪缍佸褎淇婂ú顏呯厱婵°倓绀侀埢鏇狅拷娈垮枦椤曆囧煡婢舵劕顫呴柣妯兼暩濞煎姊绘担渚劸闁哄牜鍓熼、姘跺箻椤旂⒈娼婇梺闈涚墕濡盯宕㈤崡鐐╂斀闁绘劕寮堕ˉ婊呯磼缂佹ê鐏撮挊鐔兼煟閹邦剦鍤熺紒鐘荤畺閺屻倛銇愰幒鎴滃枈闂佹悶鍊栭悷鈺呭蓟瀹ュ洦瀚氶柟缁樺俯閸斿姊虹拠鈥崇仭婵☆偄鍟穱濠囧箹娴ｈ倽銊╂煥閺冨倸浜炬繝銏℃崌濮婂宕掑顒婃嫹妞嬪海鐭嗗〒姘炬嫹妤犵偞鐗犻、鏇㈡晝閿熺晫澹曢崷顓犵＝濞达綀鍋傞幋婵冩瀺闁绘ê鍘栫换鍡涙煏閸繃鍣洪柛锝呯秺閺屾盯濡搁妷銉嫹瑜版帒绠為柕濞垮剻閻旂厧绠伴幖杈剧祷閿熻姤鍔欓幃妤勩亹閹烘挷姘﹂梺鐟板殩閹凤拷?
							Team team = new Team(inviterTeamId,false);
							TeamManager.logger.debugWhileCommit("SUCC:闂傚倸鍊搁崐鎼佸磹閹间礁纾归柟闂寸绾惧綊鏌熼梻瀵割槮闁汇値鍠栭湁闁稿繐鍚嬬紞鎴犵磼閹邦収娈橀柨鐔绘缁犲秹宕曢崡鐏绘椽鏁冮崒锔剧◤闂佸搫娲㈤崹娲偂閻斿吋鐓欓梺顓ㄧ畱婢ь垶鏌熼姘卞ⅵ闁哄矉缍侀、姗�鎮ゆ担鍦殾闂備線娼уú銈囷拷姘緲椤曪絾绂掔�ｎ�晝鎲告惔銊ラ棷闁靛／鍛紳婵炶揪缍佸褎淇婂ú顏呯厱婵°倓绀侀埢鏇狅拷娈垮枦椤曆囧煡婢舵劕顫呴柣妯兼暩濞煎姊绘担渚劸闁哄牜鍓熼、姘跺箻椤旂⒈娼婇梺闈涚墕濡盯宕㈤崡鐐╂斀闁绘劕寮堕ˉ婊呯磼缂佹ê鐏撮挊鐔兼煟閹邦剦鍤熺紒鐘荤畺閺屻倛銇愰幒鎴滃枈闂佹悶鍊栭悷鈺呭蓟瀹ュ洦瀚氶柟缁樺俯閸斿姊虹拠鈥崇仭婵☆偄鍟穱濠囧箹娴ｈ倽銊╂煥閺冨倸浜炬繝銏℃崌濮婂宕掑顒婃嫹妞嬪海鐭嗗〒姘炬嫹妤犵偞鐗犻、鏇㈡晝閿熺晫澹曢崷顓犵＝濞达綀鍋傞幋婵冩瀺闁绘ê鍘栫换鍡涙煏閸繃鍣洪柛锝呯秺閺屾盯濡搁妷銉嫹瑜版帒绠為柕濞垮剻閻旂厧绠伴幖杈剧祷閿熻姤鍔欓幃妤勩亹閹烘挷姘﹂梺鐟板殩閹凤拷?(闂傚倸鍊搁崐鎼佸磹妞嬪海鐭嗗〒姘炬嫹妤犵偛顦甸弫鎾绘偐椤愵剚瀚归柨鏇炲�搁悙濠冦亜閹虹偞瀚圭紓浣瑰姈椤ㄥ﹪寮婚悢鍏肩劷闁挎洩鎷峰褍顭烽弻锝夊箳瀹ュ洨鐓撻梺鍝勭焿缂嶄焦鎱ㄩ敓浠嬫煟濡搫鏆遍柡鍡楃墦濮婅櫣绮欓崸妤婏拷妤冪磼婢跺﹦绉虹�殿喛顕ч埥澶愬閻樻彃绁梻渚�娼ч…鍫ュ磿閾忣偆顩锋い鎾卞灪閸嬬姵鎱ㄥ鍡楀箻缂佺姵鐗滅槐鎺旂磼濡皷妾ㄥ┑鐐靛帶缁绘﹢骞冨▎鎿冩晢闁跨喍绮欓、鏃堟晸閿燂拷?),TeamId: "+inviterTeamId);
							boolean ok = team.addNewMemberWithSP(invitedRoleId);
							//濠电姷鏁告慨鐑藉极閸涘﹥鍙忛柣鎴濐潟閿熻棄鍊圭粋鎺旓拷锝庡亝濞呫垽姊洪懞銉冾亪藝椤栫偛姹查梺顒�绉甸悡銉╂煟閺冨倻甯涙い銉ヮ槺缁辨挸顓奸崪鍐惈濡ょ姷鍋涢崯顐ョ亽闁荤姴娲╃亸娆戠玻閻愮儤鈷戠憸鐗堝笒娴滀即鏌涢幘瀵告创妞ゃ垺锚鐓ゆい蹇撴噳閹锋椽鎮峰鍛暭閻㈩垱甯楃粋宥嗗鐎涙鍘遍梺瑙勫劤椤曨參骞婇崶顒佺叆婵犻潧鐗嗘禒閬嶆煙椤旇娅囩紒杈ㄥ笒铻ｉ柣鎾抽缁犵偤姊婚崒姘肩叕闁稿瀚叅闁靛牆顦介弫鍕煕濞戞瑦缍戠紒锟芥径鎰叆闁哄喛鎷烽柛銊︾箘閹广垽宕卞☉娆忎化闂佹悶鍎卞ú銈夊箠閹版澘姹查柕鍫濐槹閸婂灚绻涢崼婵堜虎闁哄绋掗妵鍕敇閵忊剝鏆犳繛锝呮搐閿曨亪骞冮崸妤婃晬闁挎繂鏌婇鍡欑＝闁稿本鐟ㄩ崗灞解攽椤旂偓鏆柟顔惧厴閸╋繝宕ㄩ鈩冩啺闂備浇娉曢崰鎾存叏鐎靛摜鐭嗛悗锝庡枟閳锋帡鏌涢銈呮灁闁靛棙甯掗湁闁绘﹩鍋呭▍濠冩叏婵犲懏顏犻柟椋庡█閸ㄦ儳鐣烽崶锔藉煕缂傚倸鍊峰ù鍥春閺嶎厽鍤岄柟瑙勫姉娴滈亶姊绘担鑺ョ《闁革綇绠撻獮蹇涙晸閿燂拷?闂傚倸鍊搁崐宄懊归崶褏鏆﹂柣銏㈩焾缁愭鏌熼柇锕�鍔掓繛宸簻缁狅綁鏌ㄩ弮鍥棄闁跨喕妫勫锟犲蓟閵娾晛绫嶉柛銉厛濡嫰姊洪幖鐐插婵☆偄鍟村濠氭晲婢跺﹦顓洪梺缁樺灥濡盯宕濆畡閭︽富闁靛牆鍊瑰▍鍥煕韫囨棑鑰跨�殿喖顭烽崹鎯х暦閸ャ劍顔撴俊鐐�栧濠氬储瑜斿鎶芥偄閸忚偐鍘卞┑鈽嗗灥椤曆兠归鑺ュ弿濠电姴鍋嗛悡鑲╋拷瑙勬礃鐢帡锝炲┑瀣垫晢濞达綀顕栭崯锟介梻鍌氬�风粈渚�骞楀鍕弿闁汇垹鎲￠崑瀣煟濡儤鈻曢柛銈嗘礋閺岀喖骞嗛弶鍟冩捇鏌ｉ幒鏇炰汗闁跨喕妫勭粻宥夊磿闁秴绠犻柟鎵閸庢捇鏌涢弴銊ュ缂佺娀绠栧鍫曞醇濠靛棌鎸冮梺璇″枛閵堟悂寮婚敓鐘叉そ濞达綁鏅查崰濠囨⒑鐠団�虫灓闁轰礁顭峰顐﹀箻缂佹ɑ娅㈤梺璺ㄥ櫐閹凤拷 by changhao
							if (ok)
							{
								boolean iscruise = checkCruiseWhenInvited(invitedRoleId);
								if(iscruise){
									//闂傚倸鍊搁崐宄懊归崶褏鏆﹂柣銏㈩焾绾惧鏌ｉ幇顒佹儓缂侊拷閸曨厽鍠愰柣妤�鐗嗙粭鎺旂棯閹规劦鍤欓柍瑙勫灴閹晠宕ｆ径瀣�风紓浣哄亾閸庡磭绱炴繝鍥х畺婵°倕鎳忛弲鏌ュ箹缁櫢鎷烽幇浣规祰闂備浇顕х�涒晝鍠婂鍛殕闁归棿绀侀拑鐔兼煥濠靛棭妲搁崶鎾椤愩垺澶勯柡灞诲姂椤㈡棃鏁撻敓锟�?闂傚倸鍊搁崐椋庣矆娓氾拷楠炲鍩勯崘顏嗘嚌濠德板�曢幊搴ㄦ儗濡ゅ懏鐓ラ柣鏃傚劋濞呮洜绱掓潏銊ユ诞妤犵偛娲、妯款槼闁伙綁顥撶槐鎾存媴閾忕懓绗￠梺鐑╂櫓閸ㄥ爼鎮伴纰辨建闁跨喍绮欓獮鏍亹閹烘繃鏅濋梺鎸庣箓閹冲繘鎮楅悙顒傜瘈闁汇垽娼ф牎濡炪倖姊归悧鐘茬暦閺夎鏃堝川椤撶姷鏆梻浣侯焾閻ジ宕戦悢椋庢殼濞撴熬鎷烽柡灞诲姂閹倝宕掑☉姗嗕紦?,闂傚倸鍊搁崐鎼佸磹閻戣姤鍤勯柛顐ｆ磵閿熸枻绠撳畷濂稿閳ュ啿绨ラ梻浣稿閸嬩線宕曟潏鈺侇棜闁秆勵殕閳锋帡鏌涢銈呮瀻闁告鍏橀弻銊モ攽閸♀晜效闂佸搫鎳忕换鍫ュ蓟濞戞矮娌柛娆嶅劙鐎涒晠鎮跺顓犵疄婵﹨娅ｅ☉鐢稿川椤撗勵棈闂備浇顫夊鎸庣閻愬樊鍤楀┑鐘叉处閸ゅ嫭銇勯弽顭嬬厧效濡ゅ懏鍊甸柣褍鎲＄�氬綊姊洪崨濠冨闁告挻鐩畷銏ゅ础閻愨晜鏂�闁圭儤濞婂畷鎰板即閻欏懏瀚规慨妯煎帶瀵噣鏌熼鐐毈妞ゃ垺妫冨畷銊╊敍濠婂骸鏅梻鍌欑婢瑰﹪宕戦崨顖涘床闁告洦鍘炬稉宥囷拷瑙勬礀濞层劎澹曢崗绗轰簻闁哄啫鍊甸幏锟犳煕鎼淬垹濮嶉柟顔筋殜閹粙妫冨☉妯圭帛闂備礁鐤囬褔鏌婇敐澶屽祦閻庯綆鍠楅崑鎴︽煕濞戝崬鐏犵紒顭掓嫹
									new PAbsentReturnTeam(invitedRoleId, 1).call();
								} else {
									int ret = TeamManager.getInstance().execGotoLeader(invitedRoleId, team, true, 2);
									if (ret == 0)
									{
										xbean.Properties invitedprop = xtable.Properties.get(invitedRoleId);
										
										List<String> params = new ArrayList<String>();
										params.add(invitedprop.getRolename());
										fire.pb.talk.MessageMgr.sendMsgNotify(teamInfo.getTeamleaderid(), 160196 ,params);	
									}
								}
							}
							
							fire.pb.event.Poster.getPoster().dispatchEvent(new ArriveTeamSpecialQuestEvent(team.getTeamLeaderId(), invitedRoleId));
							
							return ok;
						}
					}
					else //闂傚倸鍊搁崐椋庣矆娓氾拷楠炴牠顢曚綅閸ヮ剦鏁冮柨鏇嫹闁汇倗鍋撶换婵囩節閸屾粌顤�闂佺顑戠换婵嬪蓟瀹ュ浼犻柛鏇ㄥ墮濞咃綁姊婚崒姘簽闁搞劌鐖煎濠氭晲婢跺﹦顓洪梺鎸庣箓濡厼螞閸曨垱鈷戦柛娑橈功閹冲啴鏌ㄩ弴妯哄姦濠碉紕鏁诲畷鐔碱敍濮橆剙鏁ら梻渚�娼ц噹闁告洦鍋呴悵顕�姊婚崒娆愮グ鐎规洜鏁诲畷浼村箛椤旇棄搴婇梺鍓插亖閸庡啿鐣垫笟锟介弻鈥愁吋鎼粹�插闂佺懓鍢查崲鏌ュ煡婢跺ň鏋嶉柧蹇ｅ亜閻忔挳鎸婇悢鍏肩厱闁斥晛鍙囧鍕洸婵犲﹤鐗婇悡娑㈡煕閵夈垺娅呴柡瀣⒐閵囧嫰鏁愰崨顓犻獓缂備胶绮惄顖炲箠濠靛鐒介柨鏇嫹婵炲牜鍙冨铏癸拷鍦У椤ュ銇勯敂璇茬仸闁糕斂鍨洪幆鏃堝Ω閵壯呮澑闂備胶绮〃鍛存偋濠婂牊鏅搁柤鎭掑劤婢у灚鎱ㄦ繝鍕笡闁瑰嘲鎳樺畷鐑筋敇閻旇鍗抽梻鍌欑閹诧繝寮婚妸鈺傚剶濠靛倸鎲￠弲鎼佹煠閹帒鍔ュ瑙勶耿閺岀喖鎳為妷褏鐓�闁告浜堕弻鐔兼焽閿曪拷閸樻挳鏌￠敓鑺ョ鐎ｎ偆鍘遍梺鐐藉劚绾绢厾绮婚弻銉︾厽闁规儳宕悘鍙夋叏婵犲啯銇濈�殿噮鍓熸俊鐑芥晜閻ｅ苯绲介梻鍌欑閹芥粓宕抽妷鈺佸瀭鐎规洖娲ら崹婵嗏攽閻樺疇澹樼紒鐘烘珪娣囧﹪濡堕崟顕呭敼闂佺懓鍢查…宄邦潖濞差亜宸濆┑鐘插�歌濠电偛鐡ㄧ划宥囧垝閹炬剚鍤曠紒瀣儥閸氬鏌涢妷銏℃珖闁挎稒绮撻弻鈩冨緞婵犲嫬顣甸梺鍝勬噺缁嬫帞绮嬮幒妤佹櫆闁告挆鍜冪床闂佽鍑界紞鍡樼鐠轰綍锝夊川婵炲じ绨婚梺鐟板⒔閸嬨劑宕戦姀顫嫹鐟欏嫭绀堥柛妯犲洤鐓橀柟杈剧畱楠炪垺淇婇妶鍛灓闁告艾鎳樺濠氬磼濮橆剨鎷烽幖浣哥９濡炲瀛╅浠嬫煏閸繍妲哥紒鐙�鍨堕弻銊╂偆閸屾稑顏�?闂傚倸鍊搁崐宄懊归崶褏鏆﹂柛顭戝亜閸ㄦ棃鏌熺紒銏犳灈缂佺媭鍨堕弻銊╂偆閸屾稑顏�? by changhao
					{
						TeamManager.logger.debug("INFO:闂傚倸鍊搁崐鎼佸磹妞嬪海鐭嗗〒姘炬嫹妤犵偞鐗犻、鏇氱秴闁搞儺鍓﹂弫鍥煏韫囨洖啸闁挎稓鍠栧娲捶椤撯剝顎楅梺鍝ュУ閻楃姴鐣烽妷褎鍠嗛柛鏇ㄥ幘閻﹀牊绻濋悽闈浶㈤柛濠冩倐椤㈡棃顢曢敂鐣屽帗缂傚倷鐒﹁摫闁抽攱鍔欓弻鏇㈠炊瑜嶉顒傜磼閻樺磭娲存鐐达耿閹煎綊顢曢敐搴℃暭闂傚倸鍊烽悞锕�顪冮幐搴ｎ洸婵炲棙鍨甸崹婵囩箾閸℃ɑ灏柦鍐枛閺屻劌鈹戦崱鈺傂﹂柟顖滃枛濮婃椽妫冨☉杈ㄐら梺绋挎捣閸庛倗锟介潧銈稿畷姗�顢欑憴锝嗗缂傚倷绀侀鍛焊閸涱収鍟呴柕澶涜礋娴滄粓鏌熺�涙绠栭柛鐘成戦〃銉╂倷閼碱剛顔掗梺杞扮劍閹瑰洭寮幘缁樻櫢闁跨噦鎷�?,inviterRoleId: "+inviterRoleId);
						//闂傚倸鍊搁崐鎼佸磹妞嬪海鐭嗗〒姘炬嫹妤犵偞鐗犻、鏇氱秴闁搞儺鍓﹂弫鍥煏韫囨洖啸闁挎稓鍠栧娲捶椤撯剝顎楅梺鍝ュУ閻楃姴鐣烽妷褎鍠嗛柛鏇ㄥ幘閻﹀牊绻濋悽闈浶㈤柛濠冩倐椤㈡棃顢曢敂鐣屽帗缂傚倷鐒﹁摫闁抽攱鍔欓弻鏇㈠炊瑜嶉顒傜磼閻樺磭娲存鐐达耿閹煎綊顢曢敐搴℃暭闂傚倸鍊烽悞锕�顪冮幐搴ｎ洸婵炲棙鍨甸崹婵囩箾閸℃ɑ灏柦鍐枛閺屻劌鈹戦崱鈺傂﹂柟顖滃枛濮婃椽妫冨☉杈ㄐら梺绋挎捣閸庛倗锟介潧銈稿畷姗�顢欑憴锝嗗缂傚倷绀侀鍛焊閸涱収鍟呴柕澶涜礋娴滄粓鏌熺�涙绠栭柛鐘成戦〃銉╂倷閼碱剛顔掗梺杞扮劍閹瑰洭寮幘缁樻櫢闁跨噦鎷�?
						if(!checkOnline(inviterRoleId))
						{
							// 闂傚倸鍊搁崐鎼佸磹閹间礁纾瑰瀣椤愪粙鏌曢崼婵愭Ц缂佺媭鍨堕弻銊╂偆閸屾稑顏�?闂傚倸鍊搁崐宄懊归崶褏鏆﹂柛顭戝亝閸欏繘鏌℃径瀣婵炲樊浜滄儫闂佸疇妗ㄥù鍥箺閺囥垺鈷戦悹鎭掑妼濞呮劙鏌熼崙銈嗗?闂傚倸鍊搁崐椋庣矆娓氾拷楠炲鍩勯崘顏嗘嚌濠德板�曢幊搴ｇ矆閸喓绠鹃柟瀛樼懃閻忣亪鏌涚�Ｑ冨⒉缂佺粯绻堝Λ鍐ㄢ槈閸楃偛澹夐梻浣虹帛閹歌煤閻旂厧钃熼柕濞炬櫅濡﹢鏌熺粙鍨劉闁稿孩鎸荤换婵堝枈濮楀牊瀚归柧蹇ｅ亜娴犳挳姊洪崫鍕拱闁烩晩鍨辨穱濠囧箚閹殿喚鏉搁梺鍝勫�归娆愬閿燂拷
							psend(invitedRoleId, new STeamError(TeamError.ObjectOffline));
							TeamManager.logger.debug("FAIL:闂傚倸鍊搁崐鎼佸磹閹间礁纾瑰瀣椤愪粙鏌曢崼婵愭Ц缂佺媭鍨堕弻銊╂偆閸屾稑顏�?闂傚倸鍊搁崐宄懊归崶褏鏆﹂柛顭戝亝閸欏繘鏌℃径瀣婵炲樊浜滄儫闂佸疇妗ㄥù鍥箺閺囥垺鈷戦悹鎭掑妼濞呮劙鏌熼崙銈嗗?闂傚倸鍊搁崐椋庣矆娓氾拷楠炲鍩勯崘顏嗘嚌濠德板�曢幊搴ｇ矆閸喓绠鹃柟瀛樼懃閻忣亪鏌涚�Ｑ冨⒉缂佺粯绻堝Λ鍐ㄢ槈閸楃偛澹夐梻浣虹帛閹歌煤閻旂厧钃熼柕濞炬櫅濡﹢鏌熺粙鍨劉闁稿孩鎸荤换婵堝枈濮楀牊瀚归柧蹇ｅ亜娴犳挳姊洪崫鍕拱闁烩晩鍨辨穱濠囧箚閹殿喚鏉搁梺鍝勫�归娆愬閿燂拷,inviterRoleId: "+inviterRoleId);
						}
						/*else if(!checkInviterStatus(inviterRoleId))
						{
							//闂傚倸鍊搁崐鎼佸磹閹间礁纾瑰瀣椤愪粙鏌曢崼婵愭Ц缂佺媭鍨堕弻銊╂偆閸屾稑顏�?闂傚倸鍊搁崐宄懊归崶褏鏆﹂柛顭戝亝閸欏繘鏌℃径瀣婵炲樊浜滄儫闂佸疇妗ㄥù鍥箺閺囥垺鈷戦悹鎭掑妼濞呮劙鏌熼崙銈嗗?闂傚倸鍊搁崐椋庣矆娓氾拷楠炲鍩勯崘顏嗘嚌濠德板�曢幊搴ㄦ儗濡ゅ懎绠圭紒顔炬嚀閻忔娊鏌ㄥ┑鍡╂Ц缁绢叏鎷烽梻浣筋嚙缁绘鐣烽悽绋跨疇闁瑰墽鍎甸敓鏂ょ畵婵℃悂鍩℃担渚О婵＄偑鍊曠换鎰拷姘煎墮琚欓柛顐犲灮绾句粙鏌涚仦鍓ф噮闁告柨绉甸妵鍕Ω閵夛箑娈楅柦妯荤箞閺岋綁濮�閵忊晝鍔哥紓浣哄Х婵灚绌辨繝鍥ч柛娑卞枛濞呫倝姊虹粙娆惧剬闁哄懏绻堥弫鎾绘偩鐏炵虎浠ч梺褰掝棑閸忔﹢寮婚妸鈺傚亜闁告挷鑳堕悡鎾绘⒑鐠団�崇仩闁活剙銈搁弫鎾诲棘閵堝洨校闂佸摜濮甸〃濠囧春濞戙垹绠虫俊銈勮兌閸橀亶姊虹憴鍕凡闁告熬鎷风紓浣靛妼椤兘寮婚敍鍕舵嫹閿濆骸浜濋柍閿嬪姉缁辨帞绱掑Ο鍏煎垱閻庤娲栭妶鎼佸箖閵忊槅妲归幖瀛樼箘缁�澶愭⒒閸屾瑦绁版い鏇熺墵瀹曚即骞掑Δ锟介悿楣冩煟濡鍤欑紒鐘靛У缁绘繃绻濋崒婊冾杸闂佸搫鎳忛幃鍌炲蓟閵娾晜鍋嗛柛灞剧☉椤忥拷??
							//psend(invitedRoleId, new STeamError(TeamError.ObjectInUnteamState));
							Message.psendMsgNotify(inviterRoleId, TeamManager.ERROR_MSG_SELF_CANT_IN_TEAM, null);
							TeamManager.logger.debug("FAIL:闂傚倸鍊搁崐鎼佸磹閹间礁纾瑰瀣椤愪粙鏌曢崼婵愭Ц缂佺媭鍨堕弻銊╂偆閸屾稑顏�?闂傚倸鍊搁崐宄懊归崶褏鏆﹂柛顭戝亝閸欏繘鏌℃径瀣婵炲樊浜滄儫闂佸疇妗ㄥù鍥箺閺囥垺鈷戦悹鎭掑妼濞呮劙鏌熼崙銈嗗?闂傚倸鍊搁崐椋庣矆娓氾拷楠炲鍩勯崘顏嗘嚌濠德板�曢幊搴ㄦ儗濡ゅ懎绠圭紒顔炬嚀閻忔娊鏌ㄥ┑鍡╂Ц缁绢叏鎷烽梻浣筋嚙缁绘鐣烽悽绋跨疇闁瑰墽鍎甸敓鏂ょ畵婵℃悂鍩℃担渚О婵＄偑鍊曠换鎰拷姘煎墮琚欓柛顐犲灮绾句粙鏌涚仦鍓ф噮闁告柨绉甸妵鍕Ω閵夛箑娈楅柦妯荤箞閺岋綁濮�閵忊晝鍔哥紓浣哄Х婵灚绌辨繝鍥ч柛娑卞枛濞呫倝姊虹粙娆惧剬闁哄懏绻堥弫鎾绘偩鐏炵虎浠ч梺褰掝棑閸忔﹢寮婚妸鈺傚亜闁告挷鑳堕悡鎾绘⒑鐠団�崇仩闁活剙銈搁弫鎾诲棘閵堝洨校闂佸摜濮甸〃濠囧春濞戙垹绠虫俊銈勮兌閸橀亶姊虹憴鍕凡闁告熬鎷风紓浣靛妼椤兘寮婚敍鍕舵嫹閿濆骸浜濋柍閿嬪姉缁辨帞绱掑Ο鍏煎垱閻庤娲栭妶鎼佸箖閵忊槅妲归幖瀛樼箘缁�澶愭⒒閸屾瑦绁版い鏇熺墵瀹曚即骞掑Δ锟介悿楣冩煟濡鍤欑紒鐘靛У缁绘繃绻濋崒婊冾杸闂佸搫鎳忛幃鍌炲蓟閵娾晜鍋嗛柛灞剧☉椤忥拷??,inviterRoleId: "+inviterRoleId);
						}*/else
						{
							//闂傚倸鍊搁崐鎼佸磹妞嬪海鐭嗗〒姘炬嫹鐎规洏鍎抽敓鏂ょ秵閸犳牜澹曢崸妤佺厵闁诡垳澧楅ˉ澶愬箹閺夋埊韬柡灞诲�濋幊婵嬪箥椤旇偐澧┑鐐茬摠缁瞼绱炴繝鍥ц摕婵炴垯鍨瑰敮濡炪倖姊婚崢褔锝為鍫熲拺缂備焦锚闁叉粓鏌熼崙銈嗗?闂傚倸鍊搁崐宄懊归崶褏鏆﹂柛顭戝亝閸欏繘鏌℃径瀣婵炲樊浜滄儫闂佸疇妗ㄥù鍥箺閺囥垺鈷戦悹鎭掑妼濞呮劙鏌熼崙銈嗗?闂傚倸鍊搁崐椋庣矆娓氾拷楠炲鍩勯崘顏嗘嚌濠德板�曢幊搴ㄥ垂閸岀偞鐓欐繛鍫濈仢閺嬨倕鈽夐幘宕囆ｇ紒缁樼洴楠炲鈻庤箛鏇氱棯闂備胶绮幐璇裁洪悢鐓庤摕闁靛ň鏅涘Λ姗�鏌熺粙鍨劉闁稿孩鎸荤换婵堝枈濡搫鈷夐柣搴ｇ懗閸涱喖搴婂┑鐐村灟閸ㄥ綊鏌嬮崶顒佺厽闁哄啫鐗滃Λ鎴澝归悡搴ゅ闁宠鍨块、娆戞兜瀹勯绱ｉ梻渚�娼ч悧濠囧箖閸岀偟宓侀柛鎰靛枛椤懘鏌曢崼婵囧櫧妞わ富鍘界换娑欐綇閸撗冾嚤闁荤媴鎷烽柨鏇嫹閸楄京绱掗幇顔界倰
							inviterTeamId = xtable.Roleid2teamid.get(inviterRoleId);
							if(checkInviterInTeam(inviterTeamId))
							{
								mkdb.Trace.log(mkdb.Trace.DEBUG, "闂傚倸鍊搁崐鎼佸磹閹间礁纾瑰瀣椤愪粙鏌曢崼婵愭Ц缂佺媭鍨堕弻銊╂偆閸屾稑顏�?闂傚倸鍊搁崐宄懊归崶褏鏆﹂柛顭戝亝閸欏繘鏌℃径瀣婵炲樊浜滄儫闂佸疇妗ㄥù鍥箺閺囥垺鈷戦悹鎭掑妼濞呮劙鏌熼崙銈嗗?闂傚倸鍊搁崐椋庣矆娓氾拷楠炲鏁嶉崟顓犵厯闂佸湱鍎ら崺鍫ユ倿閼恒儳绠鹃柛鈩兩戠亸浼存煛閸涱喗鍊愰柡宀嬬畱铻ｅ〒姘煎灡閳绘捇姊虹粙鍨劉闁搞劌娼″濠氭偄閸撳弶效闁硅偐琛ュ褔寮搁崨瀛樷拺闁告繂瀚～锕傛煕閺傚潡鍙勯柡浣规崌瀵剟濡堕崶鈹綁姊虹粙娆惧剱閻㈩垱甯掑畵鍕渻閵堝棛澧柛鈺佸暣瀵劍绂掔�ｎ偆鍘介梺褰掑亰閸樿偐寰婄紒妯镐簻闁挎棁顕ф晶鎾煛鐏炲墽娲存鐐搭焽閿熶粙娼ч幗婊堟偩閻㈠憡鈷戦柟绋垮绾炬悂鏌涢妸銊︻仩缂侇噮鍙冮幃銏ゅ礂閸忓吋顏熼梻浣藉Г閿氭い锕佹椤洭寮借閺�浠嬫煕鐏炲墽顣查柛鐔哄仱閺屾稓锟斤綆浜滈顓㈡煛鐏炲墽娲存鐐达耿閹崇姷鎹勯崫鍕厫濠碉紕鍋戦崐褏锟介潧鐭傚畷鍦崉娓氼垱缍庡┑鐐叉▕娴滄粎绮绘导鏉戠閺夊牆澧藉畝娑欎繆閹绘帞澧涚紒缁樼箞濡啫鈽夊鍫熷闁荤喖鍋婂鏍偣閸パ勨枙闁搞倖顨呴埞鎴︽偐閹绘帗娈ч梺绋款儏閹虫﹢寮诲☉銏犵疀闁宠桨绀侀‖鍫ユ倵濞堝灝鏋涢柛銏＄叀閳ユ棃宕橀鍢壯囨煕閳╁啰鎳冩い顐庡懐纾奸柣鎰靛墯缁惰尙绱掓径濠傤暢闁告帗甯″畷濂稿Ψ閿旇姤顏熼梻浣稿悑娴滀粙宕曞畷鍥уК闁跨喍绮欏娲濞戙垻宕紓浣瑰絻婢ц棄鈽夐悽绋跨鐟滃繒澹曢悡搴唵闁兼悂娼ф慨鍫熺箾閹冲嘲瀚ㄦ禍婊勩亜韫囨挸顏╅柡鍡悼閿熷�燁潐濞叉鏁幒妤嬬稏婵犻潧顑嗛崑鍌炲箹濞ｎ剙鐏柣婵囧哺濮婂宕掑▎鎰偘闂佺顑嗛崝娆撳春濞戙垹閱囬柕澶堝劤椤︻厼鈹戦悙鏉戠仧闁搞劍妞藉畷鏇熷緞閹邦厾鍘卞┑鐐村灦椤洭骞楅悩缁樼厽闁规儳顕ú鎾煛鐏炲墽娲存い銏℃礋閺佹劙宕堕埡濠傛倯濠电姷顣藉Σ鍛村垂娴犲绠梺鍨儑缁★拷閻庣數澧楅悘姘跺磹閵堝鍚归悗锝庡枟閳锋帡鏌涢弴銊ヤ簻妞ゅ浚鍋婇弻銊╂偄閻戞ɑ鐝銈忕秵閸ｏ綁鐛箛娑欐櫢闁跨噦鎷�?,TeamId: "+inviterTeamId);
								//闂傚倸鍊搁崐鎼佸磹閹间礁纾瑰瀣椤愪粙鏌曢崼婵愭Ц缂佺媭鍨堕弻銊╂偆閸屾稑顏�?闂傚倸鍊搁崐宄懊归崶褏鏆﹂柛顭戝亝閸欏繘鏌℃径瀣婵炲樊浜滄儫闂佸疇妗ㄥù鍥箺閺囥垺鈷戦悹鎭掑妼濞呮劙鏌熼崙銈嗗?闂傚倸鍊搁崐椋庣矆娓氾拷楠炲鏁嶉崟顓犵厯闂佸湱鍎ら崺鍫ユ倿閼恒儳绠鹃柛鈩兩戠亸浼存煛閸涱喗鍊愰柡宀嬬畱铻ｅ〒姘煎灡閳绘捇姊虹粙鍨劉闁搞劌娼″濠氭偄閸撳弶效闁硅偐琛ュ褔寮搁崨瀛樷拺闁告繂瀚～锕傛煕閺傚潡鍙勯柡浣规崌瀵剟濡堕崶鈹綁姊虹粙娆惧剱閻㈩垱甯掑畵鍕渻閵堝棛澧柛鈺佸暣瀵劍绂掔�ｎ偆鍘介梺褰掑亰閸樿偐寰婄紒妯镐簻闁挎棁顕ф晶鎾煛鐏炲墽娲存鐐搭焽閿熶粙娼ч幗婊堟偩閻㈠憡鈷戦柟绋垮绾炬悂鏌涢妸銊︻仩缂侇噮鍙冮幃銏ゅ礂閸忓吋顏熼梻浣藉Г閿氭い锕佹椤洭寮借閺�浠嬫煕鐏炲墽顣查柛鐔哄仱閺屾稓锟斤綆浜滈顓㈡煛鐏炲墽娲存鐐达耿閹崇姷鎹勯崫鍕厫濠碉紕鍋戦崐褏锟介潧鐭傚畷鍦崉娓氼垱缍庡┑鐐叉▕娴滄粎绮绘导鏉戠閺夊牆澧藉畝娑欎繆閹绘帞澧涚紒缁樼箞濡啫鈽夊鍫熷闁荤喖鍋婂鏍偣閸パ勨枙闁搞倖顨呴埞鎴︽偐閹绘帗娈ч梺绋款儏閹虫﹢寮诲☉銏犵疀闁宠桨绀侀‖鍫ユ倵濞堝灝鏋涢柛銏＄叀閳ユ棃宕橀鍢壯囨煕閳╁啰鎳冩い顐庡懐纾奸柣鎰靛墯缁惰尙绱掓径濠傤暢闁告帗甯″畷濂稿Ψ閿旇姤顏熼梻浣稿悑娴滀粙宕曞畷鍥уК闁跨喍绮欏娲濞戙垻宕紓浣瑰絻婢ц棄鈽夐悽绋跨鐟滃繒澹曢悡搴唵闁兼悂娼ф慨鍫熺箾閹冲嘲瀚ㄦ禍婊勩亜韫囨挸顏╅柡鍡悼閿熷�燁潐濞叉鏁幒妤嬬稏婵犻潧顑嗛崑鍌炲箹濞ｎ剙鐏柣婵囧哺濮婂宕掑▎鎰偘闂佺顑嗛崝娆撳春濞戙垹閱囬柕澶堝劤椤︻厼鈹戦悙鏉戠仧闁搞劍妞藉畷鏇熷緞閹邦厾鍘卞┑鐐村灦椤洭骞楅悩缁樼厽闁规儳顕ú鎾煛鐏炲墽娲存い銏℃礋閺佹劙宕堕埡濠傛倯濠电姷顣藉Σ鍛村垂娴犲绠梺鍨儑缁★拷閻庣數澧楅悘姘跺磹閵堝鍚归悗锝庡枟閳锋帡鏌涢弴銊ヤ簻妞ゅ浚鍋婇弻銊╂偄閻戞ɑ鐝梺杞扮劍閹倸鐣烽姀锝庢▌濡炪們鍨洪敃銏ゅ箠濠靛绠ユい鏃傚亾濠㈡垿姊绘担鍛婃儓婵炲眰鍔嶉崚濠囶敇閻愬稄缍侀幃婊堟嚍閵夈垺瀚藉┑鐐舵彧缁蹭粙骞夐敓鐘茬柈闁绘劗鍎ら悡鐔兼煟閺囨氨顦﹂柣蹇ュ閿熷�燁潐濞叉牜绱炴繝鍥х畺闁伙絽鐬奸惌娆撴偣娓氼垳鍘涙俊宸灡缁绘繂鈻撻崹顔界亶濡炪們鍔嶉崝娆撶嵁韫囨棏妲归幖鎼灡鐎氳绻涢崼婵堜虎闁哄鐟╅弻娑樜旀担绯曟灆闂侀潧妫旂粈渚�鍩ユ径濠庢建闁糕剝锚閸忓﹥淇婇悙顏勶拷鏍暜閹烘纾归柣鎴ｆ娴肩姵淇婇妶鍛櫤闁绘挾鍠栭獮鏍ㄦ綇閸撗冨煂婵炲濯崹鍫曞蓟濞戞瑧绡�闁告劦浜栧Σ鍫ユ⒑鐎圭媭鍤欑紒澶婄秺瀵偊骞囬鐐电獮闁诲函缍嗘禍娆撳箣闁垮绡�闁汇垽娼ф禒锕傛煕椤垵鐏︾�规洜鎳撶叅妞ゅ繐瀚敍鐔兼倵楠炲灝鍔氭い锔垮嵆閹繝寮撮姀锛勫幐闂佹悶鍎弲娑欑濠婂嫨浜滈柨婵嗘噽閿涘秶绱掓潏銊ユ诞闁轰焦鎹囬幊鐐哄Ψ閵壯呯嵁闂備礁缍婇崑濠囧礈濞戞瑯娈介柛銉墯閳锋垿鏌涢幇顒�绾ч柟顖氱墦閺屾稒绻濋崒銈囧悑濡ょ姷鍋涢敃顏勭暦閻旂⒈鏁勯悹鎭掑妿閻ｉ箖姊绘担铏瑰笡闁告梹鐗為妵鎰板礃椤旇姤娅㈤梺鑺ッˇ鎵嫻閿涘嫮纾兼い鏃傛櫕閹冲嫮绱掔紒妯肩疄鐎规洖鐖兼俊鎼佸Ψ閵堝洨娉块梻浣筋嚙濞寸兘骞婇幘璁规嫹濮樼厧骞楅柛鎺戯攻缁傛帞锟斤絽鐏氶弲鈺傜節閵忥絾纭炬い鎴濇川缁粯銈ｉ崘鈺侊拷鐢告煟閵忊槅鍟忛柣鎺戝⒔閹噣濡搁埡鍌楁嫼缂備礁顑嗙�笛囧船婢跺娓婚悗娑櫳戦崐鎰殽閻愯尙澧﹀┑鈩冩倐閸╋繝宕掑鐐闁绘垼濮ら悡鏇熺節闂堟稒顥滄い蹇ｅ亝閵囧嫰鏁傞崗鐓庮伓?
								xbean.TeamInfo teamInfo = xtable.Team.get(inviterTeamId); 
								if(!checkInviterIsLeader(inviterRoleId, teamInfo))
								{
									//闂傚倸鍊搁崐鎼佸磹閹间礁纾瑰瀣椤愪粙鏌曢崼婵愭Ц缂佺媭鍨堕弻銊╂偆閸屾稑顏�?闂傚倸鍊搁崐宄懊归崶褏鏆﹂柛顭戝亝閸欏繘鏌℃径瀣婵炲樊浜滄儫闂佸疇妗ㄥù鍥箺閺囥垺鈷戦悹鎭掑妼濞呮劙鏌熼崙銈嗗?闂傚倸鍊搁崐椋庣矆娓氾拷楠炲鍩勯崘顏嗘嚌濠德板�曢幊搴ｇ矆閸喓绠鹃柟瀛樼懃閻忣亪鏌涚�Ｑ冨⒉缂佺粯绻堝Λ鍐ㄢ槈閸楃偛澹夐梻浣虹帛閹稿鎯勯鐐茶摕婵炴垯鍨归崡鎶芥煏韫囧﹤澧查梺娆惧弮濮婅櫣鎷犻弻銉у椽闂傚倸瀚�氼厾绮氭潏銊х瘈闁告洦鍓欓悵浼存偡濠婂啰绠婚柟顕�绠栧畷褰掝敃閿濆懎浼庡┑鐘垫暩婵鎹㈤幋鐙呮嫹濮樼偓瀚�?
									//psend(invitedRoleId, new STeamError(TeamError.ObjectNotLeader));
									MessageMgr.psendMsgNotify(invitedRoleId, 141861, null);
									TeamManager.logger.debug("FAIL:闂傚倸鍊搁崐鎼佸磹閹间礁纾瑰瀣椤愪粙鏌曢崼婵愭Ц缂佺媭鍨堕弻銊╂偆閸屾稑顏�?闂傚倸鍊搁崐宄懊归崶褏鏆﹂柛顭戝亝閸欏繘鏌℃径瀣婵炲樊浜滄儫闂佸疇妗ㄥù鍥箺閺囥垺鈷戦悹鎭掑妼濞呮劙鏌熼崙銈嗗?闂傚倸鍊搁崐椋庣矆娓氾拷楠炲鍩勯崘顏嗘嚌濠德板�曢幊搴ｇ矆閸喓绠鹃柟瀛樼懃閻忣亪鏌涚�Ｑ冨⒉缂佺粯绻堝Λ鍐ㄢ槈閸楃偛澹夐梻浣虹帛閹稿鎯勯鐐茶摕婵炴垯鍨归崡鎶芥煏韫囧﹤澧查梺娆惧弮濮婅櫣鎷犻弻銉у椽闂傚倸瀚�氼厾绮氭潏銊х瘈闁告洦鍓欓悵浼存偡濠婂啰绠婚柟顕�绠栧畷褰掝敃閿濆懎浼庡┑鐘垫暩婵鎹㈤幋鐙呮嫹濮樼偓瀚�?,TeamId: "+inviterTeamId);
								}
								else if(isLeaderInDuel(inviterRoleId))
								{
									// 闂傚倸鍊搁崐鎼佸磹閹间礁纾归柟闂寸绾惧綊鏌熼梻瀵割槮闁汇値鍠栭湁闁稿繐鍚嬬紞鎴犵磼閹邦収娈滈柡灞革拷鎰佸悑閹肩补锟藉磭顔愭繝娈垮枦椤鎮￠垾鎰佹綎婵炲樊浜堕弫鍡涙煥閻旂儤娅曠紒顔芥楠炴﹢顢欓懖鈺婂敼闂備礁澹婇崑鍛哄锟介幃陇绠涢幘顖涙杸闂佺粯鍔樼亸娆愮閵忋倖鐓曢柡鍐挎嫹鐎癸拷閹间礁钃熼柨娑樺閹风兘鏁愰崼婵堝帿闁诲孩鑹剧紞濠傤潖婵犳艾纾兼繛鍡樺笒閸橈繝鏌ｈ箛鎾剁疄闁告梹鍨块悰顔跨疀濞戞瑦娅㈤梺璺ㄥ櫐閹凤拷?
									TeamManager.logger.debug("FAIL:闂傚倸鍊搁崐鎼佸磹閹间礁纾归柟闂寸绾惧綊鏌熼梻瀵割槮闁汇値鍠栭湁闁稿繐鍚嬬紞鎴犵磼閹邦収娈滈柡灞革拷鎰佸悑閹肩补锟藉磭顔愭繝娈垮枦椤鎮￠垾鎰佹綎婵炲樊浜堕弫鍡涙煥閻旂儤娅曠紒顔芥楠炴﹢顢欓懖鈺婂敼闂備礁澹婇崑鍛哄锟介幃陇绠涢幘顖涙杸闂佺粯鍔樼亸娆愮閵忋倖鐓曢柡鍐挎嫹鐎癸拷閹间礁钃熼柨娑樺閹风兘鏁愰崼婵堝帿闁诲孩鑹剧紞濠傤潖婵犳艾纾兼繛鍡樺笒閸橈繝鏌ｈ箛鎾剁疄闁告梹鍨块悰顔跨疀濞戞瑦娅㈤梺璺ㄥ櫐閹凤拷?,TeamId: "+inviterTeamId);
								}
								else if(!checkTeamInvitingValid(teamInfo, invitedRoleId))
								{
									//闂傚倸鍊搁崐鎼佸磹閹间礁纾瑰瀣椤愪粙鏌曢崼婵愭Ц缂佺媭鍨堕弻銊╂偆閸屾稑顏�?闂傚倸鍊搁崐宄懊归崶褏鏆﹂柛顭戝亝閸欏繘鏌℃径瀣婵炲樊浜滃洿婵犮垼娉涢敃銈囪姳閵夆晜鈷戦柛婵嗗椤箓鏌涙惔銈勫惈缂侇喖鐗撳畷鐔碱敍濞戞艾寮虫繝鐢靛仦閸ㄥ爼鏁嬪銈呮禋閸嬪棝鎯�椤忓牆绠氱憸瀣磻閵忋倖鐓熼柟鍨暙娴滄壆锟借娲栭悥鍏间繆閹间焦鏅滈柣鎰靛墻閸氬洭姊虹拠鎻掝劉缂佸甯為幑銏ゅ醇濠垫劖缍庡┑鐐叉▕娴滄粍瀵奸悩缁樼厱闁哄洢鍔屾禍婵囩箾閸繃鎯堟い顏勫暣婵″爼宕卞Ο閿嬪闂備礁鎲″褰掋�冮崨顓炵カ闂備礁缍婇崑濠囧礈閿曞倹鍊甸柛顐ｆ礃閸婄敻鏌涢敂璇插箺閻忓繒娅漡al闂傚倸鍊搁崐鎼佸磹妞嬪海鐭嗗ù锝堟〃閻掑﹪鏌涘☉娆愮稇缂佺媭鍨堕弻銊╂偆閸屾稑顏�?
									TeamManager.logger.debug("FAIL:闂傚倸鍊搁崐鎼佸磹閹间礁纾瑰瀣椤愪粙鏌曢崼婵愭Ц缂佺媭鍨堕弻銊╂偆閸屾稑顏�?闂傚倸鍊搁崐宄懊归崶褏鏆﹂柛顭戝亝閸欏繘鏌℃径瀣婵炲樊浜滃洿婵犮垼娉涢敃銈囪姳閵夆晜鈷戦柛婵嗗椤箓鏌涙惔銈勫惈缂侇喖鐗撳畷鐔碱敍濞戞艾寮虫繝鐢靛仦閸ㄥ爼鏁嬪銈呮禋閸嬪棝鎯�椤忓牆绠氱憸瀣磻閵忋倖鐓熼柟鍨暙娴滄壆锟借娲栭悥鍏间繆閹间焦鏅滈柣鎰靛墻閸氬洭姊虹拠鎻掝劉缂佸甯為幑銏ゅ醇濠垫劖缍庡┑鐐叉▕娴滄繈宕戦弽顓熷�垫繛鎴烆仾椤忓牜鏁傞柨鐕傛嫹?,TeamId: "+inviterTeamId);
								}
								else if(checkTeamNotFull(teamInfo) && checkMap(teamInfo.getTeamleaderid(), invitedRoleId))
								{
									Team team = new Team(inviterTeamId,false);
									//濠电姷鏁告慨鐑藉极閸涘﹥鍙忛柣鎴濐潟閿熻棄鍊圭粋鎺旓拷锝庡亝濞呫垽姊洪懞銉冾亪藝椤栫偛姹查梺顒�绉甸悡銉╂煟閺冨倻甯涙い銉ヮ槺缁辨挸顓奸崪鍐惈濡ょ姷鍋涢崯顐ョ亽闁荤姴娲╃亸娆戠玻閻愮儤鈷戠憸鐗堝笒娴滀即鏌涢幘瀵告噰闁诡噣娼ц灒闁煎鍊楅惁鍫ユ⒑闂堟盯鐛滅紒鎻掑⒔濞戝灚銈ｉ崘鈺冨幗濡炪倖甯掗崐鍝ユ暜閸洘鐓冪紓浣股戦ˉ鍫濃攽椤曞棙瀚归梻浣虹帛閿曗晠宕戦崨鏉戞闁跨喍绮欏缁樻媴閾忕懓绗￠梺鎸庢皑閻ヮ亞绱掗姀鐘茬睄闂佽鍣换婵嬨�佸☉銏″�烽悗鐢殿焾楠炲秵淇婇妶鍥ラ柛瀣洴閹ê鈹戠�ｎ偄锟藉爼鏌ょ喊鍗炲⒕闁圭兘顥撻幉鎾礋椤掑偆妲扮紓鍌欐祰椤曆囨偋閹惧磭鏆︽繛宸簻缁�瀣亜閺嶃劍鐨戞い锔哄姂濮婅櫣锟藉湱濯崵鍐煕閹惧崬濡跨紒顔碱煼楠炲鏁冮敓浠嬫偂閳ユ剚鐔嗛柤鎼佹涧婵洨绱掗悩鍝勫惞闁跨喎锟界噥娼愭繛鍙夌墪閳绘棃鏁冮崒姘兼綂闂侀潧鐗嗗Λ娑㈠储閸楃偐鏀介柍钘夋閻忋儲銇勯弴鍡楁处閸婂爼鏌嶉崫鍕櫤闁绘挻鐟ч敓鐣屾嚀鐎氫即宕戞繝鍥х？闁瑰濮风壕鍏笺亜閺冨倹娅曢柟鍐叉处椤ㄣ儵鎮欓弶鎴濐潔闂佽鍨卞Λ鍐春閵夆晛骞㈤柡鍥╁Х椤︺儵姊婚崒姘拷鎼佸磹閻戣姤鍤勯柛顐ｆ磵閿熸枻绠撳畷濂稿閳ュ啿绨ラ梻浣烘嚀閻°劎鎹㈤幇鐗堝殌闁秆勵殕閻撴洟鏌ㄩ弮鍥跺殭妤犵偞鐗犻弻娑㈠Ω閿斿墽鐣洪梺闈涙搐鐎氫即鐛幒鎴悑闁割偅绻傜敮顖涗繆閻愵亜锟芥劙寮插鍫熷亗闁跨喓濮撮拑鐔烘喐閹寸姷涓嶆繛鎴欏灩缁犺崵鐥幆褜鍎戞い銏犳嚇濮婄粯鎷呯憴鍕╀户闂佸憡锚閵堟悂銆侀弽銊ョ窞濠电姴瀛╃紞搴㈢節閻㈤潧校闁肩懓澧界划鍫ュ礃閳瑰じ绨婚棅顐㈡处閹告悂顢旈鍫熺厽闊洤娴烽ˇ锕傛煃鐟欏嫬鐏撮柟顔界懇閹崇娀顢楅敓浠嬪煕婵犲洦鈷戦柣鐔告緲濞堚晠鏌熼崙銈嗗
//									if(!MarryTaskStepManager.checkMarryTaskState(team.getAllMemberIds(), invitedRoleId)){
//										//TODO
//										
//									}else{
										TeamManager.logger.debugWhileCommit("SUCC:闂傚倸鍊搁崐鎼佸磹閹间礁纾归柟闂寸绾惧綊鏌熼梻瀵割槮闁汇値鍠栭湁闁稿繐鍚嬬紞鎴犵磼閹邦収娈橀柨鐔绘缁犲秹宕曢崡鐏绘椽鏁冮崒锔剧◤闂佸搫娲㈤崹娲偂閻斿吋鐓欓梺顓ㄧ畱婢ь垶鏌熼姘卞ⅱ缂佽鲸甯￠弫鎾绘嚍閵夈儳绐為梺褰掑亰閸橀箖宕㈤挊澶嗘斀闁宠棄妫楅悘銉︺亜閺囧棗鎳庣欢銈夋煠婵劕锟窖囧箯瀹勬壋鏋旈柛顭戝枟閻忓秵绻濋悽闈涗粶闁挎洏鍊濋、姘舵晲婢跺﹪鍞堕梺鍝勬川閸嬬喖宕㈤幖浣光拺缂佸瀵у﹢鎵磼椤旇偐效鐎规洘濞婃俊鐑藉煛閸屾瀚藉┑鐐舵彧缁插潡鈥﹂崼銏㈡／鐟滃繒妲愰幒妤婃晩闁兼亽鍎辩喊宥咁渻閵堝棙绌跨紓宥勭窔閵嗕礁螖閸涱厾顦板銈嗗釜閹峰嘲霉濠婂牅鎲炬慨濠冩そ瀹曟粓骞撻幒宥囧嚬缂傚倷娴囬褏锟芥凹鍘剧划瀣吋婢跺娅滄繝銏ｆ硾椤戝倿骞忓ú顏呪拻闁稿本姘ㄦ晶鎰版煛閸涱喚鐭岄柨鐔诲Г閻旑剟骞忛敓锟�?(闂傚倸鍊搁崐鎼佸磹妞嬪海鐭嗗〒姘炬嫹妤犵偛顦甸弫鎾绘偐閸愬弶鐤勯梻浣告啞閹稿棗顓奸崱妤婁紦婵犵數鍋為崹鍓佹暜濡わ拷閳诲秹宕ㄩ杞扮盎濡炪倖鎸鹃崑鐐哄窗濮楋拷閺岀喖顢欓懡銈囩厯閻庤娲忛崝宥囨崲濠靛纾兼慨姗嗗墻濡嫰姊婚崒姘拷椋庣矆娓氾拷楠炲鍨剧搾浣规そ閺佸啴宕掑顒傦拷顓㈡煛婢跺﹦澧遍柛瀣浮瀵爼鎮滃Ο鑲╃槇闂佹眹鍨藉褎绂掗埡鍛厵婵炶尪顔婇柇顖涱殽閻愯尙绠婚柡浣规崌閺佹捇鏁撻敓锟�?),TeamId: "+inviterTeamId);
										return team.addNewMemberWithSP(invitedRoleId);
									//}
								}
							}
							else
							{
								//闂傚倸鍊搁崐鎼佸磹閹间礁纾瑰瀣椤愪粙鏌曢崼婵愭Ц缂佺媭鍨堕弻銊╂偆閸屾稑顏�?闂傚倸鍊搁崐宄懊归崶褏鏆﹂柛顭戝亝閸欏繘鏌℃径瀣婵炲樊浜滄儫闂佸疇妗ㄥù鍥箺閺囥垺鈷戦悹鎭掑妼濞呮劙鏌熼崙銈嗗?闂傚倸鍊搁崐椋庣矆娓氾拷楠炲鏁嶉崟顓犵厯闂佸湱鍎ら崺鍫ユ倿閼恒儳绠鹃柛鈩兩戠亸浼存煛閸涱喗鍊愰柡宀嬬畱铻ｅ〒姘煎灡閳绘捇姊虹粙鍨劉闁搞劌娼″濠氭偄閸撳弶效闁硅偐琛ュ褔寮搁崨瀛樷拺闁告繂瀚～锕傛煕閺傚潡鍙勯柡浣规崌瀵剟濡堕崶鈹綁姊虹粙娆惧剱閻㈩垱甯掑畵鍕渻閵堝棛澧柛鈺佸暣瀵劍绂掔�ｎ偆鍘介梺褰掑亰閸樿偐寰婄紒妯镐簻闁挎棁顕ф晶鎾煛鐏炲墽娲存鐐搭焽閿熶粙娼ч幗婊堟偩閻㈠憡鈷戦柟绋垮绾炬悂鏌涢妸銊︻仩缂侇噮鍙冮幃銏ゅ礂閸忓吋顏熼梻浣藉Г閿氭い锕佹椤洭寮借閺�浠嬫煕鐏炲墽顣查柛鐔哄仱閺屾稓锟斤綆浜滈顓㈡煛鐏炲墽娲存鐐达耿閹崇姷鎹勯崫鍕厫濠碉紕鍋戦崐褏锟介潧鐭傚畷鍦崉娓氼垱缍庡┑鐐叉▕娴滄粎绮绘导鏉戠閺夊牆澧藉畝娑欎繆閹绘帞澧︽慨濠傛惈鐓ら悹鍥ㄥ絻椤晠姊洪棃娑氬闁诡喖鍊块獮鍐╁閹碱厽鏅梺璺ㄥ枙濡嫰鎮鹃悜钘夐唶闁哄洢鍔嶉弲銏ゆ⒑鐠恒劌鏋嶇紒顔界懇閻涱噣骞嬮敃锟介柋鍥煛閸モ晛鏋旈柛姗嗕簼缁绘繈鎮介棃娑楃捕闂佽绻戠换鍫ュ极閹剧粯鍤嶉柕澶樺枟閻や線姊虹拠鈥崇仩闁兼椿鍨堕崺鐐哄箣閻欏懏瀚归柨婵嗛娴滅偤鏌涘Ο鍦煓婵﹥妞藉畷鐑筋敇閻愭彃顬嗘繝鐢靛仜瀵爼鎮ч悩璇茬畺闁跨喓濮寸粻娑㈡煟濡わ拷閻楀繘宕㈡禒瀣拺闂傚牊渚楀Σ鍫曟煕鎼淬垻鍙�鐎规洜鏁诲畷鍫曞煛鐎ｎ偄顏跺┑鐐茬墕閻忔繈寮稿☉銏＄厽闊洦妫佹竟妯汇亜閺囨ê鍔︾�规洜鍠栭、鏇㈡偄閸撳弶缍屽┑鐘愁問閸犳鏁冮姀銏″厹缂佸顕抽敐澶嬪�婚柤鎭掑劗閹峰姊虹粙鎸庢拱闁煎湱鍋撶粋宥嗗鐎涙鍘甸梺鍛婂灟閸婃牜锟芥熬鎷�?闂傚倸鍊搁崐宄懊归崶褏鏆﹂柣銏㈩焾缁愭鏌熼柇锕�鍔掓繛宸簻缁狅綁鏌ｅΟ鍏兼毄闁绘帒鍚嬬换娑欐綇閸撗呅氬┑鐐叉嫅缁叉寧绔熼弴鐔侯浄閻庯綆鍋嗛崢鐢告⒑鐠団�崇�婚柛鎰亾濞堟椽姊绘担鍛婂暈妞ゃ劌妫楅悾婵嬪箹娴ｅ摜鐣哄┑掳鍊曢幊蹇涘疾閺屻儱绠圭紒顔炬閹风兘鎳犻锟介崵顒勬⒒閸屾瑨鍏岀紒顕呭灦楠炴牠顢曢敃锟界粻顖炴煟閹达絽袚闁抽攱甯掗湁闁挎繂鎳忕拹鈩冪節閿熻姤绂掔�ｎ偆鍘遍梺鍝勫�藉▔鏇㈡倶闁秵鐓ラ柣鏃囶嚙琚氱紒鐐緲缁夋挳鈥﹂崹顔ョ喖宕崟顓滃亽闂傚倸鍊烽悞锔撅拷绗涘吘娑欐媴閼叉繃鐩畷鐔碱敍閿濆棙娅旈梺鍝勵槸閻楀啴寮查鍫濈闁绘垹鏅畵渚�鏌涢…鎴濇灈濠殿喖娴风槐鎾存媴閾忕懓绗￠柣銏╁灣閸嬬喖宕氶幒妤�閱囬柣鏃堫棑缁愮偤姊鸿ぐ鎺戜喊闁告﹢绠栧畷銏ゆ焼瀹ュ棌鎷洪悷婊呭鐢帗绂嶆导瀛樼厱闁规儳顕埥澶愭煟閳藉棗骞栭柍瑙勫灴閹晠骞囨担鍛婃珱闂備礁鎽滄慨闈涚暆缁嬭法鏆﹂柟杈剧畱鍥撮梺鍛婁緱閸ㄥ崬鈻撴ィ鍐┾拺閻犳亽鍔屽▍鎰版煙閸戙倖瀚�?
								TeamManager.logger.debug("INFO:闂傚倸鍊搁崐鎼佸磹閹间礁纾瑰瀣椤愪粙鏌曢崼婵愭Ц缂佺媭鍨堕弻銊╂偆閸屾稑顏�?闂傚倸鍊搁崐宄懊归崶褏鏆﹂柛顭戝亝閸欏繘鏌℃径瀣婵炲樊浜滄儫闂佸疇妗ㄥù鍥箺閺囥垺鈷戦悹鎭掑妼濞呮劙鏌熼崙銈嗗?闂傚倸鍊搁崐椋庣矆娓氾拷楠炲鏁嶉崟顓犵厯闂佸湱鍎ら崺鍫ユ倿閼恒儳绠鹃柛鈩兩戠亸浼存煛閸涱喗鍊愰柡宀嬬畱铻ｅ〒姘煎灡閳绘捇姊虹粙鍨劉闁搞劌娼″濠氭偄閸撳弶效闁硅偐琛ュ褔寮搁崨瀛樷拺闁告繂瀚～锕傛煕閺傚潡鍙勯柡浣规崌瀵剟濡堕崶鈹綁姊虹粙娆惧剱閻㈩垱甯掑畵鍕渻閵堝棛澧柛鈺佸暣瀵劍绂掔�ｎ偆鍘介梺褰掑亰閸樿偐寰婄紒妯镐簻闁挎棁顕ф晶鎾煛鐏炲墽娲存鐐搭焽閿熶粙娼ч幗婊堟偩閻㈠憡鈷戦柟绋垮绾炬悂鏌涢妸銊︻仩缂侇噮鍙冮幃銏ゅ礂閸忓吋顏熼梻浣藉Г閿氭い锕佹椤洭寮借閺�浠嬫煕鐏炲墽顣查柛鐔哄仱閺屾稓锟斤綆浜滈顓㈡煛鐏炲墽娲存鐐达耿閹崇姷鎹勯崫鍕厫濠碉紕鍋戦崐褏锟介潧鐭傚畷鍦崉娓氼垱缍庡┑鐐叉▕娴滄粎绮绘导鏉戠閺夊牆澧藉畝娑欎繆閹绘帞澧︽慨濠傛惈鐓ら悹鍥ㄥ絻椤晠姊洪棃娑氬闁诡喖鍊块獮鍐╁閹碱厽鏅梺璺ㄥ枙濡嫰鎮鹃悜钘夐唶闁哄洢鍔嶉弲銏ゆ⒑鐠恒劌鏋嶇紒顔界懇閻涱噣骞嬮敃锟介柋鍥煛閸モ晛鏋旈柛姗嗕簼缁绘繈鎮介棃娑楃捕闂佽绻戠换鍫ュ极閹剧粯鍤嶉柕澶樺枟閻や線姊虹拠鈥崇仩闁兼椿鍨堕崺鐐哄箣閻欏懏瀚归柨婵嗛娴滅偤鏌涘Ο鍦煓婵﹥妞藉畷鐑筋敇閻愭彃顬嗘繝鐢靛仜瀵爼鎮ч悩璇茬畺闁跨喓濮寸粻娑㈡煟濡わ拷閻楀繘宕㈡禒瀣拺闂傚牊渚楀Σ鍫曟煕鎼淬垻鍙�鐎规洜鏁诲畷鍫曞煛鐎ｎ偄顏跺┑鐐茬墕閻忔繂鈻嶅▎鎾寸厵闁告垯鍊栫�氾拷?,inviterRoleId: "+inviterRoleId);
								if(!checkSingleInvitingExist(inviterRoleId, invitedRoleId))
								{
									//闂傚倸鍊搁崐鎼佸磹閹间礁纾瑰瀣椤愪粙鏌曢崼婵愭Ц缂佺媭鍨堕弻銊╂偆閸屾稑顏�?闂傚倸鍊搁崐宄懊归崶褏鏆﹂柛顭戝亝閸欏繘鏌℃径瀣婵炲樊浜滄儫闂佸疇妗ㄥù鍥箺閺囥垺鈷戦悹鎭掑妼濞呮劙鏌熼崙銈嗗?闂傚倸鍊搁崐椋庣矆娓氾拷楠炲鍩勯崘顏嗘嚌濠德板�曢幊搴ㄥ垂閸岀偞鈷戞い鎺炴嫹缂佸鏁诲畷鎴﹀煛閸涱喒鎷哄銈嗗釜閹烽绱掓径灞炬毈闁糕晜鐩獮瀣晜閻ｅ苯寮抽梻浣虹帛濞叉牠宕愰崷顓ㄦ嫹濮樼偓瀚�?闂傚倸鍊搁崐宄懊归崶褏鏆﹂柛顭戝亝閸欏繘鏌℃径瀣婵炲樊浜滃洿婵犮垼娉涢敃銈囪姳閵夆晜鈷戦柛婵嗗椤箓鏌涙惔銈勫惈缂侇喖鐗撳畷鐔碱敍濞戞艾寮虫繝鐢靛仦閸ㄥ爼鏁嬪銈呮禋閸嬪棝鎯�椤忓牆绠氱憸瀣磻閵忋倖鐓熼柟鍨暙娴滄壆锟借娲栭悥鍏间繆閹间焦鏅滈柣鎰靛墻閸氬洭姊虹拠鎻掝劉缂佸甯為幑銏ゅ醇濠垫劖缍庡┑鐐叉▕娴滄粍瀵奸悩缁樼厱闁哄洢鍔屾禍婵囩箾閸繃鎯堟い顏勫暣婵″爼宕卞Ο閿嬪闂備礁鎲″褰掋�冮崨顓炵カ闂備礁缍婇崑濠囧礈閿曞倹鍊甸柛顐ｆ礃閸婄敻鏌涢敂璇插箺閻忓繒娅al闂傚倸鍊搁崐鎼佸磹妞嬪海鐭嗗ù锝堟〃閻掑﹪鏌涘☉娆愮稇缂佺媭鍨堕弻銊╂偆閸屾稑顏�?
									TeamManager.logger.debug("FAIL:闂傚倸鍊搁崐鎼佸磹閹间礁纾瑰瀣椤愪粙鏌曢崼婵愭Ц缂佺媭鍨堕弻銊╂偆閸屾稑顏�?闂傚倸鍊搁崐宄懊归崶褏鏆﹂柛顭戝亝閸欏繘鏌℃径瀣婵炲樊浜滄儫闂佸疇妗ㄥù鍥箺閺囥垺鈷戦悹鎭掑妼濞呮劙鏌熼崙銈嗗?闂傚倸鍊搁崐椋庣矆娓氾拷楠炲鍩勯崘顏嗘嚌濠德板�曢幊搴ㄥ垂閸岀偞鈷戞い鎺炴嫹缂佸鏁诲畷鎴﹀煛閸涱喒鎷哄銈嗗釜閹烽绱掓径灞炬毈闁糕晜鐩獮瀣晜閻ｅ苯寮抽梻浣虹帛濞叉牠宕愰崷顓ㄦ嫹濮樼偓瀚�?闂傚倸鍊搁崐宄懊归崶褏鏆﹂柛顭戝亝閸欏繘鏌℃径瀣婵炲樊浜滃洿婵犮垼娉涢敃銈囪姳閵夆晜鈷戦柛婵嗗椤箓鏌涙惔銈勫惈缂侇喖鐗撳畷鐔碱敍濞戞艾寮虫繝鐢靛仦閸ㄥ爼鏁嬪銈呮禋閸嬪棝鎯�椤忓牆绠氱憸瀣磻閵忋倖鐓熼柟鍨暙娴滄壆锟借娲栭悥鍏间繆閹间焦鏅滈柣鎰靛墻閸氬洭姊虹拠鎻掝劉缂佸甯為幑銏ゅ醇濠垫劖缍庡┑鐐叉▕娴滄繈宕戦弽顓熷�垫繛鎴烆仾椤忓牜鏁傞柨鐕傛嫹?,inviterRoleId: "+inviterRoleId);
								}
								else if(isLeaderInDuel(inviterRoleId))
								{
									// 闂傚倸鍊搁崐鎼佸磹閹间礁纾归柟闂寸绾惧綊鏌熼梻瀵割槮闁汇値鍠栭湁闁稿繐鍚嬬紞鎴犵磼閹邦収娈滈柡灞革拷鎰佸悑閹肩补锟藉磭顔愭繝娈垮枦椤鎮￠垾鎰佹綎婵炲樊浜堕弫鍡涙煥閻旂儤娅曠紒顔芥楠炴﹢顢欓懖鈺婂敼闂備礁澹婇崑鍛哄锟介幃陇绠涢幘顖涙杸闂佺粯鍔樼亸娆愮閵忋倖鐓曢柡鍐挎嫹鐎癸拷閹间礁钃熼柨娑樺閹风兘鏁愰崼婵堝帿闁诲孩鑹剧紞濠傤潖婵犳艾纾兼繛鍡樺笒閸橈繝鏌ｈ箛鎾剁疄闁告梹鍨块悰顔跨疀濞戞瑦娅㈤梺璺ㄥ櫐閹凤拷?
									TeamManager.logger.debug("FAIL:闂傚倸鍊搁崐鎼佸磹閹间礁纾归柟闂寸绾惧綊鏌熼梻瀵割槮闁汇値鍠栭湁闁稿繐鍚嬬紞鎴犵磼閹邦収娈滈柡灞革拷鎰佸悑閹肩补锟藉磭顔愭繝娈垮枦椤鎮￠垾鎰佹綎婵炲樊浜堕弫鍡涙煥閻旂儤娅曠紒顔芥楠炴﹢顢欓懖鈺婂敼闂備礁澹婇崑鍛哄锟介幃陇绠涢幘顖涙杸闂佺粯鍔樼亸娆愮閵忋倖鐓曢柡鍐挎嫹鐎癸拷閹间礁钃熼柨娑樺閹风兘鏁愰崼婵堝帿闁诲孩鑹剧紞濠傤潖婵犳艾纾兼繛鍡樺笒閸橈繝鏌ｈ箛鎾剁疄闁告梹鍨块悰顔跨疀濞戞瑦娅㈤梺璺ㄥ櫐閹凤拷?,TeamId: "+inviterTeamId);
								}
								else if(checkMap(inviterRoleId, invitedRoleId))
								{
									//闂傚倸鍊峰ù鍥敋瑜嶉湁闁绘垼妫勭壕濠氭煥濠靛棭妲哥痪鎹愵潐缁绘盯骞嬮悙鍐╁哺瀵顓兼径瀣弳濠电娀娼уΛ顓炍ｈぐ鎺撶厱閻庯綆鍓欓弸鎴犵磼缂佹娲存鐐差儏閳诲氦绠涢弴姘亝濠电姷顣藉Σ鍛村磻閸涘瓨鏅濋柕蹇嬪�曢拑鐔兼煟閺傝法娈遍柡瀣閺屾盯鈥﹂幋婵囩亶闂佽绻愮粔鐟邦潖閻戞ê顕辨繛鍡樺灩琚﹀┑鐐茬摠缁繐鈻斿☉顫稏闊洦姊荤弧锟藉┑顔斤供閸撴盯藝閵娿儺娓婚柕鍫濇噽缁犱即鎮楀鐓庡籍闁诡喗顨婇幖褰掑捶椤撶媴绱冲┑鐐舵彧缁查箖宕瑰┑瀣Е妞ゆ劧闄勯悡鏇㈡倵閿濆啫濡奸柨鐔诲Г缁诲倿顢氶敐澶樻晝闁靛繆鏅涢幃鎴︽⒑閸涘﹣绶遍柛銊ュ船閳绘捇寮撮姀鈾�鎷洪梺鍛婄☉閿曘儲寰勯崟顖涚厱閻庯綆鍋呭畷灞绢殽閻愯尙绠叉い锔惧閹棃顢涘☉姗嗕紦闂備焦瀵х换鍌涱殽閸涘﹥娅犳い鏍仦閸婂灚鎱ㄥ鍡楀箹闁告繃妞介弻鈥崇暆鐎ｎ剛袦婵犵鍓濋崕鑲╃不濞戙垹妫樻繛鍡楀綖缁憋拷?闂傚倸鍊搁崐椋庣矆娓氾拷楠炲鍩勯崘顏嗘嚌濠德板�曢幊搴ｇ矆閸喓绡�闂傚牊绋撴晶銏ゆ煟椤撶偞顥㈤柟顔筋殜閺佹劖鎯旈埄鍐憾闂備焦濞婇弨杈╂暜閿熺姴钃熸繛鎴欏灩缁犳盯鏌涜箛鎾存喐闁烩晛閰ｅ娲传閸曢潧鍓遍梺鐑╂櫓閸ㄨ泛顕ｆ繝姘櫢闁绘ɑ褰冮懓鍨攽閻愭潙鐏︽い銊ユ瀹曟澘顫濋懜纰樻嫼闁哄鍋炴竟鍡浰囬敂鍓х＜濠㈣泛顑嗙亸锕傛煙椤旇棄鍔ら柍瑙勫灩閿熸枻缍嗘禍鐐核囬弶娆炬富闁靛牆妫楁慨锕傛煕閹惧瓨鐨戦柨鐔诲Г閼瑰墽绱炴繝鍥х畺婵°倕鎳忛弲鏌ュ箹缁櫢鎷烽幇浣规祰闂備浇顕х�涒晝鍠婂鍛殕闁归棿绀侀拑鐔兼煥濠靛棭妲搁崶鎾椤愩垺澶勯柡灞诲姂椤㈡棃鏁撻敓锟�?闂傚倸鍊搁崐椋庣矆娓氾拷楠炲鍩勯崘顏嗘嚌濠德板�曢幊搴ㄥ垂閸岀偞鈷戞い鎺炴嫹缂佸鏁诲畷鎴﹀煛閸涱喒鎷哄銈嗗釜閹烽绱掓径灞炬毈闁糕晜鐩獮瀣晜閻ｅ苯寮抽梻浣虹帛濞叉牠宕愰崷顓ㄦ嫹濮樼偓瀚�?闂傚倸鍊搁崐宄懊归崶褏鏆﹂柛顭戝亝閸欏繘鏌℃径瀣婵炲樊浜滃洿婵犮垼娉涢敃銈囪姳閵夆晜鈷戦柛婵嗗椤箓鏌涙惔銊ゆ喚闁诡垰鑻灃闁告侗鍨拌ぐ鍕⒑閹肩偛鍔橀柛鏂跨Ф缁牓宕奸妷锔惧幗濡炪倖鎸鹃崰鎰暦瀹�鍕厵妞ゆ棁鍋愮粔铏癸拷瑙勬礀閻栧吋淇婇幖浣肝ㄧ憸蹇涘Χ閻戣姤鈷掑ù锝堟鐢盯鏌熼崨濠冨�愮�规洘鍔欏畷褰掝敋閸涱喚绋佸┑鐘垫暩婵敻鎳濋崜褏鐭嗛柛鎰ㄦ杺娴滄粓鐓崶銊﹀碍妞ゅ浚浜弻锝嗘償閵堝棭浠╃紓浣介哺閹稿骞忛崨鏉戠闁圭儤鍨堕崕鎾绘⒒娴ｄ警鐒炬い鎴濇喘瀹曟垿鎮㈤崫鍕亰濠电偛妫欓幐濠氬疾閹间焦鐓ラ柣鏇炲�圭�氾拷?
									Team team = TeamManager.getInstance().createNewTeam(inviterRoleId);
									if(team == null)
									{
										//fire.pb.talk.Message.sendMsgNotify(inviterRoleId, TeamManager.ERROR_MSG_SELF_CANT_IN_TEAM, null);
										fire.pb.talk.MessageMgr.sendMsgNotify(invitedRoleId, TeamManager.ERROR_MSG_OBJECT_CANT_IN_TEAM, null);
										TeamManager.logger.debug("FAIL:闂傚倸鍊搁崐鎼佸磹妞嬪海鐭嗗〒姘炬嫹妤犵偛顦甸弫宥夊礋椤掍焦顔囨繝寰锋澘锟芥洟宕导瀛樺剹婵炲棙鎸婚悡娆撴倵閻㈡鐒鹃崯鍝ョ磼閹冪稏缂侇喗鐟╁濠氭偄閻撳海顦悷婊冪箳閺侇喖鈽夐姀锛勫帗闂備礁鐏濋鍡楃暦瀹�鍕厸鐎癸拷鐎ｎ剛袦閻庢鍣崜鐔风暦瑜版帩鏁嬮柛娑卞枟椤旀垹绱撻崒姘拷椋庢閵堝绠�瑰嫭澹嬮弨浠嬫煟濡绲诲ù婊呭仱閺岋綁寮幐搴＆闂佸搫鐬奸崰鏍�佸☉妯锋婵妫欓ˉ瀣磽閸屾瑩妾烽柛鏂胯嫰椤洭鏁撻悩鑼暫閻庣懓瀚竟瀣几鎼淬垻绠鹃柛鈩兠悘鈺呮煛閸℃劕锟芥繂顫忛悜妯诲闁规鍣Σ顔剧磽娴ｅ壊妲洪柟铏崌閹箖鎮滈懞銉ヤ簵闁圭厧鐡ㄨ摫闁哄偊鎷烽梻鍌欒兌绾爼宕滃┑瀣鐟滅増甯掗懜鍦喐閻楀牆绗氶柍閿嬪笒闇夐柨婵嗘噺閹牓鎮介姘暢闁汇儺浜炵槐鎺楀閻樿尙鐫勯柣搴㈩問閸犳鎮￠敓鐘拷渚�寮撮姀鈩冩珖闂佽法鍠嶇划娆忣嚕閸涘﹦鐟归柨鐔绘椤曪綁宕奸弴鐐哄敹濠电偞鍨堕敋妞ゎ剙顑呴—鍐Χ閸屾稒鐝曢梺缁樻惈缁绘繈鎮伴锟藉浠嬪Ω閿斿墽肖闂備礁鎲￠幐鍡涘礃閵娧冨笓缂傚倸鍊烽悞锕傘�冮崱娑樺瀭闁割煈鍣鏍煣韫囨凹娼愰悗姘哺閺屽秹濡烽妷銉︽瘣濡ょ姷鍋為崝妤冩閹惧鐟瑰┑鐘插暙椤忚泛鈹戦悙瀛樺鞍闁绘棏鍓熼獮蹇旑槹鎼搭垱瀚归悷娆忓婢跺嫰鏌涢妸锕�鈻曟鐐村灴瀹曠喖顢涘В灏栨櫇閹叉瓕绠涘☉姘ウ闂佽鍎抽顓犵不妤ｅ啯鐓欓柛鎾楀本顥撴繝銏ｎ潐閿曘垽寮婚妸鈺佸嵆妞ゅ繐瀚峰ú顓犵磽娓氬洤鏋涢柣妤佹尭閻ｇ兘宕￠悙鈺傤潔濠电偛妫欓崹鐢垫暜妤ｅ啯鈷掑ù锝堝Г绾爼鏌涢敐蹇曠暤妤犵偛绻橀弫鎾绘晸閿燂拷?");
										return true;
									}
									//濠电姷鏁告慨鐑藉极閸涘﹥鍙忛柣鎴濐潟閿熻棄鍊圭粋鎺旓拷锝庡亝濞呫垽姊洪懞銉冾亪藝椤栫偛姹查梺顒�绉甸悡銉╂煟閺冨倻甯涙い銉ヮ槺缁辨挸顓奸崪鍐惈濡ょ姷鍋涢崯顐ョ亽闁荤姴娲╃亸娆戠玻閻愮儤鈷戠憸鐗堝笒娴滀即鏌涢幘瀵告噰闁诡噣娼ц灒闁煎鍊楅惁鍫ユ⒑闂堟盯鐛滅紒鎻掑⒔濞戝灚銈ｉ崘鈺冨幗濡炪倖甯掗崐鍝ユ暜閸洘鐓冪紓浣股戦ˉ鍫濃攽椤曞棙瀚归梻浣虹帛閿曗晠宕戦崨鏉戞闁跨喍绮欏缁樻媴閾忕懓绗￠梺鎸庢皑閻ヮ亞绱掗姀鐘茬睄闂佽鍣换婵嬨�佸☉銏″�烽悗鐢殿焾楠炲秵淇婇妶鍥ラ柛瀣洴閹ê鈹戠�ｎ偄锟藉爼鏌ょ喊鍗炲⒕闁圭兘顥撻幉鎾礋椤掑偆妲扮紓鍌欐祰椤曆囨偋閹惧磭鏆︽繛宸簻缁�瀣亜閺嶃劍鐨戞い锔哄姂濮婅櫣锟藉湱濯崵鍐煕閹惧崬濡跨紒顔碱煼楠炲鏁冮敓浠嬫偂閳ユ剚鐔嗛柤鎼佹涧婵洨绱掗悩鍝勫惞闁跨喎锟界噥娼愭繛鍙夌墪閳绘棃鏁冮崒姘兼綂闂侀潧鐗嗗Λ娑㈠储閸楃偐鏀介柍钘夋閻忋儲銇勯弴鍡楁处閸婂爼鏌嶉崫鍕櫤闁绘挻鐟ч敓鐣屾嚀鐎氫即宕戞繝鍥х？闁瑰濮风壕鍏笺亜閺冨倹娅曢柟鍐叉处椤ㄣ儵鎮欓弶鎴濐潔闂佽鍨卞Λ鍐春閵夆晛骞㈤柡鍥╁Х椤︺儵姊婚崒姘拷鎼佸磹閻戣姤鍤勯柛顐ｆ磵閿熸枻绠撳畷濂稿閳ュ啿绨ラ梻浣烘嚀閻°劎鎹㈤幇鐗堝殌闁秆勵殕閻撴洟鏌ㄩ弮鍥跺殭妤犵偞鐗犻弻娑㈠Ω閿斿墽鐣洪梺闈涙搐鐎氫即鐛幒鎴悑闁割偅绻傜敮顖涗繆閻愵亜锟芥劙寮插鍫熷亗闁跨喓濮撮拑鐔烘喐閹寸姷涓嶆繛鎴欏灩缁犺崵鐥幆褜鍎戞い銏犳嚇濮婄粯鎷呯憴鍕╀户闂佸憡锚閵堟悂銆侀弽銊ョ窞濠电姴瀛╃紞搴㈢節閻㈤潧校闁肩懓澧界划鍫ュ礃閳瑰じ绨婚棅顐㈡处閹告悂顢旈鍫熺厽闊洤娴烽ˇ锕傛煃鐟欏嫬鐏撮柟顔界懇閹崇娀顢楅敓浠嬪煕婵犲洦鈷戦柣鐔告緲濞堚晠鏌熼崙銈嗗
//									if(!MarryTaskStepManager.checkMarryTaskState(team.getAllMemberIds(), invitedRoleId)){
//										//TODO
//										return true;
//									}
									//婵犵數濮烽弫鍛婃叏閻戣棄鏋侀柟闂寸绾惧潡鏌熺�电啸缂侊拷婵犲洦鐓ラ柣鏃囶嚙琚氶梺闈涙搐鐎氭澘顕ｉ幘顔煎耿婵°倧鎷锋い蹇ｄ邯閺屾稑鈻庤箛鏇狀啋闂佸搫鐭夌紞渚�鐛崶顒夋晢濞达絿鎳撻崜鍨節绾版ɑ顫婇柛瀣嚇閺佸啴濮�閵堝懓鎽曢梺鎸庣箓閹叉﹢寮崼鐔告婵炲濮撮鍡涘磻鐎ｎ喗鐓曢柍鈺佸暟閳句線鏌涙繝鍌滃煟闁哄本鐩俊鐑筋敊閻撳寒娼介梻浣虹帛閹歌煤閻旂厧钃熼柕濞炬櫆閸嬪棝鏌涚仦鍓р槈妞ゅ骏鎷�?
									TeamManager.logger.debugWhileCommit("SUCC:闂傚倸鍊搁崐鎼佸磹閹间礁纾归柟闂寸绾惧綊鏌熼梻瀵割槮闁汇値鍠栭湁闁稿繐鍚嬬紞鎴犵磼閹邦収娈橀柨鐔绘缁犲秹宕曢崡鐏绘椽鏁冮崒锔剧◤闂佸搫娲㈤崹娲偂閻斿吋鐓欓梺顓ㄧ畱婢ь垶鏌熼姘卞ⅱ缂佽鲸甯￠弫鎾绘嚍閵夈儳绐為梺褰掑亰閸橀箖宕㈤挊澶嗘斀闁宠棄妫楅悘銉︺亜閺囧棗鎳庣欢銈夋煠婵劕锟窖囧箯瀹勬壋鏋旈柛顭戝枟閻忓秵绻濋悽闈涗粶闁挎洏鍊濋、姘舵晲婢跺﹪鍞堕梺鍝勬川閸嬬喖宕㈤幖浣光拺缂佸瀵у﹢鎵磼椤旇偐效鐎规洘濞婃俊鐑藉煛閸屾瀚藉┑鐐舵彧缁插潡鈥﹂崼銏㈡／鐟滃繒妲愰幒妤婃晩闁兼亽鍎辩喊宥咁渻閵堝棙绌跨紓宥勭窔閵嗕礁螖閸涱厾顦板銈嗗釜閹峰嘲霉濠婂牅鎲炬慨濠冩そ瀹曟粓骞撻幒宥囧嚬缂傚倷娴囬褏锟芥凹鍘剧划瀣吋婢跺娅滄繝銏ｆ硾椤戝倿骞忓ú顏呪拻闁稿本姘ㄦ晶鎰版煛閸涱喚鐭岄柨鐔诲Г閻旑剟骞忛敓锟�?(闂傚倸鍊搁崐鎼佸磹妞嬪海鐭嗗〒姘炬嫹妤犵偞鐗犻、鏇㈡晝閿熺晫澹曡ぐ鎺撶厽闁绘梻鍘ф禍浼存煟閺傛寧顥炲ǎ鍥э躬椤㈡稑鈹戦崱鏇熺潖缂備焦鍎宠ぐ鐐靛垝濞嗘挸钃熼柣鏃傚帶缁�鍫㈡喐韫囨洘鏆滄繛鎴欏灪閻撴洟骞栨潏鍓х？閺佸牓姊洪崫鍕拱闁烩晩鍨伴锝夊箻椤斿槈鈺呮煏婢诡垰鍊婚弫楣冩⒑閼姐倕浠︾痪鏉跨Ф閹广垽宕橀鍛簥濠电偞鍨堕悢顒勫箯閻戣姤鍋ㄦ繛鍫ｆ硶閸旀悂鏌ｉ姀鈺佺仩濠⒀冩捣濡叉劙骞掗弮鎾村闁挎繂绨肩花缁樸亜韫囷絽浜濆ǎ鍥э躬瀹曪絾寰勬繝鍌ゆ綋闂備礁鐤囬～澶愬垂瑜版帗鏅搁柡鍌樺�楃粔鐢告煕鐎ｎ亝顥㈢�规洘绻堥弫鎾绘晸閿燂拷?闂傚倸鍊搁崐宄懊归崶褏鏆﹂柛顭戝亝閸欏繘鏌℃径瀣婵炲樊浜滄儫闂佸疇妗ㄥù鍥箺閺囥垺鈷戦悹鎭掑妼濞呮劙鏌熼崙銈嗗?闂傚倸鍊搁崐椋庣矆娓氾拷楠炲鍩勯崘顏嗘嚌濠德板�曢幊搴ｇ矆閸喓绡�闂傚牊绋撴晶銏ゆ煟椤撶偞顥㈤柟顔筋殜閺佹劖鎯旈埄鍐憾闂備焦濞婇弨杈╂暜閿熺姴钃熸繛鎴欏灩缁犳盯鏌涜箛鎾存喐闁烩晛閰ｅ娲传閸曢潧鍓遍梺鐑╂櫓閸ㄨ泛顕ｆ繝姘櫢闁绘ɑ褰冮懓鍨渻閵堝棙灏甸柛鐘查叄椤㈡棃鏁撻敓锟�),TeamId: "+inviterTeamId);
									return team.addNewMemberWithSP(invitedRoleId);
								}
							}
						}
					}
				}
				else
				{
					java.util.List<String> name = new java.util.ArrayList<String>();
					name.add(invitedName);
					if(checkInviteFromTeam(inviterTeamId))
					{
						//闂傚倸鍊搁崐鎼佸磹妞嬪海鐭嗗〒姘炬嫹妤犵偛顦甸弫鎾绘偐閸愯弓鐢婚梻浣瑰濞叉牠宕愰幖浣稿瀭闁稿瞼鍋為悡銉╂煟閺囩偛锟藉湱锟芥熬鎷�?婵犵數濮烽弫鎼佸磻閻樿绠垫い蹇撴缁�濠囨煥閻旇袚缂佺粯鐩畷顏堝礃椤忓柊婊堟⒑绾懏鐝紒顔芥尭閻ｉ攱绺界粙鍨祮闂佺粯鏌ㄥ鍓侊拷姘矙濮婄粯鎷呴崨濠傛殘闂佸憡妫戦梽鍕矉瀹ュ拋鐓ラ柛顐ｇ箓閸ゆ垵鈹戦悙鏉戠仧闁搞劍妞介幃鈥斥槈閵忥紕鍘遍梺瀹犳濡鐛Δ鍛�垫慨妯煎亾鐎氾拷
						Long leaderId = xtable.Team.selectTeamleaderid(inviterTeamId);
						if(leaderId!=null)
						{
							fire.pb.talk.MessageMgr.psendMsgNotify(leaderId, 140851, name);
							psendWhileCommit(leaderId, new SRespondInvite(invitedRoleId,(byte)0));
						}
					}
					else
					{
						//闂傚倸鍊搁崐鎼佸磹妞嬪海鐭嗗〒姘炬嫹妤犵偛顦甸弫鎾绘偐閸愯弓鐢婚梻浣瑰濞叉牠宕愰幖浣稿瀭闁稿瞼鍋為悡銉╂煟閺囩偛锟藉湱锟芥熬鎷�?婵犵數濮烽弫鎼佸磻閻樿绠垫い蹇撴缁�濠囨煥閻旇袚缂佺粯鐩畷顏堝礃椤忓柊婊堟⒑绾懏鐝紒顔芥尭閻ｉ攱绺界粙鍨祮闂佺粯鏌ㄥ鍓侊拷姘偢濮婄粯鎷呴懞銉с�婇梺闈╃秶缁犳捇鐛箛娑欐櫢闁跨噦鎷�?闂傚倸鍊搁崐宄懊归崶褏鏆﹂柛顭戝亝閸欏繘鏌℃径瀣婵炲樊浜滄儫闂佸疇妗ㄥù鍥箺閺囥垺鈷戦悹鎭掑妼濞呮劙鏌熼崙銈嗗??
						fire.pb.talk.MessageMgr.psendMsgNotify(inviterRoleId, 140851, name);
						psendWhileCommit(inviterRoleId, new SRespondInvite(invitedRoleId,(byte)0));
					}
					TeamManager.logger.debug("FAIL闂傚倸鍊搁崐鎼佸磹閻戣姤鍊块柨鏃�鎷濋幏椋庣箔濞戞ɑ鍣介柣顓熺懇閺岀喓锟界數顭堟禒褔姊婚崟顐㈩伃闁哄矉绻濆畷姗�濡搁妷顖涘闁煎鍊楁稉宥夋煛閸屾侗鍎ラ柣鏂挎閺屻倝骞栨担瑙勯敪婵犳鍠栧ú銊ф閹烘鍋愰柛鎰ゴ閺嬫瑩姊洪崫鍕拱婵炲弶锚椤曘儵宕熼姘跺敹濠电娀娼уΛ妤咃綖閹惧墎纾介柛灞捐壘閿熻棄鎽滅划娆撳礋椤栨氨顔嗘俊鐐差儏濞撮澹曟禒瀣厱閻忕偞宕樻竟姗�鏌ㄩ悢鍓佺煓妞ゃ儲鎸鹃崚鎺楀醇閻旂顎撻梺缁樿壘閻°劎锟芥俺顫夐幈銊ヮ潨閸℃绠虹紓浣藉煐閻撯�崇暦閿熺姵鐒肩�广儱妫涢崣鍡涙⒑閸濆嫭宸濋柛瀣洴閺佹捇鎸婃径宀�楔闂佽鍠氶崑銈夊极閹剧粯鏅搁柨鐕傛嫹?闂傚倸鍊搁崐宄懊归崶褏鏆﹂柛顭戝亜閸ㄦ棃鏌熺紒銏犳灈缂佺媭鍨堕弻銊╂偆閸屾稑顏�?,invitedRoleId: "+invitedRoleId);
				}
				//濠电姷鏁告慨鐑藉极閹间礁纾婚柣鎰惈閸ㄥ倿鏌涢锝嗙缂佺姳鍗抽弻娑樷攽閸曨偄濮㈤梺娲诲幗閹瑰洭寮婚敐澶婎潊闁绘ê鍚�缁敻姊洪崫鍕棡缂侇喗鎹囧濠氭偄閾忓湱锛滈梺闈涚箳婵敻鎮橀崼銉︹拺婵炶尪顕ч獮妤併亜閵娿儲顥炵紒宀冮哺缁绘繈宕堕‖顑洦鐓曟繛鎴濆船閺嬫稒绻涢崪鍐М婵﹨娅ｉ幑鍕Ω閵夛妇浜炴繝纰樻閸嬪嫮锟芥矮鍗抽妴渚�寮介鐐靛�炲銈嗗釜閹烽绱掗悪锟介崹鍫曞蓟閿濆憘鐔兼嚃閳轰胶顐奸梻浣虹帛閹稿爼宕曢悽绋跨畺婵°倕鎳忛弲鏌ュ箹鐎涙绠橀柡浣圭墬缁绘稓锟界數顭堟牎闂佸憡姊归悷銉╋綖韫囨拋娲敂閸曨収妲梻浣侯焾缁绘宕戦幇鏉跨闁跨喓濮甸埛鎴︽煟閻斿憡绶查柡鍡氫含缁辨帞绱掑Ο鐑樿癁閻庢鍣崑濠囥�佸鑸垫櫢濞寸姴顑囧畵浣规叏濡ゅ瀚瑰銈冨灪閻熲晠骞婇弽顓炵厸闁告劑鍔岀粻鎴炵節閻㈤潧孝闁汇儱顦靛鍫曞礌閳╁啫顏堕梺鍝勬储閸ㄥ湱绮婚悩璇茬婵烇綆鍓欐俊浠嬫煛閸涱喗鍊愰柡宀嬬畱铻ｅ〒姘煎灡閳绘捇姊虹粙鍨劉闁搞劌娼″濠氭偄閸撳弶效闁硅偐琛ョ�殿剟鏁愰崱鎰盎闂佹寧姊归崕鎶姐�傛總鍛婄厵妞ゆ牗绋掗ˉ鍫濃攽椤曞棙瀚归梻渚�娼х换鍡涘礈濠靛鏁婇煫鍥ㄧ♁閳锋帡鏌涚仦鍓ф噮妞わ讣绠撻弻鐔哄枈閸楃偘鍠婇柦妯荤箖閵囧嫰骞囬崼鏇燁�嶉梺鍝勬噺閹倿寮婚敃锟借灒濞撴凹鍨辩瑧缂傚倷鑳剁�氬繘宕熼埡锟界花濠氭⒑瑜版帒浜板ù婊呭仱閹苯鈻庨幘瀵稿幐閻庣櫢鎷烽悗锝庡墰閻﹀牓鎮楃憴鍕闁靛牊鎮傞妴渚�寮撮姀鈩冩珫闂佸憡娲﹂崑鍕掗崼銉︹拺閻犲洦褰冮銏°亜閺冿拷閻楃姴鐣烽鐑嗘晝闁挎洩鎷风�瑰憡绻冮妵鍕籍閸ヮ煈妫勯梺鍛婃⒐濮樸劎妲愰幘璇茬＜婵炲棙鍨垫俊鐣岀磽娴ｅ壊鍎愰柛銊ф暬閺佸啴濮�閳╁啰绉堕梺鍐叉惈閸熶即鎮為崗鑲╃瘈闁靛骏绲介悡鎰版煕閺冿拷閻楃娀宕哄☉銏犵闁绘劦浜欑花濠氭⒑閸濆嫬鏆欓柛濠傜埣閺佹捇鎸婃径妯哄壎濡ょ姷鍋涚换姗�骞冨鍫熷殟闁靛鍎扮花钘夆攽閻愯埖褰х紒鑼舵閿曘垽鏌嗗鍡椾簵闂佺鎻梽鍕煕閹烘嚚褰掓晲閸涱喖鏆堥梺鍝ュ枔閸嬨倝骞冩禒瀣垫晬婵犲﹤鍟╁▽顏嗙磽娴ｈ櫣甯涢柣鈺婂灦瀵偊骞樼紒妯烘疅闂侀潧锛忛崪浣告櫗闂傚倷绀侀幉鈩冪瑹濡ゅ懎鐭楅柛鎰靛枛閻鏌涢弴銊ョ仭闁绘挻绋撻敓鐣屾閹风兘鎮楅敐搴′簻妞ゅ骏鎷�?闂傚倸鍊搁崐宄懊归崶褏鏆﹂柛顭戝亜閸ㄦ棃鏌熺紒銏犳灈缂佺媭鍨堕弻銊╂偆閸屾稑顏�?
				}
				finally{
					deleteInvite(invitedRoleId);
				}
				return true;
			}
			
		};
		resInviteP.submit();		
	}
	
	private boolean checkMap(long leaderRoleId, long applierRoleId){
		boolean inWaiting1 = false;
		boolean inWaiting = false;
		
		//闂傚倸鍊搁崐鎼佸磹妞嬪海鐭嗗〒姘炬嫹妤犵偛顦甸弫鎾绘偐閸愯弓鐢婚梻浣瑰濞叉牠宕愰幖浣稿瀭闁稿本鍩冮弨浠嬫煕鐏炲墽鐭ら柣鎺戝⒔缁辨帡鎮╁畷鍥у绩闂佸搫琚崝宀勫煘閹达箑骞㈡慨妤�妫欓敓銉︿繆閻愵亜锟芥劙寮查鍫濈闁跨噦鎷�?
		final fire.pb.map.Role  invitMaprole = fire.pb.map.RoleManager.getInstance().getRoleByID(leaderRoleId);
		final fire.pb.map.Role  desMaprole = fire.pb.map.RoleManager.getInstance().getRoleByID(applierRoleId);
		if(invitMaprole == null || desMaprole == null){
			return true;
		}
		int srcMapId = invitMaprole.getMapId();
		MapConfig cfg = ConfigManager.getInstance().getConf(MapConfig.class).get(srcMapId);
		
		int desMapId = desMaprole.getMapId();
		MapConfig descfg = ConfigManager.getInstance().getConf(MapConfig.class).get(desMapId);
		
		if(inWaiting || inWaiting1){
			return false;
		}
		
		//闂傚倸鍊搁崐鎼佸磹妞嬪孩顐芥慨姗嗗墻閻掍粙鏌ゆ慨鎰拷鏍拷姘煼閺岋綁寮崒姘粯缂備緤鎷峰璺虹焿閹风兘鎯傞崨濠傤伓闂備礁鎲″ú锕傚礈濞嗘劗顩峰┑鍌氭啞閳锋垿姊婚崼鐔峰礋闁割偁鍎遍悿鐐箾閹寸偞鐨戦柣顓炴閺屾稑鐣濋敓浠嬪磻閻愮儤鍋傞煫鍥ㄦ尨閺�浠嬫煟閹邦垰鐨哄ù鐘灲閺屾盯寮敓鐣屽垝閹捐钃熸繛鎴欏灩閸楁娊鏌曡箛瀣伄闁哄棭鍋婂娲传閸曨剚鎷遍梺鐑╂櫓閸ㄨ泛顕ｉ锕�绠荤紓浣股戝▍銏ゆ⒑鐠恒劌娅愰柟鍑ゆ嫹? 濠电姷鏁告慨鐑藉极閹间礁纾婚柣鎰惈閸ㄥ倿鏌涢锝嗙缂佺姳鍗抽弻娑樷攽閸曨偄濮㈤梺娲诲幗閹瑰洭寮婚敐澶婎潊闁绘ê鍟块弳鍫ユ⒑缁嬫鍎忔い鎴濐樀閻涱噣寮介‖銉ラ叄椤㈡鏁撴禒瀣�块柣鎴烆焽缁犻箖鏌涢鐘茬仾婵炲懏娲熼弻銊╂偄閻戞ɑ鐝┑鐐叉噷閸ㄤ粙鐛箛娑欏�婚柤鎭掑劤閸欏棝姊虹紒妯烩拻闁稿簺鍊曢埢宥夊即閵忥紕鍘遍梺鍦劋閹稿摜绮幒鎾变簻闁规儳鍟块幃鎴狅拷鍨緲鐎氼噣鏁撻弬銈嗭拷銉╁礋椤愩倖袧?
		if(cfg == null || descfg == null){
			return true;
		}
		if(cfg.getSafemap() == descfg.getSafemap() && cfg.getSafemap() == 1){
			return true;
		}
		
		return true;
	}

	// 婵犵數濮烽弫鍛婃叏閻戝锟藉倿鎸婃竟鈺嬬秮瀹曠喖顢涘槌栧數闂備浇娉曢崳锕傚箯閿燂拷?婵犵數濮烽弫鍛婃叏閻戣棄鏋侀柟闂寸绾惧鏌ｉ幇顒佲枙闁绘帟濮ょ换娑㈠幢濡纰嶉梺缁樻尰閿曘垽寮婚悢鐑樺磯妞ゎ厽鍨堕锟�
	private static int checkPvP(long inviterRoleId, long invitedRoleId) {
		// 闂傚倸鍊搁崐鎼佸磹閻戣姤鍊块柨鏇炲�哥粻鏍煕椤愶絾绀�缁炬儳娼￠弻鐔煎箚閻楀牜妫勭紒鎯у⒔缁垳鎹㈠☉銏犵闁绘劙顣︾�涒晜绻濆▓鍨灍濠电偛锕濠氭晬閸曨亝鍕冮柣鐘叉处瑜板啯鎱ㄩ弴銏♀拺缂備焦锚闁叉粓鏌熼崙銈嗗?闂傚倸鍊搁崐宄懊归崶褏鏆﹂柛顭戝亜閸ㄦ棃鏌熺紒銏犳灈缂佺媭鍨堕弻銊╂偆閸屾稑顏�?
		return fire.pb.battle.pvp.PvPTeamHandle.onRespondInvite(inviterRoleId, invitedRoleId);
	}

	//闂傚倸鍊搁崐鎼佸磹閹间礁纾瑰瀣椤愪粙鏌曢崼婵愭Ц缂佺媭鍨堕弻銊╂偆閸屾稑顏�?闂傚倸鍊搁崐宄懊归崶褏鏆﹂柛顭戝亝閸欏繘鏌℃径瀣婵炲樊浜滃洿婵犮垼娉涢敃銈囪姳閵夆晜鈷戦柛婵嗗椤箓鏌涙惔銏㈠弨鐎规洘鍨挎俊鑸靛緞鐎ｎ剙甯惧┑鐘垫暩閸嬬喖宕戦幘鏂ユ瀺闁告稑鐡ㄩ悡娆撴煟閻旂顥嬮柛鈺嬬秮閺岋紕浠﹂悙顒傤槰缂備胶绮换鍡欑不濞戙垹妫樻繛鍡楀綖缁憋拷?闂傚倸鍊峰ù鍥敋瑜忛幑銏ゅ箳濡わ拷绾惧鏌ｅΟ娆惧殭缁炬儳顭烽弻鐔煎箥椤旂⒈鏆梺绋款儌閸撴繈濡甸崟顖氱鐎广儱鐗嗛崢锛勭磽娴ｅ搫鈻堢紒鐘崇墵楠炲啫顫滈敓浠嬪箖濞嗘挸绠甸柟鐑樼箑濞ｎ噣姊绘担渚劸闁挎洏鍎甸妴鍐川鐎涙ê浠卞銈嗘尪閸ㄦ椽鍩涢幒鎳ㄥ綊鏁愰崨顔兼殘闂佽鍨伴悧鎾诲蓟濞戙垺鍋勭紒瀣氨閺嬫瑥顪冮妶鍐ㄧ仾闁荤啿鏅犻悰顕�宕堕澶嬫櫓缂備焦绋戦鍡欑礊濡ゅ懏鈷掑ù锝呮贡濠�浠嬫煕閵娿儺鐓奸柍銉畵瀹曞ジ濡烽敃锟介崜鐟扳攽鎺抽崐鎾绘⒔瀹ュ棛顩叉繝濠傜墢閸欐捇鏌涢妷锝呭閻忓繋鍗抽弻鐔煎礂閻撳骸顫掗梺鍝勬湰缁嬫垼鐏掔紓鍌欑劍閿氶柛鐐差樀濮婃椽宕崟顒佹嫳闂佺儵鏅╅崹璺侯嚕椤愶箑纾奸柣鎰綑娴狀參姊鸿ぐ鎺撴锭闁哥喕鍎婚妵鎰姳婵夌edure濠电姷鏁告慨鐑藉极閹间礁纾婚柣鎰惈閸ㄥ倿鏌涢锝嗙缂佺姴缍婇弻宥夊传閸曨剙娅ｉ梺娲诲幗椤ㄥ﹪寮婚妸鈺傚亜閻犲洦鐣幘缁樼厪闁搞儜鍐句純濡炪們鍨哄ú鐔笺�佸Δ鍛櫢濞寸姴顑冮敓钘夋嚇椤㈡宕熼鍌氬箥濠电娀娼ч崐鎼佀囬娑氼洸闁规鍣幏椋庢喆閸曨剛顦ㄩ梺鎸庢磸閸ㄤ粙濡存笟锟藉顕�宕煎┑鍡欑崺婵＄偑鍊栧濠氭偤閺冨牆瑙﹂柨鐕傛嫹
	private boolean checkInviteExist(long invitedRoleId)
	{
		//闂傚倸鍊搁崐鎼佸磹閻戣姤鍤勯柛顐ｆ磵閿熸枻绠撳畷濂稿閳ュ啿绨ラ梻浣筋潐婢瑰棙鏅跺Δ鍛；閻庯綆鍠楅悡鏇熺箾閹存繂鑸归柣蹇曞█閺屾盯濡搁敂鍓х杽闂佸搫鐭夌徊鍊熺亽闂佸吋绁撮弲娑氱箔閿熺姵鈷戠紓浣姑柌婊堟煙閸戙倖瀚�?闂傚倸鍊搁崐宄懊归崶褏鏆﹂柛顭戝亝閸欏繘鏌℃径瀣婵炲樊浜滄儫闂佸疇妗ㄥù鍥箺閺囩喓绡�闁靛骏绲介悡鎰版煕閺冿拷濞叉繄鎹㈠鑸碘拻濞达絽鎲￠崯鐐烘煕閺傝法绠荤�殿喗褰冮埞鎴狅拷锝庝簽閸樻椽姊洪崫鍕灕闁归鍏橀弻鏇㈠炊瑜嶉顓燁殽閻愭惌鐒介柟鐟板閹粌螣闂傚鎸夐梻鍌氬�风粈渚�骞夐敓鐘冲仭闂侇剙绉寸粻顖炴煟閹达絽袚闁抽攱甯掗湁闁挎繂娲ら崝瀣煕閵堝繑瀚归梻鍌欐祰椤曆呮崲閹达附鍤屽Δ锝呭暞閸嬧晝锟界懓瀚伴崑濠傤焽閵娾晜鐓ラ柣鏂垮閻瑩鏌曢崱鏇狀槮妞ゎ偅绻堥、妤佸緞鐎ｎ亜鍘炲┑锛勫亼閸婃牠骞愰悙顒�鍨旀い鎾朵紳濞差亜绠瑰ù锝呭帨閹疯櫣绱撻崒娆戝妽闁挎岸鏌ｈ箛銉х暤闁归攱鍨跺蹇涘煛閸愵亞鏆ラ梻浣侯攰閹活亪姊介崟顖氱厱闁硅揪闄勯悡鏇熺箾閹寸儑鍏柛鏃傚枛閺屾盯鎮㈢拠鑼缂備浇椴哥敮锟犲箖閳哄懎绀冮柛娆忣槼閻т線姊绘担鐟邦嚋缂佽瀚板畷鎴﹀Χ婢跺﹥鐎梺鍛婂姦閸犳牜澹曢崗鑲╃闁瑰鍋犳竟妯衡攽椤曞棙瀚�?闂傚倸鍊搁崐宄懊归崶褏鏆﹂柛顭戝亜閸ㄦ棃鏌熺紒銏犳灈缂佺媭鍨堕弻銊╂偆閸屾稑顏�?
		xbean.InviteInfo invite = xtable.Teaminvite.get(invitedRoleId);
		if(invite == null)
			return false;
		else if(!invite.getBeinginvited())
			return false;
		else if((now - invite.getInviting().getInvitetime()) > TeamManager.MAX_INVITE_TIMEOUT)
		{   //闂傚倸鍊搁崐鎼佸磹閹间礁纾瑰瀣椤愪粙鏌曢崼婵愭Ц缂佺媭鍨堕弻銊╂偆閸屾稑顏�?闂傚倸鍊搁崐宄懊归崶褏鏆﹂柛顭戝亝閸欏繘鏌℃径瀣婵炲樊浜滄儫闂佸疇妗ㄥù鍥箺閺囩喓绡�闁靛骏绲剧涵楣冩煟椤掞拷閵堟悂骞嗗畝鍕缂備焦顭囬崢鐢电磽閸屾瑩妾烽柛銊ョ秺瀵鈽夊杈╋紲濡炪倖鍔﹂崜姘憋拷姘炬嫹?
			invite.setBeinginvited(false);
			cleanTimeoutInvites(invite.getInvited());
			return false;
		}
		else
			return true;
	}
	
	// 闂傚倸鍊搁崐宄懊归崶褏鏆﹂柣銏㈩焾绾惧鏌ｉ幇顒佹儓缂侊拷閸曨厽鍠愰柣妤�鐗嗙粭鎺旂棯閹规劦鍤欓柍瑙勫灴閹晠宕ｆ径瀣�风紓浣哄亾閸庡磭绱炴繝鍥х畺婵°倕鎳忛弲鏌ュ箹缁櫢鎷烽幇浣规祰闂備浇顕х�涒晝鍠婂鍛殕闁归棿绀侀拑鐔兼煥濠靛棭妲搁崶鎾椤愩垺澶勯柡灞诲姂椤㈡棃鏁撻敓锟�?闂傚倸鍊搁崐椋庣矆娓氾拷楠炲鍩勯崘顏嗘嚌濠德板�曢幊搴ㄥ磼閵娿儍褰掓偐瀹割喖鍓抽梺鍛婄懄濞叉﹢濡甸崟顖氱闁瑰瓨绻愰幏鐑芥嚒閵堝拋妫滄繝闈涘�搁幉锟犳偂閵夆晜鐓熼柡鍥╁仜閿熻棄婀遍敓鑺ョ啲閹凤拷??闂傚倸鍊搁崐鎼佸磹妞嬪海鐭嗗〒姘炬嫹妤犵偛顦甸弫鎾绘偐閸愯弓鐢绘俊鐐�栭悧妤冪矙閹炬眹锟藉懘寮婚妷锔惧弳濠电娀娼уΛ顓炍ｉ崫銉х＜闁跨喍绮欏畷鎺戔槈濞嗗繐浼庢繝寰锋澘锟芥洟顢栭崱娆欐嫹濮橆剛绉洪柟顔筋殘閹叉挳宕熼鍌ゆФ闂備胶顭堢换鎴︽晝閵忕姷鏆﹂柣鎴灻欢鐐烘煙闁箑澧版い鏂挎嚇濮婄儤瀵煎▎鎴濐嚤缂備焦妫忛弻鍗島re濠电姷鏁告慨鐑藉极閹间礁纾婚柣鎰惈閸ㄥ倿鏌涢锝嗙缂佺姴缍婇弻宥夊传閸曨剙娅ｉ梺娲诲幗椤ㄥ﹪寮婚妸鈺傚亜閻犲洦鐣幘缁樼厪闁搞儜鍐句純濡炪們鍨哄ú鐔笺�佸Δ鍛櫢濞寸姴顑冮敓钘夋嚇椤㈡宕熼鍌氬箥濠电娀娼ч崐鎼佀囬娑氼洸闁规鍣幏椋庢喆閸曨剛顦ㄩ梺鎸庢磸閸ㄤ粙濡存笟锟藉顕�宕煎┑鍡欑崺婵＄偑鍊栧濠氭偤閺冨牆瑙﹂柨鐕傛嫹
	private boolean checkOnline(long roleId)
	{
		if(StateCommon.isOnline(roleId))
			return true;
		else
			return false;
	}	
	
	
	// 闂傚倸鍊搁崐宄懊归崶褏鏆﹂柣銏㈩焾绾惧鏌ｉ幇顒佹儓缂侊拷閸曨厽鍠愰柣妤�鐗嗙粭鎺旂棯閹规劦鍤欓柍瑙勫灴閹晠宕ｆ径瀣�风紓浣哄亾閸庡磭绱炴繝鍥х畺婵°倕鎳忛弲鏌ュ箹缁櫢鎷烽幇浣规祰闂備浇顕х�涒晝鍠婂鍛殕闁归棿绀侀拑鐔兼煥濠靛棭妲搁崶鎾椤愩垺澶勯柡灞诲姂椤㈡棃鏁撻敓锟�?闂傚倸鍊搁崐椋庣矆娓氾拷楠炲鍩勯崘顏嗘嚌濠德板�曢幊搴ㄥ垂閸岀偞鐓欓柟顖涙緲琚氶梺绋垮椤ㄥ﹪骞冨Δ鍛櫜閹肩补鍓濋悘宥夋⒑閹惰姤鏁遍悽顖ょ節瀵鈽夐姀鐘电杸闂佺绻愰幗婊堟儎鎼淬劍鈷戦柛婵嗗閸庡繑绻涢幘顕呮婵″弶鍔欓獮鎺楀箻鐎靛摜肖闂備線娼ч…鍫ュ磿閾忣偄顕辩�癸拷閸曨剙锟界敻鎮峰▎蹇擃仾缂侊拷閸愨斂浜滈柕濞垮劵瀹搞儵鏌ｉ敐鍛Щ妞ゎ偅绮撻弫鎾寸鐎ｎ剙绁﹂梺瑙勫礃椤曆呯不閹惰姤鐓欓悗鐢殿焾閸撻亶鏌涘顒夊剶婵﹤顭峰畷鎺戔枎閹烘垵甯梻浣侯攰濞呮洟骞戦崶顒�绠栨俊顖欒濞尖晠鎮规ウ鎸庮仩妞ゆ柨娲娲川婵犲嫮绱伴梺绋垮閻擄繝鏁愰悙鍝勫嵆闁靛骏绱曢崣鍡涙⒑缂佹ɑ绀�闁稿﹤婀遍敓鑺ョ啲閹凤拷?闂傚倸鍊搁崐鎼佸磹妞嬪海鐭嗗〒姘炬嫹妤犵偛顦甸弫鎾绘偐閸愯弓鐢绘俊鐐�栭悧妤冪矙閹炬眹锟藉懘寮婚妷锔惧弳濠电娀娼уΛ顓炍ｉ崫銉х＜闁跨喍绮欏畷鎺戔槈濞嗗繐浼庢繝寰锋澘锟芥洟顢栭崱娆欐嫹濮橆剛绉洪柟顔筋殘閹叉挳宕熼鍌ゆФ闂備胶顭堢换鎴︽晝閵忕姷鏆﹂柣鎴灻欢鐐烘煙闁箑澧版い鏂挎嚇濮婄儤瀵煎▎鎴濐嚤缂備焦妫忛弻鍗島re濠电姷鏁告慨鐑藉极閹间礁纾婚柣鎰惈閸ㄥ倿鏌涢锝嗙缂佺姴缍婇弻宥夊传閸曨剙娅ｉ梺娲诲幗椤ㄥ﹪寮婚妸鈺傚亜閻犲洦鐣幘缁樼厪闁搞儜鍐句純濡炪們鍨哄ú鐔笺�佸Δ鍛櫢濞寸姴顑冮敓钘夋嚇椤㈡宕熼鍌氬箥濠电娀娼ч崐鎼佀囬娑氼洸闁规鍣幏椋庢喆閸曨剛顦ㄩ梺鎸庢磸閸ㄤ粙濡存笟锟藉顕�宕煎┑鍡欑崺婵＄偑鍊栧濠氭偤閺冨牆瑙﹂柨鐕傛嫹
	private boolean checkInvitedTeamFuctionEnable(long invitedRoleId)
	{
		return true;
	}
	// 闂傚倸鍊搁崐宄懊归崶褏鏆﹂柣銏㈩焾绾惧鏌ｉ幇顒佹儓缂侊拷閸曨厽鍠愰柣妤�鐗嗙粭鎺旂棯閹规劦鍤欓柍瑙勫灴閹晠宕ｆ径瀣�风紓浣哄亾閸庡磭绱炴繝鍥х畺婵°倕鎳忛弲鏌ュ箹缁櫢鎷烽幇浣规祰闂備浇顕х�涒晝鍠婂鍛殕闁归棿绀侀拑鐔兼煥濠靛棭妲搁崶鎾椤愩垺澶勯柡灞诲姂椤㈡棃鏁撻敓锟�?闂傚倸鍊搁崐椋庣矆娓氾拷楠炲鍩勯崘顏嗘嚌濠德板�曢幊搴ｇ矆閸喓绠鹃柟瀛樼懃閻忣亪鏌涚�Ｑ冨⒉缂佺粯绻堝Λ鍐ㄢ槈閸楃偛澹夐梻浣虹帛閹歌煤閻旂厧钃熼柕濞炬櫅濡﹢鏌熺粙鍨劉闁稿孩鎸荤换婵嗏枔閸喗鐏堥梺绋匡龚椤绮氭潏銊х瘈闁告洦鍓欓悵浼存偡濠婂嫭鐓ユい顒�锕、姘舵晸娴犲绠栨俊銈呮噺閸嬨劑姊婚崼鐔衡槈濞寸姵锚椤啴濡堕崱妯虹闂侀潧鐗忛…鍫ユ偩閻戣姤鍋勭痪鎷岄哺閺呪晠姊虹紒妯诲碍婵炲鍏橀幃楣冩焼瀹ュ棌鎷婚梺绋挎湰閻熝囧礉瀹ュ鍊电紒妤佺☉閹虫劙鎯屽▎鎾寸厵闁硅鍔﹂崵娆戠磼閹邦収娈滄鐐寸墪鑿愭い鎺炴嫹闁跨喕濮ら崹鍓佺矉瀹ュ鎹舵い鎾跺枎閺嬫垿姊洪崫鍕殭闁绘妫涚划濠氭偐閸忓懐绠氶梺闈涚墕閹冲繘宕冲ú顏呭�甸柣銏ゆ涧瀛濆銈庡弨濞夋洟骞戦崟顒傜懝妞ゆ牗鑹炬竟宥夋⒒娴ｅ憡鍟炴慨妯稿妼椤斿繒绮╅。鏄猠dure濠电姷鏁告慨鐑藉极閹间礁纾婚柣鎰惈閸ㄥ倿鏌涢锝嗙缂佺姴缍婇弻宥夊传閸曨剙娅ｉ梺娲诲幗椤ㄥ﹪寮婚妸鈺傚亜閻犲洦鐣幘缁樼厪闁搞儜鍐句純濡炪們鍨哄ú鐔笺�佸Δ鍛櫢濞寸姴顑冮敓钘夋嚇椤㈡宕熼鍌氬箥濠电娀娼ч崐鎼佀囬娑氼洸闁规鍣幏椋庢喆閸曨剛顦ㄩ梺鎸庢磸閸ㄤ粙濡存笟锟藉顕�宕煎┑鍡欑崺婵＄偑鍊栧濠氭偤閺冨牆瑙﹂柨鐕傛嫹
	private boolean checkInvitedInNoTeam(Long invitedTeamId)
	{
		if(invitedTeamId == null)
			return true;
		else
			return false;
	}
	
	private boolean checkCruiseWhenInvited(long invitedRoleId){
		PropRole prole = new PropRole(invitedRoleId, true);
		if(prole.getProperties().getCruise() > 0) {
			return true;
		}
		return false;
	}
	
	//闂傚倸鍊搁崐鎼佸磹妞嬪海鐭嗗〒姘炬嫹妤犵偞鐗犻、鏇氱秴闁搞儺鍓﹂弫鍥煏韫囨洖啸闁挎稓鍠栧娲捶椤撯剝顎楅梺鍝ュУ閻楃姴鐣烽妷褎鍠嗛柛鏇ㄥ幘閻﹀牊绻濋悽闈浶㈤柛濠勭帛閺呰泛鈽夐姀锛勫帗闂備礁鐏濋鍡楃暦瀹�鍕厸鐎癸拷鐎ｎ剛袦閻庢鍣崜鐔风暦瑜版帩鏁嬮柛娑卞枟椤旀垹绱撻崒姘拷椋庢閵堝绠�瑰嫭澹嬮弨浠嬫煟濡搫绾у璺哄閺岋綁骞樼捄鐑樼亪闂佸搫鏈ú妯兼崲濞戙垹鍨傛い鏃傚帶椤挻淇婇悙顏勶拷鏇灻瑰璺虹煑闁告劦鍠栭拑鐔哥箾閹寸偟鎳呯紒鈽呮嫹闂備胶顭堢悮顐﹀磹閺囥垹绀堥柟鎯板Г閳锋垹鎲搁悧鍫濅刊婵☆偅鍨甸埞鎴︽倻閸ャ劌顏堕梺璇叉唉椤煤濮楋拷閹兘鍩￠崒娆戠畾闂佸壊鍋呭ú鏍倷婵犲嫭鍠愰幖娣妼绾炬寧銇勮箛鎾跺闁抽攱甯掗湁闁挎繂娲﹂崵锟藉銈嗘礃缁海妲愰幒鏃撴嫹閿濆骸浜滈柣蹇嬪劜閵囧嫰顢橀悙瀛樻倷濡炪値鍋侀崹褰掑煝閻ｅ苯顥氭慨濠冩礋濮婂宕掑顒婃嫹妞嬪海鐭嗗〒姘炬嫹妤犵偞鐗犻、鏇㈠Χ韫囨柨顏跺┑顔矫畷顒勫储鐎甸潻鎷风憴鍕缂傚秴锕ら悾鐑芥晸閻樺啿锟藉鏌涢埄鍐噧濠殿喗妞藉缁樻媴閸︻厽鑿囬梺鎼炲妼缂嶅﹪鐛径鎰櫢闁绘ɑ褰冮幆鐐寸節閻㈤潧孝闁哥喆鍔嶇粋宥咁煥閸垹褰勯梺鎼炲劘閸斿秶浜搁銏＄厸闁糕槅鍘剧粔顕�鏌＄仦鍓ф创濠碘�崇埣瀹曨亝鎷呯粙鍨棈闂傚倸鍊稿ú銈壦囬幍顔藉床婵犻潧娲ㄧ弧锟介梺绋挎湰缁嬫垵鈻嶉敐澶嬧拺婵懓娲ゆ俊浠嬫煕閵娿儲璐℃俊鍙夊姍楠炴帡骞樼�靛摜肖闂備線娼ч…鍫ュ磿闁秴绠洪柣銏犳啞閸婄敻鎮峰▎蹇擃仾缂佸矁娉曠槐鎾愁吋閸曨厾鐛㈤梺闈涙缁舵艾顕ｉ锟藉畷鐓庘攽閸繐鎷烽悙鐑樺仭婵犲﹤鍟版晥闂佺粯渚楅崰姘舵晸閺傘倗绉甸柛鐘愁殜閸╂盯骞嬮敂瑙ｆ嫽闂佸壊鍋呯喊宥呪枍閸儲鐓曟慨姗嗗墮閿熻姤鎮傞垾锕傛嚄椤栵絾顎囨繝鐢靛仜閹峰寮茬猾顪玠ure濠电姷鏁告慨鐑藉极閹间礁纾婚柣鎰惈閸ㄥ倿鏌涢锝嗙缂佺姴缍婇弻宥夊传閸曨剙娅ｉ梺娲诲幗椤ㄥ﹪寮婚妸鈺傚亜閻犲洦鐣幘缁樼厪闁搞儜鍐句純濡炪們鍨哄ú鐔笺�佸Δ鍛櫢濞寸姴顑冮敓钘夋嚇椤㈡宕熼鍌氬箥濠电娀娼ч崐鎼佀囬娑氼洸闁规鍣幏椋庢喆閸曨剛顦ㄩ梺鎸庢磸閸ㄤ粙濡存笟锟藉顕�宕煎┑鍡欑崺婵＄偑鍊栧濠氭偤閺冨牆瑙﹂柨鐕傛嫹
	private boolean checkInviteFromTeam(Long inviterTeamId)
	{
		if(inviterTeamId != null)
			return true;
		else
			return false;
	}
	
	//闂傚倸鍊搁崐鎼佸磹閹间礁纾瑰瀣椤愪粙鏌曢崼婵愭Ц缂佺媭鍨堕弻銊╂偆閸屾稑顏�?闂傚倸鍊搁崐宄懊归崶褏鏆﹂柛顭戝亝閸欏繘鏌℃径瀣婵炲樊浜滄儫闂佸疇妗ㄩ懗鍫曀囪閳规垿鍩ラ崱妤冧户缂傚倸绉寸粔褰掑极閹邦厼绶為悗锝庡亝閻濇洟姊绘担钘壭撻柨姘亜閿旇法鐭欑�规洜鏁绘俊鑸靛緞鐎ｎ亷鎷烽崹顐闁绘劘灏欐禒銏ゆ煕閺冿拷瀹�鎼佸蓟閿濆憘鏃堟晸閻ｅ本宕查柟鐑樻煥閸ㄦ繂鈹戦悩宕囶暡闁稿﹤顭烽弻銈夊箒閹烘垵濮庨梺璺ㄥ枙濡嫰鎮樺杈ㄥ床婵炴垯鍨圭粻锝夋煟閹存繃顥欓柣銉簻椤啴濡堕崨顖滎唶闁诲孩纰嶉幃鍌炲箠閹捐绠伴幖瀛樼◥缁ㄥ妫呴銏″闁瑰摜鍋撻弲璺衡槈閵忥紕鍘搁梺鍛婄矆缁�浣规櫠閹绢喗鐓涚�癸拷鐎ｎ剛袦閻庢鍣崜鐔风暦瑜版帩鏁婇柛娆樺亐閺呮盯鍩為幋锔藉�烽柡澶嬪灦閻︽垿姊洪幖鐐插姌闁告柨閰ｅ畷銏°偅閸愨晝鍘介柟鑲╄ˉ閸撴繄鎷归垾鏂ユ斀妞ゆ梻鍋撻弳顒勬寠閻斿鐔嗛悹杞拌閸庢垹绱掗埥鍛闂傚倷娴囧▔鏇㈠窗瀹ュ洤鍨濇繛鍡樻尭缁犳牗銇勮箛鎾搭棤缂佹唻绠撻弻锝夋偐濞堣法鍙恊dure濠电姷鏁告慨鐑藉极閹间礁纾婚柣鎰惈閸ㄥ倿鏌涢锝嗙缂佺姴缍婇弻宥夊传閸曨剙娅ｉ梺娲诲幗椤ㄥ﹪寮婚妸鈺傚亜閻犲洦鐣幘缁樼厪闁搞儜鍐句純濡炪們鍨哄ú鐔笺�佸Δ鍛櫢濞寸姴顑冮敓钘夋嚇椤㈡宕熼鍌氬箥濠电娀娼ч崐鎼佀囬娑氼洸闁规鍣幏椋庢喆閸曨剛顦ㄩ梺鎸庢磸閸ㄤ粙濡存笟锟藉顕�宕煎┑鍡欑崺婵＄偑鍊栧濠氭偤閺冨牆瑙﹂柨鐕傛嫹
	private boolean checkInviterTeamExist(xbean.TeamInfo teamInfo)
	{
		if(teamInfo != null)
			return true;
		else
			return false;
	}
	
	//闂傚倸鍊搁崐鎼佸磹閹间礁纾归柟闂寸绾惧綊鏌熼梻瀵割槮闁汇値鍠栭湁闁稿繐鍚嬬紞鎴犵磼閹邦収娈橀柨鐔绘缁犲秹宕曢崡鐏绘椽鏁冮崒锔剧◤闂佸搫娲㈤崹娲偂閻斿吋鐓欓梺顓ㄧ畱閺嬫盯鏌涢弬娆惧剶闁哄本绋掗幆鏃堟晬閸曟嚪鍥ㄧ厸閻忕偛澧藉ú瀵革拷娈垮枟閹歌櫕淇婇幖浣肝ㄧ憸宀勫传濡ゅ懏鈷掑ù锝堝Г绾爼鏌涢悩铏閾荤偤鏌涢弴銊ョ伇闁轰礁瀚伴弻娑㈠Ψ椤旂厧顫╃紓浣哄閸ㄥ爼寮婚敐鍛傜喖鎳栭埡浣侯偧闂備胶鎳撻惇浼村磿閻㈢钃熸繛鎴炵煯濞岊亪鏌涢幘妤�鎳愰弳銈嗕繆閵堝洤啸闁稿孩鍨块獮蹇涙倻閼恒儮鎷绘繛杈剧悼閻℃棃宕靛▎鎾村�垫繛鎴炲笚濞呭洨绱掗鐣屾噰妤犵偞甯掕灃濞达綀顫夐悵銊︾節閻㈤潧啸闁轰礁鎲￠崚濠囧箻椤旇偐顔嗛梻浣哥仢椤戝啯绂嶅鍫㈠彄闁搞儯鍔嶇亸浼存煕閿濆懏鎯堥棁澶嬬節瑜嶉悘婵嬫晸閼恒儳澧遍柟骞垮灩閳藉濮�閻樿尪锟藉灝鈹戞幊閸婃洟骞婃惔鈽嗗殨濞寸厧鐡ㄩ埛鎴︽煙閼测晛浠滈柨鐔诲Г濞茬喖銆侀弽銊ョ窞濠电姴瀛╃紞搴♀攽閻愬弶鈻曞ù婊勭箞瀵煡骞栨担鍦弳闂佺粯娲栭崐鍦拷姘炬嫹?闂傚倸鍊搁崐宄懊归崶褏鏆﹂柛顭戝亝閸欏繘鏌℃径瀣婵炲樊浜滃洿婵犮垼娉涢敃銈夊箚閻愮儤鈷戦柛婵嗗閳诲鏌涚�ｎ亝鍤囬柨婵堝仱瀵挳鎮㈤搹鍦闂傚倸鍊搁悧濠冪瑹濡ゅ懎纾块柟鎵閻撴洟鏌曢崼婵堢閻庢艾缍婂缁樻媴缁涘娈紓浣虹帛鐢�崇暦閹达附鍋愰悹鍥皺閿涙盯姊虹憴鍕棆濠⒀勵殜瀹曟垿鍩勯崘锔跨盎闂佸湱鍎ら崹鐢割敂閳哄啰纾奸柣娆愮懃濞诧箓鎮￠崘顔界厱婵犻潧妫楅褏绱掓笟鍨姦闁哄瞼鍠撻敓鑺ョ♁椤洨绮绘导瀛樼厾闁绘鐗嗛婊堟煏閸パ冾伃妤犵偞顭囬幑鍕儎閹虹偟绉柡宀�鍠栭、娑樜熼崫鍕曢梻浣告惈閺堫剛绮欓幋锕�鐓″鑸靛姇绾拷闂佺粯鍔曢顓熺閼稿吀绻嗛柣鎰典簷缁辨牕霉閿濆懏鍟炲璺哄閺岋綁骞橀崡鐐插缂備胶绮惄顖炵嵁鐎ｎ喗鍊烽悹杞拌濡喖姊绘担鍛婃儓妞ゆ垵鎳庨湁闁绘垼妫勭粻鐔兼煙闂傚顦︾紒鐙�鍠栭埞鎴︽偐閹绘帪鎷风憴鍕窞闁告洦鍨遍悡鏇㈡煏閸繃鍣规い蹇ｅ弮閺屸�崇暆鐎ｎ剛鏆犻柧浼欑到閵嗘帒顫濋悡搴ｄ画闁轰礁鐗撳濠氬磼濮樿偐鍙曢梺鍛婃尰閻╊垶鐛崘顔肩柧濞ｅ洨顒dure濠电姷鏁告慨鐑藉极閹间礁纾婚柣鎰惈閸ㄥ倿鏌涢锝嗙缂佺姴缍婇弻宥夊传閸曨剙娅ｉ梺娲诲幗椤ㄥ﹪寮婚妸鈺傚亜閻犲洦鐣幘缁樼厪闁搞儜鍐句純濡炪們鍨哄ú鐔笺�佸Δ鍛櫢濞寸姴顑冮敓钘夋嚇椤㈡宕熼鍌氬箥濠电娀娼ч崐鎼佀囬娑氼洸闁规鍣幏椋庢喆閸曨剛顦ㄩ梺鎸庢磸閸ㄤ粙濡存笟锟藉顕�宕煎┑鍡欑崺婵＄偑鍊栧濠氭偤閺冨牆瑙﹂柨鐕傛嫹
	private boolean checkTeamInvitingValid(xbean.TeamInfo teamInfo, long invitedRoleId)
	{
		java.util.Map<Long,Long> invitings = teamInfo.getInvitingids();
	    cleanTimoutInvitings(invitings);
	    if(invitings.get(invitedRoleId) != null)
	    	return true;
	    else
	    	return false;
	}
	//闂傚倸鍊搁崐鎼佸磹閹间礁纾归柟闂寸绾惧綊鏌熼梻瀵割槮闁汇値鍠栭湁闁稿繐鍚嬬紞鎴犵磼閹邦収娈橀柨鐔绘缁犲秹宕曢崡鐏绘椽鏁冮崒锔剧◤闂佸搫娲㈤崹娲偂閻斿吋鐓欓梺顓ㄧ畱閺嬫盯鏌涢弬娆惧剶闁哄本绋掗幆鏃堟晬閸曟嚪鍥ㄧ厸閻忕偛澧藉ú瀵革拷娈垮枟閹歌櫕淇婇幖浣肝ч柛銉戝啯鐦撻梻鍌氬�烽悞锕�顪冮幐搴ｎ洸婵炲棙鍨甸崹婵囩箾閸℃ɑ灏柦鍐枛閺屽秹鍩℃担鍛婃婵犳鍨遍幐鎶藉蓟濞戞ǚ鏀介柛鈩冾殢娴煎矂姊洪崫鍕紞闁告ê銈搁崺鐐哄箣閿旇棄浜奸梺鍛婁緱閸犳牠顢旈懜鍏哥箚闁绘劦浜滈敓鑺ョ墵楠炴劖銈ｉ崘銊х崶闂佸綊鍋婇崰姘辩矆婵犲洦鐓曢柕澶樺枛婢ь垶鏌ｉ幘瀵告噭闁靛洤瀚板鍊燁槼妞ゃ儲绮撻弻娑㈡偄鐠哄搫绁悗瑙勬磸閸ㄤ粙寮幘缁樻櫢闁跨噦鎷�5濠电姷鏁告慨鐑藉极閹间礁纾绘繛鎴欏灪閸嬨倝鏌曟繛褍鍟悘濠囨煙閼圭増褰х紒鎻掋偢閹偞绻濋崶銊у帾婵犵數鍊崘顭戜紝濠电偠鍋愰崰鏍ь潖閸濆嫅褔宕惰娴煎嫬顪冮妶搴″箹闁绘鎹囬獮鍡欎沪鏉炴寧姊归幏鍛村礂閸濄儳娉块梻鍌氼煬閸嬪嫬煤閿曞倸绠板┑鐘宠壘缁犲綊鏌熼幍顔碱暭闁绘挻娲樻穱濠囶敍濠婂懎绗￠柣蹇撻獜缁犳捇寮婚敍鍕勃闁告挆鍕灡闂備浇妗ㄧ粈渚�宕愰崸妤�绠栭柣鎴ｆ缁犮儵鏌涢幇顓炵祷闁煎磭顫渙cedure濠电姷鏁告慨鐑藉极閹间礁纾婚柣鎰惈閸ㄥ倿鏌涢锝嗙缂佺姴缍婇弻宥夊传閸曨剙娅ｉ梺娲诲幗椤ㄥ﹪寮婚妸鈺傚亜閻犲洦鐣幘缁樼厪闁搞儜鍐句純濡炪們鍨哄ú鐔笺�佸Δ鍛櫢濞寸姴顑冮敓钘夋嚇椤㈡宕熼鍌氬箥濠电娀娼ч崐鎼佀囬娑氼洸闁规鍣幏椋庢喆閸曨剛顦ㄩ梺鎸庢磸閸ㄤ粙濡存笟锟藉顕�宕煎┑鍡欑崺婵＄偑鍊栧濠氭偤閺冨牆瑙﹂柨鐕傛嫹
	private boolean checkTeamNotFull(xbean.TeamInfo teamInfo)
	{
		if (teamInfo.getMembers().size() < 4)
			return true;
		else
			return false;
	}
	
/*	//闂傚倸鍊搁崐鎼佸磹閹间礁纾瑰瀣椤愪粙鏌曢崼婵愭Ц缂佺媭鍨堕弻銊╂偆閸屾稑顏�?闂傚倸鍊搁崐宄懊归崶褏鏆﹂柛顭戝亝閸欏繘鏌℃径瀣婵炲樊浜滄儫闂佸疇妗ㄥù鍥箺閺囥垺鈷戦悹鎭掑妼濞呮劙鏌熼崙銈嗗?闂傚倸鍊搁崐椋庣矆娓氾拷楠炲鍩勯崘顏嗘嚌濠德板�曢幊搴ㄦ儗濡ゅ懎绠圭紒顔炬嚀閻忔娊鏌ㄥ┑鍡╂Ц缁绢叏鎷烽梻浣筋嚙缁绘鐣烽悽绋跨疇闁瑰墽鍎甸敓鏂ょ畵婵℃悂鍩℃担渚О婵＄偑鍊栧ú鏍箯閹达箑绠�瑰嫭瀚堥弮鍫濈闁宠桨鐒﹂悗楣冩⒒娴ｅ憡鎯堟い锔诲灦閹ê鈹戦崼銏★紡閻熸粌绻掑Σ鎰板箳濡わ拷绾惧吋绻涢幋鐐嗘垹鎷犻悙瀵哥瘈缁炬澘顦辩壕鍧楁煛鐏炵瓔妯�閽樻繈鏌熺紒銏犳灍闁绘挾鍠愰妵鍕箻鐠哄搫澹夐梺绋垮濮婂綊骞堥妸锔剧瘈闁稿被鍊楅崥瀣倵鐟欏嫭绀冮柨鏇樺灲閵嗕線寮崼婵堫槹濡炪倖甯掗崐椋庤姳閺夋垟鏀介柣妯虹仛閺嗏晠鏌涚�ｎ偆娲撮柟顔ㄥ嫮绡�闁搞儜鍐拷顓㈡⒑缁夊棗瀚峰▓鏃傜磼閻樺磭澧甸柡灞界Ч瀹曨偊宕熼锟藉▍銈夋⒑閹肩偛锟芥洟顢栨径鎰摕闁靛ň鏅滈崑鍡涙煕鐏炲墽鈽夋い蹇ユ嫹?婵犵數濮烽弫鎼佸磻閻愬搫绠板┑鐘崇閸ゅ苯螖閿濆懎鏆為柡鍛箞閺屻劑寮撮悙璇ф嫹閸濄儲鍠嗛柨鏃傚亾閸犳劙鏌ｅΔ锟介悧鍡欑箔濮樿埖鐓熼柟鎯у船閸旀粎绱掔紒妯兼创妤犵偛顑夐幃婊堝幢濞嗗繐楔婵犵數濮幏鍐吋婢跺锟藉秶绱撴担铏瑰笡缂佸鎹囧畷鐗堢節閸パ呯厬濠碘槅鍨伴崥瀣疾婵傚憡鈷掑ù锝呮啞鐠愶繝鏌熼搹顐ｅ暗闁跨喕濮ら惌顕�宕￠幎鑺ュ仒妞ゆ梹鎷濋幏鐑芥晲鎼存繄鎸夐梺鐚存嫹濞寸姴顑嗛悡鏇㈡煏婢舵稓鍒板┑陇娉曢幉鎼佸级鐠恒剱褎鎱ㄦ繝鍕笡缂佹鍠栭弫鎾绘寠婢舵鍔烽悷婊冪Х閻忓姊洪崫鍕殭闁稿﹤缍婇、鏇㈡嚍閵夛箑寮垮┑鈽嗗灣閳峰牊瀵奸崒姘肩唵闁兼悂娼ф慨鍫ユ煛閸涱喚鍙�闁哄本鐩俊鐑芥晲閸涱収鐎冲┑鐐差嚟婵數鏁敓鐘茶摕闁挎繂鐗忛悿锟介梺鍝勬川閸嬫稒绔熺�ｎ喗鈷戦柣鐔告緲濞堚晠鏌熼崙銈嗗?婵犵數濮烽弫鎼佸磻閻樿绠垫い蹇撴缁躲倝鏌涜閵囨盯鏁撻弬銈囩暤鐎规洖銈告慨锟介柕蹇嬪灮閸斿爼姊虹拠鎻掑毐缂傚秴妫濋弫鎾存叏閹邦剛浼勯梺纭呮珪閹瑰洭鍨鹃敃鍌毼╅柍杞扮閼板灝鈹戦埥鍡楃仸婵炵厧顭烽獮蹇涙倻閽樺顦ㄥ銈嗘⒒閺咁偊宕㈤棃娴虫棃鎮╅棃娑楃捕闂佽绻戠换鍫ュ箖濮楋拷閹崇娀顢楁繝鍐伓闁荤喐鐟ョ�氼厾绮堥崘顏嗙＜閻犲洩灏欐晶锔撅拷娈垮櫘閸嬪嫰顢橀崗鐓庣窞濠电姴瀚峰Σ瑙勪繆閻愵亜锟芥牠骞愭ィ鍐ㄧ獥闁圭増婢樼壕鎸庛亜閺嶎偄浠﹂柍閿嬪笒闇夐柨婵嗘祩閻掗箖鏌ｉ…鎺旂瘈闁哄瞼鍠栧畷娆撳Χ閸℃浼�?
	private boolean checkInviterStatus(long inviterRoleId)
	{
		BuffAgent buffagent = new BuffRoleImpl(inviterRoleId,true);
		if(!buffagent.canAddBuff(StateType.STATE_TEAM))
		{
			TeamManager.logger.info("闂傚倸鍊搁崐鎼佸磹閻戣姤鍤勯柛鎾茬閸ㄦ繃銇勯弽銊с�掗柣婵嗙埣閺岋繝宕堕妷銉т患闂佹眹鍊楅崑鎾舵崲濞戙垹绠ｆ繛鍡楃箳閸旀挳姊烘潪鎵槮闁挎洦浜濠氬Ω閳哄倸浜為梺绋挎湰缁嬫垿顢旈敓锟�(roleId=" + inviterRoleId+")濠电姷鏁告慨鐑藉极閸涘﹥鍙忓ù鍏兼綑閸ㄥ倿鏌ｉ幘宕囧哺闁哄鐗楃换娑㈠箣閻愰潧鏆￠梺鐟板槻閸㈡煡锝炲┑瀣拻閻庨潧鎲￠弲濂告⒒娴ｇ鎮戞俊鐐跺Г缁傚秹宕奸弴姗堟嫹娴ｈ倽鏃�鎷呴悷閭︼拷鎾绘煟閻愬鈻撻柛鎾寸箞閹﹢宕橀鐣屽幗闁硅壈鎻槐鏇㈡偩椤撱垺鐓曢幖娣妺閹查箖鏌熼銊ユ搐楠炪垺绻涢幋鐏活亪宕戝澶嬬厽閹兼番鍔嶅☉褔鏌熼懞銉х煂濠㈣娲熼幐濠冪珶濠靛棛绉洪柡浣瑰姍瀹曞爼宕滄担绋啃┑锛勫亼閸婃洖霉濮樿泛鍌ㄩ柤鎭掑劤閳瑰秴鈹戦悩鎻掝仾閻庢碍姘ㄩ幉姝岀疀濞戞瑥浠奸梺姹囧灩閹诧繝鎮″▎鎰╀簻闁哄秲鍔忔竟姗�鏌￠崱顓犳偧闁跨喎锟界噥娼愭繛鍙夌矒瀹曚即寮介婊愭嫹娴ｅ壊娼ㄩ柨鐔剁矙楠炲啫鈻庨幘宕囩杸闂佸憡鎸烽懗鍫曞汲閵堝鈷戦柛婵嗗閻忛亶鏌涢悩宕囧⒌鐎殿噮鍋婇獮妯肩磼濡粯顏熼梻浣芥硶閸ｏ箓骞忛敓锟�?");
			return true;
		}
		return true;
	}
*/	
	//闂傚倸鍊搁崐鎼佸磹閹间礁纾瑰瀣椤愪粙鏌曢崼婵愭Ц缂佺媭鍨堕弻銊╂偆閸屾稑顏�?闂傚倸鍊搁崐宄懊归崶褏鏆﹂柛顭戝亝閸欏繘鏌℃径瀣婵炲樊浜滄儫闂佸疇妗ㄥù鍥箺閺囥垺鈷戦悹鎭掑妼濞呮劙鏌熼崙銈嗗?闂傚倸鍊搁崐椋庣矆娓氾拷楠炲鍩勯崘顏嗘嚌濠德板�曢幊搴ㄦ儗濡ゅ懎绠圭紒顔炬嚀閻忔娊鏌ㄥ┑鍡╂Ц缁绢叏鎷烽梻浣筋嚙缁绘鐣烽悽绋跨疇闁瑰墽鍎甸敓鏂ょ畵婵℃悂鍩℃担渚О婵＄偑鍊栧濠氬储瑜斿畷锝嗙節閸愵亞鐦堥悗鐢靛閻忔岸宕愰妶澶婂惞閻庯綆鍠楅埛鎺楁煕閺囥劌浜滄い蹇ｅ亰閺屻劑鎮㈤悜妯荤彧闂佽桨鐒﹂幃鍌氱暦閵忥綆妯勫銈冨灪钃辩紒铏规櫕缁瑧鎹勯…鎴炐у┑锛勫亼閸婃牕顫忔繝姘偍鐟滃繒鍒掓繝姘闁挎棁袙閹风粯绻涙潏鍓ф偧闁硅櫕鎹囬、姘煥閸涱垳锛滈柣搴秵閸嬪懎鐣峰畝锟介敓鍊燁潐濞叉粍鏅跺Δ鍛畾闁哄啫鐗嗗洿闂佸憡鍓崟顓熺稁闂備浇宕甸崰鎰垝瀹ュ憘娑㈠礃椤旀儳绁︽繝鐢靛Т娴硷綁寮崼婵嗙獩濡炪倖妫侀崑鎰瀶椤斿皷鏀介柣姗嗗枛閻忚鲸绻涙径瀣创妞ゃ垺鐗犲畷濂稿Ψ閵夈剱鏇㈡⒑缂佹鐭婇柛蹇斾粶cedure濠电姷鏁告慨鐑藉极閹间礁纾婚柣鎰惈閸ㄥ倿鏌涢锝嗙缂佺姴缍婇弻宥夊传閸曨剙娅ｉ梺娲诲幗椤ㄥ﹪寮婚妸鈺傚亜閻犲洦鐣幘缁樼厪闁搞儜鍐句純濡炪們鍨哄ú鐔笺�佸Δ鍛櫢濞寸姴顑冮敓钘夋嚇椤㈡宕熼鍌氬箥濠电娀娼ч崐鎼佀囬娑氼洸闁规鍣幏椋庢喆閸曨剛顦ㄩ梺鎸庢磸閸ㄤ粙濡存笟锟藉顕�宕煎┑鍡欑崺婵＄偑鍊栧濠氭偤閺冨牆瑙﹂柨鐕傛嫹
	private boolean checkInviterInTeam(Long inviterTeamId)
	{
		if(inviterTeamId != null)
			return true;
		else
			return false;
	}
	
	// 闂傚倸鍊搁崐鎼佸磹閹间礁纾瑰瀣椤愪粙鏌曢崼婵愭Ц缂佺媭鍨堕弻銊╂偆閸屾稑顏�?闂傚倸鍊搁崐宄懊归崶褏鏆﹂柛顭戝亝閸欏繘鏌℃径瀣婵炲樊浜滄儫闂佸疇妗ㄥù鍥箺閺囥垺鈷戦悹鎭掑妼濞呮劙鏌熼崙銈嗗?闂傚倸鍊搁崐椋庣矆娓氾拷楠炲鍩勯崘顏嗘嚌濠德板�曢幊搴ｇ玻濡や椒绻嗛柕鍫濇噹閺嗙喖鏌熼崘鍙夊殗婵﹤顭峰畷鎺戭潩椤掑﹥瀚归柟闂寸绾惧綊鏌熼梻瀵割槮闁汇値鍠栭湁闁稿繐鍚嬬紞鎴犵磼閹邦収娈滈柡灞革拷鎰佸悑閹肩补锟藉磭顔愭繝娈垮枦椤鎮￠垾鎰佹綎婵炲樊浜堕弫鍡涙煥閻旂儤娅曠紒顔芥閹晫绮欑捄銊︾叄婵＄偑鍊栫敮鎺旓拷姘煎弮閹繝鎮㈤崗鑲╁幐闂佺鏈銊︾閵忊�茬箚闁肩⒈鍓涚敮娑氱磼缂佹娲存鐐诧工閻ｏ繝鎮ч崼婵愭П闂備胶绮幐鐐箾閿熶粙鏌熼绛嬫疁鐎规洜鍏橀、姗�鎮欓幇鍓佺ɑ闁靛洤瀚版俊鐑藉Ψ椤斿彨褏绱撴担铏瑰笡缂佽鐗撳顐﹀箻鐎靛壊娴勯柣搴秵閸嬪嫭绂嶉懖鈺冪＝濞达綀濮ら鐘绘煙閸濄儳顑俥dure濠电姷鏁告慨鐑藉极閹间礁纾婚柣鎰惈閸ㄥ倿鏌涢锝嗙缂佺姴缍婇弻宥夊传閸曨剙娅ｉ梺娲诲幗椤ㄥ﹪寮婚妸鈺傚亜閻犲洦鐣幘缁樼厪闁搞儜鍐句純濡炪們鍨哄ú鐔笺�佸Δ鍛櫢濞寸姴顑冮敓钘夋嚇椤㈡宕熼鍌氬箥濠电娀娼ч崐鎼佀囬娑氼洸闁规鍣幏椋庢喆閸曨剛顦ㄩ梺鎸庢磸閸ㄤ粙濡存笟锟藉顕�宕煎┑鍡欑崺婵＄偑鍊栧濠氭偤閺冨牆瑙﹂柨鐕傛嫹
	private boolean checkInviterIsLeader(long inviterRoleId , xbean.TeamInfo teamInfo)
	{
		if(teamInfo.getTeamleaderid() == inviterRoleId)
			return true;
		else
			return false;
	}
	
	//濠电姷鏁告慨鐑藉极閹间礁纾婚柣鎰惈閸ㄥ倿鏌涢锝嗙缂佺姴缍婇弻宥夊传閸曨偓鎷锋繝姘ワ拷鍛村矗婢跺瞼顔曢梺绯曞墲椤ㄥ顢楅悢鐑樺枑閹肩补妲呴崵妤呮煕閺囥劌鐏犵紒鐘崇♁閵囧嫰骞樼捄鐩掋垹鈹戦鍡樺?闂傚倸鍊搁崐宄懊归崶褏鏆﹂柛顭戝亝閸欏繘鏌℃径瀣婵炲樊浜滄儫闂佸疇妗ㄥù鍥箺閺囩喓绡�闁靛骏绲介悡鎰版煕閺冿拷濞叉繄鎹㈠鑸碘拻濞达絽鎲￠崯鐐烘煕閺傝法绠荤�殿喗褰冮埞鎴狅拷锝庝簽閸樻椽姊洪崫鍕灕闁归鍏橀弻鏇㈠炊瑜嶉顓燁殽閻愭惌鐒介柟鐟板閹嫰骞掗悙鐢敌滈梺鍝勭焿缂嶄線寮幇顓炵窞濠㈣泛顑呴弸銈嗙節濞堝灝鏋涢柨鏇樺劚椤啯绂掔�ｎ亝鐎梺鐟板⒔缁垶寮查幖浣圭叆闁绘洖鍊圭�氾拷?闂傚倸鍊搁崐宄懊归崶褏鏆﹂柛顭戝亝閸欏繘鏌℃径瀣婵炲樊浜滃洿婵犮垼娉涢敃銈囪姳閵夆晜鈷戦柛婵嗗椤箓鏌涙惔銏㈠弨鐎规洘鍨挎俊鑸靛緞鐎ｎ剙甯惧┑鐘垫暩閸嬬喖宕戦幘鏂ユ瀺闁告稑鐡ㄩ悡娆戠棯椤撶偞鍣归柣鎾村姍閺屾洟宕惰椤忣厽銇勯姀鈽呰�块柟顔哄灪椤︾増鎯旈鐓庡闂傚倸鍊风粈渚�骞夐敓鐘冲殞闁告挆鍛槸婵犵數濮村ú銈夋嫅閻斿摜绠鹃柟瀵稿�戝璺哄嚑閹兼惌婢�缁诲棙銇勯弽銊х婵炲吋鍔欓弻鐔兼儌閸濄儳袦濠殿喖锕ㄥ▍锝囧垝濞嗘垶宕夐柕濞у苯鏁奸梻鍌欑劍鐎笛兠鸿箛娑樺瀭鐟滅増甯楅崑鈺呮煟閹达絽袚闁稿﹤顭烽弻锕�螣娓氼垱楔闂佸憡鏌ㄧ紞濠傤潖濞差亝鍋￠柡澶嬵儥閺嗐垽姊洪崫鍕櫤缂佹梻顭玠ure濠电姷鏁告慨鐑藉极閹间礁纾婚柣鎰惈閸ㄥ倿鏌涢锝嗙缂佺姴缍婇弻宥夊传閸曨剙娅ｉ梺娲诲幗椤ㄥ﹪寮婚妸鈺傚亜闁告挷鑳堕悡鎾绘⒑閸濆嫮鐒跨紓宥勭劍娣囧﹤顫㈠畝濠冃╅梻浣告惈椤戝棝鎯勯鐐茶摕闁绘梻鈷堥弫瀣煕閳╁厾顏堫敂閿燂拷?
	private boolean checkSingleInvitingExist(long inviterRoleId, long invitedRoleId)
	{
		xbean.SingleInvitings singleInvitings = xtable.Singleinviting.get(inviterRoleId);
		if(singleInvitings == null)
			return false;
		else
		{
			cleanTimoutInvitings(singleInvitings.getInvitingids());
			if(singleInvitings.getInvitingids().get(invitedRoleId) == null)
				return false;
		    else
		    	return true;
		}
	}
	
	
	//濠电姷鏁告慨鐑藉极閹间礁纾婚柣妯款嚙缁犲灚銇勮箛鎾搭棤缂侊拷婵犲洦鐓ラ柣鏃囶嚙琚氱紓浣虹帛缁嬫帒顕ラ崟顓ㄦ嫹閿濆骸浜炴い锔诲弮濮婄儤娼幍顔跨獥闂侀潻缍囩紞渚�鐛弽顑句汗闁圭儤鎸搁崜顒勬⒑閸涘﹦鈽夐柨鏇樺�濋、鏃堝礈娴ｈ櫣锛滅紓鍌欓檷閸ㄥ綊鐛弽顓熺厵闁告劘灏欑粻铏箾閹寸姵鏆柟顔界懇椤㈡宕掑搴℃櫗闂傚倷绀侀幉锟犳偡閵夆敡鍥ㄦ綇閵婏附鐝烽梺姹囧灮椤ｎ噣骞忔搴㈠枂闁告洦鍓涢ˇ銊╂倵閻у憡瀚归梺褰掓？缁�浣虹不閺嶎偅鍠愰柡鍌濇硶閺嗭箑鈹戦崒姘暈闁稿瀚—鍐拷锝庝邯椤庢銇勯敂瑙勬珚婵﹦绮幏鍛存寠婢跺﹥鍎梻浣侯焾椤戝洭宕戦妶鍛殾婵炲棙甯囨禍褰掓煙閻戞ê鐏╅柨娑欑♁缁绘繈鎮介棃娴躲垺绻涚仦鍌氾拷妤佺珶閺嚶颁汗闁圭儤鎸搁敓鐣屾暬閺屻劌鈹戦崱娑憋拷妤�顭胯閸ㄥ爼骞冨Δ锟介～婵嬵敇閳ユ剚妫熸俊鐐�ゆ禍婊堝疮娴煎瓨鏅搁柡鍌樺�楃粔闈浢瑰搴濋偗妞ゃ垺鎸歌灃闁告劦浜為悾鍫曟⒑绾懏褰ч梻鍕閸╂盯骞嬮敂鐣屽幗閻熸粌绉归獮澶愭晬閸曡埖瀚规慨妯煎亾鐎氾拷?,闂傚倸鍊搁崐鎼佸磹妞嬪海鐭嗗〒姘炬嫹妤犵偛顦甸弫鎾绘偐閸愬弶鐤勫┑掳鍊х徊浠嬪疮椤愩倧鎷峰顒夋Ч闁靛洤瀚伴獮鎺楁倷閺夋埈浼撳┑锛勫亼閸娿倖绂嶅鍫濈柈闁哄鍨归弳锕傛煙閻戞﹩娈曢柛濠勫厴閺屻倗鍠婇崡鐐测拻濠碘�冲级閹稿啿顫忕紒妯诲闁惧繒鎳撶粭鈥愁渻閵堝骸骞栨繛灞傚姂瀹曟岸骞掑Δ濠冩櫖闂佺粯鍔栧娆愮瑜斿铏圭磼濡儵鎷婚梺鍛婎焼閸涱垱锛忛悷婊勬瀵顓奸崱妯侯潯闂佽顔栭崰鏍ㄤ繆閼恒儳绡�闁靛骏绲剧涵楣冩倵濮樼厧骞橀柟骞垮灩閳规垹锟斤綆鍋呭▍銏＄箾鐎电孝妞ゆ垵妫濆鏌ュ箹娴ｅ湱鍘藉┑鈽嗗灥濞咃綁鏁嶅澶嬬厱闁哄啯鎸荤�氾拷?闂傚倸鍊搁崐宄懊归崶褏鏆﹂柛顭戝亜閸ㄦ棃鏌熺紒銏犳灈缂佺媭鍨堕弻銊╂偆閸屾稑顏�?
	private void deleteInvite(final long invitedRoleId)
	{
		xbean.InviteInfo inviteInfo = xtable.Teaminvite.select(invitedRoleId);
		if(inviteInfo == null)
			return;
		//闂傚倸鍊搁崐鎼佸磹妞嬪海鐭嗗〒姘炬嫹妤犵偛顦甸弫宥夊礋椤掍焦顔囬梻浣虹帛閸旀洟顢氶鐘典笉濡わ絽鍟悡銉╂煟閺冨浂鍤欑悮姘辩磽娴ｈ櫣甯涢柣鈺婂灠閻ｇ兘濡搁埡濠冩櫍闂佺粯锕㈠褎瀵奸悥锟絘m闂傚倸鍊搁崐宄懊归崶褏鏆﹂柣銏㈩焾绾惧鏌ｉ幇顔芥毄闁活厽鐟╅悡顐﹀炊閵娧�妲堢紓渚婃嫹濠㈣埖鍔栭崐鐢告煥濠靛棝顎楅柡瀣枛閺屾盯濡堕崨顖氣叺闂佸搫鐬奸崰鎰焽韫囨柣鍋呴柛鎰ㄦ櫓閿熻棄绉瑰铏圭矙閸ф锟芥绱掓径濠勭Ш鐎殿喛顕ч埥澶愬閻樻鍞洪梻浣告惈閸犳盯骞忛悜鑺ョ厱閹艰揪绲惧▍鏉媡ing濠电姷鏁告慨鐑藉极閹间礁纾块柟瀵稿Т缁躲倝鏌﹀Ο渚＆婵炲樊浜濋崑鎰版偣閸ヮ亜鐨烘い锔诲幖閳规垿鎮╃紒妯婚敪濠电偛鐪伴崐婵嬨�佸鑸电劶鐎广儱妫涢崢鍗炩攽閻愭潙鐏﹂柣鐕傚缁辩偤骞嬮悩鐢碉紲闂佺粯鐟ラ幊鎰矓椤曪拷閺岋紕浠﹂棃鈺傚闁归绀侀幃鎴︽椤愩垺澶勯柡灞诲姂椤㈡棃鏁撻敓锟�?闂傚倸鍊搁崐椋庣矆娓氾拷楠炲鏁撻悩鍐蹭罕濠电姴锕ら崯鐘诲几瀹ュ棎浜滈柨娑樺濡埐eInvitings濠电姷鏁告慨鐑藉极閹间礁纾婚柣鎰惈閸ㄥ倿鏌涢锝嗙缂佺姴缍婇弻宥夊传閸曨剙娅ｉ梺绋胯閸旀垿寮婚悢纰辨晬闁糕槅鍘界�氬綊姊洪崫鍕靛剱婵☆偄鍟村濠氭偄閸涘﹦绉堕梺瀹犳〃缁�浣虹矆婵柉ting濠电姷鏁告慨鐑藉极閹间礁纾块柟瀵稿Т缁躲倝鏌﹀Ο渚＆婵炲樊浜濋崑鎰版偣閸ヮ亜鐨烘い锔诲幖閳规垿鎮╃紒妯婚敪濠电偛鐪伴崐婵嬨�佸鑸电劶鐎广儱妫涢崣鍡涙⒑缂佹ɑ绀�闁稿﹤婀遍敓鑺ョ啲閹凤拷
		if(inviteInfo.getInviting().getTeamid() > -1)
		{
			xbean.TeamInfo team = xtable.Team.get(inviteInfo.getInviting().getTeamid());
			inviteInfo = xtable.Teaminvite.get(invitedRoleId);
			if(inviteInfo == null)
				return;
			if(team != null)
				team.getInvitingids().remove(invitedRoleId);
		}
		else
		{
			/*Set<Long> rids = new HashSet<Long>();
			rids.add(invitedRoleId);
			rids.add(inviteInfo.getInviting().getRoleid());
			Lockeys.lock(xtable.Locks.ROLELOCK, rids);*/
			inviteInfo = xtable.Teaminvite.get(invitedRoleId);
			if(inviteInfo == null)
				return;
			final long invitingroleid = inviteInfo.getInviting().getRoleid();
			mkdb.Procedure.pexecuteWhileCommit(new mkdb.Procedure(){
				@Override
				protected boolean process() throws Exception
				{
					xbean.SingleInvitings singleInvitings = xtable.Singleinviting.get(invitingroleid);
					if(singleInvitings != null)
					{
						singleInvitings.getInvitingids().remove(invitedRoleId);
						if(singleInvitings.getInvitingids().size() == 0)
							xtable.Singleinviting.remove(invitingroleid);
					}
					return true;
				}
			});
		}
		
		//闂傚倸鍊搁崐鎼佸磹妞嬪海鐭嗗〒姘炬嫹妤犵偞鐗犻、鏇㈠煕濮橆厽銇濆┑陇鍩栧鍕拷锝庝簷濡叉劙姊绘笟锟藉褑澧濋梺鍝勬噺閻╊垶骞忛幋锔藉亜閻忓繋鐒﹂弬锟介梻浣侯焾閺堫剛鍒掗崼銉ョ濠碘剝顒es闂傚倸鍊搁崐宄懊归崶褏鏆﹂柣銏㈩焾绾惧鏌ｉ幇顔芥毄闁活厽鐟╅悡顐﹀炊閵娧�妲堢紓渚婃嫹濠㈣埖鍔栭崐鐢告煥濠靛棝顎楅柡瀣枛閺屾盯濡堕崨顖氣叺闂佸搫鐬奸崰鎰焽韫囨柣鍋呴柛鎰ㄦ櫓閿熻棄绉瑰铏圭矙閸ф锟芥绱掓径濠勭Ш鐎殿喛顕ч埥澶愬閻樻彃绁梻渚�娼ч…鍫ュ磹濡ゅ懏鍤勯柧蹇撴贡绾捐棄霉閿濆洨鎽傞柛銈嗙懄娣囧﹪顢曢敐鍥╃杽閻庢鍠栭…鐑藉箖閵忋倕绀傞柛蹇撳悑椤忕喖姊绘担鑺ョ《闁革綇绠撻獮蹇涙晸閿燂拷?
		inviteInfo.setBeinginvited(false);
		cleanTimeoutInvites(inviteInfo.getInvited());
		//濠电姷鏁告慨鐑藉极閸涘﹥鍙忛柣鎴濐潟閿熻棄鍊圭粋鎺旓拷锝庡亝濞呫垽姊洪懞銉冾亪藝椤栫偛姹查梺顒�绉甸悡銉╂煟閺冨倻甯涙い銉ヮ槺缁辨挸顓奸崪鍐惈濡ょ姷鍋涢崯顐ョ亽闂佺厧顫曢崐妤呮偩娴犲鈷戞繛鑼额唺缁ㄥジ鏌熼鍛挬ted濠电姷鏁告慨鐑藉极閹间礁纾婚柣鎰惈閸ㄥ倿鏌涢锝嗙缂佺姴缍婇弻宥夊传閸曨剙娅ｉ梺绋胯閸旀垿寮昏缁犳盯寮撮悢閿嬬暚濠电姵顔栭崳顕�宕滈悢鐓庤摕婵炴垯鍨圭粻娑㈡煃鏉炴壆顦﹂崬顖炴⒒娴ｅ憡鎯堥柣顓烆槺缁骞樼拠鑼舵憰閻庡箍鍎遍ˇ顖炴偂濞戞◤褰掓晲閸涱喖鏆堝┑鐐茬墣鐏忔瑧妲愰幘瀛樺闁告繂瀚呴敐澶嬪仺妞ゆ牗绋戝ù顔界節閿熻姤绗熼敓钘夘潖閾忓湱纾兼俊顖氱箺閸嬫劙骞忛崘顔芥櫇闁稿本淇洪崺鐐烘⒑閹呯婵狅拷鏉堚晛顥氶柣锝呯焿閹风兘鐛崹顔煎闂佺娅曢崝鏍偋鎼达絿纾介柛灞剧懅椤︼箓鏌ｉ鐐诧拷鍦矉瀹ュ閱囬柡鍥╁仦濡差剟姊洪崨濠冨闁搞劍澹嗙划鍫ュ礃椤忓懎鏋戦棅顐㈡处濞叉粓鎯岄崱娑欑叆闁绘柨澧庨惌娆愭叏婵犲嫮甯涢柟宄版嚇閹兘鏌囬敃锟藉▓婵堢磽閸屾瑧顦︽い鎴濇瀹曞綊宕稿Δ锟界粻鐘绘煟閺冨倵鎷￠柡浣哥Ч閺岋綁骞囬鐐电シ闂佽瀵掗崢濂糕�旈崘顔嘉ч柛鈩冪懃椤囨⒑閸涘﹤鐏╅柟铏崌閳ワ箓宕堕妸銉殼闁诲孩绋掗…鍥储椤忓牊鈷戦柛鎾村絻娴滄繄绱掔拠鎻掓殻閽樼喖鏌ｉ幇顔煎妺闁绘挶鍨介弻娑氫沪閹呭姲闂佺尨鎷烽柣鐘殿潯iteInfo婵犵數濮烽弫鍛婃叏閻戣棄鏋侀柟闂寸绾剧粯绻涢幋鐐垫噧缂佸墎鍋ら弻娑㈠Ψ椤旂厧顫╃紓渚婃嫹闁割偆鍠撶弧锟介梻鍌氱墛缁嬫帡鏁嶉弮鍫熺厾闁哄娉曟禒銏ゆ婢舵劖鐓ユ繝闈涙閹兼劙鏌ｉ妸锕�鐏撮柡宀�鍠庨悾锟犲级閹稿巩鈺呮⒑鐎圭姵顥夋い锔诲灦閸┿垹顓兼径妯绘櫍閻熸粌鐬奸懞杈ㄧ節濮橆厾鍙嗛梺鍝勬处閿氶柣蹇撳级閵囧嫰濮�閳╁喚妫冮悗瑙勬礀閵堟悂骞冮姀鐘垫殝闁哄顑欏Λ鍕⒒閸屾艾锟介绮堟笟锟介獮澶愬灳鐡掍焦妞介弫鍐磼濮樻唻绱遍梻浣虹《閸撴繈鎮疯缁嬪顓兼径瀣幍闁哄鐗撶粻鏍ь瀶椤曪拷閺屾稓锟斤絽澧庣弧锟介梺鍝勭焿缁绘繂鐣烽崼鏇炍╅柨鏃傚亾椤撹崵绱撻崒娆戝妽缂佸鍨归幑銏ゅ箳閺冿拷椤洟鏌熼悜妯诲鞍缂傚秴娲弻鏇熺箾瑜嶉幊鎰板级娴犲鐓熼幖娣�ゅ鎰箾濞村娅囩紒杈╁仦缁楃喖鏁撴禒瀣ュù锝囩《濡插牊淇婇鐐存暠闁诲骸顭烽弻鐔兼嚌閻楀牆娑х紓鍌氱С缁舵岸骞冨Δ锟界叅妞ゅ繐鎳夐幏缁樼箾鏉堝墽鍒伴柟璇х節瀹曨垶鎮欓悜妯轰缓濡炪倖鐗楃划灞剧閿斿墽纾肩紓浣诡焽濞叉挳鏌℃担瑙勫磳闁瑰磭鍋ゆ俊鐤槾妞ゆ梹娲熷娲川婵犲嫮鐓�闂佸摜鍣ラ崹鎶芥晸閼恒儳鍟查柟鍑ゆ嫹
		if(inviteInfo.getInvited().size() == 0)
			xtable.Teaminvite.remove(invitedRoleId);
		
		
	}
	
	
	//婵犵數濮烽弫鍛婃叏閻戣棄鏋侀柟闂寸绾惧鏌ｉ幇顒佹儓缂佺姳鍗抽弻鐔兼⒒鐎靛壊妲紓浣哄Х婵灚绌辨繝鍥舵晬婵犻潧瀚搁幏鐑芥晸娴犲鐓涢悗锝庝簽鏁堝Δ鐘靛仦閻楁洝褰佸銈嗗釜閹峰嘲鈹戦垾鑼煓闁哄矉缍侀獮鎺楁倷閺夋埈浼�?闂傚倸鍊搁崐宄懊归崶褏鏆﹂柛顭戝亝閸欏繘鏌℃径瀣婵炲樊浜滄儫闂佸疇妗ㄥù鍥箺閺囩喓绡�闁靛骏绲介悡鎰版煕閺冿拷濞叉繄鎹㈠鑸碘拻濞达絽鎲￠崯鐐烘煕閺傝法绠荤�殿喗褰冮埞鎴狅拷锝庝簽閸樻椽姊洪崫鍕灕闁归鍏橀弻鏇㈠炊瑜嶉顓燁殽閻愭惌鐒介柟鐟板閹嫰骞掗悙鐢敌滈梺鍝勭焿缂嶄線寮幇顓炵窞濠㈣泛顑呴弸銈夋煟鎼淬埄鍟忛柛鐘崇墵閹儲绺界粙鎸庢К闂佹枼鏅涢崯顖涘垔閹绢喗鐓熼柣鏃傚帶娴滅増淇婇懠鍫曞摵缂佺粯绻堥幃浠嬫濞戞唻鎷烽幘缁樼厵濡炲楠搁崢鎾煛鐏炶濮傞柟顔哄灲瀹曨偊宕熼幋顖滅М闁哄矉缍侀獮鎺楁倷閺夋埈浼�?闂傚倸鍊搁崐宄懊归崶褏鏆﹂柛顭戝亜閸ㄦ棃鏌熺紒銏犳灈缂佺媭鍨堕弻銊╂偆閸屾稑顏�?,闂傚倸鍊搁崐鎼佸磹妞嬪海鐭嗗〒姘炬嫹妤犵偛顦甸弫鎾绘偐閸愯弓鐢绘俊鐐�栭悧妤冪矙閹炬眹锟藉懘寮婚妷锔惧弳濠电娀娼уΛ顓炍ｉ崫銉х＜闁跨喍绮欏畷鎺戔槈濞嗗繐浼庢繝寰锋澘锟芥洟顢栭崱娆欐嫹濮橆剛绉洪柟顔筋殘閹叉挳宕熼鍌ゆФ闂備胶顭堢换鎴︽晝閵忕姷鏆﹂柣鎴灻欢鐐烘煙闁箑澧版い鏂挎嚇濮婄儤瀵煎▎鎴濐嚤缂備焦妫忛弻鍗島re濠电姷鏁告慨鐑藉极閹间礁纾婚柣鎰惈閸ㄥ倿鏌涢锝嗙缂佺姴缍婇弻宥夊传閸曨剙娅ｉ梺娲诲幗椤ㄥ﹪寮婚妸鈺傚亜閻犲洦鐣幘缁樼厪闁搞儜鍐句純濡炪們鍨哄ú鐔笺�佸Δ鍛櫢濞寸姴顑冮敓钘夋嚇椤㈡宕熼鍌氬箥濠电娀娼ч崐鎼佀囬娑氼洸闁规鍣幏椋庢喆閸曨剛顦ㄩ梺鎸庢磸閸ㄤ粙濡存笟锟藉顕�宕煎┑鍡欑崺婵＄偑鍊栧濠氭偤閺冨牆瑙﹂柨鐕傛嫹
	private void cleanTimeoutInvites(java.util.List<xbean.TeamInvite> invites)
	{
		java.util.List<xbean.TeamInvite> timeoutList = new java.util.ArrayList<xbean.TeamInvite>();
		for (xbean.TeamInvite invite : invites)
		{
			if ((now - invite.getInvitetime()) > TeamManager.MAX_INVITE_TIMEOUT)
				timeoutList.add(invite);
		}
		invites.removeAll(timeoutList);
	}
	
	//婵犵數濮烽弫鍛婃叏閻戣棄鏋侀柟闂寸绾惧鏌ｉ幇顒佹儓缂佺姳鍗抽弻鐔兼⒒鐎靛壊妲紓浣哄Х婵灚绌辨繝鍥舵晬婵犻潧瀚搁幏鐑芥晸娴犲鐓涢悗锝庝簽鏁堝Δ鐘靛仦閻楁洝褰佸銈嗗釜閹峰嘲鈹戦垾鑼煓闁哄苯绉归弻銊э拷锝庡亜绾炬娊姊洪崫鍕効缂傚秳绀侀锝夘敆閸曨偄鐎銈嗘礀閹冲繐鈻撻搹鍦＝闁稿本鐟х粵蹇涙煙瀹勬澘妲婚柍瑙勫灴閹晠宕ｆ径濠庢П闂備胶绮幐璇裁哄Ο鍏煎床婵犻潧娲ㄧ弧锟介梺绋挎湰绾板秴鈻撻鐑嗘富闁靛牆鍟俊浠嬫煟閻斿弶娅呮い顐㈢箰鐓ゆい蹇撳閻撴垶绻濋姀锝嗙【闁活剙銈搁幃鈩冩媴閾忓湱锛濇繛杈剧悼椤牓鏁撻挊澶嬫喐缂侇喗姊婚敓鐣屾暩椤牆顕ｉ崣澶夌箚闁绘劦浜滈敓鑺ユ礈閹广垽骞囬鍡樺婵﹩鍘介崐鎰殽閻愯尙绠叉い锔惧閹棃顢涘☉姗嗕紦闂備焦瀵х换鍌涱殽閸涘﹥娅犳い鏍仦閸婂灚鎱ㄥ鍡楀箹闁告繃妞介弻鈥崇暆鐎ｎ剛袦婵犵鍓濋崕鑲╃不濞戙垹妫樻繛鍡楀綖缁憋拷?闂傚倸鍊搁崐椋庣矆娓氾拷楠炲鍩勯崘顏嗘嚌濠德板�曢幊搴ｇ矆閸喓绡�闂傚牊渚楅崕蹇涙煕鐏炶濡介柕鍥у楠炴帡骞嬪┑鎰棯闂備胶绮幐楣冨窗閺嶎厼钃熼柡鍥╁枔缁犻箖鏌涢…鎴濇灈濠殿喖楠搁—鍐Χ閸涱喚顩伴梺鍛婃尰缁嬫挸危閹版澘绠抽柡鍐挎嫹閻庢碍宀搁弻鐔虹磼濡櫣鐟插┑鐐茬墕椤兘骞冨Δ锟介埢鎾诲垂椤旂晫浜鹃梻浣芥〃缁�渚�鈥﹂悜鐣屽祦闁告劦鍠栭～鍛存煏閸繃顥滃ù婊勵殜閺岀喖宕楅崗鐓庡壒闂佹悶鍔忔禍顒勬晸閼恒儴澹樼紓宥咃躬楠炲啫螖閸涱喗娅滈柟鑲╄ˉ閿熻姤鍓氬浠嬫⒑鐠囨彃顒㈤柣鏃戝墴楠炲繘鏁撻敓锟�?
	private void cleanTimoutInvitings(java.util.Map<Long,Long> invitings)
	{
		Object[] keys = invitings.keySet().toArray();
		for(int i = 0; i <keys.length;i++)
		{
			if ((now - invitings.get(keys[i])) > TeamManager.MAX_INVITE_TIMEOUT)
			invitings.remove(keys[i]);
		}
	}
	
	public boolean isLeaderInDuel(long leaderRoleId)
	{
		BuffAgent agent = new BuffRoleImpl(leaderRoleId, true);
		if (agent.existBuff(PlayPKManage.BuffDuelID))
		{
			MessageMgr.sendMsgNotify(leaderRoleId, 141867,  null);
			return true;
		}
		else
			return false;
	}
	
	
	// {{{ RPCGEN_DEFINE_BEGIN
	// {{{ DO NOT EDIT THIS
	public static final int PROTOCOL_TYPE = 794448;

	public int getType() {
		return 794448;
	}

	public byte agree; // agree为1接受邀请，为0拒绝邀请

	public CRespondInvite() {
	}

	public CRespondInvite(byte _agree_) {
		this.agree = _agree_;
	}

	public final boolean _validator_() {
		return true;
	}

	public OctetsStream marshal(OctetsStream _os_) {
		if (!_validator_()) {
			throw new VerifyError("validator failed");
		}
		_os_.marshal(agree);
		return _os_;
	}

	public OctetsStream unmarshal(OctetsStream _os_) throws MarshalException {
		agree = _os_.unmarshal_byte();
		if (!_validator_()) {
			throw new VerifyError("validator failed");
		}
		return _os_;
	}

	public boolean equals(Object _o1_) {
		if (_o1_ == this) return true;
		if (_o1_ instanceof CRespondInvite) {
			CRespondInvite _o_ = (CRespondInvite)_o1_;
			if (agree != _o_.agree) return false;
			return true;
		}
		return false;
	}

	public int hashCode() {
		int _h_ = 0;
		_h_ += (int)agree;
		return _h_;
	}

	public String toString() {
		StringBuilder _sb_ = new StringBuilder();
		_sb_.append("(");
		_sb_.append(agree).append(",");
		_sb_.append(")");
		return _sb_.toString();
	}

	public int compareTo(CRespondInvite _o_) {
		if (_o_ == this) return 0;
		int _c_ = 0;
		_c_ = agree - _o_.agree;
		if (0 != _c_) return _c_;
		return _c_;
	}

	// DO NOT EDIT THIS }}}
	// RPCGEN_DEFINE_END }}}

}

