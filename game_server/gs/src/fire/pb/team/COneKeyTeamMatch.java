
package fire.pb.team;
import java.util.Arrays;

import fire.pb.fushi.DayPayManager;
import fire.pb.main.ConfigManager;
import fire.pb.talk.ChatChannel;
import fire.pb.talk.ChatMsgId;
import fire.pb.talk.LastChatTime;
import fire.pb.talk.MessageMgr;
import fire.pb.util.FireProp;


// {{{ RPCGEN_IMPORT_BEGIN
// {{{ DO NOT EDIT THIS
import com.locojoy.base.Marshal.OctetsStream;
import com.locojoy.base.Marshal.MarshalException;

abstract class __COneKeyTeamMatch__ extends mkio.Protocol { }

// DO NOT EDIT THIS }}}
// RPCGEN_IMPORT_END }}}

/***
 * 婵犵數濮烽弫鍛婃叏閻戣棄鏋侀柛娑橈攻閸欏繘鏌ｉ幋锝嗩棄闁哄绶氶弻鐔兼⒒鐎靛壊妲紒鐐劤椤兘寮婚敐澶婄疀妞ゆ帊鐒﹂崕鎾绘⒑閸濆嫬顏ラ柛搴ㄤ憾閸╃偤骞嬮敂钘変汗闂佸憡鐟ラˇ浼村箖濞嗘垹纾藉ù锝呮惈椤庡矂鏌涢妸銉у煟鐎殿喖顭锋俊鎼佸煛閸屾矮绨介梻浣侯焾閺堫剛绮欓幋锔绘晜闁跨噦鎷�?闂傚倸鍊搁崐鎼佸磹閹间礁纾归柟闂寸绾惧綊鏌熼梻瀵割槮缁炬儳缍婇弻鐔兼⒒鐎靛壊妲紒鐐劤缂嶅﹪寮婚敐澶婄闁挎繂鎲涢幘缁樼厱濠电姴鍊归崑銉╂煛鐏炶濮傜�殿喗鎸抽幃娆撶叓椤撶姵鏅奸梻鍌欐祰濡椼劎绮堟担鐚存嫹濮樼厧骞橀柟骞垮灩閳藉濮�閻樿尪锟藉灝鈹戦埥鍡楃仴妞ゆ泦鍛瀳鐎广儱娲ㄧ壕钘壝归敐鍥ㄥ殌濠殿喖鐗婇妵鍕Ω閵夘垵鍚悗娈垮枛椤兘宕规ィ鍐ㄧ疀濞达絽鎲￠崐顖炴⒑绾懎浜归悶娑栧劦閺佹捇鎸婃径宀嬬礊濡炪倖姊归崝娆忣潖缂佹ɑ濯撮柛娑橈工閺嗗牓姊洪幖鐐插妞ゎ偄顦遍幑銏犫槈閵忊剝娅㈡繛瀵稿Т椤戝棝鎮″☉銏″�堕柣鎰絻閳锋梹绻涢幓鎺旀憼闁靛洤瀚版慨锟介柍鈺佸暟椤︿即姊虹拠鈥虫灀闁哄懐濞�楠炲﹪鎮╁ú缁樻櫈闁荤姵浜介崝宥夋晬韫囨稒鈷掗柛灞剧懄缁佺増銇勯弴鍡楁嫅閹峰嘲鈽夐幒鎾寸彋闂佽鍠撻崹浠嬨�佸Δ鍛妞ゆ劑鍊ら崬鐢告⒒娴ｈ姤纭堕柛锝忕畵楠炲繘鏁撻敓锟�?
 * @author by changhao
 *
 */
public class COneKeyTeamMatch extends __COneKeyTeamMatch__ {
	@Override
	protected void process() {
		
		final long roleid = gnet.link.Onlines.getInstance().findRoleid(this);
		if (roleid < 0)
			return;
		/*闂傚倸鍊搁崐鎼佸磹閹间礁纾归柟闂寸绾惧綊鏌熼梻瀵割槮缁惧墽鎳撻—鍐拷锝庝簼閹癸綁鏌ｉ鐐搭棞闁靛棙甯掗～婵嬫倷椤掞拷椤忚埖淇婇妶鍥ラ柛瀣洴钘濋柣銏㈩焾閸ㄥ倸螖閿濆懎鏆欑紒鐘崇☉闇夐柨婵嗘噺鐠愶紕绱掔�ｂ晞鍏岀紒杈ㄦ崌瀹曟帒顫濋濠冨闁绘垼濮ら崐鍧楁煥閺囩偛锟界敻鏁撻弬銈囩暤鐎规洖鐖奸崺锟犲礃瑜忛悷婵嗏攽鎺抽崐褏寰婃禒瀣柈妞ゆ牜鍋為崑鍌炴煏婢跺棙娅嗛柣鎾跺枛閺岋繝宕掑鍙樿檸濡炪倧绲炬繛濠囧蓟閿濆鏁囬柣鏃傚劋閸ｄ即姊洪崫鍕槵闁跨喕妫勭壕顓㈠汲閸℃稒鍊甸柨婵嗛婢т即鏌ｉ敃锟介悧鎾愁潖閻戞ɑ濮滈柟娈垮枛婵′粙姊虹憴鍕憙鐎规洜鏁搁崚鎺旓拷锝庡枛缁犳娊鏌￠崘鈺傚鞍閻庢艾缍婇弻銊モ攽閸℃侗锟芥霉濠婂嫮绠栫紒缁樼洴瀹曘劑顢欓崜褏鍘滄繝娈垮枛閿曘劌鈻嶉敐澶婄闁哄稁鍘奸崡鎶芥煟閹邦厾銈撮柟鏋�濆缁樻媴閸涘﹤鏆堝┑顔硷工濠�閬嶅极椤曪拷閹瑩鎮滃Ο鐑樼枀闂佸搫顦悧鍕礉鎼达絽濮柨鐔绘閳规垿顢欓弬銈勭返闂佸憡蓱閹倿鐛箛鎾佹椽顢旈崨顏呭闂備礁鎲＄粙鎴︽晝閿曞倸鐓″鑸靛姈閻撱儵鏌￠崶鏈电盎妞も晩鍓涚槐鎺楊敊绾拌京鍚嬪Δ鐘靛仦椤洨妲愰幒鎳崇喖鎮�涙ê顏堕梺鍓茬厛閸嬪懘宕ｈ箛鏂剧箚妞ゆ牗绮岀敮鍫曟偨椤栨氨鍩ｉ柡宀嬬磿閿熸枻绲婚崝宀勬晸閼恒儳绠炵�殿喛顕ч埥澶愬閳ュ厖姹楅梺鑽ゅТ濞壯囧幢濡や礁鍓甸梻鍌氬�峰ù鍥ь浖閵娾晜鍊块柨鏇炲�哥粻鏌ユ煕閵夘喖澧柡瀣╃窔閺岀喖宕滆鐢盯鏌￠崨顔藉�愰柡灞诲姂閹倝宕掑☉姗嗕紦 team->roleid->match by changhao*/
		mkdb.Procedure onekeyteammatch = new mkdb.Procedure()
		{
			@Override
			protected boolean process()
			{
				
				fire.pb.team.SOneKeyTeamMatch msg = new fire.pb.team.SOneKeyTeamMatch();
				if (channeltype != fire.pb.talk.ChannelType.CHANNEL_TEAM_APPLY &&
					channeltype != fire.pb.talk.ChannelType.CHANNEL_WORLD &&
					channeltype != fire.pb.talk.ChannelType.CHANNEL_CURRENT &&
					channeltype != fire.pb.talk.ChannelType.CHANNEL_CLAN)
				{
					msg.ret = 1;
					mkdb.Procedure.psendWhileCommit(roleid, msg);
					return false;
				}
				
				//婵犵數濮烽弫鍛婃叏閻戣棄鏋侀柛娑橈攻閸欏繘鏌ｉ幋锝嗩棄闁哄绶氶弻娑樷槈濮楀牊鏁鹃梺鍛婄懃缁绘﹢寮婚敐澶婄婵犲灚鍔栫紞妤呮⒑鐠恒劌鏋欐俊顐㈠瀹曟劙宕烽鐘电効闂佸湱鍎ゅΛ鎴﹀箯閻戣姤鏅查幖绮癸拷鑼嚬婵犵數鍋涢幊宀勫垂閽樺娼栨繛宸簼閸ゅ秹鏌曟径濠傛灓濞存粠浜ｅΛ鐔奉渻閵堝棛澧遍柛瀣☉鏁堥柡灞诲劜閳锋垶銇勯幒鐐村缂備礁顦遍弫濠氬箖閿熺姴唯闁冲搫鍊婚崢浠嬫⒑閸濆嫬鏆欓柛濠呭吹閺侇喖鈽夊▎宥勭盎闂侀潧顦崕鍝勎ｉ搹鍦＜閺夊牄鍔嶇亸顓熴亜閹剧偨鍋㈢�规洦浜畷姗�顢橀悙鏉戝壍婵犲痉鏉匡拷妤佹叏閻戣棄纾绘繛鎴欏灩閻ゎ喗銇勯幇鈺佸姢濞存粈绮欏娲嚒閵堝憛銏＄箾濞村娅囧ù婊咁焾閳诲酣骞嬮悩闈涚闂備胶绮崝妤呭磿閵堝鐓曢柟瀵稿У閸犳劙鏌ｅΔ锟介悧鍡欑箔閹烘嚚鐟邦煥閿熶粙宕￠幎钘夎摕婵炴垯鍨圭粻濠氭倵闂堟稒鍟為柛锛卞喚娓婚柕鍫濇缁岃法绱掗煫顓犵煓闁诡噣绠栭弫鎾绘偐瀹曞洤濮洪梻浣瑰濡礁螞閸曨垱鍎婃繝濠傜墛閳锋帒銆掑鐐濠电偘鍖犻崶銊ヤ罕闂佺硶鍓濋妵鍌氣槈濡攱顫嶅┑鐐叉閸旀牠鎮靛畡閭︽富闁靛牆妫楃粭鎺楁倵濮樼厧寮柟顕嗙節閹晝绱掑Ο杞扮敾婵犵數鍋涘Λ妤冩崲閹伴偊鏁傞柍鍝勫暟绾惧ジ鏌ㄩ悢鍓佺煓鐎规洘锕㈤、娆撴偩鐏炶棄濡囬梻鍌欑劍閹爼宕曢鐐茬閻忕偟鍋撻崣蹇曪拷骞垮劚濞村嫰骞忔搴㈠枂闁告洦鍓涢ˇ銉╂倵鐟欏嫭澶勯柛鎾跺枛閸ㄩ箖寮崼婵堫槰濡炪倖姊婚崢褍鐣甸崱娑欌拺缂備焦锚婵鏌℃担鍛婂暈妞ゃ劍鐟╁铏规嫚閸欏鏀銈庡亜椤︻垳鍙呭┑顔筋殣閹风兘鏌曢崱妤�鏆炵紒缁樼箞瀹曟儼顦撮柣銈呮搐閳规垿鎮╃紒妯婚敪濡炪倖鍨甸幊鎰版儉椤忓浂妲肩紓浣虹帛閻╊垰鐣烽崡鐐╂瀻闊洤楠搁ˉ姘繆閻愵亜锟芥垿宕曢鐐茬９婵犻潧妫鏍ㄧ箾瀹割喕绨奸柛銈嗗浮閺屾洟宕煎┑鍥ф闂佽楠告晶鐣屾閹惧鐟归柛銉戝嫮浜紓鍌欑椤︿即骞愰幎钘夌伋闁挎洖鍊搁崹鍌涖亜閺囩偞鍣虹�点倖妞藉铏规崉閵娿儲鐏嗗┑鈽嗗亜鐎氫即骞冩ィ鍐╁�婚柦妯侯槺閻わ拷闂備礁鎼ˇ顖氼焽閿熺姴鏋佹繝濠傚暊閺�浠嬪箳閹惰棄纾圭憸鏃堢嵁韫囨稒鍊婚柤鎭掑劤閸欏啴姊洪崨濠傚Е濞存粍绮撳绋库槈閵忥紕鍘搁柣蹇曞仜婢т粙鍩ユ径鎰厓闁芥ê顦藉Ο锟介悗瑙勬穿缁绘繈骞冨▎鎴嫹閻㈠憡娅滃瑙勬礋濮婂宕掑▎鎰偘閻庤娲滈弫璇茬暦娴兼潙绠婚悹鍥皺閻ゅ洭姊虹憴鍕妞ゆ泦鍥ㄥ亗婵鎷烽柡宀�鍠愬蹇斻偅閸愨晩锟藉秹姊虹粙娆惧剱闁告梹鐟╁濠氭偄閾忓湱锛滃┑鈽嗗灥濡椼劑宕氭繝鍐閻庡灚鎮堕敓钘夘儔楠炲繐鐣￠幍铏杸闂佹寧绋戠�氼剚绂嶆總鍛婄厱濠电倯鍐╁珔闁归鍏樺Λ鍐ㄢ槈濮樺崬濮遍柣搴ゎ潐濞叉ɑ绻涙繝鍥ф瀬闁圭増婢樺钘壝归敐鍛础缂佸绶氬缁樻媴閸涘﹤鏆堢紓浣筋嚙閸婂湱鎹㈠☉娆戠瘈闁搞儯鍔嶉崕顏堟煟閻斿摜鎳冮悗姘煎墴椤㈡挸鈽夐姀鈥筹拷鐢告偡濞嗗繐顏紒锟介敓钘夆攽閻愯尙婀撮柛鏂跨焸閸┿垽寮崼婵堫唶闁圭厧鐡ㄧ换鍕不濮樿埖鈷戠紓浣姑慨锕�霉濠婂嫮鐭掗柡浣规崌閹崇偤濡疯閳峰矂鎮楃憴鍕缂傚秴锕よ灋闁告劦鐓佽ぐ鎺戭潊闁斥晛鍟ㄦ禒銏＄節瀵版灚鍊曢悡鎰拷鍨緲鐎氼噣鏁撻弬銈囩У闁稿鎳橀幃鐢稿冀椤撶啿鎷绘繛鎾寸啲閹烽攱绻涙担鍐叉噺瀹曟煡鏌涢鐘插姎缁炬儳缍婇弻锟犲炊閳轰礁澹夐梺鍝ュ枎閹冲繒鎹㈠┑瀣棃婵炴垵宕崜閬嶆⒑缂佹ɑ灏扮紒瀣灴閳ワ妇鎹勯妸锕�纾繛鎾村嚬閸ㄤ即宕滄导瀛樷拺閻犲洩灏欑粻鐐烘煕鎼淬垹鈻曢柡浣规崌閹崇偤濡烽鍏兼珱闂備礁鎽滄慨鐢告偋閻樿尙鏆﹂柡灞诲劚閽冪喖鏌曟径妯荤窙闁归鍏樺顕�宕煎┑鍫О婵＄偑鍊栭弻銊ノｉ崼锝庢▌闂佸搫鏈惄顖炲春閸曨垰绀冩い蹇撴噹濞呮垶淇婇悙顏勶拷銈夊磹閵堝宸濇い鏍ㄧ玻缁辨煡姊绘担铏瑰笡闁告棑绠撳畷婊冾潩鏉堫煈鍋ㄩ梺鑲┾拡閸撴稓澹曢悡搴唵閻犺櫣鍎ゅ﹢浼存煕閵堝繑瀚归梻鍌欐缁鳖喚寰婇崸妤�绀傛俊顖欒閸ゆ洟鏌熺紒銏犳灍闁稿瀚伴弻褑绠涢幘纾嬬濠碘剝褰冨ú顓烆潖缂佹ɑ濯撮悷娆忓娴犫晠姊虹粙鍨槰闁搞劏娉涢悾宄扳攽閸ャ劌鍔呴梺闈涱焾閸庨亶宕戝澶嬧拺鐟滅増甯楅敍鐔兼煟閹虹偟鐣甸柛鈺傜洴楠炲鏁傞悾灞藉箞闂備礁婀遍崑鎾愁焽濞嗘垵绶ら悹鍥梿閻熼偊鐓ラ柛鏇ㄥ幘閻ｈ偐绱撴担浠嬪摵閻㈩垳鍋ら獮蹇涙偐缂佹ê娈ゅ銈嗗焾閸嬩線宕归挊澶屾殾闁跨喓濮甸悞鑲╋拷骞垮劚濡盯宕㈤悽鍛娾拻闁稿本鑹鹃敓鑺ユ倐椤㈡岸顢橀姀鐘殿槷閻庡箍鍎遍ˇ浼存偂閻斿吋鐓欓柟顖嗗懏鎲肩紓渚婃嫹闁告劦浜炵壕鑲╃磽娴ｈ鐒芥繛鎻掝嚟閿熷�燁潐濞叉牕鐣烽鍐航闂備礁鎲＄换鍌滐拷姘槻椤洭寮崒婊咃紳闂佺鏈悷褏绮佃箛娑欑厵濡炲楠搁崢鎾煛鐏炲墽娲存鐐叉喘濡啫鈽夊▎鎴滄喚闂傚倷鑳堕…鍫ユ晝閿曞倸鏋侀柟闂寸劍閸庡銇勮箛鎾跺缂佺嫏鍕闁糕剝鐟ユ禍楣冨极閸儲鈷戦悹鍥ㄥ絻椤掋垽鏌ｉ弮鎴濆⒋妤犵偛绻橀弫鎾绘晸閿燂拷? by changhao
				if (channeltype == fire.pb.talk.ChannelType.CHANNEL_CLAN)
				{
					xbean.Properties prop = xtable.Properties.select(roleid);
					if (prop != null)
					{
						if (prop.getClankey() <= 0)
						{
							MessageMgr.sendMsgNotify(roleid, 141053, null);	
							
							msg.ret = 1;
							mkdb.Procedure.psendWhileCommit(roleid, msg);
							return false;
						}
					}
				}
				
				Long teamid = xtable.Roleid2teamid.select(roleid);
				if (teamid == null)
				{
					psend(roleid, new STeamError(TeamError.SelfNOtLeader));
					TeamManager.logger.error("COneKeyTeamMatch:闂傚倸鍊搁崐鎼佸磹閹间礁纾归柟闂寸绾惧綊鏌熼梻瀵割槮缁炬儳缍婇弻锝夊箣閿濆憛鎾绘煕閵堝懎顏柡灞剧洴椤㈡洟鏁愰崱娆樻К闂備胶顭堢悮顐﹀礉鎼淬劌绠熼柟闂寸缁秹鏌涢锝嗗剷闁靛鏅滈悡鏇㈡煙閼割剙濡芥繛鍛閺屾稒鎯旈敐鍛亪闂佸搫鏈ú婵堢不濞戞熬鎷烽敐搴濈敖闁告梹娼欓埞鎴︽倷鐠鸿櫣姣㈠銈庡幖閻楁捇宕洪悙鍝勭闁挎棁妫勬禍褰掓煟閻樺弶鍘傞柛鎰屽懐鐓戦梻鍌氬�烽懗鍫曞箠閹捐鐤悹鎭掑妽瀹曟煡鏌熼幍顔碱暭闁稿鏅犻弻锝夊箣閿濆棭妫勭紓浣哄Х閺佸寮婚悢鐑樺枂闁告洖鐏氶悾鍓佺磽閸屾氨孝闁挎洦浜滈锝夘敃閿曪拷缁犳盯鏌℃径濠勪虎缂佹劖绋戦—鍐Χ閸℃﹩姊垮┑鐐差槹濞茬喖濡存笟锟藉畷銊э拷娑櫱氶幏缁樼箾鏉堝墽鍒伴柟鑺ョ矒閺佸秴顓奸崶鈺冿紲濡炪倖娲栭幊搴ㄦ倶閻樼偨浜滄い鎰╁灮缁犺尙绱掔紒妯肩畵妞ゎ偅绻堥、姗�鎮㈤崜韫埛闂傚倸鍊峰ù鍥ㄦ叏閵堝鏅俊鐐�х粻鎾寸閸洖绠栧Δ锝呭枤閺佸洭鏌曡箛銉х？闁告﹢浜堕弻鐔兼嚃閳哄媻澶愭煥閻旂粯顥夐柣銈呮喘瀹曟椽鎮欓悜妯煎弰闂佺厧顫曢崐鏇熺閿斿墽纾肩紓浣诡焽濞插锟借娲栧畷顒冪亽闂佹儳绻橀敓鑺ョ♁閸嬪懘姊婚崒娆掑厡闁硅櫕鎹囧畷顖炲锤濡わ拷缁犵姵淇婇娆掝劅婵炲吋鐗曢埞鎴︽偐鐎圭姴顥濈紒鐐劤閸氬骞堥妸銉建闁糕剝顨呴埛鏇㈡⒑瑜版帩妫戦柛蹇旓耿閻涱噣寮介妸锕�顎撻梺鍛婄缚閸庤崵妲愰锟藉缁樻媴閸濄儳楔濠碘槅鍋夊▔鏇犲垝閸喓鐟归柨鐔剁矙楠炲啴宕稿Δ濠冩櫓濠电偞娼欐鍝ョ礊婵犲倻鏆︽俊銈呮噹缁�鍌炴煠濞村娅囬柍璇茬箳缁辨捇宕掑▎鎴濆闂佸憡姊归悧鐘诲Υ閸愨晝绡�闁搞儜鍡樻啺闂備胶鍋ㄩ崕鏌ュ礈濮樿泛瑙﹂悗锝庡枛缁犲湱绱掗鐐仧闁瑰嘲鍢查悾鐑藉炊鐠虹儤娅嶅┑鐘垫暩婵敻顢欓弽顓炵獥婵炴埈婢佺紞鏍ь熆閼搁潧濮堥柛瀣�块弻銊╂偄閸濆嫅銏ゆ煢閸愵亜鏋涢柡灞炬礃缁绘盯鎮欓浣哄絾闂備胶顭堥鍛涘┑瀣摕婵炴垶鐭▽顏堟煕閹炬鎷锋俊鎻掔墕椤啴濡堕崨瀵稿椽闂佺懓鍤栭幏锟� "+roleid);
					
					msg.ret = 1;
					mkdb.Procedure.psendWhileCommit(roleid, msg);
					return true;					
				}
				
				Team team = null;
				team = TeamManager.getTeamByTeamID(teamid);	//闂傚倸鍊搁崐鎼佸磹閹间礁纾归柟闂寸绾惧綊鏌熼梻瀵割槮缁惧墽鎳撻—鍐拷锝庝簼閹癸綁鏌ｉ鐐搭棞闁靛棙甯掗～婵嬫倷椤掞拷椤忚埖淇婇妶鍥ラ柛瀣仱閹囨偐濮瑰浄鎷锋笟锟藉鎾閳╁啯鐝曢梻浣藉Г閿氭い锔诲枤缁辨棃寮撮姀鈾�鎷绘繛杈剧秬濞咃綁濡存繝鍥ㄧ厱闁规儳顕粻鐐烘煙閽樺锟藉鏁撻弬銈囩У闁哥姵鐗犻幃娆愮節閸愶缚绨婚梺鐟版惈缁夊墎鎷归悧鍫滅箚妞ゆ劑鍨归弳娆撴煃鐟欏嫬鐏撮柟顔界懃椤斿繘顢欓崗纰卞晙濠碉紕鍋戦崐鏍暜閻旇桨鐒婃繛鍡樺灦椤洟鏌ｉ幇顒夊殶闁荤喎缍婇弻銊╂偄缂佹﹩妫勫銈嗘穿缂嶄線銆侀弴銏℃櫇闁跨喓鏅划鍫ュ礃閳瑰じ绨婚梺鍝勫暙濞层倖绂嶈ぐ鎺撶叆婵炴垶鐟ч惌濠囨煃鐟欏嫬鐏存い銏＄懇瀵剟濡堕崼顒佸閻犳亽鍔庡Λ顖涖亜閹捐泛顎岄柣鎺楃畺瀹曗剝娼忛妸锝勭盎闂佸搫绋侀崑鍕閿曞倹鐓冮梺鍨儏缁楁帡妫佹径鎰叆婵犻潧妫欑粊鈺呮煟閹烘柨浜鹃柕鍥у婵＄兘濡疯椤旀帡姊洪崫鍕拱缂佸鎹囬弫鎾诲棘閵堝洨校婵炲瓨绮嶇换鍫ｆ＂闂侀潧娴氬渚�骞忔搴㈠枂闁告洦鍓涢ˇ顓熺節閳凤拷閸曞灚鐤佸Δ鐘靛仜濡繂顕ｉ锟藉畷鐓庘攽閹邦厾绉遍梻鍌欒兌缁垵鎽悷婊勬緲閸熸挳鏁愰悙瀵哥瘈闁搞儯鍔夐幏濠氭⒑缁嬫寧婀伴柤褰掔畺閺佹捇鎳為妷锕�锟芥劗锟借娲橀崝娆撶嵁閺嶃劍濯撮柛婵勫劵缁鳖噣姊绘担鍝ョШ婵☆偉娉曠划鍫熸媴閸濆嫷妫滈悷婊呭鐢鎮″▎鎾粹拻闁稿本鍑归崵鐔搞亜閿旇偐鐣甸柡宀嬬秮婵¤埖鎯旈埄鍐邯闂傚倸娲らˇ鐢稿蓟濞戞粎鐤�闁规崘娅曢崐顖滅磽閸屾氨校闁搞劌婀卞Σ鎰板箳濡わ拷缁犳稒銇勯幘妤�瀚弳顓㈡⒒娴ｈ姤纭堕柛鐘虫礀铻為柛鏇ㄥ幘娑撳秶锟藉箍鍎遍ˇ顖滃閸ф鐓曟俊銈呭暕缁辫櫕绻涘顔荤凹闁哄懏绻堥弻娑樼暆鐎ｎ亶娲紓浣割儏缁绘ê顫忓ú顏勪紶闁告洦鍓欓崑宥夋⒑閹肩偛濡芥俊鐐扮矙楠炲啴鏁撻悩鍐蹭簻闂佺绻楅崑鎰板储閻㈠憡鈷掑〒姘搐瀵法绱掗悩鍐茬伌鐎殿喚顭堥埥澶愬閿涘嫬骞堥梻浣告惈閸婂綊顢栧▎鎾崇？闁哄啫鐗婇悡娑氾拷鐧告嫹閻庯綆鍓涜ⅵ婵°倗濮烽崑鐐烘晝閵忕姷鏆﹂柨鐔哄У閸婄兘鏌熺紒妯轰刊婵炲吋鐩濠氬磼濮橆剨鎷风粙妫垫椽濡舵竟锕�娲幃鐣岀矙閼愁垱鎲伴梻渚�娼ч…鍫ュ磿椤曪拷瀵劍绂掔�ｎ偆鍘遍梺铏嫕閹风兘鏌￠崨顔剧煉闁糕斂鍨介獮姗�寮妷锔芥澑闂備礁鐤囧Λ鍕涘Δ浣侯洸婵犻潧顑嗛悡鏇㈡煏婵炲灝鍔滈悹鎰ㄥ墲娣囧﹪宕ｆ径濠傤潚濡ょ姷鍋炵敮锟犵嵁濡櫣鏆﹂柛銉㈡櫇瀹撲礁鈹戦悩鍨毄闁稿鍋ゅ畷褰掑醇閺囩喎浠梺闈涱槴閺呪晠寮崒鐐寸叆闁绘洖鍊圭�氾拷 by changhao	
				if (!team.isTeamLeader(roleid))
				{
					psend(roleid, new STeamError(TeamError.SelfNOtLeader));
					TeamManager.logger.error("COneKeyTeamMatch:闂傚倸鍊搁崐鎼佸磹閹间礁纾归柟闂寸绾惧綊鏌熼梻瀵割槮缁炬儳缍婇弻锝夊箣閿濆憛鎾绘煕閵堝懎顏柡灞剧洴椤㈡洟鏁愰崱娆樻К闂備胶顭堢悮顐﹀礉鎼淬劌绠熼柟闂寸缁秹鏌涢锝嗗剷闁靛鏅滈悡鏇㈡煙閼割剙濡芥繛鍛閺屾稒鎯旈敐鍛亪闂佸搫鏈ú婵堢不濞戞熬鎷烽敐搴濈敖闁告梹娼欓埞鎴︽倷鐠鸿櫣姣㈠銈庡幖閻楁捇宕洪悙鍝勭闁挎棁妫勬禍褰掓煟閻樺弶鍘傞柛鎰屽懐鐓戦梻鍌氬�烽懗鍫曞箠閹捐鐤悹鎭掑妽瀹曟煡鏌熼幍顔碱暭闁稿鏅犻弻锝夊箣閿濆棭妫勭紓浣哄Х閺佸寮婚悢鐑樺枂闁告洖鐏氶悾鍓佺磽閸屾氨孝闁挎洦浜滈锝夘敃閿曪拷缁犳盯鏌℃径濠勪虎缂佹劖绋戦—鍐Χ閸℃﹩姊垮┑鐐差槹濞茬喖濡存笟锟藉畷銊э拷娑櫱氶幏缁樼箾鏉堝墽鍒伴柟鑺ョ矒閺佸秴顓奸崶鈺冿紲濡炪倖娲栭幊搴ㄦ倶閻樼偨浜滄い鎰╁灮缁犺尙绱掔紒妯肩畵妞ゎ偅绻堥、姗�鎮㈤崜韫埛闂傚倸鍊峰ù鍥ㄦ叏閵堝鏅俊鐐�х粻鎾寸閸洖绠栧Δ锝呭枤閺佸洭鏌曡箛銉х？闁告﹢浜堕弻鐔兼嚃閳哄媻澶愭煥閻旂粯顥夐柣銈呮喘瀹曟椽鎮欓悜妯煎弰闂佺厧顫曢崐鏇熺閿斿墽纾肩紓浣诡焽濞插锟借娲栧畷顒冪亽闂佹儳绻橀敓鑺ョ♁閸嬪懘姊婚崒娆掑厡闁硅櫕鎹囧畷顖炲锤濡わ拷缁犵姵淇婇娆掝劅婵炲吋鐗曢埞鎴︽偐鐎圭姴顥濈紒鐐劤閸氬骞堥妸銉建闁糕剝顨呴埛鏇㈡⒑瑜版帩妫戦柛蹇旓耿閻涱噣寮介妸锕�顎撻梺鍛婄缚閸庤崵妲愰锟藉缁樻媴閸濄儳楔濠碘槅鍋夊▔鏇犲垝閸喓鐟归柨鐔剁矙楠炲啴宕稿Δ濠冩櫓濠电偞娼欐鍝ョ礊婵犲倻鏆︽俊銈呮噹缁�鍌炴煠濞村娅囬柍璇茬箳缁辨捇宕掑▎鎴濆闂佸憡姊归悧鐘诲Υ閸愨晝绡�闁搞儜鍡樻啺闂備胶鍋ㄩ崕鏌ュ礈濮樿泛瑙﹂悗锝庡枛缁犲湱绱掗鐐仧闁瑰嘲鍢查悾鐑藉炊鐠虹儤娅嶅┑鐘垫暩婵敻顢欓弽顓炵獥婵炴埈婢佺紞鏍ь熆閼搁潧濮堥柛瀣�块弻銊╂偄閸濆嫅銏ゆ煢閸愵亜鏋涢柡灞炬礃缁绘盯鎮欓浣哄絾闂備胶顭堥鍛涘┑瀣摕婵炴垶鐭▽顏堟煕閹炬鎷锋俊鎻掔墕椤啴濡堕崨瀵稿椽闂佺懓鍤栭幏锟� "+roleid);
					
					msg.ret = 1;
					mkdb.Procedure.psendWhileCommit(roleid, msg);
					return true;						
				}
				
				teamid = xtable.Roleid2teamid.get(roleid);		
				if (fire.pb.fushi.Module.GetPayServiceType() == 1) //闂傚倸鍊搁崐鎼佸磹閹间礁纾归柟闂寸绾惧綊鏌熼梻瀵割槮缁炬儳缍婇弻锝夊箣閿濆憛鎾绘煕閵堝懎顏柡灞剧洴楠炴﹢鎳犻澶嬓滈梻浣规偠閸斿秶鎹㈤崘顔嘉﹂柛鏇ㄥ灠閸愶拷濡炪倖鍔﹀锟界紒顔煎缁辨挻绗熸繝鍐伓濠电姰鍨煎▔娑㈩敄閸曨厽宕查柛鈩冪♁閻撳繘鏌涢锝囩畺闁革絾妞介弻娑㈡晲閸涱喛纭�缂備浇椴哥敮锟犲箖閳哄懏顥堟繛鎴炲笚閻庝即姊绘担鍛婃儓闁活剙銈稿畷浼村冀椤撶姴绁﹂梺绯曞墲閸戠懓危妤ｅ啯鈷戦柟绋挎捣閳藉绱掓径濠勭Ш鐎殿喖顭烽弫鎾绘偐閹绘帟锟藉灝顪冮妶鍡樺暗濠殿喚鍏樺鎶藉Χ閸涱亝鏂�濡炪倖姊婚妴瀣绩缂佹ü绻嗛柣鎰閻瑩鏌曢崱鏇狀槮閾绘牠鏌涘☉鍗炴灍婵炲懌鍨藉鐑樺濞嗘垵鍩岄梺娲诲墮閵堟悂骞嗗畝鍕缂備焦锚閿熺晫鏁婚弻锝夊閻樺啿鏆堟繛瀛樺殠閸婃繈寮婚悢椋庢殝闁哄瀵т簺婵＄偑鍊ら崑鍛崲閸儯锟戒礁螖娴ｅ摜绐為柣搴稻閹稿爼宕濋幋婵愭綎闁惧繗顫夊畷澶愭煏婵炲灝鍔滈柣蹇撴閳规垿鍩ラ崱妞剧盎闁诲孩鍑归崰姘跺礆閹烘梹瀚氱�瑰壊鍠栭幃鎴炵節閵忥絾纭鹃柨鏇畵閺佸秹鎮㈤崗灏栨嫽婵炴挻鑹惧ú銈嗘櫠椤斿墽纾煎璺侯煬閸ょ喓绱掗纰辩吋闁诡喒鏅濋幏鐘绘嚑椤掑鏅ｉ梻鍌欑濠�閬嶅煕閸儱鍌ㄥΔ锝呭暙閸屻劍绻濇繝鍌涘櫧缁惧墽鏅敓钘夌畭閸庡崬螞濞戞瑦娅犻柣銏犳啞閻撴盯鎮橀悙闈涗壕缂侊拷鐎ｎ剨鎷风憴鍕闁告鍥х厴闁硅揪绠戠粻娑欍亜閹剧绱￠柛銉ｅ妷閹疯櫣绱撻崒娆戝妽閽冮亶鎮樿箛鏇烆暭缂佺粯鐩幊鐘活敆閿熶粙寮稿☉姘炬嫹濞堝灝鏋涙い顓㈡敱娣囧﹪骞栨担鍝ュ幐闂佺鏈惌顔捐姳娴犲鈷掑ù锝勮閻掗箖鏌￠崼顐㈠缂侇喗鐟╅獮瀣晜缂佹ɑ娅嗛梻浣芥硶閸ｏ箓骞忛敓锟�? by changhao
				{
					DSTeamMatchInfo config = ConfigManager.getInstance().getConf(DSTeamMatchInfo.class).get(team.getTeamInfo().getTargetid());
					if (config == null)
					{
						psend(roleid, new STeamError(TeamError.NoTarget));
						TeamManager.logger.error("COneKeyTeamMatch:闂傚倸鍊搁崐鎼佸磹閹间礁纾归柟闂寸绾惧綊鏌熼梻瀵割槮缁炬儳缍婇弻锝夊箣閿濆憛鎾绘煕閵堝懎顏柡灞剧洴椤㈡洟鏁愰崱娆樻К缂備胶鍋撻崕鍐差焽閿熺姴钃熼柨婵嗩槸椤懘鏌曡箛濠冩珖闁告梹鎮傚鍝勑ч崶褝鎷峰┑鍫笉闁哄稁鍘奸拑鐔猴拷骞垮劚椤︻垱瀵奸悩缁樼厱闁哄洢鍔屾晶顔界箾閸滃啰鎮肩紒杈ㄦ尰閹峰懘鎮烽弶娆炬綌婵＄偑鍊戦崝灞轿涘▎鎴犵煔閺夊牄鍔庣弧锟介梺鎼炲労閻忔稖顦归柡灞剧☉閳藉宕￠悙瀵镐邯婵犵數鍋涢幊宀勫磹濠靛棭娼栭柧蹇撴贡閻瑦绻涢崱妯哄姢闁告挻婢橀—鍐Χ韫囨洜绐楅梺鍛婎殙濞呮洘绌辨繝鍥ㄥ仺缂佸娉曢ˇ鏉款渻閵堝棛澧い鏇＄簿椤﹀綊鏌＄仦鍓р槈闁宠棄顦靛畷锟犳倷閸忕瀵查梻鍌欒兌缁垶骞愮拠鍙傛盯宕橀…鎴炵稁婵犵數濮甸懝鍓у閸忓吋鍙忔慨妤�妫楁晶楣冩煙妞嬪骸鍘存鐐寸墬閹峰懘宕妷顖滀覆闂傚倷鑳剁划顖炲垂閸忓吋鍙忛柕鍫濐槸绾惧綊鏌涜椤ㄥ棝鎮￠妷鈺傜厸闁告劖瀵х�氬綊姊鸿ぐ鎺撴暠缂佽鐗撻悰顔跨疀閺冩垶效闁硅壈鎻徊鍧楁偩鐠鸿　鏀介柣鎰綑閻忥箓鎷戦崡鐑嗙唵閻犲搫鎼顓㈡煛鐏炲墽銆掗柨鐔告灮缁茶姤鏅舵惔锝呭К闁跨喍绮欏娲传閸曨剚鎷卞┑鐐插级椤洭骞戦姀鐘闁靛繆锟界鎷烽柨瀣ㄤ簻闁瑰搫绉烽崗宀�鎲搁幍顔兼灈婵﹦绮幏鍛存嚍閵夛綇鎷烽崘顏嗙＜闁跨喕濮ょ粭鐔兼晸娴犲锟戒線寮介妸銉х獮闂佸綊鍋婇崜婵嬪箺閺囥垺鈷戦梻鍫熷崟閸儱鐤炬繝濠傜墕绾惧鏌涢埄鍐檨闁绘挻娲熼幃姗�鎮欓幓鎺嗘寖闂佸疇妫勯ˇ浼村Φ閸曨喚鐤�闁靛绠戦锟� "+roleid);
						
						msg.ret = 1;
						mkdb.Procedure.psendWhileCommit(roleid, msg);
						return true;					
					}					
				}
				else
				{
					STeamMatchInfo config = ConfigManager.getInstance().getConf(STeamMatchInfo.class).get(team.getTeamInfo().getTargetid());
					if (config == null)
					{
						psend(roleid, new STeamError(TeamError.NoTarget));
						TeamManager.logger.error("COneKeyTeamMatch:闂傚倸鍊搁崐鎼佸磹閹间礁纾归柟闂寸绾惧綊鏌熼梻瀵割槮缁炬儳缍婇弻锝夊箣閿濆憛鎾绘煕閵堝懎顏柡灞剧洴椤㈡洟鏁愰崱娆樻К缂備胶鍋撻崕鍐差焽閿熺姴钃熼柨婵嗩槸椤懘鏌曡箛濠冩珖闁告梹鎮傚鍝勑ч崶褝鎷峰┑鍫笉闁哄稁鍘奸拑鐔猴拷骞垮劚椤︻垱瀵奸悩缁樼厱闁哄洢鍔屾晶顔界箾閸滃啰鎮肩紒杈ㄦ尰閹峰懘鎮烽弶娆炬綌婵＄偑鍊戦崝灞轿涘▎鎴犵煔閺夊牄鍔庣弧锟介梺鎼炲労閻忔稖顦归柡灞剧☉閳藉宕￠悙瀵镐邯婵犵數鍋涢幊宀勫磹濠靛棭娼栭柧蹇撴贡閻瑦绻涢崱妯哄姢闁告挻婢橀—鍐Χ韫囨洜绐楅梺鍛婎殙濞呮洘绌辨繝鍥ㄥ仺缂佸娉曢ˇ鏉款渻閵堝棛澧い鏇＄簿椤﹀綊鏌＄仦鍓р槈闁宠棄顦靛畷锟犳倷閸忕瀵查梻鍌欒兌缁垶骞愮拠鍙傛盯宕橀…鎴炵稁婵犵數濮甸懝鍓у閸忓吋鍙忔慨妤�妫楁晶楣冩煙妞嬪骸鍘存鐐寸墬閹峰懘宕妷顖滀覆闂傚倷鑳剁划顖炲垂閸忓吋鍙忛柕鍫濐槸绾惧綊鏌涜椤ㄥ棝鎮￠妷鈺傜厸闁告劖瀵х�氬綊姊鸿ぐ鎺撴暠缂佽鐗撻悰顔跨疀閺冩垶效闁硅壈鎻徊鍧楁偩鐠鸿　鏀介柣鎰綑閻忥箓鎷戦崡鐑嗙唵閻犲搫鎼顓㈡煛鐏炲墽銆掗柨鐔告灮缁茶姤鏅舵惔锝呭К闁跨喍绮欏娲传閸曨剚鎷卞┑鐐插级椤洭骞戦姀鐘闁靛繆锟界鎷烽柨瀣ㄤ簻闁瑰搫绉烽崗宀�鎲搁幍顔兼灈婵﹦绮幏鍛存嚍閵夛綇鎷烽崘顏嗙＜闁跨喕濮ょ粭鐔兼晸娴犲锟戒線寮介妸銉х獮闂佸綊鍋婇崜婵嬪箺閺囥垺鈷戦梻鍫熷崟閸儱鐤炬繝濠傜墕绾惧鏌涢埄鍐檨闁绘挻娲熼幃姗�鎮欓幓鎺嗘寖闂佸疇妫勯ˇ浼村Φ閸曨喚鐤�闁靛绠戦锟� "+roleid);
						
						msg.ret = 1;
						mkdb.Procedure.psendWhileCommit(roleid, msg);
						return true;					
					}						
				}
				
				long systemTime = System.currentTimeMillis();
				
				final long now = System.currentTimeMillis();
				final long delaytime = ChatChannel.getInstance().getWorldChatDelayTime();
				final LastChatTime rctime = new LastChatTime(roleid, false);
				if (channeltype == fire.pb.talk.ChannelType.CHANNEL_WORLD && rctime.getLastWorldChatTime() + delaytime > now) {
					java.util.ArrayList<String> args = new java.util.ArrayList<String>();
					args.add("" + (rctime.getLastWorldChatTime() + delaytime - now) / 1000);
					MessageMgr.sendMsgNotify(roleid, ChatMsgId.CHAT_WORLD_CHANNEL_TIME_LIMIT, args);
					
					msg.ret = 1;
					mkdb.Procedure.psendWhileCommit(roleid, msg);
					return true;
				}
				
				long delta = systemTime - team.getTeamInfo().getOnekeytimestamp() - TeamManager.ONE_KEY_APPLY_TEAM;
				if (delta < 0)
				{
					String s = String.format("%d", (int)-delta / 1000);
					MessageMgr.sendMsgNotify(roleid, 150028, Arrays.asList(s));
					TeamManager.logger.info("COneKeyTeamMatch:婵犵數濮烽弫鍛婃叏閻戣棄鏋侀柛娑橈攻閸欏繘鏌ｉ幋锝嗩棄闁哄绶氶弻鐔兼⒒鐎靛壊妲紒鐐劤椤兘寮婚敐澶婄疀妞ゆ帊鐒﹂崕鎾绘⒑閸濆嫬顏ラ柛搴ㄤ憾閸╃偤骞嬮敂钘変汗闂佸憡鐟ラˇ浼村箖濞嗘垹纾藉ù锝呮惈椤庡矂鏌涢妸銉у煟鐎殿喖顭锋俊鎼佸煛閸屾矮绨介梻浣侯焾閺堫剛绮欓幋锔绘晜闁跨噦鎷�?闂傚倸鍊搁崐鎼佸磹閹间礁纾归柟闂寸绾惧綊鏌熼梻瀵割槮缁炬儳缍婇弻鐔兼⒒鐎靛壊妲紒鐐劤缂嶅﹪寮婚敐澶婄闁挎繂鎲涢幘缁樼厱濠电姴鍊归崑銉╂煛鐏炶濮傜�殿喗鎸抽幃娆撶叓椤撶姵鏅奸梻鍌欐祰濡椼劎绮堟担鐚存嫹濮樼厧骞橀柟骞垮灩閳藉濮�閻樿尪锟藉灝鈹戦埥鍡楃仴妞ゆ泦鍛瀳鐎广儱娲ㄧ壕钘壝归敐鍥ㄥ殌濠殿喖鐗婇妵鍕Ω閵夘垵鍚悗娈垮枛椤兘宕规ィ鍐ㄧ疀濞达絽鎲￠崐顖炴⒑绾懎浜归悶娑栧劦閺佹捇鎸婃径宀嬬礊濡炪倖姊归崝娆忣潖缂佹ɑ濯撮柛娑橈工閺嗗牓姊洪幖鐐插妞ゎ偄顦遍幑銏犫槈閵忊剝娅㈡繛瀵稿Т椤戝棝鎮″☉銏″�堕柣鎰絻閳锋梹绻涢幓鎺旀憼闁靛洤瀚版慨锟介柍鈺佸暟椤︿即姊虹拠鈥虫灀闁哄懐濞�楠炲﹪鎮╁ú缁樻櫈闁荤姵浜介崝宥夋晬韫囨稒鈷掗柛灞剧懄缁佺増銇勯弴鍡楁嫅閹峰嘲鈽夐幒鎾寸彇闂佸摜濮撮敃銈夘敇婵傜鐐婄憸搴ㄦ倵閹惰姤鍊垫鐐茬仢閸旀碍绻涚拠褏鐣遍柣锝囧厴瀹曪絾寰勫畝锟介惁鍫ユ⒒閸屾氨澧涘〒姘殜瀹曟洟骞囬婊�绨婚梺闈涱槶閸庤櫕鏅跺☉姘辩＜缂備焦顭囧ú瀛橆殽閻愬樊鍎旈柟顔界懇瀹曞綊顢曢姀锛勫經婵犵绱曢崑鎴﹀磹瑜旈幊娆掋亹閹烘垹鏌у┑鐐村灍閹冲洭鏁撻懞銉︻棃鐎规洘锕㈤、娆撳床婢舵盯妾柕鍥у瀵粙濡歌閸ｎ喖顪冮妶蹇氼吅闂傚嫬瀚幑銏犫槈濮橆厼鐝伴悷婊冪箻閹箖鎮介崨濠勫幈闂佸啿鎼崐璇裁虹�涙﹩娈介柣鎰綑缁楁帡鎽堕弽顬″綊鏁愰崨顔藉創濡ょ姷鍋涢悧鎾愁潖閾忚瀚氶柤纰卞墰椤斿﹪姊虹粙娆惧剱缂佸甯″鏌ユ嚋閻㈡娴勯柣搴秵娴滅偤宕ｉ崘鈺冪闁规儳顕崯鏌ユ煙妞嬪骸鍘撮柡宀�鍠栭、娆戠驳鐎ｎ剙濮肩紓鍌欒兌婵敻鎯勯娑楃箚闁绘垼妫勯悡娑㈡煕鐏炶锟窖囧箯瀹勯偊鍚嬮柛鈩冪懅椤旀洟姊洪幐搴ｇ畵闁瑰啿绻橀獮鏍箛閻楀牏鍙嗛梺鍝勬储閸斿鏌囬鐐寸厪闁糕剝娲滅粣鏃傦拷娈垮枟閹歌櫕鎱ㄩ敓浠嬫煟濞嗘瑦瀚瑰┑鐐靛帶閿曨亜顫忓ú顏呭�烽柦妯侯槸婵酣姊洪崨濞氭垿鎮ч弴鈥崇倒婵＄偑鍊栧濠氬疾椤愩倕濮柨鐔绘閳规垿鎮欓懠顒�顣洪梺璇茬箲缁诲牆顕ｇ粙搴撴婵炲棗绉崇花璇差渻閵堝棙瀵欓柛鎰╁妿閻嫭淇婇妶鍥ラ柛瀣〒閹广垹顫滈敓钘夘嚕椤愶箑绠荤紓浣股戝▍銏ゆ⒑鐠恒劌娅愰柟鍑ゆ嫹?60缂傚倸鍊搁崐鎼佸磹閹间礁纾归柟闂寸绾惧綊鏌熼梻瀵割槮缁炬儳缍婇弻鐔兼⒒鐎靛壊妲紒鎯у⒔閹虫捇鈥旈崘顏庢嫹閿濆簼绨奸柟鐧哥秮閺岋綁顢橀悙鎼闂侀潧妫欑敮鎺楋綖濠靛鍊锋い鎺炴嫹妞ゅ繐鐖煎娲嚍閵夊鍨归幑銏ゅ醇閵夈儴鎽曢梺缁樻煥閻ㄦ繈寮搁弮鍫熺厱妞ゎ厽鍨甸弸鐔兼煟韫囨挾效婵﹥妞藉畷顐﹀礋椤掑锛佺紓鍌欑贰閸犳骞戦崶褜鍤曞┑鐘宠壘鎯熼梺鍐叉惈閸婂憡绂嶉悙鐑樷拺缂佸瀵у﹢鎵磼鐎ｎ偄鐏存い銏℃閺佹捇鏁撻敓锟�?? "+roleid);
					
					msg.ret = 1;
					mkdb.Procedure.psendWhileCommit(roleid, msg);
					return true;						
				}
				
				team.getTeamInfo().setOnekeytimestamp(systemTime);
				
				/*
				fire.pb.message.SStringRes msg1 = ConfigManager.getInstance().getConf(fire.pb.message.SStringRes.class).get(285);
				if (msg1 == null)
				{
					TeamManager.logger.error("COneKeyTeamMatch:闂傚倸鍊搁崐鎼佸磹閹间礁纾归柟闂寸绾惧綊鏌熼梻瀵割槮缁惧墽鎳撻—鍐拷锝庝簼閹癸綁鏌ｉ鐐搭棞闂囧鏌ㄥ┑鍡欏妞ゅ繒濮风槐鎺楁晸閼恒儳绡�闁稿本顨嗛弬锟介梻浣虹帛钃辩憸鏉垮暞缁傚秹鎮欓悜妯煎幗闂佸湱鍎ゅ鐟扳枍閺囥垺鐓欓柛娆忣槹閸婃劖顨ラ悙宸剶闁轰礁鍟撮弫鎾绘嚍閵夘喗鏁梻鍌氬�峰ù鍥綖婢跺鐝堕柛鈩兩戝▍鐘充繆閵堝懏鍣圭痪鎯х秺閺岋綁骞嬮敐鍛呮捇鏌ｉ幘璺烘灈闁哄本娲濈粻娑氾拷锝庝簽娴犻箖姊洪崫鍕棏闁哄懐濞�瀵鏁愭径瀣珳闂佸壊鍋呯换鍕储椤愩倗纾藉ù锝堟鐢稓绱掔拠鑼闁逛究鍔戦弫鎾寸鐎ｎ偆鍙嗗┑鐘绘涧濡瑩宕虫禒瀣厱婵妫楁禍鐗堟叏婵犲啯銇濈�规洏鍔嶇换婵嬪礃閿濆棗顏稿┑鐘垫暩閸嬫稑顕ｉ崜浣稿灊閹兼番鍔岀粈鍡涙煙閻戞﹩娈旈梺鍗炴喘閺屾洘寰勯崼婵嗗闂佸吋婢橀悘婵嬪煘閹达附鍊烽柡澶嬪灩娴犳悂姊洪懡銈呮殌闁搞儜鍐ㄤ憾闂備礁鎲＄粙鎴︽晝閿旀儳濮柨鐔剁矙濮婃椽妫冨☉銏㈠椽缂備焦褰冩晶钘夆槈閸偁鍋呴柛鎰ㄦ櫅閿熻棄鐏氱换娑㈠箣閻愯尙鐟插┑鐐叉噹濞诧妇鎹㈠☉銏犵闁绘娅曞В鍫ユ倵鐟欏嫭绀�闁靛牏顭堥锝夊箻椤旇棄浜滈梺鍛婄箓鐎氼剛绮婚妷鈺傗拻闁稿本鐟﹂ˇ椋庣磼妲屾牕鏋ょ�垫澘锕ョ粋鎺旓拷锝庡亜濞堬絽顪冮妶鍡欏⒈闁稿鐩畷娆撴偐缂佹鍘搁梺鍛婂姂閸斿矂鏁撻崐鐔峰惞濠㈣娲樼缓鐣岀矙鐠恒劑鐛撻梻浣稿閸嬪懐绮欓幋鐐扮箚闁兼祴鏅濈壕鍏间繆閵堝嫮顦︽繛鎼櫍閺岀喖鎸婃径灞界厽閻庢鍠曠划娆撱�佸锟介幃銏ゅ礄閵堝棗顏堕梺姹囧灩閹诧繝鎮￠妷锔剧瘈闂傚牊绋掗ˉ銏°亜鎼淬埄娈旀い顓″劵椤﹀啿顭块悷鐗堫棤婵″弶鍔欓獮鎺懳旈敓鐣岀不濞戞瑣浜滈柟鐐殔鐎氼噣寮惰ぐ鎺撯拻濞达絽鎲￠幆鍫ユ煟椤撶儐妲虹紒杈╁仦缁楃喖鏁撴禒瀣祦闁告劦鍠栭～鍛存煏閸繃鍣圭紒鎰♁缁绘繈鎮介棃娴躲垽鎮楀锟介崶褎鐎悗骞垮劚椤︿即鍩涢幒鎳ㄥ綊鏁愰崶褍濡洪梺鎼炲�ч幏鐑芥⒒娴ｈ鍋犻柛濠冪墵閹囨偐閼姐倕绁﹂棅顐㈡处缁嬫帡寮查幖浣圭叆闁绘洖鍊圭�氾拷 "+roleid);
					return false;						
				}
				*/
				
				fire.pb.message.SStringRes msg2 = ConfigManager.getInstance().getConf(fire.pb.message.SStringRes.class).get(286);
				if (msg2 == null)
				{
					TeamManager.logger.error("COneKeyTeamMatch:闂傚倸鍊搁崐鎼佸磹閹间礁纾归柟闂寸绾惧綊鏌熼梻瀵割槮缁惧墽鎳撻—鍐拷锝庝簼閹癸綁鏌ｉ鐐搭棞闂囧鏌ㄥ┑鍡欏妞ゅ繒濮风槐鎺楁晸閼恒儳绡�闁稿本顨嗛弬锟介梻浣虹帛钃辩憸鏉垮暞缁傚秹鎮欓悜妯煎幗闂佸湱鍎ゅ鐟扳枍閺囥垺鐓欓柛娆忣槹閸婃劖顨ラ悙宸剶闁轰礁鍟撮弫鎾绘嚍閵夘喗鏁梻鍌氬�峰ù鍥綖婢跺鐝堕柛鈩兩戝▍鐘充繆閵堝懏鍣圭痪鎯х秺閺岋綁骞嬮敐鍛呮捇鏌ｉ幘璺烘灈闁哄本娲濈粻娑氾拷锝庝簽娴犻箖姊洪崫鍕棏闁哄懐濞�瀵鏁愭径瀣珳闂佸壊鍋呯换鍕储椤愩倗纾藉ù锝堟鐢稓绱掔拠鑼闁逛究鍔戦弫鎾寸鐎ｎ偆鍙嗗┑鐘绘涧濡瑩宕虫禒瀣厱婵妫楁禍鐗堟叏婵犲啯銇濈�规洏鍔嶇换婵嬪礃閿濆棗顏稿┑鐘垫暩閸嬫稑顕ｉ崜浣稿灊閹兼番鍔岀粈鍡涙煙閻戞﹩娈旈梺鍗炴喘閺屾洘寰勯崼婵嗗闂佸吋婢橀悘婵嬪煘閹达附鍊烽柡澶嬪灩娴犳悂姊洪懡銈呮殌闁搞儜鍐ㄤ憾闂備礁鎲＄粙鎴︽晝閿旀儳濮柨鐔剁矙濮婃椽妫冨☉銏㈠椽缂備焦褰冩晶钘夆槈閸偁鍋呴柛鎰ㄦ櫅閿熻棄鐏氱换娑㈠箣閻愯尙鐟插┑鐐叉噹濞诧妇鎹㈠☉銏犵闁绘娅曞В鍫ユ倵鐟欏嫭绀�闁靛牏顭堥锝夊箻椤旇棄浜滈梺鍛婄箓鐎氼剛绮婚妷鈺傗拻闁稿本鐟﹂ˇ椋庣磼妲屾牕鏋ょ�垫澘锕ョ粋鎺旓拷锝庡亜濞堬絽顪冮妶鍡欏⒈闁稿鐩畷娆撴偐缂佹鍘搁梺鍛婂姂閸斿矂鏁撻崐鐔峰惞濠㈣娲樼缓鐣岀矙鐠恒劑鐛撻梻浣稿閸嬪懐绮欓幋鐐扮箚闁兼祴鏅濈壕鍏间繆閵堝嫮顦︽繛鎼櫍閺岀喖鎸婃径灞界厽閻庢鍠曠划娆撱�佸锟介幃銏ゅ礄閵堝棗顏堕梺姹囧灩閹诧繝鎮￠妷锔剧瘈闂傚牊绋掗ˉ銏°亜鎼淬埄娈旀い顓″劵椤﹀啿顭块悷鐗堫棤婵″弶鍔欓獮鎺懳旈敓鐣岀不濞戞瑣浜滈柟鐐殔鐎氼噣寮惰ぐ鎺撯拻濞达絽鎲￠幆鍫ユ煟椤撶儐妲虹紒杈╁仦缁楃喖鏁撴禒瀣祦闁告劦鍠栭～鍛存煏閸繃鍣圭紒鎰♁缁绘繈鎮介棃娴躲垽鎮楀锟介崶褎鐎悗骞垮劚椤︿即鍩涢幒鎳ㄥ綊鏁愰崶褍濡洪梺鎼炲�ч幏鐑芥⒒娴ｈ鍋犻柛濠冪墵閹囨偐閼姐倕绁﹂棅顐㈡处缁嬫帡寮查幖浣圭叆闁绘洖鍊圭�氾拷 "+roleid);
					
					msg.ret = 1;
					mkdb.Procedure.psendWhileCommit(roleid, msg);
					return false;						
				}				
				
				//String msgstring1 = msg1.msg;
				String msgstring2 = msg2.msg;

				/*
				msgstring1 = msgstring1.replaceAll("\\$parameter1\\$", config.Target);
				msgstring1 = msgstring1.replaceAll("\\$parameter2\\$", Integer.toString(team.getTeamInfo().getMinlevel()));
				msgstring1 = msgstring1.replaceAll("\\$parameter3\\$", Integer.toString(team.getTeamInfo().getMaxlevel()));
				msgstring1 = msgstring1.replaceAll("\\$parameter4\\$", Long.toString(roleid));
				*/
				
				final java.util.ArrayList<fire.pb.talk.DisplayInfo> showinfos  = new java.util.ArrayList<fire.pb.talk.DisplayInfo>();
				
				boolean ret = ChatChannel.getInstance().process(roleid, channeltype, text, msgstring2, showinfos, 1);
				
				if (ret == true)
				{					
					MessageMgr.sendMsgNotify(roleid, 162025, null);					
				}
				else
				{
					msg.ret = 1;
				}
				
				mkdb.Procedure.psendWhileCommit(roleid, msg);
								
				return ret;
			}
			
		};
		onekeyteammatch.submit();	
	}

	// {{{ RPCGEN_DEFINE_BEGIN
	// {{{ DO NOT EDIT THIS
	public static final int PROTOCOL_TYPE = 794498;

	public int getType() {
		return 794498;
	}

	public int channeltype; // 频道类型 14组队申请 1当前频道 4帮派 5世界频道 by changhao
	public java.lang.String text; // 发送的文本 by changhao

	public COneKeyTeamMatch() {
		text = "";
	}

	public COneKeyTeamMatch(int _channeltype_, java.lang.String _text_) {
		this.channeltype = _channeltype_;
		this.text = _text_;
	}

	public final boolean _validator_() {
		return true;
	}

	public OctetsStream marshal(OctetsStream _os_) {
		if (!_validator_()) {
			throw new VerifyError("validator failed");
		}
		_os_.marshal(channeltype);
		_os_.marshal(text, "UTF-16LE");
		return _os_;
	}

	public OctetsStream unmarshal(OctetsStream _os_) throws MarshalException {
		channeltype = _os_.unmarshal_int();
		text = _os_.unmarshal_String("UTF-16LE");
		if (!_validator_()) {
			throw new VerifyError("validator failed");
		}
		return _os_;
	}

	public boolean equals(Object _o1_) {
		if (_o1_ == this) return true;
		if (_o1_ instanceof COneKeyTeamMatch) {
			COneKeyTeamMatch _o_ = (COneKeyTeamMatch)_o1_;
			if (channeltype != _o_.channeltype) return false;
			if (!text.equals(_o_.text)) return false;
			return true;
		}
		return false;
	}

	public int hashCode() {
		int _h_ = 0;
		_h_ += channeltype;
		_h_ += text.hashCode();
		return _h_;
	}

	public String toString() {
		StringBuilder _sb_ = new StringBuilder();
		_sb_.append("(");
		_sb_.append(channeltype).append(",");
		_sb_.append("T").append(text.length()).append(",");
		_sb_.append(")");
		return _sb_.toString();
	}

	// DO NOT EDIT THIS }}}
	// RPCGEN_DEFINE_END }}}

}

