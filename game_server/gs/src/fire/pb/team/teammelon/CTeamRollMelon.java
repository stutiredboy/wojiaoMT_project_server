
package fire.pb.team.teammelon;

// {{{ RPCGEN_IMPORT_BEGIN
// {{{ DO NOT EDIT THIS
import com.locojoy.base.Marshal.OctetsStream;
import com.locojoy.base.Marshal.MarshalException;

abstract class __CTeamRollMelon__ extends mkio.Protocol { }

// DO NOT EDIT THIS }}}
// RPCGEN_IMPORT_END }}}

public class CTeamRollMelon extends __CTeamRollMelon__ {
	@Override
	protected void process() {
		// protocol handle
		
		final long roleid = gnet.link.Onlines.getInstance().findRoleid(this);
		if (roleid < 0)
			return;
		mkdb.Procedure teamrollmelon = new mkdb.Procedure() 
		{
			@Override
			/*闂傚倸鍊搁崐鎼佸磹閹间礁纾归柟闂寸绾剧懓顪冪�ｎ亝鎹ｉ柣顓炴閵嗘帒顫濋悙顒�顏舵俊銈囧Х閸嬫盯藝閻㈢鍨傚Δ锝呭暙缁犳稑霉閿濆懏璐＄紒瀣╄兌缁辨捇宕掑顒婃嫹閻戣姤鍊块柨鏇炲�甸敓鏂ょ畵瀹曞爼鍩￠崘褏鐟濆┑掳鍊х徊浠嬪疮椤栫偞鍋傞柕澶嗘櫆閻撶喖鏌￠崒姘变虎妞わ絾濞婇弻锝夘敇閻旂儤鍣伴梺鍝勫閿熻棄纾弳鍡涙倵閿濆骸澧伴柣锕�鐗撳鐑樻姜閹殿喖濡介梺瑙勭摃瀹曠數鍒掔�ｎ喖绠抽柡鍐╂尰鐎氬綊鏌ㄥ┑鍡涱�楀ù婊勭箖缁绘盯宕ㄩ鍓х厜濠殿喖锕ㄥ▍锝夊礌閺嶎厼鍗抽柣鎰ゴ閹枫倝姊绘担鍛婂暈婵﹤婀遍弫顕�鎮欓悜妯烘疅闁哄鐗勯崝搴ｅ姬閿熻棄鈹戦鏂や緵闁告ɑ鎮傞獮蹇撁洪鍛嫼闂佸憡绋戦敃锕傚煡婢舵劖鐓ラ柡鍥朵簻椤╊剛绱掗纰辩吋妤犵偞顭囩槐鎺懳熼悮瀛樺闁割煈鍋呴崣蹇斾繆椤栨粌甯堕悽顖氱埣閺岋紕锟斤絻鍔岄敓鑺ョ箞瀵鈽夐姀鈥充汗闁荤姴娉ч崘褏鐭楅梻鍌欐缁鳖喚绱為崶鈺傤潟闁哄洨濮撮崹婵嬫煕椤愮姴鐏柣顓烆槺缁辨帒鐣濈�ｎ偄顏� by changhao*/
			protected boolean process()
			{	
				xbean.Properties roleprop = xtable.Properties.select(roleid);
				
				Long battlemelonid = xtable.Roleid2battlemelonid.select(roleid);
				if (battlemelonid == null)
				{
					psend(roleid, new fire.pb.team.STeamError(fire.pb.team.TeamError.SelfNotInTeam));
					fire.pb.team.TeamManager.logger.debug("CTeamRollMelon: "+roleid);
					return true;					
				}
				
				xbean.ETeamMelon eteammelon = xtable.Battlemelonid2melon.get(battlemelonid);
				if (eteammelon == null)
				{
					psend(roleid, new fire.pb.team.STeamError(fire.pb.team.TeamError.SelfNotInTeam));
					fire.pb.team.TeamManager.logger.debug("CTeamRollMelon:婵犵數濮烽弫鍛婃叏閻戣棄鏋侀柛娑橈攻閸欏繘鏌ｉ幋锝嗩棄闁哄绶氶弻鐔兼⒒鐎靛壊妲紒鎯у⒔缁垳鎹㈠☉銏犵闁绘劕鐏氶崳褏绱撴担绋款暢闁稿鍊濆璇测槈閵忕姈銊︺亜閺冨倸甯舵い顐熸櫇缁辨挻绗熸繝鍐伓闂備礁澹婇崑鍡涘窗閹捐泛濮柨鐔剁矙濮婂宕掑鍗烆杸缂備礁顑嗙敮锟犲极瀹ュ绫嶉柛顐ゅ枔閸橀箖姊洪崫鍕垫Ъ婵炲娲樼粋鎺楀閵堝棭姊挎繝銏ｅ煐閸旀牠鎮￠妷锔剧瘈闂傚牊绋掗ˉ鐐烘煕閿濆棙銇濋柟顔肩秺楠炲洭宕滄担铏规婵犳鍠栭敃銈夆�﹀畡鎵殾闁绘梻鈷堥弫鍐煏韫囧﹥娅冪紒杈ㄦ濮婄粯鎷呴崨濠冨創婵犮垼娉涘ú顓㈠极閹剧粯瀵犲璺虹焿缁辩偤姊洪崫鍕棑闁稿﹥鐗犳俊鐢稿礋椤栨氨鐫勯梺绋挎湰閼圭偓绂掑锟藉鐑樻姜閹殿喛绐楁繛瀛樼矤娴滎亜顕ｆ繝姘╅柍鍝勫�告禍婊堟⒑閸涘﹦绠撻悗姘嚇閺佹劖寰勭�ｎ剙骞楅梻浣筋潐閸庢娊鎮洪妸褏鐭嗛柛鎰典簽绾捐偐绱撴担璇＄劷婵炴彃顕敓鍊燁潐濞叉牕鐣烽鍐航闂傚鍋勫ù鍕緤婵傚憡鐒芥い鏍仦閻撴瑦銇勯弮锟介弸濠氭嚀閸ф鐓欐い鏃囶潐濞呭洨绱掓潏銊ョ瑨閾伙綁鏌ｉ幘鎶筋�楃紒鐘靛仱濮婂宕掑▎鎴犵崲濠电偘鍖犻崶锝忔嫹閿曞倸閱囬柕澶堝劤閿涚喖姊哄Ч鍥х伄妞ゎ厼鐗撻幆灞轿旈崨顔惧幈闂佸搫娲㈤崝宀勬倶閿熺姵鐓熼柟鎯ь嚟閵嗘帡鏌ㄩ悢鐑樻珪婵炲懌鍨介獮蹇涙倻閼恒儱锟界敻鏌ㄥ┑鍡涱�楀ù婊勭矋閵囧嫯绠涢妷锕�顏�?"+roleid);
					return true;					
				}
				
				xbean.TeamMelon teammelon = eteammelon.getMelonid2melons().get(melonid);
				if (teammelon == null)
				{
					psend(roleid, new fire.pb.team.STeamError(fire.pb.team.TeamError.SelfNotInTeam));
					fire.pb.team.TeamManager.logger.debug("CTeamRollMelon:婵犵數濮烽弫鍛婃叏閻戣棄鏋侀柛娑橈攻閸欏繘鏌ｉ幋锝嗩棄闁哄绶氶弻鐔兼⒒鐎靛壊妲紒鎯у⒔缁垳鎹㈠☉銏犵闁绘劕鐏氶崳褏绱撴担绋款暢闁稿鍊濆璇测槈閵忕姈銊︺亜閺冨倸甯舵い顐熸櫇缁辨挻绗熸繝鍐伓闂備礁澹婇崑鍡涘窗閹捐泛濮柨鐔剁矙濮婂宕掑鍗烆杸缂備礁顑嗙敮锟犲极瀹ュ绫嶉柛顐ゅ枔閸橀箖姊洪崫鍕垫Ъ婵炲娲樼粋鎺楀閵堝棭姊挎繝銏ｅ煐閸旀牠鎮￠妷锔剧瘈闂傚牊绋掗ˉ鐐烘煕閿濆棙銇濋柟顔肩秺楠炲洭宕滄担铏规婵犳鍠栭敃銈夆�﹀畡鎵殾闁绘梻鈷堥弫鍐煏韫囧﹥娅冪紒杈ㄦ濮婄粯鎷呴崨濠冨創婵犮垼娉涘ú顓㈠极閹剧粯瀵犲璺虹焿缁辩偤姊洪崫鍕棑闁稿﹥鐗犳俊鐢稿礋椤栨氨鐫勯梺绋挎湰閼圭偓绂掑锟藉鐑樻姜閹殿喛绐楁繛瀛樼矤娴滎亜顕ｆ繝姘╅柍鍝勫�告禍婊堟⒑閸涘﹦绠撻悗姘嚇閺佹劖寰勭�ｎ剙骞楅梻浣筋潐閸庢娊鎮洪妸褏鐭嗛柛鎰典簽绾捐偐绱撴担璇＄劷婵炴彃顕敓鍊燁潐濞叉牕鐣烽鍐航闂傚鍋勫ù鍕緤婵傚憡鐒芥い鏍仦閻撴瑦銇勯弮锟介弸濠氭嚀閸ф鐓欐い鏃囶潐濞呭洨绱掓潏銊ョ瑨閾伙綁鏌ｉ幘鎶筋�楃紒鐘靛仱濮婂宕掑▎鎴犵崲濠电偘鍖犻崶锝忔嫹閿曞倸閱囬柕澶堝劤閿涚喖姊哄Ч鍥х伄妞ゎ厼鐗撻幆灞轿旈崨顔惧幈闂佸搫娲㈤崝宀勬倶閿熺姵鐓熼柟鎯ь嚟閵嗘帡鏌ㄩ悢鐑樻珪婵炲懌鍨介獮蹇涙倻閼恒儱锟界敻鏌ㄥ┑鍡涱�楀ù婊勭矋閵囧嫯绠涢妷锕�顏�?"+roleid);
					return true;					
				}
				
				//婵犵數濮烽弫鍛婃叏閻戣棄鏋侀柛娑橈攻閸欏繘鏌ｉ姀鐘差棌闁轰礁锕弻鈥愁吋鎼粹�崇缂備焦鍔栭〃鍡樼┍婵犲洤围闁告侗鍘藉▓鍓佺磽娴ｇ懓鏁剧紒鐘虫崌瀵鈽夊搴⑿俊鐐�戦崝宀勫箠閹邦厾鐝堕柡鍤堕姹楅梺鍦劋閹搁箖宕㈤悽鍛娾拺缂備焦锚婵箓鏌涢幘瀵告噰閽樼喖鏌ｉ幇顒備粵闁哥姵鍔欓獮鏍垝鐟欏嫷娼戦梺鎼炲�栭〃濠囧蓟濞戙垹鍗抽柕濞垮劚椤偆绱撴担鍝勨枅缂佺姵鐗犲濠氭晲婢跺﹦鐤�闂傚倸鐗婄粙鎴︼綖椤愶附鈷戦柛娑橈功閹冲啴鏌涢悢鍛婄稇妞ゎ偄绻掔槐鎺懳熺拠宸拷鎾绘煟閻斿摜鎳冮悗姘煎枟鐎靛ジ宕堕浣叉嫼闂佸憡绻傜�氼參宕冲ú顏呯厽闁冲搫锕ら悘鐘绘煟閿濆洤鍘存い銏＄洴閹粓宕卞Ο缁樼彨濠电姷鏁告慨鎾晝閵堝绠犵�广儱娲ㄧ粻鏂款熆閼搁潧濮堥柍閿嬪灴閺屾盯鏁傜拠鎻掔闂佸憡鏌ㄩ鍡涘Φ閸曨垰惟闁靛瀵屽Λ锕傛倵鐟欏嫭绀冮柛銊ユ健瀵偊骞囬弶璺ㄥ�為梺闈涱焾閸庢煡鎮楁ィ鍐╃厽閹艰揪绱曢悾顓㈡煕鎼粹�宠埞闂囧鏌涢弴銊ョ仩缂佺媭鍨抽敓鐣屾嚀鐎氫即宕戞繝鍌ょ劷闁冲搫鎳忛悡鐔兼煙閻愵剙鈻曟い搴㈩殘缁辨帡顢曢姀鈶垦勬叏婵犲懏顏犻柟椋庡█閸ㄩ箖鎼归锝庡敳闂傚倷绀侀幉鈩冪瑹濡ゅ懎鍨傞柟鍓佹櫕瀹撲線鏌熼幆褍顣崇痪鎹愭閵嗘帒顫濋浣规倷婵炲瓨绮嶇换鍕箟閹间礁绾ч柟绋垮閸庡酣姊婚崒姘拷鎼佸磹閹间礁纾归柟闂寸绾惧湱锟界懓瀚伴崑濠傘�掓繝姘厵闁绘垶蓱閳锋劖銇勯锝嗙闁靛洤瀚板鎾敂閸涱収浼撳┑掳鍊楁慨鐑藉磻濞戞碍宕叉慨妤嬫嫹鐎殿噮鍋婇獮妯肩磼濡粯顏熼梻浣芥硶閸ｏ箓骞忛敓锟�? by changhao
				Integer rollpoint = teammelon.getMelonroleids().get(roleid);
				if (rollpoint == null)
				{
					psend(roleid, new fire.pb.team.STeamError(fire.pb.team.TeamError.SelfNotInTeam));
					fire.pb.team.TeamManager.logger.debug("CTeamRollMelon:婵犵數濮烽弫鍛婃叏閻戣棄鏋侀柛娑橈攻閸欏繘鏌ｉ幋锝嗩棄闁哄绶氶弻鐔兼⒒鐎靛壊妲紒鎯у⒔缁垳鎹㈠☉銏犵闁绘劕鐏氶崳褏绱撴担绋款暢闁稿鍊濆璇测槈閵忕姈銊︺亜閺冨倸甯舵い顐熸櫇缁辨挻绗熸繝鍐伓闂備礁澹婇崑鍡涘窗閹捐泛濮柨鐔剁矙濮婂宕掑鍗烆杸缂備礁顑嗙敮锟犲极瀹ュ绫嶉柛顐ゅ枔閸橀箖姊洪崫鍕垫Ъ婵炲娲樼粋鎺楀閵堝棭姊挎繝銏ｅ煐閸旀牠鎮￠妷锔剧瘈闂傚牊绋掗ˉ鐐烘煕閿濆棙銇濋柟顔肩秺楠炲洭宕滄担铏规婵犳鍠栭敃銈夆�﹀畡鎵殾闁绘梻鈷堥弫鍐煏韫囧﹥娅冪紒杈ㄦ濮婄粯鎷呴崨濠冨創婵犮垼娉涘ú顓㈠极閹剧粯瀵犲璺虹焿缁辩偤姊洪崫鍕棑闁稿﹥鐗犳俊鐢稿礋椤栨氨鐫勯梺绋挎湰閼圭偓绂掑锟藉鐑樻姜閹殿喛绐楁繛瀛樼矤娴滎亜顕ｆ繝姘╅柍鍝勫�告禍婊堟⒑閸涘﹦绠撻悗姘嚇閺佹劖寰勭�ｎ剙骞楅梻浣筋潐閸庢娊鎮洪妸褏鐭嗛柛鎰典簽绾捐偐绱撴担璇＄劷婵炴彃顕敓鍊燁潐濞叉牕鐣烽鍐航闂傚鍋勫ù鍕緤婵傚憡鐒芥い鏍仦閻撴瑦銇勯弮锟介弸濠氭嚀閸ф鐓欐い鏃囶潐濞呭洨绱掓潏銊ョ瑨閾伙綁鏌ｉ幘鎶筋�楃紒鐘靛仱濮婂宕掑▎鎴犵崲濠电偘鍖犻崶锝忔嫹閿曞倸閱囬柕澶堝劤閿涚喖姊哄Ч鍥х伄妞ゎ厼鐗撻幆灞轿旈崨顔惧幈闂佸搫娲㈤崝宀勬倶閿熺姵鐓熼柟鎯ь嚟閵嗘帡鏌ㄩ悢鐑樻珪婵炲懌鍨介獮蹇涙倻閼恒儱锟界敻鏌ㄥ┑鍡涱�楀ù婊勭矋閵囧嫯绠涢妷锕�顏�?"+roleid);
					return true;	
				}
				
				Integer alreadroll = teammelon.getOpmelonroleids().get(roleid);
				if (alreadroll != null)
				{
					fire.pb.team.TeamManager.logger.debug("CTeamRollMelon:闂傚倸鍊搁崐鎼佸磹瀹勬噴褰掑炊椤掑鏅悷婊冪Ч閿濈偛鈹戠�ｎ偅娅囬梺绋跨焿婵″洨绮欒箛鏃傜瘈闁靛骏绲介悡鎰版煕閺冿拷閻楃姴鐣烽幋锕�围濠㈣泛顑囬崢鎼佹⒑閹肩偛鍔楅柡鍛☉閻剟姊绘担铏瑰笡閻㈩垱甯￠弫鍐Ψ瑜庡畷鍙夌箾閹存瑥鐏╂鐐灪娣囧﹪顢涘┑鍥朵哗婵炲濮甸幐鍐差潖濞差亜绠归柣鎰絻椤绱撴担绛嬪殭闁哥喎鐡ㄦ穱濠囨偨缁嬭法顦板銈嗙墬濮樸劑宕濋幘顔解拺闁告稑锕ゆ慨褏绱掗悩鍐茬仸缂佸倹甯￠垾鏃堝箥閿熺姵鈷掗柛灞捐壘閿熻姤鎮傚畷鎰槹鎼达絿鐒兼繛鎾寸啲閹烽攱顨ラ悙瀵稿⒌妞ゃ垺娲戠紞鍛存煕閵夘喖澧婚柡浣稿暣閺屻劑寮撮鍛伓闂備焦鐪归崐妤呭磻閹捐埖宕叉繛鎴欏灩缁狅綁鏌ｉ幇銊︽珕闁挎稑鐗嗛埞鎴︽倷閸欏鏋欐繛瀛樼矋缁诲牆顕ｉ弻銉ヨ摕闁靛濡囬崢閬嶆⒑闂堟侗妯堥柛鐘虫礈閼洪亶鎳￠妶鍕墾闂婎偄娲︾粙鎺楀煕閹烘嚚褰掓晲閸粳鎾剁棯椤撶偟鍩ｉ柡灞剧洴閺佹劘绠涢弴鐘虫婵°倗濮烽崑娑氭崲濮楋拷瀵偊骞樼紒妯绘闂佽法鍣﹂幏锟�"+roleid);
					return true;
				}
				
				if (status == 0) //闂傚倸鍊搁崐鎼佸磹閹间礁纾归柟闂寸绾剧懓顪冪�ｎ亝鎹ｉ柣顓炴閵嗘帒顫濋悙顒�顏舵俊銈囧Х閸嬬偤鎮ч悩姹囷拷渚�寮撮姀鈩冩珖闂佽法鍠撻弲顐︽晸閼恒儴澹樻い锔垮嵆婵＄敻宕熼姘鳖唺闂佺懓鐡ㄧ换宥嗙閼测晝纾藉〒姘攻鐎氳绻濋姀锝呯厫闁告梹鐗犻幃鈥斥枎閹惧鍘介梺鐟邦嚟娴兼繈顢旈崟鎴炲浮瀹曠喖顢橀悢閿嬬�鹃梺纭呭亹鐞涖儱危閸涙潙鍚规俊銈呮噺閻撴洟鏌￠崶銉ュ鐎殿喖娼￠弻鐔割槹鎼粹�冲箣闂佽桨鐒﹂崝娆忕暦閹烘垟妲堟繛鍡樺灥缁茶法绱撻崒姘拷鐑芥嚄閼稿灚鍙忛梻鍫熺〒閺嗗棛绱掔�ｎ偒鍎ユ繛鍏肩墵閺屟嗙疀閹剧纭�闂佹椿鍘介悷鈺呭蓟閻旇櫣鐭欓柛顭戝櫘閸斿姊洪崷顓熺効濞存粠鍓涘Σ鎰板箻鐎涙ê顎撻梺鍛婃尰瑜板啴宕滈柆宥嗏拺閻熸瑥瀚幗鍐拷瑙勬礈閺佹悂宕氶幒鏃撴嫹閿濆簼鎲鹃柛姘儏椤潡鎳滈惉顏呭灴瀵煡顢楅崟顑芥嫼缂傚倷鐒﹂敋濠殿喖娲﹂妵鍕即閵娿儱绫嶉悗瑙勬磸閸ㄤ粙鐛弽銊﹀闁稿繐顦扮�氬ジ姊洪懡銈呅ｅù婊�绮欏畷婵嗙暆閸曨偄鍤戦悗骞垮劚濞层劎澹曢崗绗轰簻闁哄啫鍊瑰▍鏇㈡煙閸愬弶鍠橀柡宀嬬到閳藉宕￠悙瀵稿綆闁诲氦顫夊ú鏍х暦椤掑嫸缍栨繝闈涱儏缁�鍌氼熆閹偊鍤冮柛鎾寸〒濡叉劙骞樼�涙ê顎撶紓浣割儏缁ㄩ亶骞愰崘顔解拺缂佸顑欓崕鎰版煙閻熺増鎼愰柣锝囧厴瀵挳濮�閻樻鍞撮梻浣稿悑娴滀粙宕曢幎鑺ュ仼闁规儼濮ら埛鎺楁煕鐏炲墽鎳勭紒浣哄缁绘稒寰勭�ｎ偆顦伴悗瑙勬礃婵炲﹪寮崘顔肩＜婵﹢纭搁崬鐢告⒒娴ｈ姤纭堕柛锝忕畵楠炲繘鏁撻敓锟�? by changhao
				{					
					teammelon.getMelonroleids().put(roleid, 0);
				}
				
				int num = teammelon.getOpnum();
				num ++;
				teammelon.setOpnum(num);
				
				teammelon.getOpmelonroleids().put(roleid, teammelon.getMelonroleids().get(roleid));
				
				fire.pb.team.teammelon.SOneTeamRollMelonInfo msg = new fire.pb.team.teammelon.SOneTeamRollMelonInfo();
				msg.itemid = teammelon.getItemid();
				msg.melonid = melonid;
				msg.rollinfo.roleid = roleid;
				msg.rollinfo.rolename = roleprop.getRolename();
				msg.rollinfo.roll = teammelon.getMelonroleids().get(roleid);
				
				for (Long e : eteammelon.getMelonerlist()) //闂傚倸鍊搁崐鎼佸磹閹间礁纾归柟闂寸绾剧懓顪冪�ｎ亝鎹ｉ柣顓炴閵嗘帒顫濋悙顒�顏舵俊銈囧Х閸嬫盯藝閻㈢鏋侀柟鍓х帛閸嬫劙鏌涢幇顖氱处闁汇垹顭峰缁樻媴閻熼偊鍤嬪┑鐐插级閻楃姴鐣烽幇鏉跨濞达絿顭堥悗顓㈡⒑缁嬭法鐏遍柛瀣仱閹繝寮撮姀锛勫弳闂佸搫鍟ù鍌炲吹濞嗘劦娈介柣鎰嚟婢х敻鏌＄仦鍓ф创濠碘剝鎮傞弫鍌炲礈瑜忛弳銈夋⒒閸屾碍鎼愭い锔炬暬瀵鈽夊鍛澑闂佽宕樺▍鏇㈠磹椤栨粎纾介柛灞炬皑鏍￠梺鎼炲妼濠�鍗炍ｉ幇鏉跨婵°倓绀佹禍濂告⒑閸涘﹣绶遍柛鐘崇墵椤㈡棃鏁撻敓锟�?闂傚倸鍊搁崐鎼佸磹閹间礁纾归柟闂寸绾剧懓顪冪�ｎ亝鎹ｉ柣顓炴閵嗘帒顫濋悙顒�顏舵俊銈囧Х閸嬬偤鎮ч悩姹囷拷渚�寮撮姀鈩冩珕闂佽姤锚椤︻喚绱旈弴銏♀拻濞达綀娅ｉ妴濠囨煕閹惧绠為柟钘夊�婚敓鏂ょ秵閸犳牠鎮欐繝鍐︿簻闁瑰搫绉剁拹鐗堜繆椤愩垹鏆欓柍瑙勫灴閹瑥顔忛鍏碱啀婵＄偑鍊栫敮鐔轰焊濞嗘垶顫曢柣鎰嚟閻熷綊鏌ㄩ悢缁橆棄妞ゆ洩缍侀、鏇㈡晝閿熺晫绮堥崘鈹夸簻闁哄啫娲ゆ禍褰掓煥濞戞瑧鐭婇柍瑙勫灴椤㈡瑩寮妶鍕繑闂備礁鎲￠幐濠氭儎椤栫偛绠栧ù鍏兼綑閻撴盯鏌涚仦鍓х煂闁伙箑鐗忕槐鎺楀礈瑜嶉。濂告嫅鏉堛劊浜滄い鎰垫緛闊剟鏌＄仦鍓ф创濠碘剝鎮傛俊鐤檪缂佽京鍋ゅ娲川婵犲倻鐟查柣銏╁灲缁绘繈濡存担绯曟婵☆垶鏀遍～宥呪攽椤旂煫顏堝触鐎ｎ剛鐭堟い鎰剁悼缁★拷缂佸墽澧楄摫妞ゎ偄锕弻娑㈠Ω瑜庨弳顒傦拷瑙勬礃閸ㄥ潡鐛崶顒夋晩缁炬媽椴搁ˉ锟犳⒒娴ｈ棄袚闁挎碍銇勯妷锝呯伇闁靛洦鍔欓獮鎺楀箻鐎涙褰搁梻鍌欑閹测剝绗熷Δ鍛獥婵°倕鎳庣粣妤呮煙闁箑骞樼紒鈽呮嫹闂備礁鍟块崵鏍箯瀹勬噴褰掓晲閸涱喗鍠愭繛瀵稿Т婢х晫妲愰幘瀛樺闁惧繒鎳撶粭锟犳⒑閻戔晜娅撻柛銊ゅ嵆閹箖鏌ㄧ�ｎ剟妾梺鍛婄☉閿曘倖绂嶅鍕箚闁绘劕妯婇崕蹇曠磼閵娧冨付妞も晛銈搁獮妯硷拷闈涙憸閻﹀牓姊哄Ч鍥х伈婵炰匠鍕浄闁宠桨绶￠悢鍡涙煟閻旂顥嬪褝闄勯妵鍕閳ヨ弓瀛╁銈忕畱缂嶅﹪寮诲☉銏犵厴闁割煈鍠氭禒楣冩⒑鐠団�崇仭婵☆偄鍟幈銊╂晸娴犲鐓冮柕澶堝劚閺嗗崬鈹戦埄鍐ㄢ枙婵﹦绮粭鐔兼晸閽樺鐒界憸鏃堝灳閿曞倸閱囬柕澶堝劤閿涚喖姊洪崫鍕潶闁稿孩鐓″畷鎴︻敂閸喓鍘遍柣蹇曞仦閸庢娊鎮炶ぐ鎺撶厸闁跨喕濮ょ粋鎺旓拷锝庡亞閸樹粙姊鸿ぐ鎺戜喊闁搞劋鍗抽幆鍐洪鍛幍闂佷紮绲介懟顖氭毄缂傚倷娴囨ご鍝ユ暜閿熺姰锟戒礁鈻庨幇顕�妾紓浣割儏閻忔繈宕ｆ繝鍥ㄢ拻濞达絿鐡旈崵鍐煕閵娿倕宓嗙�规洘鍔欏畷鐑筋敇閻樼數鏆ラ梻浣虹帛閺屻劑骞栭銈嗩偨闁靛牆顦伴悡鏇狅拷骞垮劚閹峰螣閿熻棄鈹戦纭峰伐妞ゎ厼鍢查悾鐑藉箳閹存梹鐎婚梺鍦劋閸ㄧ數鏁婊呯＝闁稿本鐟х拹浼存煕閿濆骸娅嶇�规洖婀遍幑鍕惞鐟欏嫭顔曟繝鐢靛█濞佳兾涢鐑嗙劷闁靛ň鏅滈悡銉╂煟閺傚灝顣抽柣顓熺懇閺屸剝鎷呴悷鏉款潚闂佽鍠楅悷鈺侇嚕閸洖绠ｉ柣妯兼暩瀹撲線姊婚崒娆戭槮缂傚秴锕畷鎴炵節閸パ咁槶濠电偞鍨崹娲疾椤掑嫭鐓熼柡鍌氱仢閹垶銇勯妷銉敾闁靛洤瀚伴獮鍥煛娴ｈ桨鐥┑鐘灱濞夋稓锟芥凹鍠氬Σ鎰板箳閺冩挻瀚归柨婵嗛娴滄粓鏌ｈ箛濠冩珖缂佽鲸甯￠、娆撴嚃閳轰讲鍙洪梻浣芥〃閻掞箓骞戦崶顒�鏋侀柟鍓х帛閺呮悂鏌ㄩ悤鍌涘? by changhao
				{
					//TeamManager.logger.info("roll闂傚倸鍊搁崐鎼佸磹閹间礁纾归柟闂寸绾惧湱锟界懓瀚伴崑濠傘�掓繝姘厵闁绘垶蓱閳锋劖銇勯锝嗙闁靛洤瀚板鎾敂閸涱収浼撳┑掳鍊楁慨鐑藉磻濞戞碍宕叉慨妤嬫嫹鐎殿噮鍋婇獮妯肩磼濡粯顏熼梻浣芥硶閸ｏ箓骞忛敓锟�?:闂傚倸鍊搁崐鎼佸磹閹间礁纾归柟闂寸绾剧懓顪冪�ｎ亝鎹ｉ柣顓炴閵嗘帒顫濋悙顒�顏舵俊銈囧Х閸嬫盯藝閻㈢鏋侀柟鍓х帛閸嬫劙鏌涢幇顖氱处闁汇垹顭峰缁樻媴閻熼偊鍤嬪┑鐐插级閻楃姴鐣烽幇鏉跨濞达絿顭堥悗顓㈡⒑缁嬭法鐏遍柛瀣仱閹繝濡烽埡鍌滃幗闂佸搫娲ㄩ崑娑㈡晸閽樺璐￠柨鐔诲Г閻旑剟骞忛敓锟�?婵犵數濮烽弫鍛婃叏閻戣棄鏋侀柟闂寸绾惧鏌ｅΟ娆惧殭缂佺姴鐏氶妵鍕疀閹炬惌妫ょ紓渚婃嫹濠电姴娲﹂悡銉╂煟閺冨浂鍤欑悮姘辩磽娴ｈ櫣甯涢柣鈺婂灠閻ｇ兘顢旈崼婵堫槰濡炪倕绻愰弻濠傤煥閸啿鎷虹紒缁㈠幖閹冲繘鎮甸鍡欑＜妞ゆ柨鍚嬮幑锝夋煕閹烘挸娴�殿噮鍓欓埢搴ㄦ倷椤掑倻鈻夐梻鍌欒兌缁垶鎮ч弴鐑嗙劷闁硅埖绔�:" + e + "闂傚倸鍊搁崐鎼佸磹閹间礁纾归柟闂寸绾惧綊鏌ｉ幋锝呅撻柛銈呭閺屾盯骞橀懠顒夋М闂佹悶鍔嶇换鍐Φ閸曨垰鍐�妞ゆ劦婢�缁墎绱撴笟濠冨婵犮垼娉涢鍡涘矗韫囨柧绻嗛柕鍫濇媼閸庢劙鎮楀顒傜Ш婵﹥妞介獮鎰償閿濆洨鏆梻浣侯焾椤戝洭宕戝☉銏╂晪闁靛鏅涚粈瀣亜閺嶃劍鐨戦柣銈忔嫹濠碉紕鍋戦崐鏍暜婵犲伅褰掑炊閳哄偆鍋ㄩ梺闈涚箞閸婃牠鍩涢幒鎳ㄥ綊鏁愰崼婢挾鐥鐐靛煟闁哄本鐩弫鎰疀閺囩姵娈兼俊銈囧Х閸嬫稓鎹㈠锟藉顐﹀箻缂佹ɑ娅㈤梺璺ㄥ櫐閹凤拷:" + msg.rollinfo.roll);
					mkdb.Procedure.psendWhileCommit(e, msg);			
				}
				
				for (Long e : eteammelon.getWatchmelonerlist()) //闂傚倸鍊搁崐鎼佸磹閹间礁纾归柟闂寸绾剧懓顪冪�ｎ亝鎹ｉ柣顓炴閵嗘帒顫濋悙顒�顏舵俊銈囧Х閸嬫盯藝閻㈢鏋侀柟鍓х帛閸嬫劙鏌涢幇顖氱处闁汇垹顭峰缁樻媴閻熼偊鍤嬪┑鐐插级閻楃姴鐣烽幇鏉跨濞达絿顭堥悗顓㈡⒑缁嬭法鐏遍柛瀣仱閹繝寮撮姀锛勫弳闂佸搫鍟ù鍌炲吹濞嗘劦娈介柣鎰嚟婢х敻鏌＄仦鍓ф创濠碘剝鎮傞弫鍌炲礈瑜忛弶浠嬫⒒娴ｅ憡鎯堥柣顒�銈稿畷鐗堟償閵娿儳鍘洪梺瑙勫礃椤曆囧垂閸屾稏浜滈柡鍐ㄥ�瑰▍鏇灻瑰鍐煟婵﹦绮幏鍛村川婵犲啫鏋戝┑鐘愁問閸犳顭囧▎鎺斾罕婵犵數濞�濞佳囶敄閸涘瓨瀚呴柣鏂挎憸缁犻箖鏌熺�电浠ч柣鎿冨灡缁绘稑鐣濇繝渚�鍋楅梺鍝勬湰閻╊垶鐛Ο浣曟棃鏁撴禒瀣疇闁圭増婢橀崒銊╂煙鐎电啸缁惧彞绮欓弻娑氫沪閸撗勫櫙闂佺绻愰懟顖炲煘閹达富鏁嶆繛鎴炵懃閸炲螖閻橀潧浠滅紒缁橈耿瀵偊骞樼紒妯绘闂佽法鍣﹂幏锟� ROLL闂傚倸鍊搁崐鎼佸磹閹间礁纾归柟闂寸绾惧綊鏌ｉ幋锝呅撻柛銈呭閺屾盯骞橀懠顒夋М闂佹悶鍔嶇换鍐Φ閸曨垰鍐�妞ゆ劦婢�缁墎绱撴笟濠冨婵犮垼鍩栭崝鏍偂濞戙垺鐓曢柕澶堝灪濞呭懘鏌涢幘鏉戔枙闁哄被鍊濆鍫曞箰鎼粹�叉樊闂備礁鎼張顒傜矙閹达絿浜欓梻浣告啞閸旀垿宕濈�ｎ�兾旈崨顔规嫼闂佸憡绻傜�氱兘宕曢幇顓濈箚妞ゆ劑鍨归弳锝囷拷娈垮枛椤兘骞冮姀銈嗗仏閻庢稒锚椤忓爼姊哄Ч鍥х仾妞ゆ梹鐗犻幃鐐哄箚椤�崇秺閹晛鈻庤箛鎿冧淮婵炲瓨绮嶇划鎾诲蓟瀹ュ浼犻柛鏇㈡涧閸撻亶鏌ｆ惔銏㈠暡闁瑰嚖鎷�? by changhao
				{
					if (e != null)
						mkdb.Procedure.psendWhileCommit(e, msg);			
				}
				
				if (num >= teammelon.getMelonroleids().size())
				{
					new PTeamRollMelonInfo(battlemelonid, 0).call();
				}
				
				return true;
			}
			
		};
		teamrollmelon.submit();
	}
	
	/*
	 * 
	 * 闂傚倸鍊搁崐鎼佸磹閹间礁纾归柟闂寸绾惧綊鏌ｉ幋锝呅撻柛銈呭閺屾盯骞橀崣澶樻▊闂佺粯甯掗敃顏堝蓟閺囩喓绠鹃柣鎰靛墯閻濇梻绱撴担鍝勵�岄柛銊ョ埣瀵濡搁埡鍌氫簽闂佺鏈粙鎴︻敂閿燂拷?缂傚倸鍊搁崐鎼佸磹閹间礁纾归柟闂寸绾惧綊鏌熼梻瀵割槮缁炬儳缍婇弻鐔兼⒒鐎靛壊妲紒鎯у⒔閹虫捇鈥旈崘顏庢嫹閿濆簼绨奸柟鐧哥秮閺岋綁顢橀悙鎼闂侀潧妫欑敮鎺楋綖濠靛鍊锋い鎺炴嫹妞ゅ繐鐖煎缁樻媴缁涘娈愰梺鍝ュ櫏閸嬪﹤鐣烽幆閭︽Щ闂佸吋婢橀悘婵嬪煘閹达附鍊烽柡澶嬪灩娴犵顪冮妶搴″箹婵炲樊鍙冮獮鍐╁閺夋嚦銊╂煃閸濆嫬锟界敻骞忓ú顏呪拺闁告稑锕﹂埥澶愭煥閺囶亞鎮兼繛鍡愬灲閺屽棗顓奸崱娆忓箞闂備線娼ч…鍫ュ磹濡ゅ懏鍎楁繛鍡樺姦濞堜粙鏌ｉ幇顖氱毢缂佺姴寮堕妵鍕晜閹屾毉闂佽鍨卞Λ鍐╂叏閿熶粙鏌ｅΟ铏癸紞闁跨喓鐡旈崣鍐潖缂佹ɑ濯撮柛娑橈工閺嗗牆鈹戦悙棰濆殝闂傚嫬瀚划瀣吋閸涱亝鐎婚梺瑙勬儗閸ㄨ京锟芥俺顫夌换娑㈠箣閻愯尙鐟插┑鐐叉噹閿曘儵骞堥妸锔剧瘈闁稿本绋掗崕鎾绘煛娴ｅ摜澧﹂柡灞剧洴婵＄兘骞嬪┑鍡樼亾闂佽楠搁顓犳閹捐纾兼繛鍡樺姉閵堟澘顪冮妶鍡樿偁闁搞儯鍔屾禍閬嶆⒑鐟欏嫬绀冪�规洟娼ч悾鍨瑹閿熶粙寮诲☉銏犵労闁告劦浜栧Σ鍫㈢磽娓氬﹥瀚归梺鍛婂姀閺傚倹绂嶅鍫熺厸闁告劑鍔嶉幖鎰瑰鍡╂綈闁靛洤瀚伴弫鍌炴嚍閵壯冨殥婵＄偑鍊ゆ禍婊堝疮鐎涙ü绻嗛柛顐ｆ礀楠炪垺淇婇婊冨妺婵炲牜鍋婂缁樻媴娓氼垳鍔稿銈嗗灥濡繈寮崘顔碱潊闁绘ê鐏氬▓楣冩⒑缂佹﹩鐒炬い鏇嗗洤绀冮柨鐔绘椤啴濡堕崱妯烘殫闂佸摜鍠庡锟犵嵁韫囨拋娲敂閸涱亝瀚肩紓鍌氬�烽悞锕傗�﹂崼鐔虹彾婵鎷烽柡宀嬬稻楠炲﹪鏌涢弬鍧楀弰闁轰焦鎹囬幊鐐哄Ψ瑜嶉弳锟犳⒑閻熸澘娈╅柟鍑ゆ嫹?濠电姷鏁告慨鐑藉极閸涘﹥鍙忛柣鎴ｆ閺嬩線鏌涘☉姗堝伐闁搞劍姊归妵鍕箻鐠哄搫澹夐梺缁樻煥濡濡撮幒鎴僵闁绘劦鍓欓鑸典繆閵堝洤啸闁稿绋撻幑銏狀潨閿熻棄顕ｉ锕�绠荤紓浣股戝▍銏ゆ⒑鐠恒劌娅愰柟鍑ゆ嫹? by changhao
	 */
	public long calcMaxRollPoint(java.util.ArrayList<Long> roleids, xbean.TeamMelon teammelon)
	{
		int max = 0;
		long maxroleid = 0;
		for (Long roleid : roleids)
		{
			Integer rollpoint = teammelon.getMelonroleids().get(roleid);
			if (rollpoint >= max)
			{
				max = rollpoint;
				maxroleid = roleid;
			}
		}
		
		return maxroleid;
	}

	// {{{ RPCGEN_DEFINE_BEGIN
	// {{{ DO NOT EDIT THIS
	public static final int PROTOCOL_TYPE = 794523;

	public int getType() {
		return 794523;
	}

	public long melonid; // 分赃id by changhao
	public int status; // 1是ROLL 0是放弃 by changhao

	public CTeamRollMelon() {
	}

	public CTeamRollMelon(long _melonid_, int _status_) {
		this.melonid = _melonid_;
		this.status = _status_;
	}

	public final boolean _validator_() {
		return true;
	}

	public OctetsStream marshal(OctetsStream _os_) {
		if (!_validator_()) {
			throw new VerifyError("validator failed");
		}
		_os_.marshal(melonid);
		_os_.marshal(status);
		return _os_;
	}

	public OctetsStream unmarshal(OctetsStream _os_) throws MarshalException {
		melonid = _os_.unmarshal_long();
		status = _os_.unmarshal_int();
		if (!_validator_()) {
			throw new VerifyError("validator failed");
		}
		return _os_;
	}

	public boolean equals(Object _o1_) {
		if (_o1_ == this) return true;
		if (_o1_ instanceof CTeamRollMelon) {
			CTeamRollMelon _o_ = (CTeamRollMelon)_o1_;
			if (melonid != _o_.melonid) return false;
			if (status != _o_.status) return false;
			return true;
		}
		return false;
	}

	public int hashCode() {
		int _h_ = 0;
		_h_ += (int)melonid;
		_h_ += status;
		return _h_;
	}

	public String toString() {
		StringBuilder _sb_ = new StringBuilder();
		_sb_.append("(");
		_sb_.append(melonid).append(",");
		_sb_.append(status).append(",");
		_sb_.append(")");
		return _sb_.toString();
	}

	public int compareTo(CTeamRollMelon _o_) {
		if (_o_ == this) return 0;
		int _c_ = 0;
		_c_ = Long.signum(melonid - _o_.melonid);
		if (0 != _c_) return _c_;
		_c_ = status - _o_.status;
		if (0 != _c_) return _c_;
		return _c_;
	}

	// DO NOT EDIT THIS }}}
	// RPCGEN_DEFINE_END }}}

}

