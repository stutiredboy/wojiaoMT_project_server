
package fire.pb.team;

// {{{ RPCGEN_IMPORT_BEGIN
// {{{ DO NOT EDIT THIS
import com.locojoy.base.Marshal.OctetsStream;
import com.locojoy.base.Marshal.MarshalException;

abstract class __CRequestClanFightRoleList__ extends mkio.Protocol { }

// DO NOT EDIT THIS }}}
// RPCGEN_IMPORT_END }}}

/***
 * 闂傚倸鍊搁崐鎼佸磹閹间礁纾归柟闂寸绾惧綊鏌熼梻瀵割槮缁炬儳婀遍敓鐣屾嚀鐎氼參宕崇壕瀣ㄤ汗闁圭儤鍨归崐鐐烘偡濠婂啰绠荤�殿喗濞婇弫鍐磼濞戞艾骞堟俊鐐�ら崢浠嬪垂閸偆顩叉繝闈涱儐閻撴洘绻涢崱妤冪缂佺姴顭烽弻锛勪沪缁嬪灝鈷夐悗鍨緲鐎氼噣鏁撻弬銈囩У濞存粍绻堥、娆撳川椤撴稒鏂�闂佺粯鍔曞鍫曞煝閺囩伝鐟邦煥閸愵亜鐓熼悗娈垮櫘閸嬪﹤鐣烽崼鏇ㄦ晢濞达絽鎼敮楣冩⒒婵犲骸浜滄繛璇х畱鐓ら柡宓嫭鐦庨梻鍌氬�风粈渚�骞夐敍鍕床闁告劦鍠撻敓钘夊暞缁绘繈宕掗妶鍡欑▉缂傚倸鍊烽悞锕傗�﹂崶顒佸仭鐟滅増甯楅悡鏇㈡煏婢跺鐏ラ柛鐘宠壘椤洭鎳￠妶鍥╋紳闂佺鏈悷褔藝閿斿浜滈柨鏇炲�烽幉鍓э拷娈垮櫘閸嬪棝骞忛悩缁樺殤妞ゆ帊鐒﹂鏇㈡⒒娴ｅ憡鎯堟繛灞傚灲瀹曞綊宕烽鐘辩瑝闂佹寧绻傚Λ娑氬姬閿熶粙姊洪棃娑㈢崪缂佽鲸娲滅划濠氬箻閸撲胶锛濋悗骞垮劚閹锋垵顔忛妷鈺傜厽闁挎繂鎳庡Σ濠氭懚閺嶎厽鐓曟繛鎴濆船楠炴ɑ銇勮熁閸ャ劉鎷洪梺绋跨箺閸嬫劙濡堕幘顔界厸闁告侗鍠氱粻鐐烘煕閳瑰灝鐏辩紒鐘崇洴瀵挳鎮╃喊澶岄棷闂傚倷鑳堕…鍫ュ嫉椤掑嫭鍋＄憸蹇曞垝娴ｅ啰鐤�婵炴垶鐟ч崢鍨繆閻愬樊鍎忓Δ鐘虫倐瀹曘垽骞橀鐣屽幐闁诲繒鍋涙晶浠嬪Υ閹烘嚚褰掓偑閸涱垳鏆ら悗瑙勬礃缁繘藝椤旀垝绻嗘い鎰Т婵＄晫绱掔紒妯笺�掗柨鐔诲Г缁嬫帡鈥﹂崶顒佸剹閻庯綆鍓涚壕鍏笺亜閺冨洤袚鐎规洖鐬奸敓鑺ヮ問閸犳牠鈥﹂悜钘夌畺闁靛繈鍊曞婵嗏攽閻樻彃顏懖鏍⒒閸屾瑧顦﹂柟璇х節楠炴劙宕卞☉妯啃曢梻浣哥仢椤戝懘鎮橀埡鍐＜閺夊牄鍔岀粭褏绱掓潏銊ユ诞濠殿噯鎷烽梺缁橆焾鐏忔瑩顢欓幇顑芥斀闁绘﹩鍋呮刊浼存煕閹般劍娅嗙�规洖鍟块埞鎴﹀灳閸愯尙楠囬梺鍛婃⒐閻熲晠鎮伴锟介獮鎺楀箠閾忣偅顥堥柡浣规崌閹儳鐣濋敓鑺ョ▔瀹ュ棛绠鹃柟瀵稿仧閹筹拷婵炲瓨绮嶇划鎾诲蓟閻斿吋鍊锋い鎺戭槹閻ｅ爼鏌ｆ惔銏犲毈闁革綇绲介锝夊箚閼割兛姹楅梺鍦劋閹告挳骞忕紒妯肩閺夊牆澧介崚浼存煙鐠囇呯瘈妤犵偛妫濆畷濂稿Ψ閿旀儳骞楁俊鐐�栫敮顏堝箯閻戣姤鐓忛柛顐犲焺閻掗箖鏌ｉ敐澶嬫暠閻庨潧銈稿鍫曞箣閻欙拷閸熷绱撻崒姘拷鐑芥倿閿曚焦鎳屾繝鐢靛仜閹冲矂宕归挊澶樻綎婵炲樊浜滅粈鍌炴⒒閸屾粠妫庨柛鈺佹嚇濮婅櫣绮欓崹顕呭妷婵犵數鍋涢敃顏勭暦濞差亝鏅滈柣锝呯灱閹虫繈姊虹捄銊ユ瀺缂侇喗鐟ラ锝嗙節濮橆儵鈺呮煃鏉炴壆顦︾�规挸妫濆娲濞戣京鍔搁梺绋跨凹閸楀啿鐣烽悧鍫㈢瘈闁搞儯鍔夐幏铏圭磼缂併垹骞栭柟鍐茬箻閹敻顢旈崼鐔哄幍闂佽崵鍠撴晶妤呭箹閹扮増鐓熼柨婵嗩樈濡垹绱掗鐣屾噮闁归濞�閹瑩顢楁担鍙夊闂備胶鎳撻崲鏌ュ箠濡櫣鏆︽い鎰剁畱缁�瀣亜閹扳晛锟芥寮舵禒瀣拻闁稿本鑹鹃敓鑺ユ倐瀹曟劙鎮滈懞銉ワ拷鍧楁煥閺冿拷閹锋繈骞忔搴ｇ當婵炴垶蓱閸ｈ櫣锟借娲橀悡锟犲蓟濞戞鏆嗛柨鐔剁矙瀹曟劕鈽夐姀鐘靛�炲銈嗗笂缁�渚�鎯傞崟顒傜瘈闁靛繒濮寸敮銊╂煛閸涱喚鐭掗柟顖氬椤㈡盯鎮欓棃娑氥偊闂佽鍑界紞鍡涘窗濡ゅ懎鐤炬繝濠傜墛閻撶喖鏌ㄥ┑鍡樺殌閻庢氨澧楅〃銉╂倷閼碱儷褎鎱ㄦ繝鍕笡闁瑰嘲鎳樺畷銊︾節閸屾稒鐣奸梻鍌欐祰瀹曠敻宕伴崱娑樼？濞达絽鍟ˉ銈夋⒒娴ｇ瓔娼愭い鏃�鐗犲畷浼村即閵忊�筹拷鍨攽閻樺弶澶勯柣鎾卞劦閺岋繝宕橀妸銉嫹婵犳艾绠洪柛灞剧〒缁犻箖鏌涢锝囩煂闁活厽鐟╅弻鈥崇暆鐎ｎ剛袦濡ょ姷鍋涘ú顓€�佸锟介幃銏ゆ惞閸忓鐎兼繝鐢靛Х閺佹悂宕戦悙鍝勭畾鐎癸拷閸曨偆鐛ュ┑顔筋焾閸╂牠寮查幖浣圭厾闁诡厽甯掗崝鎾煕閻旈绠婚柡灞剧洴閹晠骞囨担鍦澒婵°倗濮烽崑鐐哄礉濞嗘挾宓侀幖娣妽鐎电姴顭跨捄铏圭伇闁哄棭鍋呯换婵嬫偨闂堟刀銏ゆ煥閺囨ê锟芥繈骞冭瀹曞崬鈽夊顒傘偊闂備線娼х换鍡涘礈濠靛鐭楅煫鍥ㄦ煣缁诲棝鏌曢崼婵堢閻庢氨鎳撻埞鎴﹀煡閸℃ぞ绨奸梺鑽ゅ暱閺呯偛螞閵忋倖鈷戦柛婵嗗閿熻棄鎽滈懞閬嶆焼瀹ュ懐鍝楁繛瀵稿Т椤戝棝鎮￠悢闀愮箚妞ゆ牗绻冮鐘裁归悩宕囨创闁哄矉绻濆畷杈疀閺冿拷閻濇岸姊洪崫鍕拱缂佸甯￠獮鍡涘籍閸繍娼婇梺缁樏崥锟介柟顕嗙秮閺岋絾鎯旈敍鍕驳濠电姰鍨洪敃銏ゅ极閸愵噮鏁傞柛顐ｇ箘椤斿洦绻濋悽闈浶㈤柛鐔跺嵆閹敻鎳滈悽鐢电槇闂傚倸鐗婄粙鎺撳緞閸曨垱鐓忛柛銉ｅ妿缁犵偤鏌″畝锟介崰鏍�佸▎鎴炲枂闁告洦鍓涜ぐ鍥⒒娴ｅ摜绉烘い銉︽尰缁绘盯鏁撴禒瀣厵鐎规洖娲ら埢鍫熴亜閵忊槅娈曠�垫澘瀚敓鏂ょ稻閹稿爼宕愰弴銏犵厴闁硅揪闄勯崑鎰版煕椤垵浜濇慨锝呭缁绘繈鎮介棃娑樺闂佺懓鍢查崲鏌ュ煘閹达附鍊烽柡澶婄仢閻ㄧ喖姊虹粙璺ㄧ濠殿噣娼ч—鍐嚍閵夈倗绠氶梺鍏兼倐濞佳呮閻愮繝绻嗘い鏍ㄧ矌鐢稒绻涢崨顔筋棃婵﹤顭峰畷鎺戔枎閹达絿鐛ラ梻浣告啞閹稿鎮疯閸掓帡寮崼鐔蜂缓闂佸憡绋戦敃銈嗙濡ゅ懏鈷戦梻鍫熶緱濡叉挳鏌￠崨顔剧煉闁诡噯绻濋幃銏ゅ礂閼测晛骞愰梻浣规偠閸庮噣寮插☉娆戭浄婵犲﹤鐗婇悡銉╂煟閺冨倻甯涙い銉ヮ槹缁绘繈鏁撴禒瀣劶鐎广儱妫欏▍銏ゆ⒑閸忛棿鑸柛搴㈠▕瀹曨垶寮婚妷锔惧幍闂佸憡鍨崐鏍拷姘炬嫹 by changhao
 *
 */
public class CRequestClanFightRoleList extends __CRequestClanFightRoleList__ {
	@Override
	protected void process() {
		// protocol handle
		final long roleid = gnet.link.Onlines.getInstance().findRoleid(this);
		if (roleid < 0)
		{
			return;
		}
		
		mkdb.Procedure r = new mkdb.Procedure()
		{
			@Override
			protected boolean process()
			{
				if (num > 20)
				{
					return false;
				}
				
				int side = 0;
				Long c1 = xtable.Roleid2clanfightid.select(roleid); //婵犵數濮烽弫鍛婃叏閻戣棄鏋侀柛娑橈攻閸欏繘鏌ｉ幋锝嗩棄闁哄绶氶弻娑樷槈濮楀牊鏁鹃梺鍛婄懃缁绘﹢寮婚敐澶婄婵犲灚鍔栫紞妤呮⒑鐠恒劌鏋欐俊顐㈠瀹曟劙宕稿Δ锟界粻鏉库攽閻樻彃鏆熼柣婵嗙埣閺屽秹宕崟闈涘壋缂備礁顦介崰姘舵晸閸婄噥娼愭繛鍙夌矒瀹曚即寮介婊愭嫹娴ｇ硶妲堟慨妤�妫欓崓鍨繆閹绘帗婀伴柣妤佹礋瀵偊骞栨担鍏夋嫽闂佺鏈悷锔剧矈閻楀牏绠惧璺侯儐缁�瀣拷瑙勬礃婵炲﹪寮崘顔肩＜婵﹢纭搁崬鐢告⒒娴ｈ姤纭堕柛锝忕畵楠炲繘鏁撻敓锟�?婵犵數濮烽弫鍛婃叏閻戣棄鏋侀柛娑橈攻閸欏繘鏌ｉ幋锝嗩棄闁哄绶氶弻娑樷槈濮楀牊鏁鹃梺鍛婄懃缁绘﹢寮婚敐澶婄闁挎繂妫Λ鍕⒑閸濆嫷鍎庣紒鑸靛哺瀵鎮㈤崗灏栨嫽闁诲酣娼ф竟濠偽ｉ鍓х＜闁绘劦鍓欓崝銈嗐亜椤撶姴鍘寸�殿喖顭烽弫鎰緞婵犲嫮鏉告俊鐐�栫敮濠勬媼閺屻儱鍑犳繛鍡樻尰閳锋垹绱撴担濮戭亞绮埡浣叉斀妞ゆ柨鎼敓鑺ヮ殜楠炴垿濮�閻橆偅顫嶉梺闈涚箳婵挳鎳撻崹顔规斀闁宠棄妫楅悘锝囩磼椤曞懎鐏︾�规洘娲橀幆鏃堝Ω閿旇瀚奸梺鍝勵槺閸嬬偞绔熼崱娴板洭鏁冮崒娑橈拷鍨叏濮楀棗浜滅�规挸妫涢敓鑺ヮ問閸犳盯顢氳閸┿儲寰勯幇顒夋綂闂佺粯锕㈠褎鎱ㄩ崼鏇熲拻濞达絽鎲￠崯鐐烘煕閺傜偛鎳愮壕鑺ユ叏濡法绨垮┑顔藉▕閺岋綁濮�閻樺啿鏆堥梺鎶芥敱閸ㄥ潡寮婚悢铏圭煓闁圭瀛╁畷宕囩磽娴ｅ搫校闁圭顭锋俊鐢稿礋椤栨稒娅嗛柣鐘叉穿鐏忔瑦绂掗婊呯＝濞撴艾娲ら弸娑欍亜椤撶姴鍘存鐐插暣閹粓鎸婃径宀�鏋冨┑鐘垫暩婵挳宕愰懡銈囩煋婵炲樊浜濋悡娑樏归敐鍥ㄥ殌濠殿喖绉堕敓鍊燁潐濞叉牕鐣烽鍕厺閹兼番鍔岀粻娑欍亜閹捐泛浠︽繛鍛灲濮婄粯鎷呴挊澶婃優闂佺顑囬崑鐔煎窗婵犲偆鍚嬮柛銉ｅ妼鎼村﹪姊洪崜鎻掍簼缂佽绉撮…鍥冀椤愩倗锛濇繛杈剧秬閸嬪倿骞嬮悙鎻掔亖闂佸湱铏庨崰妤呮偂閻斿吋鐓熼柡鍐ㄥ�哥敮璺好瑰锟介崡鎶藉蓟濞戙垹围闁告粈绀侀崜浼存⒑鐎圭媭娼愰柛銊ユ健楠炲啫鈻庨幋顖涘闁割煈鍋呴崑鐘绘煕鐎ｎ剙浠辨慨濠冩そ瀹曨偊宕熼锟藉▍褎绻濋悽闈涘壋闁归鍏樺铏圭磼濡湱绻侀梺鍝ュУ缁嬫挾鍒掔拠娴嬫婵☆垶鏀遍～宥呪攽閻愬弶顥為柛銊╂涧椤曪綁骞庨懞銉㈡嫼闁荤姴娲﹁ぐ鍐吹鏉堚晝纾界�广儱鎳忛ˉ銏拷瑙勬礃缁矂鍩ユ径鎰潊闁炽儱鍟挎晶楣冩⒒娴ｇ顥忛柛瀣╃窔瀹曟洟寮婚妷銉у幈闂佺鎻梽鍕磻閿濆鐓欐い鎾跺枎缁楁帒鈹戦垾鐐藉仮闁哄矉绱曢敓鏂ょ秵娴滅偠鍊寸紓鍌欐祰妞村摜鏁敓鐘拷浣糕枎閹炬潙浠奸柣蹇曞仦閸庡啿鈻嶅鑸碘拻濞撴熬鎷锋繛浣冲吘娑㈠籍閸屾侗鍋ㄥ┑顔斤供閸擄箓宕甸弴鐔翠簻闁哄浂浜濈�氬綊鎮楃憴鍕闁告鍥х厴闁瑰濯撮幏鐑芥晲鎼存繄鍑归梺鍝勬－娴滄粓鍩為幋锔藉亹闁割煈鍋呭В鍕節閻㈤潧鍓抽柟宄板槻閳规垿鎮欓弶鍨殶闂佹悶鍎崝灞剧閸楃偐鏀介柣妯款嚋瀹搞儵鏌ｅΔ锟藉Λ娑㈠箟閹绢喗鏅濋柛灞剧〒閸樺崬鈹戦悙鏉戠仴鐎规洦鍓熷鎼佸Χ閸モ晝锛滈梺瀹犳閹冲繒锟芥艾婀辩槐鎾诲磼濞嗘埈妲繝鈷�鍡椥撻柡鍛版硾铻栭柛鏇ㄥ墯閸ｅ嘲鈹戦敍鍕杭闁稿鍊濆畷鎴﹀礋椤栨稒娅囧銈呯箰閻楀棝鎷戦悢鍝ョ闁瑰瓨鐟ラ悘鈺呭箚閻斿吋鈷戦柟绋垮缁屽潡鏌熸搴″幋闁哄苯绉剁槐鎺懳熼懡銈庢Ф闂備浇娉曢崰搴ㄦ晸閻ｅ苯娅忔繛鍏煎姈缁绘盯宕ｆ竟婵愪簽閸欏懘姊虹紒妯活棃闁哄懓灏欓幑銏ゅ幢濞戞瑧鍘卞銈嗗姧缁插墽绮堥敓浠嬫⒑缂佹ê濮囬柨鏇樺劦婵＄敻宕熼鍓ф澑闂佽鍎崇壕顓°亹閸涘瓨鈷戦柣鎰閸旀粓鏌＄�ｎ亗鍋㈢�殿喓鍔戦幊鐐哄Ψ閿濆嫮鐩庨梻浣告惈閸犳盯骞忛悜鑺ョ厸閻庯綆鍓涚敮娑氱磼濡ゅ啫鏋庨柍钘夘樀婵拷闁挎稑瀚獮鍫ユ⒒婵犲骸浜滄繛璇х畵瀵悂宕掗悜鍡樻櫆闂佸憡娲﹂崑鍡涘Χ椤愶附鈷掗柛灞剧懅椤︼箑顭块悷甯含鐎规洘鍨剁粭鐔兼晸閽樺鏆﹂柡鍥ュ灩閽冪喖鏌曟径娑氱暠濞存粍顨婂娲濞戣鲸孝闂佸搫鎳忕划鎾诲箖閿熺姵鍋勯柛蹇氬亹閸樻悂姊洪幖鐐插姉闁哄懏绋掔粋鎺戭煥閸喓鍙嗛梺缁樻⒒缁垶藟婢跺绡�闁跨喍绮欓弻鍡楊吋閸℃ɑ顏熼梻浣稿悑娴滀粙宕曢幎钘夌柈闁哄被鍎查悡娆撴煕閹存瑥锟芥牜锟芥熬鎷�? by changhao
				if (c1 == null)
				{
					return false;
				}
			
				fire.pb.clan.fight.ClanFightBattleField bf = fire.pb.clan.fight.ClanFightFactory.getClanFightBattleField(c1, true);
				if (bf != null)
				{
					Long clanid = xtable.Roleidclan.select(roleid);
					if (clanid == null)
					{
						return false;
					}
					
					if (clanid == bf.getClanfightBean().getClanid1())
					{
						side = 0;
					}
					else if (clanid == bf.getClanfightBean().getClanid2())
					{
						side = 1;
					}
					else
					{
						return false;
					}
					
					SRequestClanFightRoleList msg = new SRequestClanFightRoleList();
					java.util.Map<Long, Integer> v = bf.getClanroleidsByWhich(side);
					
					java.util.List<Long> sortdata = new java.util.ArrayList<Long>();
					if (v != null)
					{
						sortdata.addAll(v.keySet());
					}
					
					sortdata.sort(new java.util.Comparator<Long>(){
						@Override
						public int compare(Long o1, Long o2)
						{
							if (o1 > o2)
							{
								return 1;
							}
							else
							{
								return -1;
							}
						}
					});
					
					if (v != null)
					{
						int curnum = 0;
						for (Long e : sortdata)
						{
							if (start != 0 && e <= start)
							{
								continue;
							}
							
							Long teamid = xtable.Roleid2teamid.select(e);
							if (teamid == null)
							{
								xbean.Properties prop = xtable.Properties.select(e);
								if (prop != null)
								{
									fire.pb.team.RoleSimapleInfo info = new fire.pb.team.RoleSimapleInfo();
									info.roleid = e;
									info.rolename = prop.getRolename();
									info.level = prop.getLevel();
									info.schoold = prop.getSchool();
									info.shape = prop.getShape();
									msg.rolelist.add(info);
									
									curnum ++;
									if (curnum >= num)
									{
										break;
									}	
								}								
							}
						}						
					}
					
					msg.isfresh = isfresh;
					if (msg.rolelist.size() == 0)
					{
						msg.ret = -1;
					}
					
					mkdb.Procedure.psendWhileCommit(roleid, msg);
				}
				
				return true;
			}
		};
		
		r.submit();	
	}

	// {{{ RPCGEN_DEFINE_BEGIN
	// {{{ DO NOT EDIT THIS
	public static final int PROTOCOL_TYPE = 794559;

	public int getType() {
		return 794559;
	}

	public int isfresh; // 客户端用 0刷新 1不刷新  by qyl
	public long start; // 起始roleid by changhao
	public int num; // 请求的数量 by changhao

	public CRequestClanFightRoleList() {
	}

	public CRequestClanFightRoleList(int _isfresh_, long _start_, int _num_) {
		this.isfresh = _isfresh_;
		this.start = _start_;
		this.num = _num_;
	}

	public final boolean _validator_() {
		return true;
	}

	public OctetsStream marshal(OctetsStream _os_) {
		if (!_validator_()) {
			throw new VerifyError("validator failed");
		}
		_os_.marshal(isfresh);
		_os_.marshal(start);
		_os_.marshal(num);
		return _os_;
	}

	public OctetsStream unmarshal(OctetsStream _os_) throws MarshalException {
		isfresh = _os_.unmarshal_int();
		start = _os_.unmarshal_long();
		num = _os_.unmarshal_int();
		if (!_validator_()) {
			throw new VerifyError("validator failed");
		}
		return _os_;
	}

	public boolean equals(Object _o1_) {
		if (_o1_ == this) return true;
		if (_o1_ instanceof CRequestClanFightRoleList) {
			CRequestClanFightRoleList _o_ = (CRequestClanFightRoleList)_o1_;
			if (isfresh != _o_.isfresh) return false;
			if (start != _o_.start) return false;
			if (num != _o_.num) return false;
			return true;
		}
		return false;
	}

	public int hashCode() {
		int _h_ = 0;
		_h_ += isfresh;
		_h_ += (int)start;
		_h_ += num;
		return _h_;
	}

	public String toString() {
		StringBuilder _sb_ = new StringBuilder();
		_sb_.append("(");
		_sb_.append(isfresh).append(",");
		_sb_.append(start).append(",");
		_sb_.append(num).append(",");
		_sb_.append(")");
		return _sb_.toString();
	}

	public int compareTo(CRequestClanFightRoleList _o_) {
		if (_o_ == this) return 0;
		int _c_ = 0;
		_c_ = isfresh - _o_.isfresh;
		if (0 != _c_) return _c_;
		_c_ = Long.signum(start - _o_.start);
		if (0 != _c_) return _c_;
		_c_ = num - _o_.num;
		if (0 != _c_) return _c_;
		return _c_;
	}

	// DO NOT EDIT THIS }}}
	// RPCGEN_DEFINE_END }}}

}

