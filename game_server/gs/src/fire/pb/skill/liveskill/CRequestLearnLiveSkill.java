
package fire.pb.skill.liveskill;

import java.util.HashMap;

import fire.log.beans.RoleSkillUpBean;






import fire.pb.attr.SRefreshRoleData;
import fire.pb.buff.BuffConstant;
import fire.pb.clan.srv.ClanManage;
import fire.pb.item.Pack;
import fire.pb.main.ConfigManager;
import fire.pb.skill.Result;
import fire.pb.skill.SSkillError;
import fire.pb.skill.SkillConstant;
import fire.pb.talk.MessageMgr;


// {{{ RPCGEN_IMPORT_BEGIN
// {{{ DO NOT EDIT THIS
import com.locojoy.base.Marshal.OctetsStream;
import com.locojoy.base.Marshal.MarshalException;

abstract class __CRequestLearnLiveSkill__ extends mkio.Protocol { }

// DO NOT EDIT THIS }}}
// RPCGEN_IMPORT_END }}}

/***
 * 闂傚倸鍊搁崐鎼佸磹閹间礁纾归柟闂寸绾惧湱锟界懓瀚崳纾嬨亹閹烘垹鍊為悷婊冪箻瀵娊鏁冮崒娑氬幈濡炪値鍘介崹鍨濠靛鐓曟繛鍡楃箳缁犲鏌＄仦绋垮⒉鐎垫澘瀚敓鏂ょ秵娴滄繈顢欓崨顓涙斀闁绘劕寮堕埢鏇灻瑰鍐煟鐎殿噮鍋婂畷鍫曨敆娴ｅ搫甯鹃梻濠庡亜濞诧箑煤閺嵮勬瘎闂傚倷绀侀幉锛勬崲閸愵喓锟藉啯绻濋崒銈嗙稁缂傚倷鐒﹂…鍥偡瑜版帗鐓曢柕澶嬪灥閸犳艾顭囬懡銈囩＝闁稿本鐟чˇ锔姐亜閿曞倷鎲剧�殿噮鍋嗛幏鐘绘嚑椤掍焦顔曢梻浣告惈濞层垽宕归崷顓犱笉闁挎繂顦伴悡銉╂煛閸愩劌锟界懓鈻嶉弴銏＄厱婵鎷锋繛浣冲洤鐓橀柟杈鹃檮閸婄兘鏌ょ喊鍗炲妞わ絾妞藉铏规嫚閼碱剛顔夌紓浣筋嚙閸婂潡宕洪姀鐙�鍚嬮柛娑变簼閻庡姊虹憴鍕姢妞ゆ洦鍙冨畷銏ゆ偨閸涘﹤锟界敻鏌ｉ悢鍛婄凡妞ゅ浚浜濈换婵嬪閳浜滃畵鍕節閻㈤潧校缁炬澘绉归幃锟犲礃椤旂晫鍙冨┑鈽嗗灟鐠�锕�螣閸喍绻嗛柛娆忣槹閸婃劙鏌″畝瀣М闁轰焦鍔欏畷鎯邦槻妤犵偛顑夐幃妤冩喆閸曨剛顦ラ梺缁樼墪閵堢鐣峰ú顏呮櫢闁绘灏欓ˇ銊ヮ渻閵堝懐绠伴悗姘煎櫍瀹曟劙鎮欓悽鐢碉紳闂佺鏈懝楣冩晸閼恒儲鍊愮�规洘鍔欓獮鏍ㄦ媴閸濄儻绱┑锛勫仜椤戝懐锟芥稈鏅滈崚濠冪附閸涘﹦鍘搁柣蹇曞仩椤曆囧礉濠婂牊鐓涢柛娑卞枟閸婃劙鏌″畝瀣暠閾伙絽銆掑鐓庣仭缁楁垿姊绘担鍛婃儓婵☆偅绮嶉妵鏃堝箹娴ｈ倽锕傛煕閺囥劌鏋ら柣銈忔嫹闂備焦瀵х换鍌炲箠鎼达絿灏电�广儱顦伴埛鎴︽煕濠靛棗顏柣蹇涗憾閺屾盯鎮╁畷鍥р拰闂侀潧妫旂粈渚�鍩㈡惔銊ョ闁哄鍨堕濂告⒒娓氾拷濞佳囨偋閸℃娲Ω閳轰礁鍋嶅銈嗙墱閸嬬偤鍩涢幒鎳ㄥ綊鏁愰崶鈺傛啒闂佹悶鍊曢崯鎾蓟濞戙垺鍋愰柧蹇ｅ亜绾炬娊鎮楃憴鍕缂傚秴锕獮鎰節閸愩劎绐為柣蹇曞仧閸嬫捇顢欓弴銏♀拻濞撴熬鎷锋繛浣冲洠锟斤箓顢橀悢鍓佺畾闂佹悶鍎弲婵囩▔瀹ュ鐓欐い鏍ф閻ジ宕悽鍛婄厽闁绘鍎ら鐘绘煕鎼存稑锟芥繂鐣烽鐐村�烽柣鎴烆焽閸橀亶姊洪崘鍙夋儓闁稿﹨顕х叅閻庢稒蓱閸欏繐鈹戦悩鎻掍簽闁绘捁鍋愰敓鍊燁潐濞叉鏁幒妤�鐓濋幖娣妼缁犳娊鏌熺�涙绠撻柤鍨姇閳规垿鎮╅崹顐ｆ瘎闂佺顑嗛惄顖炵嵁婵犲倻鏆嗛柛鏇ㄥ亜閻庮厽绻涚�电孝妞ゆ垵娲ら悾鍨瑹閿熶粙鎮￠锕�鐐婇柕濞э拷濡俱劑姊洪崫鍕櫤闁诡喖鍊垮濠氬Ω閳哄倸浜為梺绋挎湰缁嬫垿顢旈敓锟�?闂傚倸鍊搁崐鎼佸磹閹间礁纾归柟闂寸绾惧綊鏌熼梻瀵割槮缁炬儳缍婇弻锝夊箣閿濆憛鎾绘煕閵堝懎顏柡灞剧洴椤㈡洟鏁愰崱娆樻К闁哄鏅滅换鍫ュ蓟閿濆棙鍎熸い鏍ㄧ矌鏍￠梻浣告憸婵敻鎮у鍛灊濠电姵鍑归弫宥夋煟閹邦剦鍤熼柛娆忔濮婅櫣绱掑Ο鑽ゎ槬闂佺锕ゅ﹢閬嶆晸閼恒儳鍟查柟鍑ゆ嫹?
 * @author changhao
 *
 */
public class CRequestLearnLiveSkill extends __CRequestLearnLiveSkill__ {
	@Override
	/* 闂傚倸鍊搁崐鎼佸磹閹间礁纾归柟闂寸绾惧綊鏌熼梻瀵割槮缁惧墽鎳撻—鍐拷锝庝簼閹癸綁鏌ｉ鐐搭棞闁靛棙甯掗～婵嬫倷椤掞拷椤忚埖淇婇妶鍥ラ柛瀣洴钘濋柣銏㈩焾閸ㄥ倸螖閿濆懎鏆欑紒鐘崇☉闇夐柨婵嗘噺鐠愶紕绱掔�ｂ晞鍏岀紒杈ㄦ崌瀹曟帒顫濋濠冨闁绘垼濮ら崐鍧楁煥閺囩偛锟界敻鏁撻弬銈囩暤鐎规洖鐖奸崺锟犲礃瑜忛悷婵嗏攽鎺抽崐褏寰婃禒瀣柈妞ゆ牜鍋為崑鍌炴煏婢跺棙娅嗛柣鎾跺枛閺岋繝宕掑鍙樿檸濡炪倧绲炬繛濠囧蓟閿濆鏁囬柣鏃傚劋閸ｄ即姊洪崫鍕槵闁跨喕妫勭壕顓㈠汲閸℃稒鍊甸柨婵嗛婢т即鏌ｉ敃锟介悧鎾愁潖閻戞ɑ濮滈柟娈垮枛婵′粙姊虹憴鍕憙鐎规洜鏁搁崚鎺旓拷锝庡枛缁犳娊鏌￠崘鈺傚鞍閻庢艾缍婇弻銊モ攽閸℃侗锟芥霉濠婂嫮绠栫紒缁樼洴瀹曘劑顢欓崜褏鍘滄繝娈垮枛閿曘劌鈻嶉敐澶婄闁哄稁鍘奸崡鎶芥煟閹邦厾銈撮柟鏋�濆缁樻媴閸涘﹤鏆堝┑顔硷工濠�閬嶅极椤曪拷閹瑩鎮滃Ο鐑樼枀闂佸搫顦悧鍕礉鎼达絽濮柨鐔绘閳规垿顢欓弬銈勭返闂佸憡蓱閹倿鐛箛鎾佹椽顢旈崨顏呭闂備礁鎲＄粙鎴︽晝閿曞倸鐓″鑸靛姈閻撱儵鏌￠崶鏈电盎妞も晩鍓涚槐鎺楊敊绾拌京鍚嬪Δ鐘靛仦椤洨妲愰幒鎳崇喖鎮�涙ê顏堕梺鍓茬厛閸嬪懘宕ｈ箛鏂剧箚妞ゆ牗绮岀敮鍫曟偨椤栨氨鍩ｉ柡宀嬬磿閿熸枻绲婚崝宀勬晸閼恒儳绠炵�殿喛顕ч埥澶愬閳ュ厖姹楅梺鑽ゅТ濞壯囧幢濡や礁鍓甸梻鍌氬�峰ù鍥ь浖閵娾晜鍊块柨鏇炲�哥粻鏌ユ煕閵夘喖澧柡瀣╃窔閺岀喖宕滆鐢盯鏌￠崨顔藉�愰柡灞诲姂閹倝宕掑☉姗嗕紦 roleid by changhao*/
	protected void process() {
		// protocol handlen 
		final long roleid = gnet.link.Onlines.getInstance().findRoleid(this);
		if (roleid < 0)
			return;
		mkdb.Procedure requestlearnliveskill = new mkdb.Procedure()
		{
			@Override
			protected boolean process()
			{
				if (fire.pb.buff.Module.existState(roleid, BuffConstant.StateType.STATE_BATTLE_FIGHTER))
				{
					fire.pb.talk.MessageMgr.psendMsgNotifyWhileCommit(roleid, 142383, null);
					return true;
				}
				
				fire.pb.skill.SLifeSkill config = ConfigManager.getInstance().getConf(fire.pb.skill.SLifeSkill.class).get(id);
				
				if (config == null)
				{
					LiveSkillManager.logger.error("CRequestLearnLiveSkill config error:" + id);
					psend(roleid, new SSkillError(SkillConstant.SkillError.LiveSkillIdError));
					return true;						
				}
			
				fire.pb.skill.SkillRole skillrole = new fire.pb.skill.SkillRole(roleid);
				
				xbean.LiveSkill liveskill = skillrole.getLiveSkills().get(id);
				
				int requireLevel = 1; //闂傚倸鍊搁崐鎼佸磹閹间礁纾归柟闂寸绾惧綊鏌熼梻瀵割槮缁炬儳缍婇弻鐔兼⒒鐎靛壊妲紒鐐劤缂嶅﹪寮婚悢鍏尖拻閻庨潧澹婂Σ顔剧磼閻愵剙绀冩い鏇嗗洤鐓橀柟杈鹃檮閸嬫劙鏌涘▎蹇ｆЧ闁诡喗鐟х槐鎾存媴閸濆嫷锟藉矂鏌涢妸銉у煟鐎殿喖顭锋俊鎼佸煛閸屾矮绨介梻浣侯焾閺堫剛绮欓幋锔绘晜闁跨噦鎷�?闂傚倸鍊搁崐鎼佸磹閹间礁纾归柟闂寸绾惧湱锟界懓瀚崳纾嬨亹閹烘垹鍊為悷婊冪箻瀵娊鏁冮崒娑氬幗闂侀潧绻堥崺鍕倿閸撗呯＜闁归偊鍙庡▓婊堟煛瀹�锟介崰鏍蓟閸ヮ剚鏅濋柨鐔剁矙瀹曟繈骞掗幘鍓侇啎閻庣懓澹婇崰鏇犺姳閼姐倗纾奸柣娆忔噽缁夘噣鏌″畝瀣埌閾伙綁鏌涜箛鎾虫倯婵絽瀚板铏圭磼濡櫣鐟ㄩ梺鍛婅壘椤戝洭骞戦姀鐘闁靛繒濮烽鎺楁煟鎼达絾鏆╂い顓炵墦瀵娊鏁撻悩鏂ユ嫼闂侀潻瀵岄崢濂稿储閹绢喗鐓涢柨鐔剁矙閺屽棗顓奸崨鍌︾畵閺屾盯寮撮妸銉т哗濡炪値鍋勯幊姗�寮诲澶嬪癄濠㈣泛顑愬Λ锟犳⒑濮瑰洤锟芥挾娆㈠顒夋綎闁惧繗顫夌�氭岸鏌嶉妷銊︾彧闁诲繋绶氬娲箹閻愭彃顫呭┑鈽嗗亜鐎氫即骞冩ィ鍐╁�荤紒娑橆儐閺呮繈姊洪幐搴㈢┛闁归鍏樺畷顒勵敍閻愮补鎷洪梻鍌氱墛閻╊垶鎮板鍛＜閺夊牄鍔嶇粈鍐磼閸屾氨效闁诡喗鐟╅幃婊兾熼柨瀣伜闂傚倷鑳堕…鍫ュ嫉椤掑嫭鍋￠柕濞炬櫅缁�鍌滐拷鐧告嫹闁跨喓鏅Σ鎰板箳濡ゅ﹥鏅梺鍛婁緱閸樼偓绂掗幘顔解拺闁革富鍘鹃幗鍌炴煕鐎ｎ亷韬鐐插暙閻ｏ繝鏌囬敂鎯у汲闂備礁鎲″ú锕傚礈濞戙垹绀勯柨鐔哄У閳锋垿鏌涘┑鍕姎闁哄鍨块弻鐔煎川婵犲倵鏋欓梺缁樹緱閸ｏ絽鐣峰锟介、娆撴嚍閵夛富浠ч梻鍌欒兌缁垶鈥﹂崼顫剨婵炲棙鎸婚弲顒佺節婵犲倻澧涢柍閿嬪灩缁辨挻鎷呮慨鎴簼閹便劑宕堕妸锝勭盎闂佸搫娲㈤崝灞筋嚕椤旀拝鎷风憴鍕８闁搞劏娅ｇ划瀣箳閺冩挻瀚归柨婵嗛娴滄劙鏌熼柨瀣仢婵﹤顭峰畷鎺戭潩閸楃儐鏉稿┑鐐存尰绾板秹銆冩繝鍥х畺闁绘劖鐣崑鍛存煕閹般劍娅囬柛姗�浜堕弻鐔煎礂閼测晜娈梺鍛婃煥椤戝鐛径鎰�锋い鎴濆綖缁ㄥ姊洪棃娑氱畾闁告挻绻堣棢闁割偆鍠嗘禍婊堟煏韫囧﹤澧茬紒锟界�ｎ喗鐓涘ù锝囶焾閿熻棄娼￠獮鍐礈瑜屽▽顏堟煢濡警妲烘い鏃�鍨垮濠氬磼濮橆剨鎷烽悜鑺ュ�块柨鏇炲�搁崙鐘测攽閸屾粠鐒鹃柣銈囧亾缁绘盯骞嬪▎蹇曚患闂佹眹鍊ら崰妤呭Φ閸曨垰绠涢柛顐ｆ礃椤庡秹姊虹粙鍖″伐闁绘牕銈稿璇差吋婢跺﹣绱堕梺鍛婃处閸撴瑥鈻嶉妶澶嬧拺缂備焦蓱鐏忕敻鏌涢悩宕囧⒌鐎殿喖顭峰鎾偄妞嬪海鐛繝纰樻閸ㄩ潧鈻嶉敐鍡欘浄妞ゆ挶鍨洪悡鐔煎箹濞ｎ剙鐏柛鐔哥叀閺岀喖宕欓妶鍡楊伓? by changhao
				
				if (liveskill != null)
				{
					requireLevel = liveskill.getLevel() + 1;
				}
				
				if (requireLevel > config.skillLevelMax) //闂傚倸鍊搁崐鎼佸磹閹间礁纾归柟闂寸绾惧綊鏌熼梻瀵割槮缁惧墽鎳撻—鍐拷锝庝簼閹癸綁鏌ｉ鐐搭棞闁靛棙甯掗～婵嬫倷椤掞拷椤忚埖淇婇妶鍥ラ柛瀣仱閹囨偐濮瑰浄鎷锋笟锟藉鎾閻樻爠鍥╁彄闁搞儯鍔嶉悡銉︺亜韫囨碍纭鹃柍瑙勫灴椤㈡瑩鎯岄顐＄盎闁伙絿鍏橀、妤呭礋椤愩垹浜堕梺璇叉捣閺佽顭囨繝姘濡炲瀛╅崰鍡涙煕閺囥劌澧版い锔诲枛椤啴濡舵惔鈥茬盎濡炪倧绠撴禍鍫曞极閹惧顩烽悗锝庡亝闁款參姊洪棃娑氬ⅱ妞ゎ厼鐗撻、姘舵晲婢跺﹪鍞堕梺鍝勬川閸嬬喖顢樺ú顏呪拺缂備焦鈼ら鍫熷�舵慨姗嗗劮閹烘挻鍎熼柕蹇嬪灮閻﹀牓姊哄Ч鍥х伈婵炰匠鍕浄闁冲搫鎳忛悡娆愮箾閼奸鍞虹紒銊ф櫕閿熻棄鐏氬姗�鏁冮鍫濈疇闁绘劕鎼敮閻熸粌绻楅妵鎰版倷椤掑倻鐦堥梺姹囧灲濞佳冪摥婵犵數鍋涢惇浼村磹濠靛绠栭柛褎顨忛弫瀣煥閻斿墎鐭欑�殿喛顕ч埥澶娢熼柨瀣垫綌婵犵妲呴崹浼村触鐎ｎ喖绠熷┑鍌氭啞閳锋垹绱撴担鑲℃垹浜搁棃娑掓斀妞ゆ梹鍎抽崢鎾煙椤栥倖瀚规俊鐐�曠换鎰版偋閸℃瑧妫憸鏃堝蓟濞戔懇锟斤箓骞嬪┑鍥╀粚闂備胶纭堕弲婵嬪磻閻愬灚宕叉繝闈涱儏閻撴洟鏌ㄩ悢鍓佺煓鐎规洘甯掗～婵嬵敆閸屾ê浠忛梻鍌氬�风粈渚�骞栭锔藉剹濠㈣泛鐬肩粈濠偯归敐澶涙嫹濞戞氨鐣鹃梻浣虹帛閸ㄧ厧螞閸曨偅鏆滈梻鍌欑劍鐎笛兠洪埡鍛闂佸灝顑囩粻楣冩煕椤愩倕娅忔繛鍫熺矒閺岀喖顢欑粵瀣暥闂佸磭绮幑鍥х暦瑜版帩鏁婇柣锝呭闁垶姊婚崒娆掑厡缂侇噮鍨堕幃褍顭ㄩ崼婵嗗亶閻熸粍妫冮獮鍐┿偅閸愨晝鍙嗛柣搴秵閸撶喎顬婇锟藉娲川婵犲嫧妲堥梺鎸庢磸閸婃牜绮嬪鍜佺叆闁割偆鍠庨敓鐣屾暬閺岋綁鎮㈤崨濠勫嚒濡炪倕娴氭禍婵堟崲濠靛顫呴柍钘夋閸旂顪冮妶蹇曞缂侇喗鐟ラ～蹇旂節濮橆剛锛滃┑顔斤供閸撱劑骞忛悜鑺ュ�婚柤鎭掑劚濞堟垿姊洪崨濠冨矮闁绘帪绠撳畷妤�顭ㄩ崼鐔哄幈濡炪倖鍔х徊鍓х矆閿熶粙姊哄Ч鍥э拷妤呭磻閹捐埖宕叉繛鎴欏灩缁狅絾绻涢崱妤冪濞寸娀绠栧铏圭矙閸噮鍔夊銈冨妼閿曨亜顕ｇ拠娴嬫婵﹩鍋呴崟鍐⒑鐠団�崇�婚柛鎰ㄦ櫇濡叉姊婚崒娆戝妽闁诡喖鐖煎畷鎰板冀椤剝妞介幃銏ゆ偂鎼淬倖鎲伴梻渚�娼ц墝闁哄懏绮撳畷鎴﹀幢濞戞瑧鍘遍柣蹇曞仜婢т粙鍩ユ径瀣ㄤ簻闊洢鍎茬�氾拷?婵犵數濮烽弫鍛婃叏閻戣棄鏋侀柛娑橈攻閸欏繘鏌ｉ幋锝嗩棄闁哄绶氶弻娑樷槈濮楀牊鏁鹃梺鍛婄懃缁绘劙婀侀梺绋跨箰閸氬绱為幋锔界厱闁靛鍎遍敓钘夘煼楠炲骞栨担鐟颁罕闂佸壊鍋呯换鍕偡閺屻儲鈷戠紒瀣儥閸庡繑銇勯敂鐐毈鐎殿喖顭峰鎾晬閸曨厽婢戦梺璇插嚱缂嶅棙绂嶉悜钘夌闁绘垼妫勯崡鎶芥煟閹存繃顥滈柡鍛Т閳规垿鎮╃紒妯婚敪濠电偛鐪伴崹铏圭矉瀹ュ拋鐓ラ柛顐ゅ枔閸樻悂鎮楅獮鍨姎闁哥噥鍋呮穱濠囧锤濡や胶鍘撻梺鍛婄懀閸庡磭绮ｉ弮鍫熺厸閻忕偛澧介埦渚�鏌熼娑欘棃妞ゃ垺鐟╅幊鏍煛閿熶粙宕犻弽顐ょ＝闁稿本鐟︾粊鏉款渻鐎涙ɑ鍊愭鐐村灴瀹曟儼顦撮柡鍡畵閺岀喖鎮滃Ο铏逛憾闂佸搫顑呴柊锝夊蓟閻旂尨鎷烽悽娈跨劸閸熸悂姊虹涵鍛棄闁活厼鍊搁～蹇曠磼濡顎撻梺缁樺灦閿氭繛鍫濈焸濮婃椽骞栭悙璇ф嫹閺嶎厽鍋嬮柣妯垮吹瀹撲線鐓崶銊р檨闁哄懏鎮傞弻銊╂偆閸屾稑顏�? by changhao
				{
					psend(roleid, new SSkillError(SkillConstant.SkillError.SkillMaxLimit));
					return false;						
				}
				 
				fire.pb.skill.SLifeSkillCost cost = ConfigManager.getInstance().getConf(fire.pb.skill.SLifeSkillCost.class).get(requireLevel);
				if (cost == null)
				{
					LiveSkillManager.logger.error("CRequestLearnLiveSkill cost error:" + requireLevel);					
					psend(roleid, new SSkillError(SkillConstant.SkillError.LiveSkillIdError));
					return false;					
				}
				
				xbean.Properties roleproperty = xtable.Properties.get(roleid);
				
				int roleidlevel = roleproperty.getLevel();
				
				if (config.studyLevelRule > 0)
				{
					int needLevelLimit = cost.needLevelList.get(config.studyLevelRule - 1);
					if (roleidlevel < needLevelLimit) //缂傚倸鍊搁崐鎼佸磹閹间礁纾归柟闂寸绾惧綊鏌熼梻瀵割槮缁炬儳缍婇弻鐔兼⒒鐎靛壊妲紒鐐劤缂嶅﹪寮婚敐澶婄闁挎繂鎲涢幘缁樼厱濠电姴鍊归崑銉╂煛鐏炶濮傜�殿噮鍓熷畷褰掝敊鐟欏嫬鐦遍梻鍌欑劍濡炲潡宕㈡禒瀣仭闁冲搫鎳庨拑鐔兼煟閺傝法娈遍柡瀣叄濮婁粙宕堕澶嬫櫔閻熸粌绉堕崣鍛存⒑閹稿孩绌块柟鐑芥敱閵囧嫰顢橀悙瀵糕敍缂備胶濮电粙鎴﹀煡婢舵劕绠抽柣鎰綑椤忓爼姊洪幐搴㈢闁稿﹤鎽滅划濠氭晲婢跺鍘介梺鐟扮摠缁诲啴藟濠婂牊鐓涢柛婊�绀佹晶瀛樻叏婵犲偆鐓肩�规洘甯掗埢搴ㄥ箣濠靛棭鐎撮梻鍌欐祰椤曟牠宕伴弽顓熷亯闁绘挸娴烽弳锕傛煛閸ャ儱鐒洪柡浣哥Ч閺岋綁骞囬姘辨濡炪倧瀵岄崳锝夊蓟閻旂厧绀傞柤娴嬫櫆濞堫剟姊洪崨濠冪叆闁活厼鍊块獮鍐灳閺傘儲鏂�闁诲函缍嗛崑鍡涘储閹间焦鈷戦柛娑橈工婵倿鏌涢弬鎸庢拱缂佸倸绉电�佃偐锟芥稒顭囬崢鍨繆閻愬樊鍎忓Δ鐘虫倐瀹曘垽骞橀鐣屽幗濠电偞鍨靛畷顒�鈻嶅鍥锋嫹鐟欏嫭绀�缂傚秴锕妴浣糕枎閹炬潙浜楅柟鍏兼儗閸犳绱為幘缁樷拻闁稿本鑹鹃敓鐣屽厴閹虫宕奸弴鐐电枃闂佽宕橀褎鎯旀繝鍥ㄧ厸閻忕偠顕ч崝鎾煛娴ｇ顏柡灞剧☉閳藉顫濇稊妯侯樀閺屻劑鎮㈢拠娈嬫捇鏌ｅΔ渚囨畼闁瑰箍鍨归埞鎴狅拷锝庝簽閸婄偤姊洪棃娑辩叚闂傚嫬瀚伴、鏃堟偄閸忓皷鎷绘繛杈剧秬婵倗娑甸崼鏇熺厱闁挎繂绻掗悾鍨殽閻愯尙绠婚柡浣规崌閺佹捇鏁撻敓锟� by changhao
					{
						psend(roleid, new SSkillError(SkillConstant.SkillError.MoneyNotEnough));
						return false;						
					}					
				}
				
				if (config.needGuild == 1 && roleproperty.getClankey() <= 0) //闂傚倸鍊搁崐鎼佸磹閹间礁纾归柟闂寸绾惧綊鏌熼梻瀵割槮缁惧墽鎳撻—鍐拷锝庝簼閹癸綁鏌ｉ鐐搭棞闁靛棙甯掗～婵嬫倷椤掞拷椤忚埖淇婇妶鍥ラ柛瀣仱閹囨偐濮瑰浄鎷锋笟锟藉鎾閻樻爠鍥╁彄闁搞儯鍔嶉悡銉︺亜韫囨碍纭鹃柍瑙勫灴椤㈡瑩鎯岄顐＄盎闁伙絿鍏橀、妤呭礋椤愩垹浜堕梺璇叉捣閺佽顭囨繝姘濡炲瀛╅崰鍡涙煕閺囥劌澧版い锔诲枛椤啴濡舵惔鈥茬盎濡炪倧绠撴禍鍫曞极閹惧顩烽悗锝庡亝闁款參姊洪棃娑氬ⅱ妞ゎ厼鐗撻、姘舵晲婢跺﹪鍞堕梺鍝勬川閸嬬喖顢樺ú顏呪拺缂備焦鈼ら鍫熷�舵慨姗嗗劮閹烘挻鍎熼柕蹇嬪灮閻﹀牓姊哄Ч鍥х伈婵炰匠鍕浄闁挎洖鍊归悡娆戠磼鐎ｎ偒鍎ラ柣鎾炽偢閺岀喖顢欓崫鍕紙濡炪們鍨洪〃濠傜暦閻旂⒈鏁冮柕鍫濋閺佹悂姊婚崒姘拷椋庣矆娓氾拷閹ê鈹戠�ｅ灚鏅為梺鍛婃处閸樿棄鐣烽弻銉︾厱闁斥晛鍙囧鍕洸婵犲﹤鐗婇悡娆徝归悡搴ｆ憼婵炴嚪鍐剧唵鐟滄粓宕归崼鏇炵畺婵°倧鎷锋い顐ｇ箞閹瑩顢楅敓浠嬵敂閿燂拷?闂傚倸鍊搁崐鎼佸磹閹间礁纾归柟闂寸绾惧湱锟界懓瀚崳纾嬨亹閹烘垹鍊為悷婊冪箻瀵娊鏁冮崒娑氬幗闂侀潧绻堥崺鍕倿閸撗呯＜闁归偊鍙庡▓婊堟煛瀹�锟介崰鏍蓟閸ヮ剚鏅濋柨鐔剁矙瀹曟繈骞掗幘鍓侇啎閻庣懓澹婇崰鏇犺姳閼姐倗纾奸柣娆忔噽缁夘噣鏌″畝瀣埌閾伙綁鏌涜箛鎾虫倯婵絽瀚板铏圭磼濡櫣鐟ㄩ梺鍛婅壘椤戝洭骞戦姀鐘闁靛繒濮烽鎺楁煟鎼达絾鏆╂い顓炵墦瀵娊鏁撻悩鏂ユ嫼闂侀潻瀵岄崢濂稿储鐎涙ǜ浜滈柕澶涢檮瀹曞矂鏌℃担瑙勫磳鐎规洘鍔欓幃銈嗘媴閸︻厾啸濠电姷鏁搁崑鐐电矈閹绢喖鐤炬繝闈涚墛椤洟鏌ｉ幇顒傛憼濠殿垱鎸抽弻娑㈠箻閺夋垹绁峰┑鐐茬墑閸旀垵顫忓ú顏勬嵍妞ゆ挴鍓濋妤呮⒑閸濄儱校妞ゃ劌锕ら悾鐑藉箣閿曪拷缁�瀣亜閹邦喖鏋戦柡鍌︽嫹闂傚倷鑳堕…鍫ュ嫉椤掑嫬绀勯柣鐔稿珗閿濆宸濆┑鐘插椤旀洟姊洪崜鎻掍航闁告挻姘ㄩ敓鑺ョ啲閹凤拷? by changhao
				{
					MessageMgr.psendMsgNotify(roleid, 150027, null);
					return false;	
				}
				
				//濠电姷鏁告慨鐑藉极閸涘﹥鍙忛柣鎴ｆ閺嬩線鏌涘☉姗堟敾闁告瑥绻橀弻锝夊箣濠垫劖缍楅梺璺ㄥ枙濡嫰宕愰崸妤�绠板┑鐘插暟閻濆爼鏌嶉崫鍕靛剳缂佸鍠氶敓鍊燁潐濞叉粓宕伴弽顓滐拷浣糕槈濮楀棙鍍垫俊鎻掓湰閻楁洟寮幖浣光拻闁稿本鐟︾粊鐗堢箾婢跺绀嬬�规洘濞婇弫鍐磼濮橀硸鍞甸梻浣芥硶閸ｏ箓骞忛敓锟�?濠电姷鏁告慨鐑藉极閸涘﹥鍙忛柣鎴ｆ閺嬩線鏌涘☉姗堟敾闁告瑥绻橀弻锝夊箣閿濆棭妫勯梺鍝勵儎缁舵岸寮婚悢鍏尖拻閻庨潧澹婂Σ顔剧磼閻愵剙鍔ゆい顓犲厴瀵鏁愭径濠勭杸濡炪倖甯婄拋鏌ュ几濞嗘挻鈷戠紓浣姑粭鈺佲攽椤斿搫锟芥骞戦姀鐘闁靛繒濮撮懓鍨攽閳藉棗鐏ｇ紒顕呭灦瀹曟洘鎯旈妸锔规嫼闁哄鍋炴竟鍡浰囬敃鍌涘�垫慨姗嗗亜瀹撳棛锟芥鍠涢褔鍩ユ径濞㈢喖鏌ㄧ�ｅ灚缍屽┑鐘垫暩閸嬫稑螞濞嗘挸绀夐柡鍥ュ灩缁�鍫㈡喐閻楀牆绗氶柍閿嬪灴瀵爼鎮欓弶鎴濡炪倧璁ｉ梽鍕┍婵犲浂鏁冮柨婵嗘川閻ゅ嫰鎮楀▓鍨灈妞ゎ厾鍏樺顐﹀箛椤撶偟绐炴繝鐢靛Т閸犳艾螞閻斿吋鈷掑ù锝呮啞鐠愨剝銇勯鐐靛ⅱ闁跨喕濮ょ粙鍫ュ疾閻樿尙鏆﹀ù鍏兼綑缁犳盯鏌ｅΔ锟介悧鍐箯濞差亝鍊甸悷娆忓缁�锟藉┑鐐茬湴閸斿酣寮灏栨婵炲棙鍨归鏇㈡⒑閼测斁鎷￠柛鎾寸懇瀵鈽夊鐐婵炲牆鐏濋弸娑欍亜椤撶姴鍘寸�殿噮鍋婇獮鍥级閸喚鐛╅梻浣侯焾閺堫剛鍒掑畝鍕嚑婵炴垯鍨洪悡娆撴煟閹捐櫕鎹ｇ紒澶嬫そ閺岀喖顢涘顒婃嫹閸喚鏆︽い鎰剁畱鍞悷婊勭矊鍗遍柟闂寸劍閳锋帡鏌涚仦鍓ф噮妞わ讣绠撻弻鐔兼嚍閵壯呯厜閻庤娲戦崡鎶界嵁閸ヮ剙绾ч悹鎭掑妿閺嗩偊姊绘担渚劸闁哄牜鍓熷畷娆撴偡闁妇鍔烽梺鍝勭▉閸樹粙鎮￠敐澶屽彄闁搞儯鍔岄崵顒佺箾閸忕厧濮嶉柡灞剧缁犳盯寮崒婊呭帨婵犳鍠栭敃銉ヮ渻閽樺鏆︾憸鐗堝俯閺佸鏌涘☉鍗炲箹濠㈢懓鐗婃穱濠囨倷椤忓嫸鎷烽弴鐕佹闊洦绋戠粻顖炴煥閻曞倹瀚�? by changhao
				
				if (config.studyCostRule > 0)
				{
					int silverCost = cost.silverCostList.get(config.studyCostRule - 1);
					
					Pack bag = (Pack)fire.pb.item.Module.getInstance().getItemMaps(
							roleid, fire.pb.item.BagTypes.BAG, false);
					
					if (bag.getMoney() < silverCost)
					{
						psend(roleid, new SSkillError(SkillConstant.SkillError.MoneyNotEnough));
						return false;					
					}
					
					//闂傚倸鍊搁崐鎼佸磹閹间礁纾归柟闂寸绾惧綊鏌熼梻瀵割槮缁惧墽鎳撻—鍐拷锝庝簼閹癸綁鏌ｉ鐐搭棞闂囧鏌ㄥ┑鍡╂Ч濞存嚎鍊濋弻銈夊级閹稿骸浠村┑顔硷攻濡炰粙銆佸Δ鍛櫢闁伙絽鐬奸惌鎾绘煛鐏炶鍔滈柡鍛倐閺岋箑螣娓氼垱笑闂佽法鍠曞Λ鍕焽閿熺姴违濞达絿纭堕弸搴ㄦ煙閹咃紞妞わ富鍙冮幃宄邦煥閸愵亞顔掗柦妯荤箖閵囧嫰寮介妸褋锟芥帞绱掗悩鑽ょ暫闁哄瞼鍠栭獮鍡氼檨闁搞倗鍠栭弻娑㈡偄閸濄儱寮ㄩ梺鍝勭灱閸犳牠骞冨鍫熷殟闁靛闄勫▓鍛婁繆閻愵亜锟芥垿宕濇繝鍥х？闁汇垻顭堢粻鏍ㄧ箾閸℃ɑ灏紒鐙欏洦鐓欓悗娑欘焽缁犮儲绻涢崗鐓庡摵婵﹦绮幏鍛存嚍閵夛綇鎷烽崘顔界厽闁硅櫣鍋熼悾鍨殽閻愭潙鐏寸�规洖鐖奸、妤呮晸娴犲鍑犲〒姘炬嫹闁哄瞼鍠栧畷婊嗩槾閻㈩垱鐩弻锟犲川椤旇棄锟芥劙鏌＄仦璇插闁诡喓鍊濆畷鎺戔槈濮楀棔绱� by changhao
					if(bag.subMoney(-silverCost, LiveSkillManager.LiveSkill, fire.log.enums.YYLoggerTuJingEnum.tujing_Value_gonghuilianjin, 0) != -silverCost)
					{
						psend(roleid, new SSkillError(SkillConstant.SkillError.MoneyNotEnough));
						return false;	
					}
				}
				
				//闂傚倸鍊搁崐鎼佸磹閹间礁纾归柟闂寸绾惧綊鏌熼梻瀵割槮缁炬儳缍婇弻鐔兼⒒鐎靛壊妲紒鐐劤缂嶅﹪寮婚悢鍏尖拻閻庨潧澹婂Σ顔剧磼閻愵剙绀冩い鏇嗗洤鐓橀柟杈鹃檮閸嬫劙鏌涘▎蹇ｆЧ闁诡喗鐟х槐鎾存媴閸濆嫷锟藉矂鏌涢妸銉у煟鐎殿喖顭锋俊鎼佸煛閸屾矮绨介梻浣侯焾閺堫剛绮欓幋锔绘晜闁跨噦鎷�?闂傚倸鍊搁崐鎼佸磹閹间礁纾归柟闂寸绾惧湱锟界懓瀚崳纾嬨亹閹烘垹鍊為悷婊冪箻瀵娊鏁冮崒娑氬幗闂侀潧绻堥崺鍕倿閸撗呯＜闁归偊鍙庡▓婊堟煛瀹�锟介崰鏍蓟閸ヮ剚鏅濋柨鐔剁矙瀹曟繈骞掗幘鍓侇啎閻庣懓澹婇崰鏇犺姳閼姐倗纾奸柣娆忔噽缁夘噣鏌＄仦璇插鐎殿噮鍣ｅ畷鍫曗�﹂幋鐑嗘濠电姷鏁搁崑娑㈡偋婵犲洤鍨傞柛褎顨呴拑鐔兼煥濠靛棭妲归柛瀣姍閺屻倖鎱ㄩ幇顒婃嫹濡ゅ啰鐜绘俊銈呮噺閳锋垿姊婚崼鐔衡檨闁挎稒妫冮弻鐔割槹鎼粹�冲箣濠殿喖锕ュ钘夌暦椤愶箑绀嬮梻鍫熺☉婢瑰绻濈喊妯活潑闁稿瀚板畷顖炲级閹搭厼娈ㄦ繝鐢靛У绾板秹宕戦崟顖涚厽婵﹩鍓涢幗鐘绘倵濮橆剛绉洪柡宀嬬秮婵拷闁宠棄妫楅弲閬嶆⒑缂佹ê娴紒鐘崇墪椤曪絾绂掔�ｎ偅娅㈤梺缁樕戦弸濂稿箯濞差亝鈷戦柛娑橈功缁犳捇鎮楀鐓庡籍閽樼喖鏌ｉ幇顔芥毄缁炬儳鍚嬮妵鍕籍閸パ傛睏闁轰礁鐗婄换婵堝枈婢跺瞼锛熼梺杞版祰椤曆囨偩閻戣姤鍋勭痪鎷岄哺閺咁剙鈹戦绛嬬劸濞存粠鍓欓…鍥ㄥ緞閹邦厸鎷绘繛杈剧秬椤宕戦悩缁樼厱閹兼惌鍠栭悘锔撅拷瑙勬礃缁诲啴骞嗛弮鍫澪╅柕澶婄昂閸庨亶鍩為幋锔藉亹闁圭粯甯婄花钘夆攽閻愬瓨灏い顓犲厴瀵寮撮姀鐘诲敹濠电娀娼уΛ顓㈠礉婢跺瞼纾藉ù锝堟閻撴劙鏌ｉ埡濠傜仸鐎殿喖顭烽幃銏ゆ偂鎼达綆妲遍梻渚�娼ч悧鍡椢涘Δ鍜佹晜闁跨噦鎷� by changhao
				if (config.studyCostRule > 0)
				{
					int needfactioncontr = cost.guildContributeCostList.get(config.studyCostRule - 1);
					if (needfactioncontr > 0)
					{
						boolean ok = ClanManage.delContribution(roleid, needfactioncontr, LiveSkillManager.StudyLiveSkill, false);
						if (ok == false) //闂傚倸鍊搁崐鎼佸磹閹间礁纾归柟闂寸绾惧綊鏌ｉ幋锝呅撻柛濠傛健閺屻劑寮撮悙璇ф嫹瑜版帒纾块柟瀵稿У閸犳劙鏌ｅΔ锟介悧鍡欑箔閹烘鐓涢柛鏇楁櫅閸旓箓鏌＄仦鍓ф创鐎殿喗鎸虫俊鎼佸Ψ瑜岄崫妤呮⒒娴ｈ鍋犻柛鏂跨焸瀹曟劙骞栨担鍝ュ幋闂佺鎻粻鎴犲閸忚偐绡�濠电姴鍊归幑锝夋煕閺傛寧鎲哥紒杈ㄦ尰閹峰懘鎮烽弶娆炬綌婵＄偑鍊戦崝灞轿涘☉銏犵闁靛繒濮Σ鍫ユ煏韫囨洖啸妞ゆ挻妞藉铏圭磼濡搫顫嶅銈嗘⒐閻楃姴顕ｉ幎鑺ユ櫢闁绘ɑ鏋奸幏铏圭磽娴ｅ壊鍎撴繛澶嬫礈缁鎳犻鍌滐紲濡炪倖妫佹慨銈呯暦瀹�锟介敓鑺ヮ問閸犳牠鈥﹂柨瀣╃箚闁归棿绀侀悡娑㈡煕鐏炲墽鐓紒銊ㄥ吹缁辨捇宕掑顒婃嫹閻戣姤鍊块柨鏇炲�归弲婵嬫煃鏉炴壆瀵兼繛鎴欏灩缁�瀣亜閺嶃劎鈻撻柟閿嬫そ閺岋絾鎯旈埄鍐婵犳鍠氶弫鏄忔＂婵犮垼娉涢鍐╃濠婂牊鐓ラ柡鍐ㄥ�告禍楣冩煛閸♀晛澧撮柡宀嬬到閳藉宕￠悙瀵镐邯闂佸彞绱紞渚�寮昏缁犳稑顫濋崗鑲╃Х婵犵數鍋涢悧鎾剁不閺嵮屾綎婵炲樊浜滅粻褰掓煟閹邦厼绲诲┑顔奸閳规垿鍩ラ崱妞剧盎闂備礁搴滅徊浠嬫偩閻戣姤鍋￠柟鍐诧攻濡炰粙銆侀弮鍫濈閹兼惌鍨抽悾鐢告煛鐏炲墽娲寸�殿喗鎸虫俊鎼佸Ψ閿旀儳钂嬪┑鐘殿暜缁辨洟鎼规惔銏㈩洸妞ゅ繐瀚峰鏍ㄧ箾瀹割喕绨奸柛瀣剁節閺屸剝寰勭�ｎ亶鍤嬪銈嗘閹风兘姊婚崒娆掑厡闁硅櫕鎹囧畷鐢稿冀椤撶偟顔嗛梺璺ㄥ櫐閹凤拷 by changhao
						{
							psend(roleid, new SSkillError(SkillConstant.SkillError.ContributeNotEnough));
							return false;						
						}					
					}						
				}			
				
				if (liveskill == null)
				{
					xbean.LiveSkill e = xbean.Pod.newLiveSkill();
					e.setLevel(requireLevel);
					skillrole.getLiveSkills().put(id, e);
					
					liveskill = e;
				}
				else
				{
					liveskill.setLevel(requireLevel);					
				}
				
				if (config.skillId != 0) //闂傚倸鍊搁崐鎼佸磹閹间礁纾归柟闂寸绾惧綊鏌熼梻瀵割槮缁惧墽鎳撻—鍐拷锝庝簼閹癸綁鏌ｉ鐐搭棞闁靛棙甯掗～婵嬫倷椤掞拷椤忚埖淇婇妶鍥ラ柛瀣仱閹囨偐濮瑰浄鎷锋笟锟藉鎾閻樻爠鍥╁彄闁搞儯鍔嶉悡銉︺亜韫囨碍纭鹃柍瑙勫灴椤㈡瑩鎯岄顐＄盎闁伙絿鍏橀、妤呭礋椤愩垹浜堕梺璇叉捣閺佽顭囨繝姘濡炲瀛╅崰鍡涙煕閺囥劌澧版い锔哄劤缁辨捇宕掑姣欍垽鏌ㄩ弴銊ら偗闁绘侗鍣ｅ畷姗�鍩￠崘鐐カ闂佽鍑界紞鍡涘磻閹烘嚦娑㈠礃椤旇В鎷洪梺鍛婂姇瀵爼骞嗛崼銉︾厱闁绘棁娉涘畵鍡涙煕閳哄绉┑陇鍩栧鍕拷锛卞嫬顏烘繝鐢靛仩閹活亞寰婇崸妤�绠犻柟鐐た閺佸绻濇繝鍌氼伀缂佺娀绠栭弻娑樷枎韫囷絾楔婵犫拃鍛毄闁跨喎锟界噥娼愭繛鍙夛耿瀹曟繂鈻庤箛鏇熸濡炪倖鍔х粻鎴濇暜闁荤喐绮岀换姗�骞冮悙鍝勭闁兼祴鏅濋惁鍫ユ⒑闂堟盯鐛滅紒韫矙閹繝骞囬悧鍫㈠幈闂佸搫鍠涢幏鐑芥煟濡ゅ啫鈻堟鐐插暣濡捐京绱掗悩宕囨创妤犵偞锕㈤、娑樷槈濞嗘劖绶梻鍌氬�烽懗鍓佸垝椤栫偐锟斤箓宕奸～顓犲墾濠电偛妫欓崹瑙勭▔瀹ュ鐓欓柟顖涙緲琚氶梺缁樻尵閸犳牠寮婚妸銉㈡斀闁糕檧鏅滃暩闂備浇顫夐悡锛勭不閺嶎厼钃熼柣鏃傚帶绾惧綊鏌ｉ弬鎸庢喐闁靛棙鍔曢—鍐Χ鎼粹�茬凹缂備浇顕ч悧鎾荤嵁婵犲偆鐓ラ柛娑卞幗閻庡啿鈹戦埥鍡楃仴妞ゆ泦鍥舵晜闁革富鍘剧壕浠嬫煕鐏炲墽鎳嗛柛蹇撶焸閺屟嗙疀閹捐寮伴悗瑙勬穿缂嶄礁鐣峰锟介、娆撴嚃閳轰焦鎲㈤梻浣告惈椤︻垶鎮ч崘顔肩柧妞ゅ繐鐗嗙粻顖滐拷鐟板閸嬪﹤顭囬埡鍛厽闁逛即娼ф晶顔姐亜韫囥儲瀚�? by changhao
				{
					Result result = new Result(true);
					
					//闂傚倸鍊搁崐鎼佸磹閹间礁纾归柟闂寸绾惧綊鏌熼梻瀵割槮缁惧墽鎳撻—鍐拷锝庝簼閹癸綁鏌ｉ鐐搭棞闁靛棙甯掗～婵嬫倷椤掞拷椤忚埖淇婇妶鍥ラ柛瀣洴钘濋柣銏㈩焾閺嬩胶锟藉箍鍎遍ˇ顖滅矆鐎ｎ偁浜滈柟鍝勭Ф閸斿秵銇勯弬鎸庡枠婵﹦绮幏鍛存嚍閵壯侊拷濠囨⒑閸濄儱校闁圭顭烽獮鍫ュΩ瑜濋幏鐑芥濞戞瑦鍠愮紒鐐劤閵堟悂寮诲澶婁紶闁告洦鍓欏▍銈夋⒑閹惰姤鏁遍柛銊ョ埣婵＄敻宕熼姘鳖唺闂佺粯鍔栧娆擃敂閸撲胶纾介柛灞剧懅椤︼附銇勯敂鍨祮妤犵偞鍔欓獮搴ㄦ寠婢跺矈鍞甸梻浣侯攰閹活亪姊介崟顖氱；闁告洦鍋�閺�浠嬫煕鐏炴儳鍤俊鍙夋そ閺屾盯鎮欓崹顐ｆ瘓濠殿喖锕ュ钘夌暦閵婏妇绡�闁告劑鍔庨悡顖炴⒒娴ｅ搫甯堕柛鐔锋健閹儲绺界粙璺ㄧ暫闂佺粯鍨垫竟娆愬緞閹邦厼浠ч梺璺ㄥ櫐閹凤拷 by changhao
					result.updateResult(skillrole.addLiveSkillBuff());	
				
					if(!result.getChangedAttrs().isEmpty())//闂傚倸鍊搁崐鎼佸磹閹间礁纾归柟闂寸绾惧綊鏌熼梻瀵割槮缁炬儳缍婇弻鐔兼⒒鐎靛壊妲紒鎯у⒔閹虫捇鈥旈崘顏庢嫹閿濆簼绨绘い鎺嬪灪閵囧嫰骞囬鍡欑厯闂佸搫琚崝鎴﹀箖閵忋倕浼犻柛鏇熷灟閸ㄥ鎯�椤忓牆绠氱憸婊堟偂婵傚憡鐓涢悘鐐插⒔閳藉鏌嶉挊澶樻█鐎规洩绻濋幃娆撳箵閹烘繂濡ф繝鐢靛Х閺佹悂宕戝☉銏″剭闁绘垼妫勯悿楣冩煟濡鍤欓柦鍐枛閺岋繝宕堕埡浣圭亖缂備胶濞�缁犳牠寮婚敐澶婄疀闂傚牊绋戦～顏堟⒑缂佹绠栨繛鑼枎椤繘鎼归崷顓犵厯濠电偛妫欓崕鎶藉礈娴煎瓨鈷戠紒瀣皡瀹搞儲绻涚亸鏍垫嫹閹颁礁娈ㄦ繝鐢靛У閼圭偓鍎梻渚�娼чˇ顓㈠垂濞差亷缍栫�广儱鎳夐弨浠嬫煃閽樺顥滈柣蹇曞枛閹綊鏁撴禒瀣櫆闁伙絽鐭堝ù鍕⒑閼姐倕鏋戝鐟邦儔瀵劍绂掔�ｎ偆鍘介梺褰掑亰閸ㄤ即鎯冨ú顏呯厽闁圭儤鎸搁崝銈夋婢跺绡�濠电姴鍊婚崙褰掓⒑椤撗冪仯闁跨喕濮ら鏍窗閺嶎厸锟斤箓鎮滈挊澶嬬�梺褰掑亰閸樿偐娆㈤悙娴嬫斀闁绘ɑ褰冮顐︽煛婢跺鍊愭慨濠勭帛閹峰懐绮欓幐搴★拷顖炴⒑鐠団�虫灈闁稿﹥鎮傞垾锕傚炊椤忓秵鈻屾俊鐐�戦崹鍝勎涢崘顔兼瀬闁瑰墽绮弲鎼佹煥閻曞倹瀚�?闂傚倸鍊搁崐鎼佸磹瀹勬噴褰掑炊瑜忛弳锕傛煟閵忋埄鐒剧紒鎰殜閺岀喖鏌囬敃锟介弸娑㈡煕閵婏妇绠橀柨鐔烘櫕濞呫垽骞忛悜鑺ョ厱闁哄洢鍔屾晶浼存煕濡濮嶆慨濠冩そ楠炴劖鎯旈敐鍥╂殼闂備胶鎳撻崲鏌ヮ敄婢跺﹦鏆﹂柣銏㈩焾閸楁娊鏌ｉ弮鍌滅瘈缂併劌顭峰铏规喆閸曨剛鍑℃繝鈷�鍐弰妤犵偛鍟缓浠嬪川婵炵偓瀚介梻浣告啞濞诧箓宕戦崟顖ｆ晜妞ゆ劑鍊楃壕濂稿级閸稑濡肩紒妞﹀洦鐓ラ柣鏂挎啞閻忣喚绱撳鍛棦鐎规洏鍨介幃鍓т沪閹冨箲闂備胶鍘ч幗婊堝磻閿濆棛顩叉繝濠傜墛閻撱儵鏌￠崒姘变虎闁诡喗鍨块幃妤�顫濋悙顒�顏�? by changhao
					{
						mkdb.Procedure.psendWhileCommit(roleid,new SRefreshRoleData((HashMap<Integer, Float>)result.getChangedAttrs()));
					}
				}
				
				SUpdateLearnLiveSkill msg = new SUpdateLearnLiveSkill();
				msg.skill.level = liveskill.getLevel();
				msg.skill.id = id;
				
				mkdb.Procedure.psendWhileCommit(roleid, msg);

				mkdb.Procedure.pexecuteWhileCommit(new fire.pb.ranklist.proc.PRoleZongheRankProc(roleid));
				
				//闂傚倸鍊搁崐鎼佸磹閹间礁纾归柟闂寸绾惧綊鏌熼梻瀵割槮缁惧墽鎳撻—鍐拷锝庝簼閹癸綁鏌ｉ鐐搭棞闁靛棙甯掗～婵嬫倷椤掞拷椤忚埖淇婇妶鍥ラ柛瀣洴钘濋柣銏㈩焾閺嬩線鏌熼崜褏甯涢柛瀣姍閺屟嗙疀閿濆懍绨奸梺缁樼缚閸斿秶鎹㈠┑瀣仺闂傚牊鍒�閵夛负浜滈柨婵嗙墛椤ュ宕￠柆宥嗙厱婵炴垶鐟︾紞鎴犵棯閹岀吋闁哄本绋戦埥澶娢熼崗鍏煎枛闂備胶顭堟鍝ワ拷娑掓櫊婵＄敻宕熼姘敤濡炪倖鍔﹀锟界紒顔肩埣濮婃椽宕崟顐淮闂佺娴烽弫璇差嚕婵犳艾鍗抽柨娑樺閺夋悂姊洪棃娑崇础闁告粌鍟伴崥褰掓⒒閸屾艾锟芥悂宕愰崫銉嫹濮樼厧澧伴柨鐔诲Г閻噣宕￠崘宸殨閻犲洦绁村Σ鍫熶繆椤栫偞鏁辨い顐㈢Т閳规垿顢欑粵瀣暥闂佺粯顨呭Λ娆戯拷闈涖偢楠炲洭顢橀悩娈垮晭闂佽娴烽弫鎼佲�﹂崼鐔哄ⅰ濠电姷顣槐鏇㈠磻閻樺弬娑㈠礋椤栥倗绋忛棅顐㈡处缁嬫帡骞嗛悙鐑樼厱闁挎棁顕ч獮姗�鏌ㄥ☉娆戠煀闁宠鍨块崺銉╁幢濡ゅ啩娣柣搴ゎ潐濞叉粓寮拠鑼殾闁挎繂顦獮銏＄箾閹寸偟鎲块柟鐤缁辨帞绱掗姀鐘茬闂佺懓鍢查澶婄暦閻㈢鎷烽敐搴″缁炬崘鍋愮槐鎾存媴鐠囷紕鍔风紓浣哄У閻楁洝褰侀梺鎼炲劀瀹ュ牆鎯堥梻浣筋嚃閸犳洜鍒掑▎蹇曟殾闁靛濡囩弧锟介梺绋挎湰閻熝囨儎鎼淬劍鈷掗柛灞剧懆閸忓本銇勯鐐靛ⅱ闁瑰箍鍨硅灃闁告侗鍘鹃敍娑㈡⒑閸︻厼顣兼繝銏★耿瀹曟帡濡搁埡鍌滃幗闂侀潧绻掓慨鐢稿疮閻愮儤鐓冮梺鍨儏閻忔挳鏌熼鑲╃Ш妤犵偘绶氶獮鎺楀箣濠垫劗锟借櫕绻濋悽闈涗粶闁瑰啿绻樺畷婵嗏枎閹惧疇鎽曢梺缁樻⒒閸樠呯矆閸曨垱鐓忛柛顐ｇ箖椤ユ粍銇勮箛銉﹀?闂傚倸鍊搁崐鎼佸磹閹间礁纾归柟闂寸绾惧綊鏌熼梻瀵割槮缁炬儳缍婇弻锝夊箣閿濆憛鎾绘煕閵堝懎顏柡灞剧洴椤㈡洟鏁愰崱娆樻К闂備胶顭堢悮顐﹀礉鎼淬劌绠熼柟闂寸濡﹢鎮归幁鎺戝婵炲牊鍎抽—鍐Χ閸℃瑥鈷堥梺绋款儐閻╊垶寮婚妸鈺佄ч柛鈩冩礈缁犳岸姊洪棃娑氬閻庢凹鍣ｅ畷婵嗩吋閸℃瑧顔曢梺鍛婁緱閸嬪嫰鎮橀崣澶嬪弿濠电姴瀚崝瀣倵閻㈤潧甯堕柍璇查叄楠炲鈹戦崱娆忓笓闂傚倸鍊风粈渚�宕ョ�ｎ亶娓婚柛褎顨呴崹鍌炴偣鏉炴媽顒熼柛銈嗘礋閺岀喖姊荤�靛壊妲紓浣哄缂嶄線寮婚敐鍛傜喖宕崟顒佺槪闂備礁鎼鍡涘垂閸噮娼栭柧蹇氼潐閸忔粓鏌涘☉鍗炴灓闁靛棙鍔欏娲箰鎼淬垻锛橀梺绋匡攻濞叉粓宕ｉ崨瀛樷拺闁圭瀛╃粈锟介梺绋匡工缂嶅﹤鐣烽幋锕�纾奸柣鎰嚟閸樻悂姊洪幖鐐插姌闁稿酣浜堕幃姗�顢旈崼鐔哄幗闂佽鍎抽顓㈠箠閸ヮ剚鐓涚�癸拷鐎ｎ剛袦濡ょ姷鍋涢澶愬箖濞嗘挸骞㈡俊顖濇娴犲吋绻涚�涙鐭嬮柟顔煎�块妴浣割潨閿熶粙骞冮姀銏㈢闁绘鏁稿▔鍧楁⒒閸屾瑧绐旀繛浣冲泚鍥敇閵忕姷锛熷┑鐐叉▕娴滄粎澹曢崸妤佺厸闁告劑鍔庢晶娑㈡煟閹惧銆掗柨鐔烘櫕濞呫垽骞忛悜鑺ュ�甸柨婵嗛婢ф壆鎮敃鍌涒拻濞达綀娅ｉ妴濠囨煛閸涱喚銆掗柨鐔诲Г绾板秴顭垮锟介幃鎯х暋闁附寤洪梺璺ㄥ枙婵倖绌辨繝鍌ゆ桨鐎癸拷婵犲唭銊╂⒒娴ｇ瓔鍤冮柛锝庡灣缁辩偞鎷呴崜鍙夌稁缂傚倷鐒﹁摫濠殿垱鎸抽弻娑㈡晜鐠囨彃绠洪梺鐓庣仢濞差厼顫忛搹鍦煓闁秆勵殢閿熻姤顨嗛妵鍕敇閻樻彃骞嬮梺缁樹緱閸犳稓绮诲☉妯锋婵炲棙鍔栭鐔兼⒒娴ｈ姤纭堕柛锝忕畵楠炲繘鏁撻敓锟�?
				fire.pb.course.CourseManager.checkAchieveCourse(roleid, fire.pb.course.CourseType.SHENG_HUO_JINENG, liveskill.getLevel());
				fire.log.YYLogger.roleSkillUPLog(roleid, new RoleSkillUpBean(id, liveskill.getLevel()));
				return true;
			}
		};
		
		requestlearnliveskill.submit();	
	}

	// {{{ RPCGEN_DEFINE_BEGIN
	// {{{ DO NOT EDIT THIS
	public static final int PROTOCOL_TYPE = 800515;

	public int getType() {
		return 800515;
	}

	public int id;

	public CRequestLearnLiveSkill() {
	}

	public CRequestLearnLiveSkill(int _id_) {
		this.id = _id_;
	}

	public final boolean _validator_() {
		return true;
	}

	public OctetsStream marshal(OctetsStream _os_) {
		if (!_validator_()) {
			throw new VerifyError("validator failed");
		}
		_os_.marshal(id);
		return _os_;
	}

	public OctetsStream unmarshal(OctetsStream _os_) throws MarshalException {
		id = _os_.unmarshal_int();
		if (!_validator_()) {
			throw new VerifyError("validator failed");
		}
		return _os_;
	}

	public boolean equals(Object _o1_) {
		if (_o1_ == this) return true;
		if (_o1_ instanceof CRequestLearnLiveSkill) {
			CRequestLearnLiveSkill _o_ = (CRequestLearnLiveSkill)_o1_;
			if (id != _o_.id) return false;
			return true;
		}
		return false;
	}

	public int hashCode() {
		int _h_ = 0;
		_h_ += id;
		return _h_;
	}

	public String toString() {
		StringBuilder _sb_ = new StringBuilder();
		_sb_.append("(");
		_sb_.append(id).append(",");
		_sb_.append(")");
		return _sb_.toString();
	}

	public int compareTo(CRequestLearnLiveSkill _o_) {
		if (_o_ == this) return 0;
		int _c_ = 0;
		_c_ = id - _o_.id;
		if (0 != _c_) return _c_;
		return _c_;
	}

	// DO NOT EDIT THIS }}}
	// RPCGEN_DEFINE_END }}}

}

