
package fire.pb.skill.particleskill;

import java.util.HashMap;
import java.util.Map;

import fire.log.beans.RoleSkillUpBean;
import fire.pb.attr.SRefreshRoleData;
import fire.pb.buff.BuffPetImpl;
import fire.pb.course.CourseType;
import fire.pb.item.GroceryItemShuXing;
import fire.pb.item.Pack;
import fire.pb.main.ConfigManager;
import fire.pb.pet.Pet;
import fire.pb.pet.PetColumn;
import fire.pb.pet.PetColumnTypes;
import fire.pb.skill.BuffUnit;
import fire.pb.skill.Module;
import fire.pb.skill.Result;
import fire.pb.skill.SkillPet;
import fire.pb.skill.SkillRole;
import fire.pb.skill.SubSkillConfig;
import fire.pb.skill.fight.FightSkillConfig;
import fire.pb.skill.liveskill.LiveSkillManager;
import fire.pb.talk.MessageMgr;
import fire.script.FightJSEngine;
import fire.script.JavaScript;









// {{{ RPCGEN_IMPORT_BEGIN
// {{{ DO NOT EDIT THIS
import com.locojoy.base.Marshal.OctetsStream;
import com.locojoy.base.Marshal.MarshalException;

abstract class __CRequestLearnParticleSkill__ extends mkio.Protocol { }

// DO NOT EDIT THIS }}}
// RPCGEN_IMPORT_END }}}

/***
 * 闂傚倸鍊搁崐鎼佸磹閹间礁纾归柟闂寸绾惧綊鏌熼梻瀵割槮缁炬儳婀遍敓鐣屾嚀鐎氼參宕崇壕瀣ㄤ汗闁圭儤鍨归崐鐐差渻閵堝棗绗掓い锔垮嵆瀵煡顢旈崼鐔蜂画濠电姴锕ら崯鎵不婵犳碍鐓涘ù锝堫潐瀹曞矂鏌熷畷鍥т槐濠碉紕鏌夐ˇ顕�鏌＄�ｎ偅顥堟慨濠冩そ瀹曨偊宕熼锟藉▍褎绻濆▓鍨灍闁瑰憡濞婇獮鍐箚瑜忛弳瀣⒑椤撱劑妾�点倖妞藉铏规崉閵娿儲鐎虹紓渚囧枟閻熲晠鎮伴鐣岀瘈闁搞儯鍔嶅▍銏ゆ⒑缂佹◤顏勵嚕椤掑喚妯勯梺鍝勬湰閻╊垱淇婇悜钘夘潊闁斥晛鍟拌ぐ锝囩磽閸屾瑦绁扮紒顔藉劤閳诲秹寮撮悩鍐插簥濠电娀娼уΛ宀勫几閺冨牊鐓曟い顓熷灥閺嬬喖鏌ｈ箛鎾缎ф慨濠冩そ楠炴劖鎯旈姀銏☆吇闂備浇娉曢崰搴ㄦ晸閻ｅ苯娅忔繛鍏煎姈缁绘稓鎷犺閻ｇ數锟借娲樼划宀勶綖濠靛牊宕夐柧蹇撴贡閺変粙姊绘笟锟藉褑澧濋梺鍝勬噳閺呯姴顕ｉ锕�骞㈡繛鎴炵懅閸橀亶姊洪崫鍕偍闁告柨鏈弲鑸靛鐎涙鍘卞┑顔筋殣閹峰嘲霉濠婂棙纭炬い顐㈢箰鐓ゆい蹇撳缁卞爼姊洪崨濠冨闁告挻鐟╁畷鎴濐吋婢跺鎷洪梺鍛婄☉閿曘儵鎮￠妷鈺傜厸闁割偒鍋勬晶瀵革拷娈垮枟閻擄繝骞婂鍫燁棃婵炴垵宕▓濂告⒑鐠囨彃顒㈢紒瀣浮閳ワ箓宕堕锟介崒銊╂煙閸撗呭笡闁抽攱鍨块弻銈嗘叏閹邦剨鎷烽弴銏犲嚑闁瑰瓨绻嶉悢鍡涙煟閻斿搫顣兼い銉у仱閺岋絽螖閿熶粙鏌婇敐鍜佹綎缂備焦顭囬悷褰掓煥閻旂粯顥夋い顓炴穿椤︽煡鎮￠妶澶嬬厪闁割偅绻冪粊顐︽煙瀹勬澘妲绘い顐ｇ箞椤㈡﹢鎮㈤崫鍕濠碉紕鍋戦崐鏍洪埡鍐濞撴熬鎷烽柕鍡曠椤繈鎳滈崹顐ｎ仧濠电偛顕慨鎾敄閸涙潙鍑犲〒姘炬嫹闁哄瞼鍠栭獮鍡氼檨闁搞倗鍠愰妵鍕煛閸愩劌骞嬮梺璇″枟椤ㄥ﹪寮幇顓熷劅婵犻潧鐗婇弲濂告⒒娴ｇ懓顕滅紒瀣崌瀹曚即寮借濞兼牗绻涘顔荤盎缂佺姵姘ㄩ幉鍛婃償閿濆洨鐒块柣搴秵閸犳鎮￠弴銏″�甸柨婵嗙凹缁ㄥ吋銇勯妷锝呯伈闁哄本娲熷畷鍗炍旀担鍛婎仭婵＄偑鍊ф俊鍥ㄦ櫠濡ゅ懎绠氶柡鍐ㄧ墕椤懘鏌ｅΟ铏癸紞闁跨喍绮欑粻鏍ь潖缂佹ɑ濯撮柧蹇曟嚀缁椻�愁渻閵堝啫濡奸柟铏耿楠炲啳顦圭�规洖宕埢搴ㄥ箣閻樺灚娈藉┑鐘愁問閸犳鈥﹂崼銉ユ槬闁哄稁鍘介崑鍌炴煟閺傚灝鎮戦柣鎾寸懇閺岀喖顢涢崱妤勫婵炲牆鐖煎娲偡閺夋寧姣愬┑鐐叉▕閸欏啫顕ｆ繝姘櫖闁告洦浜濋崟鍐煟閻樺弶澶勭憸鏉垮暣閿濈偤宕堕浣叉嫼闁荤姴娲犻敓鍊熸珪閻忎線姊虹粙鍖℃敾缂佽鍊块幃楣冩倻閽樺顔婇梺鐟扮摠濮婂綊锝炲鍛斀妞ゆ梻鐡斿▓鏃�淇婇锝嗏拻婵″弶鍔欓弫鎾绘晸閿燂拷?闂傚倸鍊搁崐鎼佸磹閹间礁纾归柟闂寸绾惧綊鏌熼梻瀵割槮缁炬儳缍婇弻鐔兼⒒鐎靛壊妲紒鐐劤缂嶅﹪寮婚敐澶婄闁挎繂鎲涢幘缁樼厱闁靛牆鎳庨顓㈡煛鐏炲墽娲存い銏℃礋閺佹劙宕卞▎妯恍氶梺鍝勵槴閺呮粎鎹㈤崼銉ヨ摕闁挎繂妫欓崕鐔搞亜閺嶃劎鐭岄弽锟犳⒒娴ｅ憡鎲稿┑顔炬暬閹冾煥閸涱厼鐏婃繝鐢靛У閸戝綊寮澶嬬厽闁归偊鍓﹂崵鐔兼煕濞嗗繑顥㈡慨濠呮缁辨帒螣閼姐値妲梻浣侯焾閿曘倕锕㈤柆宥嗘櫢闁兼亽鍎抽崯鏌ユ煙閸戙倖瀚�?
 * @author changhao
 *
 */
public class CRequestLearnParticleSkill extends __CRequestLearnParticleSkill__ {
	@Override
	protected void process() {
		// protocol handle
		
		final long roleid = gnet.link.Onlines.getInstance().findRoleid(this);
		if (roleid < 0)
			return;
		mkdb.Procedure requestlearnparticleskill = new mkdb.Procedure()
		{
			@Override
			protected boolean process()
			{
				Long battleid = xtable.Roleid2battleid.select(roleid);
				if (battleid != null)
				{
					MessageMgr.psendMsgNotify(roleid, 131451, null);	
					return true;						
				}
				int factionlevel = 0;
				
				Long factionid = xtable.Roleidclan.select(roleid);
				if (factionid != null)
				{
					xbean.ClanInfo clanInfo = xtable.Clans.select(factionid);
					if (clanInfo != null)
					{
						factionlevel = clanInfo.getClanlevel();						
					}
				}
				
				fire.pb.skill.SLifeSkill config = ConfigManager.getInstance().getConf(fire.pb.skill.SLifeSkill.class).get(id);
				
				if (config == null)
				{
					return true;						
				}
												
				SkillRole skillrole = new SkillRole(roleid);
				xbean.PracticeSkill practiceskill = skillrole.getPracticeSkill(id);
				if (practiceskill == null)
				{
					return true;
				}
				
				int curskilllevel = practiceskill.getLevel(); //闂傚倸鍊搁崐鎼佸磹閹间礁纾归柟闂寸绾惧綊鏌熼梻瀵割槮缁炬儳缍婇弻鐔兼⒒鐎靛壊妲紒鐐劤缂嶅﹪寮婚悢鍏尖拻閻庨潧澹婂Σ顔剧磼閻愵剙鍔ょ紓宥咃躬瀵鎮㈤崗灏栨嫽闁诲酣娼ф竟濠偽ｉ鍓х＜闁绘劦鍓欑粈鍐┿亜閺囧棗娲ら悡姗�鏌熸潏楣冩闁稿鍔欓弻娑樷枎韫囷絾效闂佽鍠楅悷褏妲愰幘瀛樺闁告繂瀚烽敓钘夌焸閺屾盯濡搁妷褍鐓熼悗娈垮枛椤攱淇婇幖浣哥厸闁稿本鐭花浠嬫⒒娴ｄ警鐒鹃柡鍫墰缁瑩骞嬮敂缁樻櫆闂佽法鍣﹂幏锟�?闂傚倸鍊搁崐鎼佸磹閹间礁纾归柟闂寸绾惧綊鏌熼梻瀵割槮缁炬儳婀遍敓鐣屾嚀鐎氼參宕崇壕瀣ㄤ汗闁圭儤鍨归崐鐐烘偡濠婂啰绠荤�殿喗濞婇弫鍐磼濞戞艾骞楅梻渚�娼х换鍫ュ春閸曨垱鍊块柛鎾楀懐锛滈梺褰掑亰閸欏骸鈻撳鍫熺厸鐎癸拷閿熶粙宕伴弽顓炶摕闁搞儺鍓氶弲婵嬫煥閻斿墎鐭欑�规洘绻堥獮鎺楀箻閸撲緡鍟庨柣搴ｆ嚀婢瑰﹪宕伴弴鐘哄С闁煎鍊楃壕濂告煟濞嗗繑鍣界紒澶樺櫍閺屸�崇暆鐎ｎ剙鍩岄柧浼欑秮閺屾稖绠涢幘铏�┑顕嗙到鐎氭澘顫忛搹鍦＜婵☆垵娅ｉ悷銊╂⒑閸涘﹨澹樻い鎴濇喘楠炴垿濮�閻橆偅顫嶉梺闈涚箳婵兘顢欓幒妤佺厽閹艰揪绲鹃弳鈺傘亜椤撶偟澧︾�殿喗濞婇弫鎾绘偐閺傘儲瀚奸梻渚�娼荤�靛矂宕㈡總绋垮偍闁圭虎鍠楅悡娑㈡煥閻斿墎鐭欓柡灞芥椤撳ジ宕ㄩ崒锔剧暤闁哄本鐩鎾Ω閵壯傚摋婵＄偑鍊ら崑鍕箠濮楋拷瀵顓兼径瀣檮婵犮垼娉涢鎰涢敓鐘斥拺婵懓娲ら敓鑺ユ尵濞嗐垹顫濋澶嬬稁闂佹儳绻楅～澶岋拷姘哺閺屽秹濡烽妸锔惧涧闂佽绻嬬欢姘潖濞差亜绠归柣鎰絻椤懎鈹戦埥鍡椾簻閻庢矮鍗抽獮鍐┿偅閸愨晛锟借崵绱掑☉姗嗗剱闁哄懏绻堝娲箰鎼淬垻鈹涢梺褰掝棑閸忔ê鐣烽鍕垫晬闁绘劗琛ラ幏娲⒒閸屾氨澧涢柣鈺婂灦閹澘顭ㄩ崨顖滐紲闁哄鐗勯崝宥囩矆閸愵亞纾奸柛灞炬皑鏁堥梺璇″枟閻熲晠骞冨鍏剧喖鏌ㄧ�ｎ亶浼滈梻鍌氬�烽懗鍫曗�﹂崼銉ュ珘妞ゆ帒瀚崑锟犳煏婵炵偓娅呯紒锟介崒婊愭嫹閻у憡瀚归梺璺ㄥ枔閺咁偄危閹版澘绠虫俊銈咃攻閺咁亪姊洪崨濠佺繁闁告鍋撶粋鎺楀箻椤旇В鎷洪梺闈╁瘜閸橀箖骞楅崒鐐寸厱閻庯綆浜烽煬顒侇殽閻愭彃鏆欓柣锝忕節閺屽洭鏁傞幆褍姹查梻鍌欑閹测�趁洪敃鍌氱婵炴垯鍨圭粈鍕煥閻斿搫校闁抽攱鍨块弻娑樷攽閸曨偄濮庨梺鍝勵儐閸ㄥ潡寮婚悢鐓庡窛濠电姴鍊甸弸娆撴⒑缂佹ü绶遍柛锝忕到閻ｅ嘲顫滈敓浠嬨�佸▎鎾村殟闁靛瀵屾禒褔姊婚崒娆掑厡缂侇噮鍨堕垾锕傚醇椤厾鍓ㄥ┑鐐叉閹稿寮查浣虹瘈濠电姴鍊绘晶娑㈡煃闁垮鐏╃紒杈ㄦ尰閹峰懏鎱ㄩ幋顓濈凹闁逛究鍔戝畷鍫曞Ω閿濆嫮鐩庨梻浣告惈濞层垽宕濈仦绛嬪殨妞ゆ梹鎷濋幏椋庢喆閸曨剛锛橀梺鎼炲姀濞咃絿鍒掔�ｎ喖绠抽柡鍐╂尰鐎氬綊鏌ㄥ┑鍡涱�楀ù婊勫姍閺岀喖鏌ㄧ�ｎ偁浠㈠┑顔硷工椤嘲鐣烽幒鎴僵闁告鍎愰弶绋库攽閻愬瓨灏扮痪鏉跨Ч閵嗗啯绻濋崶褏鐣洪梺缁樺姈閻ｎ亪宕戦崨瀛樼厱闁硅埇鍔嶅▍鍥煕濮楋拷娴滃爼寮婚悢鐓庣闁兼祴鏅滃▓顒勬⒑閸涘﹥鐓ユい鎴濐樀閻涱喗寰勯幇顓烇拷閿嬨亜閹存繂缍栫紒銊ヮ煼濮婃椽妫冨☉姘辩暰闂佸憡鎸荤换鍫ｆ＂闂佸壊鍋嗛崰鍡樼濠婂牊鐓忛煫鍥э工婢ц尙绱掗敓鐣岋拷锝庡枟閻撴稑霉閿濆浂鐒鹃柨鐔绘濞硷繝鐛崘顔肩鐟滃苯鈻介鍫熺參婵☆垯璀﹀Σ鐑樸亜閺冿拷閸ㄥ灝顫忔繝姘＜婵﹩鍓ㄩ幏鐑芥倻閼恒儱锟藉潡鏌ㄩ弴鐐诧拷鎼佸礄閻樻祴鏀介柛灞剧矤閻掗箖鏌ｉ妶鍥т壕缂佺粯鐩獮瀣枎韫囨洑鎮ｉ梻浣圭湽閸娿倝宕板Δ鍛﹂柛鏇ㄥ灠缁犳盯鏌涢锝嗙妞ゅ骸绉瑰铏圭矙閸栤�充紣闂佺粯鐗曢妶绋款嚕鐠囧樊鍚嬪璺猴梗缁卞爼姊洪崨濠冨闁告挻鐟ラ埢宥夊Χ婢跺鎷虹紓鍌欑劍钃遍悘蹇曟暬閺屾盯鎮╁畷鍥р拰閻庢鍠栭…宄邦嚕閹绢喗鍋勫瀣捣閻涱喗绻濈喊妯活潑闁搞劑娼ч埢宥夋晲閸℃瑯娴勫銈嗘尪閸ㄦ椽鎮￠悢鐓庣婵烇綆鍓欓悘顕�鏌涢悢鍝ュ弨闁哄瞼鍠栧畷娆撳Χ閸℃浼�? by changhao
				
				if (curskilllevel >= config.skillLevelMax) //闂傚倸鍊搁崐鎼佸磹閹间礁纾归柟闂寸绾惧綊鏌熼梻瀵割槮缁炬儳缍婇弻鐔兼⒒鐎靛壊妲紒鎯у⒔閹虫捇鈥旈崘顏庢嫹閿濆簼绨奸柟鐧哥秮閺岋綁顢橀悙鎼闂侀潧妫欑敮鎺楋綖濠靛鍊锋い鎺炴嫹妞ゅ繗鍩栨穱濠囧Χ閸ヮ灝銉╂煕鐎ｎ剙浠遍柟顔ㄥ洦鍋愭慨鐟版祫閹烽攱绗熼敓钘夘嚕閹绢喖顫呴柣妯荤垹閸モ晛褰勯梺鎼炲劘閸斿秹鎮￠妷锔轰簻闊洦纰嶇涵楣冩煃鐟欏嫬鐏存い銏＄懇閹矂顢曢锛勭泿闂佷紮绲块崗姗�銆佸Δ鍛妞ゆ劑鍨规禍鍫曟⒑鐠囧弶鎹ｉ柡浣筋嚙椤洦绻濆顒傤唵婵＄偛顑呯�涒晠宕伴崱娑欑厱闁哄洢鍔屾晶鐗堛亜閿旇鏋涙い顏勫暣婵¤埖鎯旈垾鑼泿婵＄偑鍊х粻鎾寸閸洖鏋侀柟鎯ь嚟椤╃兘鎮楅敐搴′簼闂佹鍙冨娲濞戞艾鈪卞銈庡幖閻楁捇銆佸鑸垫櫜濠㈣泛锕崬鍫曟⒑閸濆嫭宸濋柛瀣枛椤㈡ê煤椤忓應鎷虹紓鍌欑劍閳笺倝顢旈崼鐔凤拷鑸垫叏濮楀棗鍔柟鐑樻尰閸庣喖鏌曡箛瀣伄闁伙箑鐗撳鍝勑ч崶褏浼堝┑鐐板尃閸曨収娴勯梺鍐叉惈閹冲繘鎮″▎鎰闁煎ジ顤傞崬铏圭磼閵娧勬珪闁跨喕妫勯悘姘熆濮楋拷閺佸啴顢旈崼婵堢枃闂佺粯鍔曢幖顐㈡暜闁荤喐绮岀换妤呭Φ閹扮増鍊锋い鎺戝�婚惁鍫ユ⒑濮瑰洤鐏叉繛浣冲啰鎽ュ┑鐘垫暩閸嬫盯鎯囨导鏉戠９婵犻潧顑呯粻鏍煕瑜庨〃蹇涘极鐎ｎ喗鐓ラ柣鏂垮閻瑧锟芥鍠涢褔鍩ユ径濞㈢喖鏌ㄧ�ｅ灚缍屽┑鐘殿暯濡插懘宕规导鏉戣Е閻庯綆鍠栫粻鐔封攽閸屾碍鍟為柍閿嬪灩缁辨挻鎷呴懖鈩冨灩娴滄悂妫冨☉鎺撴杸濡炪倖姊归崕鎶藉储閹绢喗鐓欐い鏍ュ�栫�氳淇婇悙顏勶拷鏇犳崲閹扮増鍋嬮柛鈩冪懅濡垳鎲搁弮鍫濊摕婵炴垟鎳囬敓鏂ょ畵楠炲鈹戦崶鈺�绮氶梻鍌欒兌绾爼寮插┑瀣；闁绘劕鐏氬畷鍙夌節闂堟侗鍎忛柣鎾存礋閺屻劑鎮㈤崜浣虹厯閻庤娲樼敮鎺楋綖濠靛鏁嗛柛灞久禒蹇涙⒒閸屾艾锟介绮堟笟锟介獮鏍敃閿旇棄鍓规繝銏ｆ硾閻偐绮堟繝鍋綊鏁愭径娑欏婵炴垶姘ㄩ悾楣冩⒒娴ｈ櫣甯涢柛銊у帶铻為柛鏇ㄥ亝閺嗘粓姊婚崒娆戝妽閻庣瑳鍏犳椽鍩￠崨顓狀唵闂備礁鐏濋鍥╃不妤ｅ啯鐓曟い鎰╁�曞▍蹇旂箾閸喓鐭掗柡宀�鍠栭、娆戠驳鐎ｎ偆鏆ラ梻浣哥－缁垶骞戦崶褏鏆︾憸鐗堝俯閺佸﹪鏌ｉ敐鍛殭闂侇収鍨跺濠氬磼濞嗘帒鍘＄紓渚囧櫘閸ㄥ爼骞冭椤劑宕煎┑鍡椾憾闁荤喐绮嶅Λ鍐嵁閸愨斂鍋呴柛鎰ㄦ櫇閸欏棝鏌ｆ惔顖滅У闁告挾鍠庨‖濠囶敋閿熻棄顫忓ú顏勫窛濠电姴瀚уΣ鍫ユ⒑閹稿孩纾搁柛濠冪墱缁顓奸崪浣哄弳闂佸壊鍋嗛崰搴ㄦ晸閻ｅ本鏆柡宀嬬秮閹垽宕ㄦ繝鍕殥婵＄偑鍊曞ù姘濠靛牊宕叉繝闈涱儏椤懘鏌嶉挊澶嬵棤闁告梻顭堥—鍐Χ韫囨洖顕辩紓渚囧枟閻熴儵锝炶箛鏃傜瘈婵﹩鍓涢敍婊冣攽椤旀枻渚涢柛鎾卞姂楠炲繘鎮滈懞銉ワ拷濠氭煠閹帒鍔氭繛鍫熷灴濮婃椽宕ㄦ繝鍐ㄧ煯闂佺粯甯粻鎾崇暦濡わ拷椤劑宕奸悢鍝勫箞婵＄偑鍊栭崝褏寰婇崜褏鐭嗛柨鐔剁矙濮婂搫效閸パ嶆嫹濡ゅ懎纾婚柟鎹愬煐瀹曞弶绻涢幋娆忕仼缂佺媴绲剧换娑㈠幢濡ゅ啰顔婃繛瀵稿█缁犳牕顫忛搹鍦煓闁割煈鍣崝澶婎渻閵堝啫濡奸柨鏇ㄤ簻椤曪絿鎷犲ù瀣潔濠殿喗锕╅崑鍛村礋閸愵喗鈷戦悹鍥ｏ拷宕囷拷濠氭煕閹般劍娅囨俊鍙夘殜濮婂宕掑▎鎴濆闂佽鍠栭悥鐓庣暦閹版澘鍐�妞ゎ兘鍓濆浠嬪箖閵忋倖鍋傞幖娣�栭幉浼存⒒娓氾拷濞佳嗗闂佸搫鎳忕划鎾崇暦閹达箑骞㈡繛鎴炵懅閸橀亶鏌ｈ箛鏇炰粶濠⒀傜矙閸┿儲寰勭�ｃ劋绨婚棅顐㈡储閸庤尙锟芥熬鎷�?濠电姷鏁告慨鐑藉极閸涘﹥鍙忛柣鎴ｆ閺嬩線鏌涘☉姗堟敾闁告瑥绻橀弻锝夊箣閿濆棭妫勯梺鍝勵儎缁舵岸寮诲☉妯锋婵鐗婇弫楣冩⒑閸涘﹦鎳冪紒缁樺姍濠�渚�姊虹粙璺ㄧ闁告艾顑囩槐鐐哄箣閿旂晫鍘遍梺闈涱焾閸庨亶鏁撻挊澶樼吋妤犵偛顦甸獮鏍ㄦ媴閻熼缃曢梻浣稿閸嬪懐鎹㈤崟顖涘仭闁哄被鍎查埛鎴犵磼鐎ｎ偒鍎ラ柛搴＄箲閵囧嫰鏁傞悙顒佹瘓閻庢鍠栭…宄邦嚕閹绢喗鏅柛鏇ㄥ幗濠㈡垿姊虹拠鎻掑毐缂傚秴妫欑粋宥夋倻閽樺顔嗛梺缁樺灱濡嫰宕￠幎鑺ョ厽闁瑰瓨绻冮ˉ婊堟煛閸涱垰孝闁宠鍨块幃鈺冪磼濡鏁繝鐢靛仜閻即宕归搹鍦焿鐎广儱鎷嬮悡銉╂煕椤愩倕鏋旈柛妯绘倐閹鐛崹顔煎闂佸摜鍣ラ崑鍛┍婵犲洤閿ゆ俊銈勮兌閸樻捇姊洪崨濠勬噣闁稿骸纾划锝夊籍閸喓鍘搁柣蹇曞仜婢т粙鍩︽笟锟介弻鐔碱敍濞戞瑯妫冨銈冨灪閻熲晠骞婇弽顓炵厸闁跨喍绮欏畷鐘诲冀椤愩倗锛濋梺绋挎湰閻燂妇绮婇弶娆炬富閻庢稒蓱閸婃劖顨ラ悙鏉戠伌鐎规洘鍎奸ˇ鎾煛閸☆厾鐣甸柡宀�鍠栭幃婊兾熼搹閫涙喚闂備礁鎼鍛存煀閿濆钃熼柣鏃傚皑閹风兘鎮藉▓璺ㄥ姼闁哥喐鎮傚铏规兜閸涱噮妫勯梺娲诲幖閸婃悂锝炶箛鏇犵＜婵☆垵顕ч鎾绘⒑缂佹ê鐏﹂柨姘箾閸繄鐒告慨濠冩そ楠炴牠鎮欑拠褎瀚归柡宥庡幗閸嬪鏌ｅΟ鍨惞鐎规挷绶氶悡顐﹀炊閵娧�妾ㄩ梺鍝勬噺閹倿寮婚妸鈺傚亞闁稿本绋戦锟�? by changhao
				{
					MessageMgr.psendMsgNotify(roleid, 160107, null);	
					return true;						
				}
				
				xbean.Properties roleproperty = xtable.Properties.select(roleid);
				
				xbean.Properties prop = xtable.Properties.select(roleid);
				xbean.RoleClanPoint contribution = xtable.Roleclanpoint.select(roleid);
				
				
			
				int rolelevel = prop.getLevel();
				int contri = 0;
				if (contribution != null)
				{
					contri = contribution.getHistoryclanpoint();
				}

				//闂傚倸鍊搁崐鎼佸磹閹间礁纾归柟闂寸绾惧湱锟界懓瀚崳纾嬨亹閹烘垹鍊炲銈嗗笒椤︿即寮查鍫熷仭婵犲﹤鍟版晥濠电媴鎷峰〒姘炬嫹婵﹨娅ｇ槐鎺懳熼搹閫涚礃婵犵妲呴崑鍕拷姘緲椤曪綁宕ㄦ繝鍕嚌闂佽法鍠嶇划娆忣嚕鐠囨祴妲堟俊顖炴敱椤秴鈹戦绛嬫當闁绘锕顐﹀箚瑜夐弨浠嬫煟閹邦剙绾ч柛锝堟閳规垿顢欓懖鈺�绮电紓浣哥焷妞村摜鎹㈠┑瀣倞妞ゎ剦鍎搁崶銊у幈濠电偞鍨靛畷顒勫几濞戞瑧绠鹃柛婊冨暟缁★拷濠殿喖锕ㄥ▍锝夊箲閸曨垰惟闁靛濡囨禍鐐寸節绾版ɑ顫婇柛瀣閿熻姤纰嶅姗�鎮鹃悜绛嬫晬闁绘劘灏欐鍥⒑閻熼偊鍤熷┑顕�娼ч埢鎾淬偅閸愨斁鎷洪梻鍌氱墛閸楁洟宕奸妷銉ф煣濠电偞鍨跺銊ノ涢婊勫枑闁哄啫鐗嗛拑鐔兼煟閺冨倸鐨戦柟椋庡厴閹棄鈻撶捄銊ュЪ濠电偛顕刊瀛樹繆閸ヮ剙绠栨い鏇嫹闁轰焦鍔栧鍕拷锛卞嫬顏归梻浣藉吹婵潙煤閵堝拋鍤曢柛顐ｆ礀缁犳煡鏌ㄥ┑鍡橆棤缂佺娀绠栭弻娑樷槈閸楃偘绨婚梺璇茬箰瀵爼銆冮妷鈺傚�烽柤纰卞墰椤旀帡姊虹拠鈥虫灍缂侇喗鎹囬獮濠囨倷閸濆嫀銊ф喐瀹ュ宓侀柛顐犲劜閳锋帒霉閿濆懏鍟為柟顖氱墛缁绘稓浠﹂崒姘变紙閻庤娲樼换鍕閿曞倹鍊锋い鎺嶈兌瑜版寧淇婇悙顏勶拷鏍ь潖婵犳艾鐤炬い鎰╁�楁稉宥呂旈敐鍛殲闁绘挻娲橀妵鍕箛閳轰緤鎷烽弴銏犲嚑閹兼番鍔嶉悡鐔肩叓閸ャ劍灏甸柟鐣屽█閺岀喐绗熼崹顔碱瀴缂備胶绮换鍫濈暦濮楋拷閸╃偞寰勫灞绢�楅梻鍌氬�烽懗鍫曞箠閹捐泛顥氭い鎾卞灩绾惧鏌曢崼婵囶棛缂佽妫濋弻锝夊箣閿濆棭妫勭紓渚婃嫹闁告劦鍠楅悡鏇熺箾閸℃孝闁告棑绠撻弻娑氾拷锝庡亽濞堟粓鏌″畝瀣暠閾伙綁鏌ゆ慨鎰拷妤呮偩閻㈠憡鈷掗柛銉戝本鈻堥梺鍝勭焿缁插�熺亽闂佺粯鍨惰彜闁哄鐟╁铏圭矙閸ф锟芥绱掔紒妯虹婵″弶鍔欓獮鎺懳旀担瑙勵仧闂備礁鍚嬫禍浠嬪磿鏉堚晜顐介柣鎰劋閻撴瑩姊洪銊х暠妤犵偞锕㈤弻娑樜熼崫鍕煘闂佸疇顫夐崹鍧楀箖濞嗘挸绾ч柟瀵稿С濡楁挻淇婇悙顏勶拷銈夊储閻撳篃娲敇閵忋垹绁﹀┑掳鍊曢幊蹇涘磻閹邦喚纾藉ù锝堫嚃閻掍粙鏌涘Ο鍦煓婵﹨娅ｉ幉鎾礋椤愩値妲版繝鐢靛仜椤︿即鎯勯姘煎殨缂佸绨卞Σ鍫ユ煏韫囥儳纾块柛妯绘倐閺岋綀绠涢弴鐐版埛闂佺顑嗛幐鍓у垝閸儱绀冩い蹇撴閿涙粎绱撻崒娆戝妽妞ゎ厼娲ょ叅閻庣敻娼婚幏椋庢喆閸曨剛顦ョ紓鍌氱Т閿曨亪濡存担绯曟瀻闁圭偓娼欐禍妤呮煙閸忓吋鍎楅柛鐘愁殘缁辩偤骞樼�靛摜鐦堢紒鐐緲椤﹁京澹曢崸妤佺厱閻庯綆鍋勯悘瀵革拷瑙勬礃閸旀瑥顕ｉ幘顔藉�堕柤濮愬�栭崵锟藉銈庡亝缁诲牓銆佸锟介幃顏堟晸閽樺铏圭矙鎼存挻鏂�闂佺粯顭囩划顖氣槈瑜旈弻锝呂旈敓浠嬫晝閵堝鍋╅柣鎴ｆ閻顭跨捄铏圭伇妞ゆ梹娲熷娲偡閹殿喗鎲奸梺鑽ゅ枂閸庣敻骞冨锟介崺锟犲礃椤忓棴绱查梻浣虹帛閿氭俊顖氾躬閹剝绺介崨濠勫幐閻庣櫢鎷烽悗锝庡墰琚﹂梻浣筋嚃閸犳捇宕归懡銈呭灊婵炲棗绻嗛弸搴ㄦ煟閹伴潧澧绘俊顐㈡濮婂宕掑▎鎴М闂佺顕滅换婵嬪极閸愵喖鐓涢柛娑卞幘閿涙稒绻濋悽闈浶㈡繛灞傚�楃划濠氬冀閵娿倗绠氶梺闈涚墕閹冲繘宕宠ぐ鎺撶厱闁靛鍎遍敓钘夌秺婵＄敻宕熼姘辩杸闂佸憡鎸烽悞锕傚磻瑜斿娲川婵犲倻鍘愮紓浣虹帛缁诲牆顕ｆ繝姘櫜闁糕剝锚閸斿懘姊洪棃娑氱濠殿喗娼欒闁割偁鍎查埛鎴︽煙閼测晛浠滃┑鈥茬矙閺屾稒鎯旈敐鍛粯闁捐崵鍋ら弻锝夊棘閸喗鍊梺鎶芥敱閸ㄥ潡寮诲☉銏℃櫆閻犲洦褰冪紒鈺佲攽閿涘嫬浜鹃柟顔煎�垮璇测槈閵忊�充汗闂佸綊顣﹂悞锕傛偪娓氾拷濮婅櫣鎷犻垾铏彲缂備胶绮换鍫ョ嵁閸愵喖顫呴柕鍫濇噽椤ρ囨⒑閸忚偐銈撮柡鍛〒閺侇喖螖閸涱喒鎷绘繛杈剧到閹芥粓寮搁崘鈺�绻嗘俊鐐靛帶婵¤法绱掗鑲╁缂佹鍠栭弫鎾绘寠婢舵ê娈ㄩ梺鍛婂姈缁佹挳寮告惔銊︾厵闁诡垎灞芥闂佸憡眉缁瑥螞閸涙惌鏁冮柕蹇婂墲閹瑩姊洪幐搴㈢８闁稿酣浜堕崺銏狀吋閸℃瑧鐦堥梺鎼炲劘閸斿酣宕㈤幖浣瑰�甸柣褍鎲＄�氬綊鏌ｆ惔顖滅У闁告挻绋栭埅鍨節閻㈤潧啸妞わ綆鍠氬Σ鎰板即閵忕姷顦у┑顔筋殣閹风兘鏌曢崱鏇狀槮闁宠棄顦灒闂佸灝顑愬鏃�绻濆▓鍨灍妞ゃ劌鎳庤灋闁哄啫鍊归～鏇㈡煥閻曞倹瀚�? by changhao
				int maxlevel = 0;
						
				java.util.Map<Integer, Integer> ret = LiveSkillManager.getInstance().GetPracticeSkillMaxLevel(rolelevel, factionlevel, contri, config.skillLevelMax);
				if (ret.size() == 0)
				{
					return false;
				}
				
				java.util.Iterator<java.util.Map.Entry<Integer, Integer>> it = ret.entrySet().iterator();
				java.util.Map.Entry<Integer, Integer> entry = it.next();
				maxlevel = entry.getValue();
								
				if (curskilllevel >= maxlevel)
				{
					int msgid = 160106;
					if (entry.getKey() == 1)
					{
						msgid = 160487;
					}
					else if (entry.getKey() == 2)
					{
						msgid = 160488;
					}
					else if (entry.getKey() == 3)
					{
						msgid = 160489;
					}
					
					MessageMgr.psendMsgNotify(roleid, msgid, null);	
					return true;
				}
				
				if (config.needGuild == 1 && roleproperty.getClankey() <= 0) //闂傚倸鍊搁崐鎼佸磹閹间礁纾归柟闂寸绾惧綊鏌熼梻瀵割槮缁炬儳缍婇弻鐔兼⒒鐎靛壊妲紒鎯у⒔閹虫捇鈥旈崘顏庢嫹閿濆簼绨奸柟鐧哥秮閺岋綁顢橀悙鎼闂侀潧妫欑敮鎺楋綖濠靛鍊锋い鎺炴嫹妞ゅ繗鍩栨穱濠囧Χ閸ヮ灝銉╂煕鐎ｎ剙浠遍柟顔ㄥ洦鍋愭慨鐟版祫閹烽攱绗熼敓钘夘嚕閹绢喖顫呴柣妯荤垹閸モ晛褰勯梺鎼炲劘閸斿秹鎮￠妷锔轰簻闊洦纰嶇涵楣冩煃鐟欏嫬鐏存い銏＄懇閹矂顢曢锛勭泿闂佷紮绲块崗姗�銆佸Δ鍛妞ゆ劑鍨规禍鍫曟⒑鐠囧弶鎹ｉ柡浣筋嚙椤洦绻濆顒傤唵婵＄偛顑呯�涒晠宕伴崱娑欑厱闁哄洢鍔屾晶鐗堛亜閿旇鏋涙い顏勫暣婵¤埖鎯旈垾鑼泿婵＄偑鍊х粻鎾寸閸洖鏋侀柟鎯ь嚟椤╃兘鎮楅敐搴′簼闂佹鍙冨娲濞戞艾鈪卞銈庡幖閻楁捇銆佸鑸垫櫜濠㈣泛锕崬鍫曟⒑閸濆嫭宸濋柛瀣枛椤㈡ê煤椤忓應鎷虹紓鍌欑劍閳笺倝顢旈崼鐔凤拷鑸垫叏濮楀棗鍔柟鐑樻尰閸庣喖鏌曡箛瀣伄闁伙箑鐗撳鍝勑ч崶褏浼堝┑鐐板尃閸曨収娴勯梺鎸庢礀閸婂綊鎮″▎鎴犵＜閻庯綆鍋掗崕銉╂煟閹剧偨鍋㈤柡宀�鍠栭、娆撳传閸曨厺绱欐俊鐐�戦崹娲�冩繝鍌滄殾闁绘梻鈷堥弫鍐煏閸繈顎楅柡浣规倐濮婂宕掑顒婃嫹妞嬪海鐭嗗〒姘炬嫹闁诡喗锚閳规垹锟斤絽鐏氶弲鐐烘⒑閸涘﹥澶勯柛妯挎閻ｇ兘寮婚妷锔惧幈闂佹枼鏅涢崣鍥ь煥閸曨収娲稿┑鐘诧工閻楀﹪鎮″▎寰濆綊鎮℃惔锝嗘喖濠电偞鍤崘鍓у數閻熸粍绮撳畷褰掑醇閺囩偟鐣哄┑掳鍊ч幏閿嬨亜椤愶絿绠為柟顔界懇椤㈡鏁撴禒瀣垫晜闁跨噦鎷�?闂傚倸鍊搁崐鎼佸磹閹间礁纾归柟闂寸绾惧綊鏌熼梻瀵割槮缁炬儳婀遍敓鐣屾嚀鐎氼參宕崇壕瀣ㄤ汗闁圭儤鍨归崐鐐烘偡濠婂啰绠荤�殿喗濞婇弫鍐磼濞戞艾骞楅梻渚�娼х换鍫ュ春閸曨垱鍊块柛鎾楀懐锛滈梺褰掑亰閸欏骸鈻撳鍫熺厸鐎癸拷閿熶粙宕伴弽顓炶摕闁搞儺鍓氶弲婵嬫煥閻斿墎鐭欑�规洘绻堥獮鎺楀箻閸撲緡鍟庨柣搴ｆ嚀婢瑰﹪宕伴弴鐘哄С闁煎鍊楃壕濂告煟濞嗗繑鍣界紒澶樺櫍閺屸�崇暆鐎ｎ剙鍩岄柧浼欑秮閺屾稖绠涢幘铏�┑顕嗙到鐎氭澘顫忛搹鍦＜婵☆垵娅ｉ悷銊╂⒑閸涘﹨澹樻い鎴濇喘楠炴垿濮�閻橆偅顫嶉梺闈涚箳婵兘顢欓幒妤佺厽閹艰揪绲鹃弳鈺傘亜椤撶偟澧︾�殿喗濞婇弫鎾绘偐閺傘儲瀚奸梻渚�娼荤�靛矂宕㈡總绋垮偍閻庢稒菧娴滄粓鏌曟径娑㈡鐎规洖鐭傞弻鈩冩媴鐟欏嫬纾抽悗瑙勬礃閸旀瑩骞冮妶鍡樺闁革富鍘惧暩婵犵數濮烽弫鎼佸磻閻愮數鐭堥柟缁㈠枛閻ょ偓绻濋棃娑氬妞ゎ偅娲熼弻锝夊箛椤掑倹鎲兼繝娈垮灡閹告娊寮诲☉銏犵闁哄鍨圭粊宄扳攽閻愯尙澧戦柛鏃�鍨甸～蹇撁洪鍕祶濡炪倖鎸撮崜婵嬵敁濡ゅ懏鈷戦柛婵勫劚鏍″銈冨妼閿曘倝鎮鹃悜钘夌闁挎洩鎷风紒锟界�ｎ偁浜滈柟閭﹀枛閺嬫垿鏌￠崒锔藉闂傚倸鍊烽懗鍫曗�﹂崼銉ュ珘妞ゆ帒瀚粈鍕煟閻旂鐝楅柨婵嗩槸瀹告繂鈹戦悩鎻掝伀妞ゆ梹娲熷娲礈閹绘帊鑸梺鍛婃尰濮樸劑鏁撻懞銉у暡闁瑰嚖鎷�? by changhao
				{
					return true;	
				}
				
				int addexp = 0;
				
				Pack bag = (Pack)fire.pb.item.Module.getInstance().getItemMaps(
						roleid, fire.pb.item.BagTypes.BAG, false);
											
				int which = LiveSkillManager.getInstance().GetPracticleSkillPlayerOrPet(id); //闂傚倸鍊搁崐鎼佸磹閹间礁纾归柟闂寸绾惧湱锟界懓瀚崳纾嬨亹閹烘垹鍊炲銈嗗笒椤︿即寮查鍫熷仭婵犲﹤鍟版晥濠电媴鎷峰〒姘炬嫹婵﹨娅ｇ槐鎺懳熼搹閫涚礃婵犵妲呴崑鍕拷姘緲椤曪綁宕ㄦ繝鍕嚌闂佽法鍠嶇划娆忣嚕鐠囨祴妲堟俊顖炴敱椤秴鈹戦绛嬫當闁绘锕顐﹀箚瑜夐弨浠嬫煟閹邦剙绾ч柛锝堟閳规垿顢欓懖鈺�绮电紓浣哥焷妞村摜鎹㈠┑瀣倞妞ゎ剦鍎搁崶銊у幈濠电偞鍨靛畷顒勫几濞戞瑧绠鹃柛婊冨暟缁★拷濠殿喖锕ㄥ▍锝夊箲閸曨垰惟闁靛濡囨禍鐐寸節绾版ɑ顫婇柛瀣閿熻姤纰嶅姗�鎮鹃悜绛嬫晬闁绘劘灏欐鍥⒑閻熼偊鍤熷┑顕�娼ч埢鎾淬偅閸愨斁鎷洪梻鍌氱墛閸楁洟宕奸妷銉ф煣濠电偞鍨跺銊ノ涢婊勫枑闁哄啫鐗嗛拑鐔兼煟閺冨倸鐨戦柟椋庡厴閹棄鈻撶捄銊ュЪ濠电偛顕刊瀛樹繆閸ヮ剙绠栨い鏇嫹闁轰焦鍔栧鍕拷锛卞嫬顏烘繝鐢靛仩閹活亞寰婇崸妤佸仱闁哄啫鐗嗛崥瑙勭箾閸℃ê鐏╃痪鎹愬亹缁辨挻鎷呮慨鎴簻闇夋い鏃�鎷濋幏椋庢喆閸曨剛顦ㄩ梺鎼炲妼濞硷繝鐛崘顔碱潊闁靛牆妫楁禍妤呮煙閼圭増褰х紓宥呮川濡叉劙鏌嗗鍡忔嫽婵炶揪绲块悺鏂款焽閹扮増鐓曢幖娣灩閳绘洘銇勯姀鈥冲摵妞ゃ垺锕㈤崺锟芥い鎺戯攻鐎氬綊鏌涘☉娆愮稇闁藉啰鍠栭弻鏇熷緞濞戞﹩娲梺鍛婏供娴滎亜顫忓ú顏勭闁圭粯甯婄花鑲╃磽娴ｇ瓔鍤欓柛鐔侯棎濡垽姊虹紒姗嗙劷闁轰礁鎽滄竟鏇熺附閸涘﹦鍘藉┑鈽嗗灠閻忔繈宕ヨぐ鎺撶厽闁挎繂妫欓妵婵嬫煛瀹�瀣？濞寸媴绠撳畷婊嗩槼闁告帗鐩铏瑰寲閺囩喐鐝旈柣搴㈢濠㈡﹢鎮惧畡閭︽建闁跨喍绮欓獮鍐ㄢ枎閹垮啯鏅㈤梺绋挎湰缁嬫帞娆㈤鍕拻闁稿本鑹鹃敓浠嬵棑缁牊绗熼敓浠嬬嵁婢舵劖鏅搁柣妯哄暱娴狀參姊洪棃娑崇础鐎广儱妫楅璺衡攽椤旀枻渚涢柛瀣閻ｇ敻宕卞▎娆愬婵炲牆鐏濋弸锔姐亜閺囧棗娲ら悡鈥愁熆閼搁潧濮囨い顐㈡嚇閺岋絽螣閼姐倕鐏╅梺鎼炲劘閸斿酣宕㈤崡鐐╂斀闁绘ê妯婇悡顓㈡煙閻戠瓔妫戠紒杈ㄥ浮閺佹捇鎳為妷褏鎳濋梺璺ㄥ枙濡嫰鎮惧畡閭︾叆闁告洦鍋掗崵銈夋煟鎼淬垻鈾佹い顓炴喘瀹曘垺銈ｉ崘鈹炬嫼闂侀潻瀵岄崣搴ㄦ倿閹灛鏃堟偐閸欏鏆堥梺閫涚┒閸斿矂顢橀崗鐓庣窞閻庯綆鍓欓獮鎰版⒑鐠囪尙绠抽柛瀣♁閺呭爼鎸婃竟婵囨そ瀵爼骞嬮弮锟介弬锟介梻浣瑰缁嬫垹锟芥凹鍓熷畷銏ゅ级閹存梹鏂�闂佹枼鏅涢崯顖炲磹閹扮増鐓涘ù锝囶焾閿熻棄婀辩划姘舵焼瀹ュ懐鐤呴柣搴秵閸嬪嫰顢旈崼鏇熲拺閻熸瑥瀚ˉ瀣熆瑜庨〃濠囧春濞戙垹绠ｉ柨鏃傛櫕閸樺崬鈹戦悩缁樻锭婵☆偅顨婇、鏃堝箻椤旂晫鍘遍柟鑹版彧缁辨洘鏅ラ梻浣告惈閺堫剛绮欓幒鏃�宕叉繝闈涱儏缁�鍐┿亜韫囨挻顥犻柡澶夌矙閺岋絾鎯旈姀鈺佹櫛闂佸摜濮甸惄顖炪�佸鎰佹▌闂佺硶鏂傞崕鎻掝嚗閸曨剛绡�閹兼番鍨归崗濠囨⒒娴ｈ櫣甯涢柛鏃撶畵瀹曟粌鈻庨幙鍐╂櫆闂佸壊鍋呭ú姗�鍩涢幋锔界厵缂佸瀵ч幑锝囩磼閻樿櫕灏板ǎ鍥э躬椤㈡洟鏁愰崶銊ユ珰闂備浇顕栭崳顖滄崲濠靛洣绻嗛柣鎴ｅГ閺呮粓鏌涢幘妤�鑻弲顓㈡⒒娴ｇ瓔鍤欑紒缁樺浮瀹曟垵鈽夐姀鐘碉紮闂佸綊妫块悞锕傚疾閹间焦鐓犻柟顓熷笒閸斿瓨绻涢崼鐕傝�块柡灞剧洴楠炴帡骞樺畷鍥╂嚃缂傚倷鑳剁划顖滄崲閸岀儑缍栨繝闈涱儛閺佸洭鏌ｉ弬鍨棌濞寸姍鍥ㄢ拻闁稿本鐟︾粊鐗堢箾婢跺绀嬬�规洘濞婇弫鍐磼濮橀硸鍞甸梻浣芥硶閸ｏ箓骞忛敓锟�?闂傚倸鍊搁崐鎼佸磹閹间礁纾归柟闂寸绾惧綊鏌熼梻瀵割槮缁炬儳缍婇弻鐔兼⒒鐎靛壊妲紒鐐劤缂嶅﹪寮婚敐澶婄闁挎繂鎲涢幘缁樼厱闁靛牆鎳庨顓㈡煛鐏炲墽娲存い銏℃礋閺佹劙宕卞▎妯恍氶梻鍌欒兌椤牏鎮锕�绀夐幖娣妼缁犵喖鏌熼梻瀵割槮缂侇偄绉归弻娑㈩敃閿濆洨鐣奸梺浼欑稻濡炶棄顫忛搹鍦煋闁糕剝顨呴瀛樼箾閸喐顥堥柡宀嬬秮楠炲洭顢楁繝鍐╂毎闂備線娼уú銈囷拷姘嵆閵嗕礁螖娴ｅ摜绐炴繝鐢靛Т閸嬪棗顭囨禒瀣拻濞达絽鎼崝锕傛煛閸涱亝娅婄�规洝顫夌�佃偐锟芥稒锚娴犲ジ姊虹紒妯虹伇濠殿喓鍊濆畷鎴﹀礋椤撶姵锛忛梺鐟板槻閻倿宕ú顏呯厸闁告粈绀佹晶瀛樻叏婵犲啯銇濇鐐村姈閹棃鏁愰崶鈺傛濠电姷顣藉Σ鍛村磻閸涘瓨鍋￠柕澶嗘櫅閻撴繄锟藉箍鍎遍ˇ顖滅尵瀹ュ鐓ラ柣鏃囶嚙琚氱紓浣哥焷妞村摜鎹㈠┑瀣倞闁靛鍎婚幏鐑芥煥鐎ｃ劋绨婚棅顐㈡处閹告悂顢旈悽鍛婄厵濡炲楠搁崢瀵革拷娈垮枙缁瑩鍨鹃弽顓ф晢濞达綀銆�濡俱劑姊洪悷鏉挎Щ闁硅櫕鍔欓獮澶愬箻椤旇偐顦板銈嗗姦濠拷缂佽京鍠栧濠氬磼濞嗘垹鐛㈠┑鐐板尃閸ャ劌浜遍梺绯曞墲閾斿宕堕澶嬫櫖濠电姴锕ら崰姘涘鍫熲拺缂佸妫楃�氬嘲鈻撻弴銏＄厽闁规崘娉涢弸娑㈡煛瀹�瀣瘈鐎规洘甯掗～婵嬪矗濡寧顎楅梻鍌欐祰椤曟牠宕板Δ鍛瀭闁秆勵殔閽冪喖鏌ㄥ┑鍡╂Ц缂佺姴顭烽幃妤呮濞戞瑥鏆堥梺鍛婂笚閻╊垰顫忓ú顏勪紶闁告洦鍓氶幏閬嶆⒑閻戔晜娅撻柛銊ョ埣閹即顢氶敓钘夌暦閸洦鏁嗛柨鐔剁矙閹�斥槈濡繐缍婇弫鎰板川椤撗勵棏闂備浇顕х�涒晜绻涙繝鍌ゆ綎缂備焦蓱婵挳鏌ら幁鎺戝姢闁靛棗锕娲传閵夈儛锝嗙箾閸欏澧抽柣蹇擃儔濮婃椽宕ㄦ繝鍐槱闂佸憡锚婢х晫鍒掗崼鐔虹瘈闁稿本顨嗛弬锟介梻浣虹帛閿氱�殿喖鐖奸獮鏍箛椤斿墽锛滈梺缁樏壕顓熸櫠椤忓牊鎳氶柡宥庡幗閻撱儲绻濋棃娑欘棡闁革絽缍婇弻锟犲幢濞嗗繋妲愰梺鍝勭焿缂嶄線鐛幒妤�鍗抽柣鎰閻繘姊绘担鑺ョ《闁哥姵娲栬灋闁告洦鍘炬稉宥囷拷骞垮劚椤︻垳澹曢崸妤佺厱婵°倕鍟敓鏂ょ到閳藉螣濠婂嫭顥堢�规洏鍔戦、娆撴嚍閵夘喕鎴烽梻鍌氬�峰鎺旀椤旀儳绶ゅù鐘差儏鐎氬銇勯幒鎴濐仼婵懓寮堕妵鍕箳閹存繍浠鹃梺缁樻尰缁嬫捇鏁撻悾灞绢仧闁归鍏橀幃妤呮晲鎼粹�愁潾閻炴熬绠戦埞鎴︽偐閹颁礁鏅遍梺闈╃秵閸ㄥ爼鐛箛娑欏�婚柤鎭掑劗閹锋椽鏌ｆ惔鈩冭础濠殿喚鏁昏棢濠㈣泛顑勭换鍡樸亜閹板墎绉垫繛鍫熺矌閿熻姤顔栭崰妤呮偂閿熺姴钃熼柛鈩冾殢閸氬鏌涢垾宕囩閻庢艾銈稿缁樻媴閾忕懓绗￠梺鐓庣秺缁犳牠骞冨ú顏勎╃憸婵嬪箯瀹勯偊娼╅柟棰佺劍缂嶅牏绱撴担铏瑰笡缂佸鎹囬弫鎾绘偩鐏炵偓姣勫銈庡幖閻楀繘寮锟藉畷濂稿即閻斿搫骞楅梺鍦劋婵炲﹤鐣峰┑瀣闁挎洩鎷风紒鐘崇墵閺屻劑鎮㈤崫鍕戙垺銇勯銏″殗闁哄本娲熷畷鐓庘攽閸ヨ埖锟ラ梻浣告啞钃遍柟顔煎�块獮鍐ㄎ旈崨顖氱ウ闂佸壊鐓堥崰鏍ㄦ叏鎼淬劍鈷戠痪顓炴噺閻濐亪鏌涢弮锟介悧婊呭垝鐎ｎ喖绠抽柟瀛樻⒐椤秹姊洪棃娑氱畾闁跨喓鏅鏌ュ箯閻戣棄鍨傛い鎰剁到瀵灝鈹戦埥鍡楃仯闁告鍕洸濡わ絽鍟崐鍨叏濡厧浜鹃悗姘炬嫹 by changhao
			
				if (itemid != 0) //婵犵數濮烽弫鍛婃叏閻戣棄鏋侀柛娑橈攻閸欏繘鏌ｉ幋锝嗩棄闁哄绶氶弻娑樷槈濮楀牊鏁鹃梺鍛婄懃缁绘﹢寮婚敐澶婄闁挎繂妫Λ鍕⒑閸濆嫷鍎庣紒鑸靛哺瀵鎮㈤崗灏栨嫽闁诲酣娼ф竟濠偽ｉ鍓х＜闁绘劦鍓欓崝銈嗐亜椤撶姴鍘寸�殿喖顭烽弫鎰緞婵犲嫮鏉告俊鐐�栫敮濠囨倿閿曞倸纾块柟鍓х帛閳锋垿鏌熼懖鈺佷粶濠碘�炽偢閺屾稒绻濋崒娑樹淮閻庢鍠栭…鐑藉极閹邦厼绶炲┑鐘插缂嶅倿姊绘担铏瑰笡闁挎岸鏌涢悢閿嬪仴鐎殿喗濞婂畷濂稿Ψ閿旇瀚肩紓鍌欑椤戝棝顢栧▎鎾崇？闊洦鏌ｆ禍婊堟煙鐎涙绠ユ俊顖ゆ嫹闁诲孩顔栭崰鏍�﹂柨瀣╃箚闁归棿绀侀悡娑㈡煕鐏炲墽鐓紒銊ょ矙濮婄粯鎷呮笟顖滃姼闂佸搫鐗滈崜娑氬垝濞嗘挸绠ｉ柨鏃傜帛閺呮粓姊虹捄銊ユ珢闁瑰嚖鎷�?濠电姷鏁告慨鐑藉极閸涘﹥鍙忛柣鎴ｆ閺嬩線鏌涘☉姗堟敾闁告瑥绻橀弻鐔虹磼閵忕姵鐏嶉梺绋块椤︻垶鈥﹂崸妤佸殝闂傚牊绋戦～宀�绱撴担鍝勭彙闁搞儯鍔庨崢閬嶆⒑閸濆嫮袪闁稿﹥娲橀弲鍫曞蓟閵夛箑锟藉灚鎱ㄥ鍡楀缂佸妞介弻鈥崇暆鐎ｎ剛鐦堥悗瑙勬礀閻栧吋淇婇悜钘壩ㄧ憸宀勫箖閿濆洨纾介柛灞剧懆閸忓苯鈹戦锟介弨閬嶅箞閵娾晜鍊婚柤鎭掑劜濞呫垽姊洪懞銉冾亪藝闁秵鍋╂い鎾卞灪閻撴洟骞栫划鐧告嫹鐎圭姴鐓橀梺鎹愬吹閸嬬偟鎹㈠☉銏犵婵炲棗绻掓禒楣冩⒑缁嬫鍎戦柛鐘崇墵瀵鈽夐姀鈺傛櫇闂佹寧绻傚Λ娑⑺囬妸鈺傗拺缂備焦蓱鐏忎即鏌ｉ埡濠傜仸鐎殿喛顕ч埥澶愬閻樻牓鍔戦弻銊モ攽閸℃ê娅ｆ繝娈垮枛闁帮絽顫忛搹瑙勫珰闁告瑥顦遍々鐗堢箾鐎涙鐭ゅù婊庝簻椤曪絾绻濆顓熸珳婵犮垼娉涢敃锕傤敊閹烘鐓熼幖娣灮閳句焦銇勯鐐村枠閽樻繂霉閻撳海鎽犻柍閿嬪灩缁辨挻鎷呴懖鈩冨灴楠炲棝宕熼娑氬幈闁诲函缍嗘禍宄邦啅閵夆晜鐓熼柨婵嗘搐閸樺锟借娲栭妶绋款嚕閹绢喗鍊风�广儰鐒﹀▍濠囨煛鐏炶濮傜�殿喗鎸抽、鏃堝川椤撗傜处缂傚倸鍊烽懗鍫曞磻閹炬剚鐔嗘俊顖濆亹閻捇鏌熺紒銏犳灈闁绘挻锕㈤弻鐔告綇妤ｅ啯顎嶅銈呭閸旀瑩寮婚敐鍫㈢杸闁规儳顕々鐗堢箾鐎涙鐭嬬紒顔芥崌楠炲啯銈ｉ崘鈺侊拷濠氭煠閹帒鍔氬ù鐘虫そ濮婃椽宕ㄦ繝鍕ㄦ闂佹寧娲忛崕閬嶅煝瀹ュ顫呴柕鍫濇閹疯櫣绱撴担鍓插剰閻忓繐鎳樺畷婵嬫偄閸忚偐鍘遍梺鎸庣箓閸燁偊宕濆顓滀簻妞ゆ挾鍋為崰妯活殽閻愬弶鍠樻い銏★耿閹晛鈻撻崹顔芥珬闂傚倸鍊风粈渚�骞夐敓鐘冲仭闁靛鏁￠崶銊︾秶闁靛闄勯悵鐑芥⒑濮瑰洤鐏╅柟璇х節閹�斥枎閹扳晙绨婚梺鍝勭Р閸斿矂宕甸浣风箚闁圭粯甯楃拹锛勭磼鏉堛劌绗氭繛纰变邯楠炲秹顢欓崜褍骞嗛梺璇叉唉椤煤韫囨稑绀夌�广儱娲﹀畷鍙夌節闂堟侗鍎忕痪鎯у悑閹便劌顫滈崱妤�骞嬮梺鐟板槻椤嘲顫忔繝姘＜婵﹩鍓ㄩ幏宄扮暋閹冲﹤缍婂畷鎯邦槷闁哄鐗犻弻锟犲炊閵夈儳浠奸梻鍌氬亞閸ㄥ爼寮婚妸鈺佸嵆闁绘劘顕滈幏鐑藉传閵壯傜瑝濡炪倖鐗滈崑鐐烘偂閵夆晜鐓熼柡鍥╁仜閿熻棄婀遍敓鑺ョ啲閹凤拷? by changhao
				{
					GroceryItemShuXing grocery = (GroceryItemShuXing) fire.pb.item.Module.getInstance().getItemManager().getAttr(itemid);
					if (grocery == null)
					{
						return true;
					}
										
					//闂傚倸鍊搁崐鎼佸磹閹间礁纾归柟闂寸绾惧綊鏌熼梻瀵割槮缁炬儳婀遍敓鐣屾嚀鐎氼參宕崇壕瀣ㄤ汗闁圭儤鍨归崐鐐烘偡濠婂啰绠荤�殿喗濞婇弫鍐磼濞戞艾骞楅梻渚�娼х换鍫ュ春閸曨垱鍊块柛鎾楀懐锛滈梺褰掑亰閸欏骸鈻撳鍫熺厸鐎癸拷閿熶粙宕伴弽顓犲祦鐎广儱顦介弫濠勭棯閹峰矂鍝烘慨锝咁樀濮婄粯鎷呮笟顖滃姼濡炪倖鍨堕崹褰掑箲閵忕姭鏀介悗锝庝海閹芥洟姊洪棃娴ュ牓寮插☉姘卞暗鐎广儱顦伴悡鏇㈡倶閻愭彃鈷旈柣鎿冨灠椤法鎲撮崟顒傤槹濠殿喖锕ュ钘夌暦椤愶箑绀嬫い鎺戭槹閿涗胶绱撻崒娆戣窗闁哥姵顨婇獮鎴﹀炊瑜滈崵鏇炩攽閻樺磭顣查柡鍛絻椤法鎹勯悮瀛樻暰濡炪們鍎茬换鍫濐潖濞差亜鎹舵い鎾楀懎濮奸梺璇插缁嬪牓寮查悩鑼殾濞村吋娼欑粻娑㈡煟濡わ拷閻楀啴骞忛搹鍦＝闁稿本鐟ч崝宥嗐亜椤撶偞宸濈紒顔碱煼楠炴绱掑Ο鐓庡箺闂備礁鎼拠鐐存媴闂�鎰灊闂佽瀛╅鏍窗閺嶎厸锟斤箓鏌ㄧ�ｂ晝绠氶梺褰掓？缁�渚�鎮″☉銏＄厱閻忕偛澧介悡顖滅磼閵娿倗鐭欐慨濠勭帛閹峰懏绗熼婊冨Ъ闂備礁鎼悧婊堝礈濞戞艾鍨濇繛鍡樻尭缁狅綁鏌ㄩ弮鍌滃笡闁哄懏绮撳铏规崉閵娿儲鐝㈤梺鐟板殩閹凤拷 by changhao
					if (grocery.typeid == LiveSkillManager.ITEM_TYPE_PRACTICE_ROLE_ITEM && which == 2)
					{
						//闂傚倸鍊搁崐鎼佸磹閹间礁纾归柟闂寸绾惧綊鏌熼梻瀵割槮缁炬儳缍婇弻鐔兼⒒鐎靛壊妲紒鐐劤缂嶅﹪寮婚敐澶婄闁挎繂鎲涢幘缁樼厱闁靛牆鎳庨顓㈡煛鐏炲墽娲存い銏℃礋閺佹劙宕卞▎妯恍氱紓鍌氬�烽懗鑸垫叏闁垮绠鹃柨鐔剁矙閺屸�崇暆閿熶粙宕伴弽褏鏆︽繝濠傛－濡查箖鏌ｉ姀鈺佺仭闁烩晩鍨跺璇测槈濮樼偓瀚归柨婵嗗暙婵″ジ鏌ㄩ悢璇残撶紒璇茬墕椤曪絾绻濆顒�宓嗛梺缁樻濞咃綁顢欓弴銏♀拺缂備焦锚婵箓鏌涢幘鏉戝摵闁诡喚鏁诲顕�宕掑鍜冪闯濠电偞鎸婚懝楣冩晝閵壯嶆嫹濮樻剚娼愮紒缁樼箞婵拷闁挎繂鎳愰崢顐︽⒑閸涘﹥鈷愰柣妤冨█楠炲啴鍨鹃弬銉︻潔闂侀潧楠忕槐鏇㈠储闁秵鈷戦梻鍫熶緱濡插爼鏌涢妸銉︽儓闁宠绉瑰畷銊э拷娑欘焽閸樻悂鏌ｆ惔顖滅У闁稿瀚伴幃姗�骞橀鐣屽幐闁诲繒鍋涙晶浠嬪煡婢舵劖鐓冮悹鍥у级閸炲绱掗悩宕囨创鐎殿喗鎸抽幃顏堟晸娴犲鑸归柛锔诲幘绾句粙鏌涚仦鍓ф噯闁稿繐鐬肩槐鎺楊敋閸涱厾浠搁梺璇″灠鐎氫即銆佸☉銏″�烽梻鍫熺〒閵堬箓姊虹拠鎻掑毐缂傚秴妫濆畷鏉课旈崨顓狅紮闂佺粯鍨兼慨銈夋偂閺囥垺鐓欓柤鍓插墮婵¤姤绻涢崨顓犲妞ゎ叀娉曢幉鎾礋閹府鎷风捄顭掓嫹鐟欏嫭绌跨紒缁樼箞瀵宕卞Δ濠傛倯闂佺硶鍓濋悷銉╃嵁閸喍绻嗛柣鎰典簻閿熻姤鐗犲畷婵單旀担鐟板伎闂佸湱铏庨崰鏍矆婢跺绡�濠电姴鍊绘晶娑㈡煟閹捐泛鏋涢柡宀�鍠栭獮鍡氼槾闁圭晫濮风槐鎺楁晸娴犲绀冩い鏃傛櫕閸橆亪姊洪幖鐐插妧闁告劕褰炵槐鏃�淇婇妶鍥ラ柛瀣☉鐓ゆい鎾跺�ｅ☉銏犵闁靛鍨洪～宥呪攽椤旂瓔娈旀俊顐ｇ懃闇夐柛銉墯閳锋帒霉閿濆洨鎽傞柛銈嗙懇閹鈽夐幒鎾寸彋闂佽鍠撻崹浠嬨�佸Δ鍛妞ゆ劑鍊ら崬鐢告⒒娴ｈ姤纭堕柛锝忕畵楠炲繘鏁撻敓锟�?濠电姷鏁告慨鐑藉极閸涘﹥鍙忛柣鎴ｆ閺嬩線鏌涘☉姗堟敾闁告瑥绻橀弻鐔虹磼閵忕姵鐏嶉梺绋块椤︻垶鈥﹂崸妤佸殝闂傚牊绋戦～宀�绱撴担鍝勭彙闁搞儯鍔庨崢閬嶆⒑閸濆嫮袪闁稿﹥娲橀弲鍫曞蓟閵夛箑锟藉灚鎱ㄥ鍡楀缂佸妞介弻鈥崇暆鐎ｎ剛鐦堥悗瑙勬礀閻栧吋淇婇悜钘壩ㄧ憸宀勫箖閿濆洨纾介柛灞剧懆閸忓苯鈹戦锟介弨閬嶅箞閵娾晜鍊婚柤鎭掑劜濞呫垽姊洪懞銉冾亪藝闁秵鍋╂い鎾卞灪閻撴洟骞栫划鐧告嫹鐎圭姴鐓橀梺鎹愬吹閸嬬偟鎹㈠☉銏犵婵炲棗绻掓禒楣冩⒑缁嬫鍎戦柛鐘崇墵瀵鈽夐姀鈺傛櫇闂佹寧绻傚Λ娑⑺囬妸鈺傗拺缂備焦蓱鐏忎即鏌ｉ埡濠傜仸鐎殿喛顕ч埥澶愬閻樻牓鍔戦弻銊モ攽閸℃ê娅ｆ繝娈垮枛闁帮絽顫忛搹瑙勫珰闁告瑥顦遍々鐗堢箾鐎涙鐭ゅù婊庝簻椤曪絾绻濆顓熸珳婵犮垼娉涢敃锕傤敊閹烘鐓熼幖娣灮閳句焦銇勯鐐村枠閽樻繂霉閻撳海鎽犻柍閿嬪灴閺屾稑鈹戦崱妤婁紓濡炪値鍋撶粻鎾诲蓟濞戙垹绫嶉柨鐔剁矙瀹曞綊宕稿Δ鍐ㄧウ闂佸憡鍔﹂崰鏍ф纯濠电姰鍨煎▔娑㈡晝閿曞倹鏅繝濠傚暊閺�浠嬫煟閹邦厽缍戦柣蹇ョ畵閺屻劑寮村Δ浣圭彆闁诲酣娼ч妶鎼佸极閹剧粯鏅搁柨鐕傛嫹? by changhao
						if(bag.removeItemById(itemid, times, fire.log.enums.YYLoggerTuJingEnum.tujing_Value_gonghuixiulian, 0, LiveSkillManager.Practice) != times)
						{
							MessageMgr.psendMsgNotify(roleid, 160105, null);
							return false;
						}
						
						fire.pb.skill.SPracticeItemExp itemexp = ConfigManager.getInstance().getConf(fire.pb.skill.SPracticeItemExp.class).get(itemid);
						addexp = itemexp.exp * times;
						
					}//闂傚倸鍊搁崐鎼佸磹閹间礁纾归柟闂寸绾惧綊鏌熼梻瀵割槮缁炬儳婀遍敓鐣屾嚀鐎氼參宕崇壕瀣ㄤ汗闁圭儤鍨归崐鐐差渻閵堝棗绗掓い锔垮嵆瀵煡顢旈崼鐔蜂画濠电姴锕ら崯鎾矗閸曨垱鐓忛柛鈩冾殔閺嗭絽鈹戦敍鍕効妞わ附鎸抽弻锝夘敇閻旂儤鍣伴梺鍝勬湰閻╊垰顕ｆ繝姘兼晣婵犲﹤鍠涢幏鐤樄妤犵偛绻橀幃婊堟寠婢舵劖鏆呮繝寰锋澘锟窖囧箯妞嬪海纾奸柣娆愮懃濞诧箓鎮￠弴鐔翠簻闁规澘澧庨幃濂告煃閽樺妲搁柍瑙勫灴閸ㄩ箖鎳犻鍌滃幆闂備礁鎼張顒傜矙閹达箑鐓濋幖娣�楅悿锟介梺鍝勬川婵參宕�ｎ偆绡�婵炲牆鐏濋弸娑㈡煥閺囨ê鍔氭い顏勫暣閹稿﹥寰勭仦鐐啎闁荤喐绮庢晶妤冩暜閳哄懎鏋侀悗锝庡枟閻撴洘绻涢幋婵嗚埞妤犵偞鐗曢…鍧楁偡闁附效缂備胶绮换鍫ュ箖娴犲顥堟繛鎴烆殘閹规洟姊绘担渚敯婵炲懏娲熷畷婵嬪冀椤愶絽搴婂┑鐐村灟閸ㄦ椽寮茬粙妫靛綊鎮╁顔煎壉闂佺粯鎸婚惄顖炲箖濮楋拷閹瑦锛愬┑鍡橆唲濠电姵顔栭崰鏍磹閸ф钃熼柣鏃傗拡閺佸﹪鏌涘┑鍡楊伒闁瑰嘲鍢查埞鎴﹀幢濞嗘劖顔曢梻浣告贡閸庛倝宕归悢鑲猴綁宕奸悢绋垮伎濠德板�ч幏閿嬩繆椤愶絾鈷掓俊鍙夊姍閺佹捇鏁撻敓锟� by changhao
					else if (grocery.typeid == LiveSkillManager.ITEM_TYPE_PRACTICE_PET_ITEM && which == 1)
					{
						//闂傚倸鍊搁崐鎼佸磹閹间礁纾归柟闂寸绾惧綊鏌熼梻瀵割槮缁炬儳缍婇弻鐔兼⒒鐎靛壊妲紒鐐劤缂嶅﹪寮婚敐澶婄闁挎繂鎲涢幘缁樼厱闁靛牆鎳庨顓㈡煛鐏炲墽娲存い銏℃礋閺佹劙宕卞▎妯恍氱紓鍌氬�烽懗鑸垫叏闁垮绠鹃柨鐔剁矙閺屸�崇暆閿熶粙宕伴弽褏鏆︽繝濠傛－濡查箖鏌ｉ姀鈺佺仭闁烩晩鍨跺璇测槈濮樼偓瀚归柨婵嗗暙婵″ジ鏌ㄩ悢璇残撶紒璇茬墕椤曪絾绻濆顒�宓嗛梺缁樻濞咃綁顢欓弴銏♀拺缂備焦锚婵箓鏌涢幘鏉戝摵闁诡喚鏁诲顕�宕掑鍜冪闯濠电偞鎸婚懝楣冩晝閵壯嶆嫹濮樻剚娼愮紒缁樼箞婵拷闁挎繂鎳愰崢顐︽⒑閸涘﹥鈷愰柣妤冨█楠炲啴鍨鹃弬銉︻潔闂侀潧楠忕槐鏇㈠储闁秵鈷戦梻鍫熶緱濡插爼鏌涢妸銉︽儓闁宠绉瑰畷銊э拷娑欘焽閸樻悂鏌ｆ惔顖滅У闁稿瀚伴幃姗�骞橀鐣屽幐闁诲繒鍋涙晶浠嬪煡婢舵劖鐓冮悹鍥у级閸炲绱掗悩宕囨创鐎殿喗鎸抽幃顏堟晸娴犲鑸归柛锔诲幘绾句粙鏌涚仦鍓ф噯闁稿繐鐬肩槐鎺楊敋閸涱厾浠搁梺璇″灠鐎氫即銆佸☉銏″�烽梻鍫熺〒閵堬箓姊虹拠鎻掑毐缂傚秴妫濆畷鏉课旈崨顓狅紮闂佺粯鍨兼慨銈夋偂閺囥垺鐓欓柤鍓插墮婵¤姤绻涢崨顓犲妞ゎ叀娉曢幉鎾礋閹府鎷风捄顭掓嫹鐟欏嫭绌跨紒缁樼箞瀵宕卞Δ濠傛倯闂佺硶鍓濋悷銉╃嵁閸喍绻嗛柣鎰典簻閿熻姤鐗犲畷婵單旀担鐟板伎闂佸湱铏庨崰鏍矆婢跺绡�濠电姴鍊绘晶娑㈡煟閹捐泛鏋涢柡宀�鍠栭獮鍡氼槾闁圭晫濮风槐鎺楁晸娴犲绀冩い鏃傛櫕閸橆亪姊洪幖鐐插妧闁告劕褰炵槐鏃�淇婇妶鍥ラ柛瀣☉鐓ゆい鎾跺�ｅ☉銏犵闁靛鍨洪～宥呪攽椤旂瓔娈旀俊顐ｇ懃闇夐柛銉墯閳锋帒霉閿濆洨鎽傞柛銈嗙懇閹鈽夐幒鎾寸彋闂佽鍠撻崹浠嬨�佸Δ鍛妞ゆ劑鍊ら崬鐢告⒒娴ｈ姤纭堕柛锝忕畵楠炲繘鏁撻敓锟�?濠电姷鏁告慨鐑藉极閸涘﹥鍙忛柣鎴ｆ閺嬩線鏌涘☉姗堟敾闁告瑥绻橀弻鐔虹磼閵忕姵鐏嶉梺绋块椤︻垶鈥﹂崸妤佸殝闂傚牊绋戦～宀�绱撴担鍝勭彙闁搞儯鍔庨崢閬嶆⒑閸濆嫮袪闁稿﹥娲橀弲鍫曞蓟閵夛箑锟藉灚鎱ㄥ鍡楀缂佸妞介弻鈥崇暆鐎ｎ剛鐦堥悗瑙勬礀閻栧吋淇婇悜钘壩ㄧ憸宀勫箖閿濆洨纾介柛灞剧懆閸忓苯鈹戦锟介弨閬嶅箞閵娾晜鍊婚柤鎭掑劜濞呫垽姊洪懞銉冾亪藝闁秵鍋╂い鎾卞灪閻撴洟骞栫划鐧告嫹鐎圭姴鐓橀梺鎹愬吹閸嬬偟鎹㈠☉銏犵婵炲棗绻掓禒楣冩⒑缁嬫鍎戦柛鐘崇墵瀵鈽夐姀鈺傛櫇闂佹寧绻傚Λ娑⑺囬妸鈺傗拺缂備焦蓱鐏忎即鏌ｉ埡濠傜仸鐎殿喛顕ч埥澶愬閻樻牓鍔戦弻銊モ攽閸℃ê娅ｆ繝娈垮枛闁帮絽顫忛搹瑙勫珰闁告瑥顦遍々鐗堢箾鐎涙鐭ゅù婊庝簻椤曪絾绻濆顓熸珳婵犮垼娉涢敃锕傤敊閹烘鐓熼幖娣灮閳句焦銇勯鐐村枠閽樻繂霉閻撳海鎽犻柍閿嬪灴閺屾稑鈹戦崱妤婁紓濡炪値鍋撶粻鎾诲蓟濞戙垹绫嶉柨鐔剁矙瀹曞綊宕稿Δ鍐ㄧウ闂佸憡鍔﹂崰鏍ф纯濠电姰鍨煎▔娑㈡晝閿曞倹鏅繝濠傚暊閺�浠嬫煟閹邦厽缍戦柣蹇ョ畵閺屻劑寮村Δ浣圭彆闁诲酣娼ч妶鎼佸极閹剧粯鏅搁柨鐕傛嫹? by changhao
						if(bag.removeItemById(itemid, times, fire.log.enums.YYLoggerTuJingEnum.tujing_Value_gonghuixiulian, 0, LiveSkillManager.Practice) != times)
						{
							MessageMgr.psendMsgNotify(roleid, 160104, null);
							return false;
						}
						
						fire.pb.skill.SPracticeItemExp itemexp = ConfigManager.getInstance().getConf(fire.pb.skill.SPracticeItemExp.class).get(itemid);
						addexp = itemexp.exp * times;
					}
					else
					{
						return true;
					}
				}
				else //闂傚倸鍊搁崐鎼佸磹閹间礁纾归柟闂寸绾惧綊鏌熼梻瀵割槮缁炬儳缍婇弻鐔兼⒒鐎靛壊妲紒鎯у⒔閹虫捇鈥旈崘顏庢嫹閿濆簼绨奸柟鐧哥秮閺岋綁顢橀悙鎼闂侀潧妫欑敮鎺楋綖濠靛鍊锋い鎺炴嫹妞ゅ繐鐖奸弻锝嗘償閵堝孩缍堝┑鐐村絻缁绘ê鐣烽弴銏犵闁兼亽鍎插▍銏ゆ⒑閸濆嫬锟藉爼宕愬Δ鍐煋闂傚牊鑰介悷閭︾叆闁糕剝顭囬妴鎰版⒑闂堟稒顥為悽顖涱殘閹广垹鈹戦崱鈺傚兊濡炪倖鎸炬慨鎾嵁濮楋拷濮婄粯鎷呯粵瀣異闂佸憡顭囬弲顐﹀极椤曪拷楠炴帒螖閿熺晫绮堟径鎰厪闁割偅绻冮ˉ鎾趁瑰鍕煉闁哄苯绉瑰畷顐﹀礋椤愵剚瀚瑰┑鐘宠壘閻鏌ㄩ悢鍓佺煓婵﹥妞藉畷顐﹀礋椤掍焦瀚抽梻浣哄劦閺呪晠宕归崼鏇炍ュ〒姘炬嫹鐎殿喗鎸虫慨锟介柍鈺佸暞閻濇娊姊绘担铏广�婇柛鎾寸箞閹兘顢涘В纭风秮椤㈡宕掑鍜冪闯闂備胶顭堥張顒勬偡閵娾晛绀傞悘鐐缎掗弨鑺ャ亜閺冨洦顥夐柍缁樻礈閿熷�燁潐濞测晝鎹㈠┑瀣祦閹兼番鍔嶇�电姴顭跨捄鍝勵劉闁硅尙澧楃换婵嬫偨闂堟稐娌梺鍓茬厛閸ㄨ泛鐣峰ú顏勭妞ゆ牗纰嶉悗顒勬⒑閸涘﹤濮﹂柛鐘愁殜閹繝濡烽敂鍓х槇闂傚倸鐗婄粙鎺椝夐悙娣簻闁靛／鍐冿綁鏌曢崶褍顏柡浣稿�垮畷顐﹀礋椤愨懣鎴犵磽閸屾瑦绁板鏉戞憸閺侇噣鎮欓崹顐綗闂佸湱鍎ら〃鍛达綖閸涘瓨鐓熸俊顖氱仢缁憋妇绱掓潏鈺佹灈婵﹦绮幏鍛村传閵夘灝銊ヮ渻閵堝啫鍔滈柟鐟版搐閻ｅ嘲螖閿熷�熺亽婵炴挻鍑归崹杈╃礊鎼达絿纾介柛灞剧懅閸斿秹鎷戦崡鐐╂斀妞ゆ牗绋掔亸锕傛煙椤旂厧妲婚柍璇叉唉缁犳盯骞欓崘褎鍋呮繝鐢靛仜椤曨厽鎱ㄩ銏犵柧闁绘ê妯婂鏍煣韫囨挻璐￠柣顓熺懇閺屾盯鈥﹂幋婵囩亾濠德ゅ紦閸楀啿顫忓ú顏咁棃闁冲搫鍟拌倴缂傚倷娴囧鎾跺垝濞嗘挶锟戒礁顫濋懜鍨珳婵犮垼娉涢敃銊╁箺閺囥垺鈷戦梻鍫熶緱濡狙呯磼閻樺啿鐏︾紒鍌氱Ч瀹曠兘顢橀悩纰夌闯闂備胶顭堥張顒勬偡瑜斿畷婵嗩吋婢跺鍙嗗┑顔斤供閸庮亣銇愰幒鎾充汗闂佸憡鍔曞鍓佹嫚閻愭祴鏀芥い鏃傘�嬫Λ姘箾閸滃啰绉鐐村灴瀹曠喖顢涘В灏栨櫊閺屾洘寰勫☉姗嗘喘閻熸粎澧楀畝绋款潖缂佹ɑ濯撮柣鎴灻▓宀勬⒑閹肩偛锟芥牠鎮ч悩鑽ゅ祦闊洦绋掗弲鎼佹煥閻曞倹瀚� by changhao
				{
					fire.pb.common.SCommon costconfig = ConfigManager.getInstance().getConf(fire.pb.common.SCommon.class).get(165);
					
					int costmoney = Integer.parseInt(costconfig.value) * times;
									
					//闂傚倸鍊搁崐鎼佸磹閹间礁纾归柟闂寸绾惧綊鏌熼梻瀵割槮缁炬儳缍婇弻鐔兼⒒鐎靛壊妲紒鎯у⒔閹虫捇鈥旈崘顏庢嫹閿濆簼绨奸柟鐧哥秮閺岋綁顢橀悙鎼闂傚洤顦甸弻銊モ攽閸♀晜效婵炲瓨鍤庨崐婵嬪蓟閵堝绾ч柟绋块娴犳潙鈹戦纭锋敾婵＄偘绮欓妴浣肝旈崨顔芥闂佷紮绲介惉濂告儗閹剧粯鐓涢悘鐐额嚙閸旀粓鏌￠崨顔藉�愰柡宀嬬畱铻ｅ〒姘煎灡绗戦梻浣芥硶閸犳洖螞閸曨偒鐒介柨鐔哄Т杩濇繛杈剧悼绾爼寮告惔銊︾厵闁诡垎鍜冪礊濡炪倧瀵岄崣鍐箖瀹勯偊鐓ラ柛鎰典簽椤旀帡鏌﹀Ο鑽ょ畺闁靛洤瀚板浠嬪Ω瑜嬮敓鑺ュ笧缁辨帡鎮╅懡銈囨毇闂佸搫鐬奸崰鏍嵁閸℃凹妾ㄩ梺鎼炲�楅崰鏍蓟濞戙垺鍋勯柛婵勫劚瀵劑姊洪崫鍕伇闁哥姵鐗犻獮鍐煥閸喎娈熼梺闈涱檧闂勫嫬鈻撻崨濠佺箚闁绘劦浜滈敓鑺ュ灴瀹曟繃绻濋崶褏锛熼梺姹囧灮椤牏绮婚弽銊х闁糕剝蓱鐏忣厾绱掗悪娆忔处閻撴瑩鎮楀☉娆樼劷缂佺姰鍎茬换娑㈠礂閻撳骸鎽靛┑顔硷功缁垶骞忛崨瀛樺殟闁靛缍囬幏鐑藉礃椤旂晫鍘介梺纭呮閸嬬喖鎮鹃崹顐闁绘劖娼欓悘瀵革拷瑙勬礀閻栧ジ銆佸Δ鍛櫢濞寸姴顑呴崙鐘层�掑鐐闂佸搫鐬奸崰鏍х暦濠婂棭妲鹃柣銏╁灡閻╊垶寮婚敓鐘插窛妞ゆ棁妫勯敓鑺ュ姍閺岋紕浠︾拠鎻掝潎闂佽鍠撻崐婵嗙暦閹烘垟妲堟慨妤�妫旂槐锟� by changhao
					if(bag.subMoney(-costmoney, LiveSkillManager.Practice, fire.log.enums.YYLoggerTuJingEnum.tujing_Value_gonghuixiulian, 0) != -costmoney)
					{
						return false;	
					}					
					
					addexp = 10 * times;
				}
				
				AddExp(curskilllevel, practiceskill.getExp() + addexp, practiceskill, maxlevel); //闂傚倸鍊搁崐鎼佸磹閹间礁纾归柟闂寸绾惧綊鏌熼梻瀵割槮缁炬儳缍婇弻鐔兼⒒鐎靛壊妲紒鎯у⒔閹虫捇鈥旈崘顏庢嫹閿濆簼绨奸柟鐧哥秮閺岋綁顢橀悙鎼闂侀潧妫欑敮鎺楋綖濠靛鍊锋い鎺炴嫹妞ゅ繗鍩栨穱濠囧Χ閸ヮ灝銉╂煕鐎ｎ偆娲撮挊婵嬫煟閵忋埄鐒鹃柡瀣╃窔閺岀喖宕滆鐢盯鏌涚�ｎ偄濮堥柕鍥у瀵挳鎮欓幖顓燂紒闂佽瀛╅懝鍓х礊婵犲洤钃熸繛鎴欏灩缁犳盯姊婚崼鐔衡檨闁诲繐鐗撻幃妤呮偡閻楀牆鏆堢紓浣筋嚙閸熷瓨淇婇悽绋跨妞ゆ牗姘ㄩ濠囨⒑閻熸壆鎽犵紒璇插暣瀹曟劙顢涘锝嗘杸闂佹寧绋戠�氼剚绂掗埡浣叉斀妞ゆ柨鎼敓鑺ョ墱缁碍娼忛妸褏鐦堥梺鎼炲劀閸滀礁鏅ｆ繝鐢靛仩閹活亞绱為敓鑺ャ亜椤愩埄妲搁柍璇茬Ч瀹曞崬鈻庨幋鐙呯闯闂備胶顭堥張顒勬偡瑜斿畷婵嗩吋婢跺鍙嗛梺鍝勬处椤ㄥ棗鈻嶆繝鍕舵嫹鐟欏嫭澶勯柛銊ゅ嵆椤㈡﹢宕楅悡搴ｇ獮闁诲函鎬ラ崟顐紲濠电姷鏁搁崑鐘诲箵椤忓棛绀婇柨鐔绘閳规垿顢欓崫鍕舵嫹濡わ拷閳藉鎮界粙鍧楀敹闂佸搫娲ㄩ崰鎾诲储闁秵鈷戦柟绋挎捣缁犳挾绱掔紒妯烘诞闁诡噣绠栧畷褰掝敃椤愶綆鍟嶉梻浣虹帛閸旀浜稿▎鎴犱笉濠电姵纰嶉悡娑樏归敐鍫綈鐎规洖鐭傞弻鈩冩媴鐟欏嫬纾抽梺杞扮劍閹瑰洭寮幘缁樻櫢闁跨噦鎷� by changhao
				
				SUpdateLearnParticleSkill msg = new SUpdateLearnParticleSkill();
				msg.skill.level = practiceskill.getLevel();
				msg.skill.id = id;
				msg.skill.exp = practiceskill.getExp();
				msg.skill.maxlevel = maxlevel;
				
				if (msg.skill.level > 0)
				{
					msg.skill.effects.putAll(CalcSkillEffect(config.skillId, msg.skill.level));
					msg.skill.nexteffect.putAll(CalcSkillEffect(config.skillId, msg.skill.level + 1));
					if (practiceskill.getLevel() > curskilllevel) //闂傚倸鍊搁崐鎼佸磹閹间礁纾归柟闂寸绾惧綊鏌熼梻瀵割槮缁炬儳缍婇弻鐔兼⒒鐎靛壊妲紒鎯у⒔閹虫捇鈥旈崘顏庢嫹閿濆簼绨奸柟鐧哥秮閺岋綁顢橀悙鎼闂侀潧妫欑敮鎺楋綖濠靛鍊锋い鎺炴嫹妞ゅ繗鍩栨穱濠囧Χ閸ヮ灝銉╂煕鐎ｎ偆娲撮挊婵嬫煟閵忋埄鐒鹃柡瀣╃窔閺岀喖宕滆鐢盯鏌涚�ｎ偄濮堥柕鍥у瀵挳鎮欓幖顓燂紒闂佽瀛╅懝鍓х礊婵犲洤钃熸繛鎴欏灩缁犳盯姊婚崼鐔衡檨闁诲繐鐗撻幃妤呮偡閻楀牆鏆堢紓浣筋嚙閸熷瓨淇婇悽绋跨妞ゆ牗姘ㄩ濠囨⒑閻熸壆鎽犵紒璇插暣瀹曟劙顢涘锝嗘杸闂佹寧绋戠�氼剚绂掗埡浣叉斀妞ゆ柨鎼敓鑺ョ墱缁碍娼忛妸褏鐦堥梺鎼炲劀閸滀礁鏅ｆ繝鐢靛仩閹活亞绱為敓鑺ャ亜椤愩埄妲搁柍璇茬Ч瀹曞崬鈻庨幋鐙呯闯闂備胶顭堥張顒勬偡瑜斿畷婵嗩吋婢跺鍙嗛梺鍝勬处椤ㄥ棗鈻嶆繝鍕舵嫹鐟欏嫭澶勯柛銊ゅ嵆椤㈡﹢宕楅悡搴ｇ獮闁诲函鎬ラ崟顐紲濠电姷鏁搁崑鐘诲箵椤忓棛绀婇柨鐔诲Г閵囧嫰顢曢姀鈺傗枅閻庤娲橀崹鍧楀箖閳哄啰纾兼俊顖滃帶楠炲牓姊洪悷鏉挎倯闁伙綆浜畷鐟懊洪鍕庯附绻濋棃娑氬⒊闁圭兘顥撻幉鎾礋椤掑偆妲扮紓鍌欑贰閸犳牠鎯岄崒鐐叉槬闁靛繆鍓濋崕鐔兼煏婵炲灝鍔ゆい鎾存そ濮婅櫣绱掑鍡欏姺闂佽桨鐒﹂幃鍌氱暦濠靛閱囬柡鍥╁暱閹风粯绻涙潏鍓хК婵炲拑缍佹俊瀛樼節閸ャ劎鍘遍梺瑙勫劤椤曨厾绮诲Ο鑲╃＜妞ゆ梻鏅幊鍥殽閻愭潙绗掗摶鏍煥閻斿墎鐭欓柟顕嗙節瀵挳濮�閿涘嫬骞嶉梺鍝勵槸閻楁挾绮婚弽褜鐎舵い鏇嫹闁哄矉缍侀獮妯硷拷娑欘焽椤︺劑姊洪棃娑欐悙閻庢矮鍗抽妴浣割潨閿熶粙骞冮姀鈽嗘Ч閹煎瓨绻冨Ο濠傗攽閻樺灚鏆╅柛瀣洴楠炲﹨绠涘☉娆愭珖闂侀潧绻堥崐鏇㈡嫅閻斿摜绠鹃柟瀵稿仧閹冲嫰鏌涙惔锝呮灈闁哄本娲濈粻娑㈠即閻愭劑鍨洪妵鍕敃閿濆懏璇炲┑顔硷攻濡炶棄鐣烽锕�绀嬫い鎾跺Т婵晫绱撻崒姘拷鍝ョ矓瀹曞洦顐芥慨妯垮煐閸嬫ɑ銇勯弬璺ㄦ癁闁哄閰ｉ弻鐔煎箚瑜忛敍宥嗐亜閿旇姤绶叉い顏勫暣婵″爼宕卞Δ鍛疂闂備礁婀遍崗姗�寮ㄩ柆宥呂﹂柛鏇ㄥ枤閻わ拷闂佽宕樺▔娑㈡偂閻斿皝鏀芥い鏃傘�嬪銉︺亜椤撶偛妲婚柣锝囧厴楠炴帡骞嬮弮锟介悗濠氭⒑瑜版帒浜伴柛鐘虫崌瀹曟垵螣鐠佸磭绠氶梺缁樺姦娴滄粓鏁撻懞銉уⅹ闁崇粯妫冮弫鍐磼濮橆剛鐛╂俊鐐�栧濠氬储瑜忛懞閬嶅Ψ閳哄倵鎷绘繛杈剧到閹诧紕鎷归敓鐘崇厱閹煎瓨绋戦敓鑺ョ箞婵℃挳宕橀鐓庣獩濡炪倖鐗楅崙鐟拔涘鍕瘈闁汇垽娼ф牎缂佺偓婢樼粔褰掑箖閿熺姵鍋勯柛蹇氬亹閸樻悂姊洪崨濠傚闁告柨鐭傞弫鎾绘寠婢跺鍠愰梺杞扮贰閸ｏ絽鐣峰鍕闁绘垶锕槐锟犳⒒娴ｇ瓔鍤冮柛銊ラ閻ｆ繈鏁撴禒瀣Е閻庯綆鍠楅埛鎴︽煕濠靛棗顏い顐畵閺屾盯寮敓浠嬪垂閸ф宓侀柛鎰靛枛鍥存繝銏ｆ硾閿曪箓鏁嶅鍐ｆ斀闁绘劖娼欓悘锕傛煥閺囨娅嗛悗闈涖偢閺佹捇鏁撻敓锟�?? by changhao
					{
						Result result = new Result(true);
						
						//闂傚倸鍊搁崐鎼佸磹閹间礁纾归柟闂寸绾惧綊鏌熼梻瀵割槮缁炬儳缍婇弻鐔兼⒒鐎靛壊妲紒鎯у⒔閹虫捇鈥旈崘顏庢嫹閿濆簼绨奸柟鐧哥秮閺岋綁顢橀悙鎼闂侀潧妫欑敮鎺楋綖濠靛鍊锋い鎺炴嫹妞ゅ繗鍩栨穱濠囧Χ閸ヮ灝銉╂煕鐎ｎ偆娲撮挊婵嬫煟閵忋埄鐒鹃柡瀣╄兌閿熻棄绠嶉崕閬嵥囬婊呯焼閻庯綆鍋佹禍婊堟煙閸濆嫮肖闁告柨绉甸妵鍕棘閹稿骸鏋犲┑顔硷功缁垶骞忛崨瀛樺殟闁靛／渚婃嫹婵犲洦鈷戦柛婵勫劚鏍￠梺鍦焾椤兘鐛崼銉ノ╃憸婵嬪箯閻戣姤顥堟繛鎴炵懄閸犳劗绱掗悙顒�鍔ら柕鍫熸倐瀵顓兼径濠佺炊闂佸憡娲﹂崜娆忊枍閵堝鈷戦柟鎯板Г閺侀亶鏌涢妸銉у煟濠碉紕鏁诲畷鐔碱敍濮橀硸鍞洪梻浣虹帛閸旀牕顭囧▎鎿冩晜闁告挷鑳剁壕浠嬫煕鐏炲墽鎳呮い锔奸檮閵囧嫰鏁傞崹顔肩ギ濡ょ姷鍋為崝娆撶嵁鎼淬劍瀵犲璺虹焾閸炵敻姊绘担渚敯闁规椿浜浠嬪礋椤栨氨锛涢梺鍛婃处閸嬶拷闁猴拷娴犲鐓曢悘鐐村劤閸ゎ剚淇婇崣澶嬨仢闁哄本鐩幃娆撳垂椤愶絾鐦撴繝娈垮枛閿曘儱顪冮挊澶屾殾闁靛濡囩弧锟介梺鍛婂姂閸斿酣鎮￠鐐粹拻濞达絽鎼敮鍫曟煕閻旈攱鍋ラ柟顔哄劜缁虹晫绮欑捄銊ф毇闂備胶绮崹鍨珶濞嗘劕绶為柟閭﹀幖娴犙囨⒑鐠恒劌娅愰柟鍑ゆ嫹 by changhao
						Module.logger.info("闂傚倸鍊搁崐鎼佸磹閹间礁纾归柟闂寸绾惧綊鏌熼梻瀵割槮缁炬儳缍婇弻鐔兼⒒鐎靛壊妲紒鐐劤缂嶅﹪寮婚敐澶婄闁挎繂鎲涢幘缁樼厱闁靛牆鎳庨顓㈡煛鐏炲墽娲存鐐达耿閹崇娀顢楁径瀣撴粓姊绘担瑙勫仩闁告柨绉堕幑銏ゅ礃椤斿槈锕傛煕閺囥劌鐏犻柛鎰舵嫹闂備線娼ц噹濞撴艾锕ョ�氬綊鏌熼悜姗嗘畷闁绘挾鍠愮换婵嬫濞戞瑯妫ら梺绯曟櫔缂嶄線寮婚垾宕囨殕閻庯綆鍓涢惁鍫ユ倵鐟欏嫭绀�闁绘牕鍚嬫穱濠囨倻閽樺）銊ф喐瀹�鍕畺闁挎繂顦伴埛鎺懨归敐鍛础婵狅拷娴犲鐓曞┑鐘插枤濞堟粎锟借娲橀崹鍧楃嵁濮楋拷閹虫粓妫冨☉妯煎搸濠电姷鏁搁崑鐐哄垂椤栫偛鍨傞柛锔诲幘娑撳秹鏌ㄥ┑鍡橆棤缂佺娀绠栭弻娑㈠焺閸愮偓鐣肩紓浣哄У婵炲﹪寮诲☉銏犵睄闁跨喍绮欓獮鎰板礃瀹割喗缍庨梺缁樺灦钃卞┑顔界矒閺岀喎鈻撻崹顔界彯濠碘�虫▕閸ｏ絽顫忓ú顏勭閹兼番鍨归ˇ鈺傜箾鐎涙鐭ゅù婊勭矒椤㈡岸鏁愰崱娆戠槇濠殿喗锕╅崕鐢稿煛閸涱喚鍘撻梺鍛婄箓鐎氼剟鏁撻挊澶嬪暈缂佸倸绉归幃娆撴倻濡攱瀚肩紓鍌欑椤戝棛锟界瑳鍐胯�块柟娈垮枤绾惧ジ鎮楅敐搴′簻闁诲繐鐡ㄩ妵鍕閳╁喚妫冮梺杞扮劍閹瑰洭寮幘缁樻櫢闁跨噦鎷�:" + roleid + "濠电姷鏁告慨鐑藉极閸涘﹥鍙忛柣鎴ｆ閺嬩線鏌涘☉姗堟敾闁告瑥绻橀弻锝夊箣閿濆棭妫勯梺鍝勵儎缁舵岸寮婚悢鍏尖拻閻庨潧澹婂Σ顔剧磼閻愵剙鍔ゆ繛纭风節瀵鎮㈤悮瀛樺闁汇垺顔栭悞鍓э拷娑欑箘缁辨挻鎷呴悾灞界墯闂佺锕ョ换鍫濐嚕婵犳碍鏅濋柨鐔凤拷鐔轰航濠电偞鎸婚崙褰掑垂闁秵鏅柛鈩冪♁閸嬧剝绻濇繝鍌涘櫣妞わ絽銈搁幃浠嬵敍濞戞顑傛繝銏ｎ潐濞叉缂撴禒瀣窛濠电姴瀚獮妤呮⒒娴ｅ摜绉洪柛瀣躬瀹曡瀵肩�涙ê鍓┑鐐叉▕娴滄繈鎮￠悢鍝ョ闁瑰鍋熸晶顏堟煕閺冿拷瀹�鎼佸蓟瀹ュ洦鍠嗛柛鏇ㄥ亞娴煎苯顪冮妶鍐ㄧ仾闁荤啙鍛灊闁汇垻顣幏鐑芥晲鎼粹�愁潻婵犳鍠栭崥瀣崲濠靛鍋ㄩ梻鍫熺◥缁泛顪冮妶蹇涙濠㈢懓妫涢崚鎺戔枎閹惧磭顔掗柣搴ㄦ涧閹芥粏銇愭ィ鍐┾拺闁告繂瀚崒銊╂煕閵婏附銇濈�规洜鏁婚獮鎺懳旀担鍝勫妇闂備礁澹婇崑鍛崲閸愵啟澶婎煥閸喓鍘搁柣搴秵閸嬪嫰鎮橀幘顔界厸鐎癸拷閿熶粙宕伴弽顓炵疇婵犻潧顑嗛崑瀣煕椤愶絿绠栭梺娆惧幘缁辨捇宕掑▎鎴濆閻熸粍婢橀崯顐︹�﹂崶顒佹櫢闁绘灏欓悾楣冩煟韫囨洖浠╃悮娆撴煛鐎ｎ亪鍙勯柣鎿冨亰瀹曡埖顦版惔銏犱还闂備礁鎽滈崑鐔煎极鐠囧樊娼栨繛宸簻缁�鍌炴煕韫囨洖甯堕柨鐔诲Г閸旀牜鎹㈠☉娆愬闁告劖褰冮顏堟煕濞嗗繒绠婚柡灞剧洴婵＄兘濮�閳╁啰褰囩紓浣哄亾閸庢娊濡堕幖浣歌摕闁挎繂鎲橀悢鍏煎�绘俊顖炴敱閻忓棝姊绘担铏瑰笡闁瑰憡鎮傛俊鍫曞箹娴ｆ瓕鎽曢梺鎸庣☉鐎氼亜鈻介鍫熺厱闁圭偓顨呯�氼剟宕规潏銊ょ箚闁靛牆娲ゅ暩闂佺顑囬崑銈夊极閸愵喖顫呴柕鍫濇噽閻ゅ洭姊虹紒妯忣亪鎮樺顒傛殾濠㈣埖鍔栭悡鏇熺節闂堟稒顥滄い蹇婃櫊閺屻倝宕归銏狀潚濠殿喖锕ら…宄扮暦閹烘垟鏋庨柟鎼幗琚﹂梻鍌欐祰椤绮婇幘顔芥櫢闁稿﹦鍠撹ⅵ闂佸憡绻傜�氬嘲顭囬妸鈺傜叆闁绘柨澧庨惌娆戯拷娈垮櫘閸嬪﹤鐣峰锟介、娆戝枈鏉堛劎绉遍梻鍌欒兌缁垶鎮烽柆宥呯闂佸灝顑囩粻楣冩煕韫囨艾浜瑰褜鍓涚槐鎺旂磼濡皷妲堝銈嗘煥缁绘﹢銆佸▎鎾村殥闁靛牆鎳庡В鍫ユ⒒閸屾瑨鍏屾い顓炵墛椤ㄣ儵骞栨担鐟板壒闂佺鐬奸崑娑㈡嫅閻斿摜绠鹃柟瀵稿�戝顑╋綁宕奸悢绋垮伎濠德板�ч幏鐑芥煟濡わ拷濡瑧锟介潧銈搁獮鍥敆婢跺鐦滈梻渚�娼ч悧鍡涘箠濮楋拷閹澘顭ㄩ崼鐔哄幍闂佸憡鍨崐鏍拷姘炬嫹?闂傚倸鍊搁崐鎼佸磹閹间礁纾归柟闂寸绾惧綊鏌熼梻瀵割槮缁炬儳缍婇弻鐔兼⒒鐎靛壊妲紒鐐劤缂嶅﹪寮婚敐澶婄闁挎繂鎲涢幘缁樼厱闁靛牆鎳庨顓㈡煛鐏炲墽娲存い銏℃礋閺佹劙宕卞▎妯恍氶梻鍌欒兌椤牏鎮锕�绀夐幖娣妼缁犵喖鏌熼梻瀵割槮缂侇偄绉归弻娑㈩敃閿濆洨鐣奸梺浼欑稻濡炶棄顫忛搹鍦煋闁糕剝顨呴瀛樼箾閸喐顥堥柡宀嬬秮楠炲洭顢楁繝鍐╂毎闂備線娼уú銈囷拷姘嵆閵嗕礁螖娴ｅ摜绐炴繝鐢靛Т閸嬪棗顭囨禒瀣拻濞达絽鎼崝锕傛煛閸涱亝娅婄�规洝顫夌�佃偐锟芥稒锚娴犲ジ姊虹紒妯虹伇濠殿喓鍊濆畷鎴﹀礋椤撶姵锛忛梺鐟板槻閻倿宕ú顏呯厸闁告粈绀佹晶顕�鏌嶇憴鍕伌妞ゃ垺鐟х划鐢碉拷锝庡墮婵厧鈹戦悙鑼憼缂侇喚濞�瀹曟粓鎮㈡總澶婃闂佺懓澧庨悺鏃堝极閸愵喗鐓ユ繝闈涙瀹告繈鏌ｉ敃锟介悧鎾诲箖濡ゅ懎绀傜紒瀣仢缁侇噣姊洪悮瀛樺闂佸憡顨堥崕鎰版偄閸℃ɑ鍙忔俊銈咁儐鐎氬綊姊烘潪鎵妽闁圭懓娲獮濠囨倷閸濆嫀銊╂煥閺冨倽妾告俊鑼额潐娣囧﹪濡堕崶顬儵鏌涚�ｎ偆娲撮柡浣稿暣婵＄兘鍩℃担铏规毎闂備礁鎼崯顐︽偋婵犲洤鐤鹃柡灞诲劜閻撴洟鏌曟径鍫濈仾婵炲懎娲弻娑㈠籍閸ャ劎銆愰梺瀹狀潐閸ㄥ潡骞冮埡鍜佹晩闁兼祴鏅欑槐姗�姊绘担铏广�婇柡鍛矒閹囨偐閼碱剚娈惧┑鐘绘涧椤戝懘宕橀敓钘夘渻閵堝棙灏甸柛鐘插缁傚秴螖閸涱喒鎷虹紓鍌欑劍钃辨い銉ョ墦閺岋繝宕ㄩ弶璺ㄦ闂佺懓绠嶉崹钘夌暦閸楃倣鐔兼⒐閹邦喚娉块梻鍌欑閹碱偆绮旈弻銉ョ閹兼番鍔嶉崕妤�鈹戦悩鍙夊闁稿鍔嶉妵鍕冀閵婏妇娈ら梺绯曟櫔缂嶄線寮婚敍鍕勃闁告挆鍕灡闁诲孩顔栭崳顕�宕滃▎鎾崇厺閹兼番鍔岀粻姘辨喐瀹ュ棛鐝堕悗锝庡墰绾句粙鏌涚仦鍓ф噭缂佷焦婢橀—鍐级閹寸偞鍠愰梺杞扮贰閸犳牞鐏冮梺鍛婁緱閸橀箖顢欓崱娑欌拺闁告稑锕﹂埥澶愭煟鎺抽崝鎴濈暦閹邦喚纾兼俊顖氭贡缁犳艾顪冮妶鍡欏缂侇喖鐬奸弫顕�宕滄担铏癸紲闂佽偐鈷堥崜娆撍囬悶顤﹖icleSkill闂傚倸鍊搁崐鎼佸磹閹间礁纾归柟闂寸绾惧綊鏌熼梻瀵割槮缁炬儳缍婇弻鐔兼⒒鐎靛壊妲紒鐐劤缂嶅﹪寮婚敐澶婄闁挎繂鎲涢幘缁樼厱闁靛牆鎳庨顓㈡煙椤旀娼愰柕鍫閹叉濡惰箛鏂款伓闂佽法鍠嶇划娆撳蓟閿涘嫸鎷烽敐搴濈敖閺佸牓姊洪崫鍕拱婵炲弶绻勭划璇测槈濮樼偓瀚归柨婵嗙凹閹秹鏌熸搴″幋鐎殿喗鎸抽幃鈺呭礂閸濄儳鎲瑰┑锛勫亼閸婃牠鎮у鍫濈；闁绘劗鍎ら崑鍌炴煏婢跺棙娅嗛柣鎾跺枛閺岋繝宕堕埡浣风捕闂佽法鍠曞Λ鍕耿闁秵鏅搁柤鎭掑劤閸熸煡鏌熼崙銈嗗?闂傚倸鍊搁崐鎼佸磹閹间礁纾归柟闂寸绾惧綊鏌熼梻瀵割槮缁炬儳缍婇弻鐔兼⒒鐎靛壊妲紒鐐劤缂嶅﹪寮婚敐澶婄闁挎繂鎲涢幘缁樼厱闁靛牆鎳庨顓㈡煛鐏炲墽娲存い銏℃礋閺佹劙宕卞▎妯恍氶梺鍝勵槴閺呮粎鎹㈤崼銉ヨ摕闁挎繂妫欓崕鐔搞亜閺嶃劎鐭岄弽锟犳⒒娴ｅ憡鎲稿┑顔炬暬閹冾煥閸涱厼鐏婃繝鐢靛У閸戝綊寮澶嬬厽闁归偊鍓﹂崵鐔兼煕濞嗗繑顥㈡慨濠呮缁辨帒螣閼姐値妲梻浣侯焾閿曘倕锕㈤柆宥嗘櫢闁兼亽鍎抽崯鏌ユ煙閸戙倖瀚�?");
						if(which == 2)
							result.updateResult(skillrole.addPracticleSkillBuff());
						else if(which == 1)
						{
							PetColumn petColumn = new PetColumn(roleid, PetColumnTypes.PET, false);
							for(Pet pet : petColumn.getPets())
							{
								SkillPet spet = new SkillPet(pet.getPetInfo(), roleid);
								Result resultpet = spet.addSkillBuffWhileOnline(null);
								BuffPetImpl buffpet = new BuffPetImpl(roleid, pet.getPetInfo().getKey());
								buffpet.psendSBuffChangeResult(resultpet);
								spet.updateSkillBuffWhileOut(null);
							}							
						}
					
						if(!result.getChangedAttrs().isEmpty())//闂傚倸鍊搁崐鎼佸磹閹间礁纾归柟闂寸绾惧綊鏌熼梻瀵割槮缁炬儳缍婇弻鐔兼⒒鐎靛壊妲紒鐐劤缂嶅﹪寮婚悢鍏尖拻閻庨潧澹婂Σ顔剧磼閹冣挃闁硅櫕鎹囬垾鏃堝礃椤忓孩瀚归柨婵嗙凹缁ㄧ粯銇勯幒瀣仾闁靛洤瀚伴獮鍥敂閸℃瑧鍘梻浣告惈鐞氼偊宕濋幋锕�绠栭柕蹇嬪�曟导鐘绘煕閺囩喎鐏熼柛銊ヮ煼閹拷妞ゅ繐鐗嗙粻姘辨喐濠婂牊鍋傚┑鍌氭啞閻撴盯鎮橀悙鎻掆挃闁宠棄顦甸弻宥夋寠婢舵ɑ鈻堥悗瑙勬穿缁绘繈骞冨▎鎾崇闁圭儤绻傛俊褎绻濋悽闈浶ラ柡浣规倐瀹曟垵鈽夐姀鈥冲壄闂佺粯鍨煎Λ鍕偪妤ｅ啯鐓熸俊顖涱儥閸ゆ瑩鏌﹂崘顏勬灈闁哄矉绻濆畷鍫曞煛娴ｅ湱浜栫紓鍌欒兌婵烇拷缂佺姵鐗犲濠氭晲婢跺﹦鐤�闂傚倸鐗婄粙鎴︼綖椤忓牊鈷戠紓浣诡焽缁犳牗绻涢懠顒�鏋庢い顐㈢箻閹煎綊宕烽鐘靛幆婵犵數鍋涘Λ娆撳磿閹惰棄绀堝ù鐓庣摠閳锋垹绱掔�ｎ亜鐨＄�规悶鍎茬换娑氫焊閺嶅灚瀚归柟棰佺濞堛劍绻濋悽闈浶ｉ柤鍦亾閸庮偊姊绘笟锟藉褔藝椤撱垹鍨傛繛宸悍缂嶆牜锟藉箍鍎遍幊澶愬绩娴犲鐓冮柦妯侯槹椤ユ粓鏌ｈ箛鏇炴灈闁诡喖缍婇弫鎾寸鐎ｎ偅娅嗛梺浼欑到閻牆霉閸曨垱鈷戦柤濮愬�曢弸鎴濐熆閻熼偊鍎旂�殿喓鍔嶇粋鎺旓拷锝庡亞閸樹粙姊鸿ぐ鎺戜喊闁搞劋鍗抽幆鍐洪鍛幗闂佸湱鍎ら幐鎼佸礉閵堝顥嗗璺侯儑缁★拷婵犵數濮撮崐濠氬礄瑜版帗鈷戞い鎾楀啰浠梺璺ㄥ枙婵倝顢欓弽顓炵獥闁哄稁鍘搁敓鏂ょ畵閹粓鎸婃径瀣拷顒勬⒑瑜版帒浜伴柛妯垮亹濞嗐垽鎮欏ù瀣杸闂佺粯蓱瑜板啴顢旈锔界厸濠㈣泛顑嗛崐鎰叏婵犲嫮甯涢柟宄版噽缁瑩骞愭惔鈽呮嫹椤栫偞鈷戦悹鍥ｏ拷铏亪闂佺锕ラ幃鍌炲灳閿曞倸鐐婃い蹇撶У閳诲本淇婇悙顏勶拷鎴﹀垂閸濆嫀娑㈠礃椤斿吋鐎梺鐟板⒔缁垶寮查幖浣圭叆闁绘洖鍊圭�氾拷?闂傚倸鍊搁崐鎼佸磹閹间礁纾圭�瑰嫭鍣磋ぐ鎺戠倞鐟滃繘寮抽敃鍌涚厽闁靛繈鍩勯悞鍓х磼閹邦収娈滈柡宀�鍠栭弻鍥晝閿熶粙寮稿☉銏＄厱闁靛濡囩粻姗�鏌ㄩ悢鐑樻珪婵炲懌鍨介獮蹇涙倻閼恒儳鍘遍梺鍝勬储閸斿本鏅舵导瀛樼厱婵☆垵顕ф慨宥嗘叏婵犲啯銇濇鐐村姈閹棃鏁愰崶鈺傛闂傚倷鑳堕幊鎾诲床閺屻儺鏁勫璺猴功閺嗭箓鏌ｉ姀銏╃劸闁告濞婇弻锝夊籍閸屾粎鐦堢紓浣靛妼椤嘲顫忛搹瑙勫枂闁告洦鍓涢崙鈩冪節閳凤拷閸愵喖寮板Δ鐘靛仜閸燁垳缂撴禒瀣窛濠电偟鍋撶�氫粙姊绘担鍛婂暈婵炶绠撳畷鎴﹀礋椤栵絾鏅滃銈嗗姂閸婃澹曟總绋跨骇闁割偅绋戞俊鑲╃磼濡烇箑娲﹂悡銉╂煟閺傛寧鍟為柣蹇ｅ枤缁辨挸顓奸崨顕呮＆閻庤娲忛崹浠嬪箖閸撗傛勃闁诡垎鍐ㄧ闂傚倷鑳堕崢褔骞楀鍫濈；闁挎繂妫涢々鍙夌節婵犲倻澧涢柣鎾卞劦閺岋繝宕掑鍙樿檸闂佽鍠楅崹鍧楀箖濡わ拷椤繈鎮欓锟介锟�? by changhao
						{
							mkdb.Procedure.psendWhileCommit(roleid,new SRefreshRoleData((HashMap<Integer, Float>)result.getChangedAttrs()));
						}		
						fire.log.YYLogger.roleSkillUPLog(roleid, new RoleSkillUpBean(id, practiceskill.getLevel()));
					}					
				}
				else if (msg.skill.level == 0)
				{
					msg.skill.nexteffect.putAll(CalcSkillEffect(config.skillId, 1));
				}
				
				mkdb.Procedure.psendWhileCommit(roleid, msg);				
				mkdb.Procedure.pexecuteWhileCommit(new fire.pb.ranklist.proc.PRoleZongheRankProc(roleid));
				
				if (practiceskill.getLevel() > curskilllevel) {
					fire.pb.course.CourseManager.checkAchieveCourse(roleid, CourseType.XIULIAN_COURSE, practiceskill.getLevel());
				}
				
				return true;
			}
		};
		
		requestlearnparticleskill.submit();	
	}
	
	/***
	 * 濠电姷鏁告慨鐑藉极閸涘﹥鍙忛柣鎴ｆ閺嬩線鏌涘☉姗堟敾闁告瑥绻橀弻锝夊箣閿濆棭妫勯梺鍝勵儎缁舵岸寮婚悢鍏尖拻閻庨潧澹婂Σ顔剧磼閻愵剙鍔ゆ繛纭风節瀵鎮㈤悮瀛樺闁汇垺顔栭悞鍓э拷娑欑箘缁辨挻鎷呴悾灞界墯闂佺锕ョ换鍫濐嚕婵犳碍鏅濋柨鐔凤拷鐔轰航濠电偞鎸婚崙褰掑垂闁秵鏅柛鈩冪♁閸嬧剝绻濇繝鍌涘櫣妞わ絽銈搁幃浠嬵敍濞戞顑傛繝銏ｎ潐濞叉缂撴禒瀣窛濠电姴瀚獮妤呮⒒娴ｅ摜绉洪柛瀣躬瀹曡瀵肩�涙ê鍓┑鐐叉▕娴滄繈鎮￠悢鍝ョ闁瑰鍋熸晶顏堟煕閺冿拷瀹�鎼佸蓟瀹ュ洦鍠嗛柛鏇ㄥ亞娴煎苯顪冮妶鍐ㄧ仾闁荤啙鍛灊闁汇垻顣幏鐑芥晲鎼粹�愁潻婵犳鍠栭崥瀣崲濠靛鍋ㄩ梻鍫熺◥缁泛顪冮妶蹇涙濠㈢懓妫涢崚鎺戔枎閹惧磭顔掗柣搴ㄦ涧閹芥粏銇愭ィ鍐┾拺闁告繂瀚崒銊╂煕閵婏附銇濈�规洜鏁婚獮鎺懳旀担鍝勫妇闂備礁澹婇崑鍛崲閸愵啟澶婎煥閸喓鍘搁柣搴秵閸嬪嫰鎮樼�涙ü绻嗘い鎰╁灪閸ゅ洦銇勯姀鈩冪濠殿噯鎷烽梺鐐藉劜閸撴艾危鏉堛劎绡�闁汇垽娼ф禒婊咃拷娈垮枛閻栧ジ骞冭閹晠鎳犻浣诡啎闂備浇宕甸崰鎰珶鐎ｎ喖缁╁ù鐘差儐閸婄敻鏌ㄥ┑鍡涱�楀ù婊呭仱閺屾稑螣閸濆嫯鍩炲銈庝簻閸熷瓨淇婇懜鍨劅闁炽儱纾鎴︽⒒娴ｈ鍋犻柛鏂跨焸閹ê顫濇潏鈺冪効閻庡箍鍎遍幏瀣偂閵夆晜鐓曟繛鎴濆船閻忥綁鏌ㄥ☉娆戠煉婵﹥妞藉畷銊︾節閸愩劎鐓紓鍌欑筏閹峰嘲霉閿濆懏璐℃い鈺咁棑閹叉悂寮崼婵婃憰闂侀潧艌閺呮粓宕戦崟顖涚厽闁瑰鍊栭幋锔藉仧妞ゅ繐瀚ч弨浠嬫煟閹邦剙绾ч柛锝囧厴閺屾盯濡搁妶鍥╃厯闂佺粯渚楅崰娑氱不濞戞ǚ妲堟繛鍡楅獜閹烽攱绻濆顓犲幘闂佽鍘界敮鎺楀礉閵堝鐓曟慨妤嬫嫹濞存粏娉涢～蹇撁洪鍕炊闂佸憡娲﹂崜娆撳磻瀹ュ鈷戦柛娑橈攻閻撱儵鏌ｉ鐐诧拷鍧楀箖娴兼惌鏁嬮柨鐔绘椤曪絾绂掔�ｅ灚鏅濋梺闈涚墕濞村嫮妲愰弻銉︹拻濞达綀濮ょ涵鍫曟煕閻樿尙肖闁告帗甯掗埢搴ょ疀閺囩喐顔曞┑鐘绘涧閸婂鈥﹂崼婵囨殰闂傚倷鐒︾�笛兾涙笟锟介敐鐐村緞瀹�瀣婵娅曢ˉ澶愭煃鐟欏嫬鐏撮柟顔界懇閹虫粓妫冨☉娆撴暘缂傚倸鍊峰ù鍥ь嚕閹捐泛鍨濇繛鍡樻尵瀹撲礁顭块懜闈涘闁哄懏鎮傞弻锝呂熼崹顔炬闂佸搫鑻悧鎾愁潖閾忓湱纾兼俊顖氭惈椤矂姊虹�癸附婢樻慨鍌滐拷瑙勬穿缂嶏拷缂佺姵鐩獮姗�顢涘☉娆愭緫闂傚倷鑳剁划顖濇懌閻熸粍婢橀崯鎾�侀弮鍫晝闁挎棁妫勬禒鍝勵渻閵堝棛澧紒瀣尭鐓ら柟缁㈠枟閻撴稓锟界櫢鎷烽柨鐔剁矙瀹曚即骞囬鍓х暥闂佺粯姊婚崢褔宕归崒娑栦簻闁哄啫鍊甸幏锟犳煟鎼达紕鎽犲ǎ鍥э躬閹瑩顢旈崟鑸靛鐟滃孩绌辨繝鍥х倞闁靛闄勯悵宄扳攽鎺抽崐鏇㈠箠鎼达絿涓嶆慨妯垮煐閻撴盯鏌涢幇鈺佸濠⒀勬礋閺岋綀绠涢幘璁圭礊闂佽法鍠庨敓鐣屽櫏濞兼劖绻涢崣澶屽ⅹ閻撱倝鏌ㄥ┑鍡╂Ц缂佹劖顨呴埞鎴︽偐閸欏顦╅梺鎶芥敱鐢繝寮诲☉姘勃闁告挆鍕珮闂備礁鎲￠弻銊х矓瑜版帒钃熼柨娑樺閹风兘鏁愭惔婵堟殫闂佺顑冮崹濠氭晸閼恒儺鍟忛柛鐘愁殙閵囨劙宕橀鑲╁弨婵犮垼鍩栭崝鏇綖閸涘瓨鐓熸俊顖氬悑閺嗏晝锟借娲濋崺鏍崲濠靛棌鏋旈柛顭戝枟閻忓秹姊洪幐搴㈢５闁哄懐濮撮悾宄拔旈敓浠嬶綖濠婂牊鏅搁柦妯侯樈閸ゆ洟鏌熼梻瀵割槮缂侇偄绉归弻娑㈩敃閵堝懏鐏侀梺鍛婄懃濡繂顫忛搹鍦＜婵☆垵宕甸ˇ銉╂⒑缁嬪尅宸ユ繝锟介柆宥嗘櫢闁兼亽鍎抽崯鏌ユ煙閸戙倖瀚�? by changhao
	 * @param requirelevel
	 * @param curexp
	 * @param skill
	 */
	public void AddExp(int curskilllevel, int curexp, xbean.PracticeSkill skill, int curmaxlevel)
	{
		int maxexp = LiveSkillManager.getInstance().GetPracticleSkillNeedExp(id, curskilllevel); //闂傚倸鍊搁崐鎼佸磹閹间礁纾归柟闂寸绾惧湱锟界懓瀚崳纾嬨亹閹烘垹鍊炲銈嗗笒椤︿即寮查鍫熷仭婵犲﹤鍟版晥濠电媴鎷峰〒姘炬嫹婵﹨娅ｇ槐鎺懳熼搹閫涚礃婵犵妲呴崑鍕拷姘緲椤曪綁宕ㄦ繝鍕嚌闂佽法鍠嶇划娆忣嚕鐠囨祴妲堟俊顖炴敱椤秴鈹戦绛嬫當闁绘锕顐﹀箚瑜夐弨浠嬫煟閹邦剙绾ч柛锝堟閳规垿顢欓懖鈺�绮电紓浣哥焷妞村摜鎹㈠┑瀣倞妞ゎ剦鍎搁崶銊у幈濠电偞鍨靛畷顒勫几濞戞瑧绠鹃柛婊冨暟缁★拷濠殿喖锕ㄥ▍锝夊箲閸曨垰惟闁靛濡囨禍鐐寸節绾版ɑ顫婇柛瀣閿熻姤纰嶅姗�鎮鹃悜绛嬫晬闁绘劘灏欐鍥⒑閻熼偊鍤熷┑顕�娼ч埢鎾淬偅閸愨斁鎷洪梻鍌氱墛閸楁洟宕奸妷銉ф煣濠电偞鍨跺銊ノ涢婊勫枑闁哄啫鐗嗛拑鐔兼煟閺冨倸鐨戦柟椋庡厴閹棄鈻撶捄銊ュЪ濠电偛顕刊瀛樹繆閸ヮ剙绠栨い鏇嫹闁轰焦鍔栧鍕拷锛卞嫬顏归梻浣藉吹婵潙煤閵堝拋鍤曢柛顐ｆ礀缁犳煡鏌ㄥ┑鍡橆棤缂佺娀绠栭弻娑樷槈閸楃偘绨婚梺璇茬箰瀵爼銆冮妷鈺傚�烽柤纰卞墰椤旀帡姊虹拠鈥虫灍缂侇喗鎹囬獮濠囨倷閸濆嫀銊ф喐瀹ュ宓侀柛顐犲劜閳锋帒霉閿濆懏鍟為柟顖氱墛缁绘稓浠﹂崒姘变紙閻庤娲樼换鍕閿曞倸绀堢憸婊兠洪幖浣光拺缂備焦锚婵牓鏌ｉ敐搴濈凹缂佸倸绉撮…銊╁醇閻斿搫甯鹃梻濠庡亜濞诧箑煤閺嶃劎澧￠梻鍌欑劍閹爼宕愰弴鐏绘椽鏁冮崒姘辩杽闂侀潧顭俊鍥╁姬閿熶粙姊洪崨濠傚闁哄倸鍊圭粋鎺楀閻樻牗妫冮幃鈺呮濞戞鍕冮梻浣虹帛椤ㄥ牊绻涢敓鑺ヮ殽閻愭彃鏆欓柍璇查叄楠炴ê鐣烽崶璺烘杸闂傚倷绀佸﹢閬嶅磿閵堝鍚归柍鍝勬噹鍥撮梺鍛婁緱娴滄繈寮敓浠嬫⒒娴ｈ櫣甯涢柛鏃�顭囨禍绋库枎閹惧磭顔戦梺缁橆焽閺佸摜澹曢崗绗轰簻闁哄倽锟ラ崑銏ゆ煕濞嗗繐顏柨鐔凤拷鐕佹綈婵炲弶锕㈠畷褰掑锤濡わ拷缁犳牠鏌曡箛瀣拷鏇熷閻樼粯鐓曢柡鍥ュ妼娴滅偛霉濠婂嫭绶查柍瑙勫灴閹晠宕归锝嗙槑濠电姵顔栭崰姘跺极婵犳艾绠犳繝闈涙储閸嬪懘鏌涢幇鈺佸妞ゆ柨顦靛娲偂鎼淬垺鍠愰梺绋款儜缁插墽绮嬪鍜佺叆闁割偆鍠撻崢鐢告⒑绾拋娼愰柛鏃�鐗滃☉鍨偅閸愩劎鏌堥梺褰掓？閻掞箓鍩涢幋锔界厵缂佸瀵ч幑锝夋煃閸欍儴鍏岀紒杈ㄥ浮椤㈡瑩鎳為妷銉ь暡婵＄偑鍊ら崑鍕崲濮楋拷楠炴牞銇愰幒鎴炲祶濡炪倖鎸炬刊瀵告閸欏绡�缁剧増蓱椤﹪鏌涢妸銈呭祮鐎规洏鍎抽敓鏂ょ秵閸犳牠姊婚娑栦簻闁规儳宕悘顏堟煃闁垮鐏撮柡灞诲�栭幈銊╁箛椤掑﹥瀚归柡鍥ュ灩閸戠娀鏌涘畝锟介崑鐐烘偂閺囥垹绠规繛锝庡墮閿熻姤鎹囧畷銉╊敃閿旂晫鍘卞┑鐐叉缁绘垿宕甸崶銊﹀弿濠电姴鍟妵婵囶殽閻愭潙濮堥柟顖涙閸╂鍩￠崒姘间紲闂傚倸鍊风粈渚�骞栭锕�绠悗锝庡枛绾捐鈹戦悩鍙夋悙鏉╂繈姊洪崨濠勨槈闁宦板姂閹繝濡烽埡鍌氾拷鐢告煥濠靛棝顎楀ù婊勭矌閿熻姤顔栭崰鏍倶濠靛鐓橀柟瀵稿仜缁犵娀姊虹粙鍖℃敾婵炶尙鍠栭妴渚�寮介鐐茶�垮┑鐐叉閻燂妇锟芥俺顫夐幈銊ヮ潨閸℃顫紓浣割槺閸庛倝骞堥妸锔剧瘈闁告侗鍣禒鈺呮⒑瑜版帩妫戝┑鐑囨嫹闂佹悶鍔戠粻鏍箹瑜版帩鏁冮柕鍫濆椤ユ岸姊婚崒姘拷鐑芥嚄閸洍锟斤箓宕奸姀鈥冲簥闂佺鎻梽鍕疾椤忓懍绻嗛柣鎰典簻閿熻姤鐗曠叅闁冲搫鍟扮粈濠偯归敐鍛棌闁搞倖娲熼弻娑㈩敃閿濆棛顦ョ紓浣哄缁查箖濡甸崟顖氱閻犺櫣鍎ら悗濠氭⒑缁嬭法绠伴柨鏇ㄤ簻椤繒绱掑Ο璇差�撻梺鍛婄☉閿曘倝寮抽崼銉︹拺闁告稑锕ラ埛鎰版煟濡ゅ啫浠卞┑锛勬暬楠炲洭寮剁捄顭戞О婵＄偑鍊曠换鎰板箠韫囨挴鏋旈柡澶嬵儥濞撳鏌曢崼婵囶棤濠⒀屽墰缁辨帞锟斤綆鍋呯亸鐢碉拷娈垮暙閸ャ劍娅㈡繛瀵稿Т椤戝棝鍩涢幋鐐村弿闁荤喓澧楅幖鎰版煟韫囨挸绾х紒缁樼♁閹峰懘宕橀幓鎺濅紑濡炪倐鏅犻弨杈╂崲濠靛洨绡�闁稿本绮岄·锟介梻浣虹帛閹搁箖宕伴幇顓犫攳濠电姴娲ゅ洿闂婎偄娲﹂弻銊╊敂閸洘鈷掑ù锝囨嚀椤曟粍绻涚拠褔妾紒鍌氱Т椤劑宕奸悢铚傛偅闂備焦鐪归崐銈夊垂椤掍胶顩茬憸鐗堝笚閻撴瑩鏌ｉ幋鐏活亪鎮橀敂鎾呮嫹鐟欏嫭灏紒澶嬫尦閳ユ棃宕橀鍢壯囨煕閳╁厾顏堝汲濡ゅ懏鈷戦梻鍫氭櫇缁佺兘鏌涙惔銊ゆ喚闁炽儻绠撳畷鍫曨敆娴ｉ晲绨婚梻浣侯焾缁绘劙鎯冮悜钘夌婵炲樊浜濋埛鎴︽⒒閸碍娅呴柣锔界矒閺屾稑螣閹帒浠悗瑙勬礃缁诲嫰鏁撻弬銈囩У闁稿妫涚划缁樸偅閸愨晝鍘卞┑鐐叉濞存艾危濞差亝鐓熸い鎾跺枎濞搭噣鏌″畝锟介崰鏍�佸▎鎾崇闁绘挸绨煎ǎ顕�姊绘担鑺ャ�冮柣鎺炵畵楠炴垿宕堕锟界粻鏉库攽閻樻彃鏆欑紒鍓佸仱閺屾盯鍩勯崗鈺傚灴瀵爼骞栨担鍏夋嫽婵炶揪缍�濞咃絿鏁☉銏＄厱闁哄喛鎷烽柣妤佹礋閳ワ箓宕惰閺嬪酣鏌熼悙顒佺稇闁跨喕妫勯悥濂稿蓟閵娾晛鍗抽柣鎰嚋閹风柉銇愰幒鎾充簵闂佺粯锚閻忔岸宕伴幇鐗堢厽婵°倧鎷烽柣妤�妫涚划顓☆樄闁哄矉缍侀弫鎰板幢濡晲铏庨梻浣告惈閻ジ宕伴弽顓滐拷浣糕槈濮楀棙鍍甸柡澶婄墐閺呮稒鎱ㄩ柆宥嗏拻濞达綀濮ら妴鍐煟閹虹偟鐣垫鐐村灴瀹曞爼顢楅敓浠嬪几娓氾拷閺岀喖宕滆鐢盯鏌￠崨顔藉�愰柡灞诲姂閹倝宕掑☉姗嗕紦 by changhao
		int exp = curexp;
		while (exp >= maxexp)
		{
			exp -= maxexp;
			
			curskilllevel ++;
			maxexp = LiveSkillManager.getInstance().GetPracticleSkillNeedExp(id, curskilllevel);
			if (maxexp == -1) //闂傚倸鍊搁崐鎼佸磹閹间礁纾归柟闂寸绾惧綊鏌熼梻瀵割槮缁炬儳缍婇弻鐔兼⒒鐎靛壊妲紒鎯у⒔閹虫捇鈥旈崘顏庢嫹閿濆簼绨奸柟鐧哥秮閺岋綁顢橀悙鎼闂侀潧妫欑敮鎺楋綖濠靛鍊锋い鎺炴嫹妞ゅ繗鍩栨穱濠囧Χ閸ヮ灝銉╂煕鐎ｎ偆娲撮挊婵嬫煟閵忋埄鐒鹃柡瀣╃窔閺岀喖宕滆鐢盯鏌涚�ｎ偄濮堥柕鍥у瀵挳鎮欓幖顓燂紒闂佽瀛╅懝鍓х礊婵犲洤钃熸繛鎴欏灩缁犳盯姊婚崼鐔衡檨闁诲繐鐗撻幃妤呮偡閻楀牆鏆堢紓浣筋嚙閸熷瓨淇婇悽绋跨妞ゆ牗姘ㄩ濠囨⒑閻熸壆鎽犵紒璇插暣瀹曟劙顢涘锝嗘杸闂佹寧绋戠�氼剚绂掗埡浣叉斀妞ゆ柨鎼敓鑺ョ墱缁碍娼忛妸褏鐦堥梺鎼炲劀閸滀礁鏅ｆ繝鐢靛仩閹活亞绱為敓鑺ャ亜椤愩埄妲搁柍璇茬Ч瀹曞崬鈻庨幋鐙呯闯闂備胶顭堥張顒勬偡瑜斿畷婵嗩吋婢跺鍙嗛梺鍝勬处椤ㄥ棗鈻嶆繝鍕舵嫹鐟欏嫭澶勯柛銊ゅ嵆椤㈡﹢宕楅悡搴ｇ獮闁诲函鎬ラ崟顐紲濠电姷鏁搁崑鐘诲箵椤忓棛绀婇柨鐔诲Г閵囧嫰顢曢姀鈺傗枅閻庤娲橀崹鍧楀箖閳哄啰纾兼俊顖滃帶楠炲牓姊洪悷鏉挎倯闁伙綆浜畷鐟懊洪鍕庯附绻濋棃娑氬⒊闁圭兘顥撻幉鎾礋椤掑偆妲扮紓鍌欑贰閸犳牠鎯岄崒鐐叉槬闁靛繆鍓濋崕鐔兼煏婵炲灝鍔ゆい鎾存そ濮婅櫣绱掑鍡欏姺闂佽桨鐒﹂幃鍌氱暦濠靛閱囬柡鍥╁暱閹风粯绻涙潏鍓хК婵炲拑缍佹俊瀛樼節閸ャ劎鍘遍梺瑙勫劤椤曨厾绮诲Ο鑲╃＜妞ゆ梻鏅幊鍥殽閻愭潙绗掗摶鏍归敐澶嬫珳缂併劎鏁诲缁樻媴閾忕懓绗″┑鈽嗗亜閸熸潙顕ｉ弻銉﹀殤妞ゆ帊绀佹惔濠囨⒑缁洖澧茬紒瀣浮閹ょ疀濞戞瑧鍘卞銈嗗姧缁茶法绮诲Ο鑲╃＜闁绘ê纾崣锟介梺璇″枟椤ㄥ懘锝炲┑瀣垫晢闁稿本绨介妸銉㈡斀妞ゆ梻銆嬫Λ姘箾閸滃啰鎮兼俊鍙夊姍楠炴帡骞嬮鐔风紦闂備胶纭堕崜婵嬧�﹂崶顒�姹查柕澶嗘櫆閳锋帒霉閿濆洦鍤�妞ゆ洘绮嶇换娑㈠箵閹烘梻顔掗悗瑙勬礃濞叉牠鎮鹃悜钘夌倞鐟滃秹鎮樻繝鍥ㄧ厽閹兼惌鍨崇粔鐢告煕閻樺磭澧辩紒顔碱煼楠炲酣鎳為妷褍骞嶉梻浣告啞閸旀浜稿▎鎾存櫖鐎广儱顦伴悡鏇㈡煟濡搫鏆卞┑顔碱槺缁辨帡顢氶崨顓炵睄闂佽鍠撻崹濠氬窗婵犲啯缍囬柕濠忛檮閻濐偄鈹戦悩鍨毄濠殿喗鎸抽弫鍐Χ婢跺﹦鏌堝銈嗙墱閸嬫稑效閺屻儲鐓冮柛婵嗗閸ｆ椽鏌嶉柨瀣诞闁哄本绋撴禒锕傚礈瑜庨崳顔碱渻閵堝繗顓虹紒鐘冲灴閳ワ箓宕稿Δ浣镐画闁汇埄鍨奸崰娑㈠触椤愶附鍊甸悷娆忓缁�鍐煕閵娿儳浠㈤柣锝囧厴閹垻鍠婃潏銊︽珖闂佽鍑界紞鍡涘磻閸℃稑鐓″鑸靛姈閹虫岸鏌″搴″箺闁绘挻娲樼换娑㈠箣濠靛棜鍩炲Δ鐘靛仦閿曘垽寮婚妸銉㈡婵炲棙鍨堕崳顓犵磽娴ｈ櫣甯涚紒璇茬墦楠炲啯绂掔�ｎ偒妫冨┑鐐殿棎椤旀劗绱炴笟锟藉濠氬Χ閸稐姹楅梺鍦劋濮婂寮抽锔解拺閻犲洠锟借櫕鐏堝┑鐐点�嬬换婵嬪Υ娴ｅ壊娼╅柤绋跨仛濞呫垺绻涚�电孝妞ゆ垵鎳橀幏鎴︽偄閸忚偐鍘繝鐢靛仧閸嬫挸鈻嶉崱娑欑厱閻庯綆浜濋ˉ銏ゆ煛鐏炲墽銆掑ù鐙呯畵瀹曟粏顦俊鎻掔墕椤啴濡堕崨瀵稿椽闂佺懓鍤栭幏锟� by changhao
			{
				skill.setLevel(curskilllevel);
				skill.setExp(0);
				return;
			}
		}
		
		if (curskilllevel > curmaxlevel)
		{
			curskilllevel = curmaxlevel;
		}
		
		skill.setLevel(curskilllevel);
		skill.setExp(exp);
	}
	
	public java.util.HashMap<Integer,Float> CalcSkillEffect(int skillid, int level)
	{
		java.util.HashMap<Integer,Float> effect = new java.util.HashMap<Integer,Float>();
		
		FightSkillConfig sconf = fire.pb.skill.Module.getInstance().getFightSkillConfig(skillid);
		if (sconf != null)
		{
			FightJSEngine engine = new FightJSEngine();
			engine.setSkillLevel(level);
			
			for (SubSkillConfig subskill : sconf.getSubSkills())
			{
				for (BuffUnit buffarg : subskill.getBuffUnits())
				{
						if(buffarg==null)
						continue;
					for(Map.Entry<Integer, JavaScript> entry : buffarg.effectJavascriptMap.entrySet())
					{
						effect.put(entry.getKey(), entry.getValue().eval(engine,null,null).floatValue());
					}
				}
			}				
		}					
		
		return effect;
	}

	// {{{ RPCGEN_DEFINE_BEGIN
	// {{{ DO NOT EDIT THIS
	public static final int PROTOCOL_TYPE = 800505;

	public int getType() {
		return 800505;
	}

	public int id; // 技能ID by changhao
	public int times; // 学习次数 by changhao
	public int itemid; // 使用的道具 by changhao

	public CRequestLearnParticleSkill() {
	}

	public CRequestLearnParticleSkill(int _id_, int _times_, int _itemid_) {
		this.id = _id_;
		this.times = _times_;
		this.itemid = _itemid_;
	}

	public final boolean _validator_() {
		return true;
	}

	public OctetsStream marshal(OctetsStream _os_) {
		if (!_validator_()) {
			throw new VerifyError("validator failed");
		}
		_os_.marshal(id);
		_os_.marshal(times);
		_os_.marshal(itemid);
		return _os_;
	}

	public OctetsStream unmarshal(OctetsStream _os_) throws MarshalException {
		id = _os_.unmarshal_int();
		times = _os_.unmarshal_int();
		itemid = _os_.unmarshal_int();
		if (!_validator_()) {
			throw new VerifyError("validator failed");
		}
		return _os_;
	}

	public boolean equals(Object _o1_) {
		if (_o1_ == this) return true;
		if (_o1_ instanceof CRequestLearnParticleSkill) {
			CRequestLearnParticleSkill _o_ = (CRequestLearnParticleSkill)_o1_;
			if (id != _o_.id) return false;
			if (times != _o_.times) return false;
			if (itemid != _o_.itemid) return false;
			return true;
		}
		return false;
	}

	public int hashCode() {
		int _h_ = 0;
		_h_ += id;
		_h_ += times;
		_h_ += itemid;
		return _h_;
	}

	public String toString() {
		StringBuilder _sb_ = new StringBuilder();
		_sb_.append("(");
		_sb_.append(id).append(",");
		_sb_.append(times).append(",");
		_sb_.append(itemid).append(",");
		_sb_.append(")");
		return _sb_.toString();
	}

	public int compareTo(CRequestLearnParticleSkill _o_) {
		if (_o_ == this) return 0;
		int _c_ = 0;
		_c_ = id - _o_.id;
		if (0 != _c_) return _c_;
		_c_ = times - _o_.times;
		if (0 != _c_) return _c_;
		_c_ = itemid - _o_.itemid;
		if (0 != _c_) return _c_;
		return _c_;
	}

	// DO NOT EDIT THIS }}}
	// RPCGEN_DEFINE_END }}}

}

