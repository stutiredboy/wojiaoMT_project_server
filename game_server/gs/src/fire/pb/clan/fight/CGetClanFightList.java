
package fire.pb.clan.fight;

// {{{ RPCGEN_IMPORT_BEGIN
// {{{ DO NOT EDIT THIS
import com.locojoy.base.Marshal.OctetsStream;
import com.locojoy.base.Marshal.MarshalException;

abstract class __CGetClanFightList__ extends mkio.Protocol { }

// DO NOT EDIT THIS }}}
// RPCGEN_IMPORT_END }}}

/***
 * 闂傚倸鍊搁崐鎼佸磹閹间礁纾归柟闂寸绾惧湱锟界懓瀚崳纾嬨亹閹烘垹鍊炲銈嗗笒椤︿即寮查鍫熷仭婵犲﹤鍟版晥濠电媴鎷峰〒姘炬嫹婵﹨娅ｇ槐鎺懳熼搹閫涚礃婵犵妲呴崑鍕拷姘緲椤曪綁宕ㄦ繝鍕嚌闂佽法鍠嶇划娆忣嚕鐠囨祴妲堟俊顖炴敱椤秴鈹戦绛嬫當闁绘锕顐﹀箚瑜夐弨浠嬫煟閹邦剙绾ч柛锝堟閳规垿顢欓懖鈺�绮电紓浣哥焷妞村摜鎹㈠┑瀣倞妞ゎ剦鍎搁崶銊у幈濠电偞鍨靛畷顒勫几濞戞瑧绠鹃柛婊冨暟缁★拷濠殿喖锕ㄥ▍锝夊箲閸曨垰惟闁靛濡囨禍鐐寸節绾版ɑ顫婇柛瀣閿熻姤纰嶅姗�鎮鹃悜绛嬫晬闁绘劘灏欐鍥⒑閻熼偊鍤熷┑顕�娼ч埢鎾淬偅閸愨斁鎷洪梻鍌氱墛閸楁洟宕奸妷銉ф煣濠电偞鍨跺銊ノ涢婊勫枑闁哄啫鐗嗛拑鐔兼煟閺冨倸鐨戦柟椋庡厴閹棄鈻撶捄銊ュЪ濠电偛顕刊瀛樹繆閸ヮ剙绠栨い鏇嫹闁轰焦鍔栧鍕拷锛卞嫬顏归梻浣藉吹婵潙煤閵堝拋鍤曢柛顐ｆ礀缁犳煡鏌ㄥ┑鍡橆棤缂佺娀绠栭弻娑樷槈閸楃偘绨婚梺璇茬箰瀵爼銆冮妷鈺傚�烽柤纰卞墰椤旀帡姊虹拠鈥虫灍缂侇喗鎹囬獮濠囨倷閸濆嫀銊ф喐瀹ュ拋鍤曢柟鎯板Г閳锋帒霉閿濆牊顏犻悽顖涚洴閺岋紕浠︾拠鎻掝瀴闂佸搫鎳撻崺鏍箚閺冨牆惟闁挎洩鎷烽柛鎾舵嚀閳规垿鎮欓崣澶樻！闂佺硶鏅涢敃顏堢嵁韫囨挾鏆嬮柟浣冩珪閻忎線姊洪崜鑼帥闁哥姵顨婇幃鐢割敋閿熻棄顫忛搹鍦煓婵炲棙鍎抽崜浼存⒑閹稿孩澶勫ù婊庝簼娣囧﹦锟芥稒蓱婵挳鏌涢幘鍐茬骇闁稿秶鏁诲娲嚃閳哄﹦鍔搁梺璇茬箲閼归箖鍩㈠澶婎潊闁挎稑瀚鏇㈡煟鎼达絾鏆╂い顓炵墕閻☆厽淇婇悙顏勶拷鏍垂閻㈢鐤柟缁㈠枛閺嬩線鏌熼幑鎰靛殭缂佺媴缍侀弻鐔兼倻濡椿妫撳┑鈥虫▕閸ｏ絽顫忛搹鐧告嫹閸︻厼顎岄柛銈嗙懇濮婅櫣鏁鍓滈梺缁樹緱閸犳牠锝炲鍫熸櫢闁芥ê顦介崵鏇㈡煕椤愶絾绀�缂佺媴缍侀弻锝夊箣濠靛浂妫為梺璇″枟閸ㄥ灝顫忔繝姘＜婵﹩鍓ㄩ幏閿嬵槹鎼淬埄鍋ㄥ┑顔斤供閸擄箓鎮為悾灞惧枑闁哄啫鐗嗙粻鏍喐閺傝法鏆﹂柛妤冨剱濞撳鏌￠崶鈺佹瀾闁靛洦绻傞埞鎴﹀焺閸愨晛锟芥劕鈹戦敍鍕効妞わ箒娅曠换娑㈠醇閵壯呮毇濠殿喖锕ュ钘夌暦濠婂牆绠甸柟鍝勭Ф閸戣绻濋悽闈涗粶鐎殿喖鐖奸弫鍐閵堝懏妲┑鐐村灟閸ㄥ湱绮婚幎鑺ョ厵闁绘劘妫勬俊鑲╃磽瀹ュ拑韬�殿噮鍋婇獮鍥级鐠恒劌锟界偤鎮峰鍐ｅǎ鍥э工鐓ゆい蹇撴噳閹锋椽姊虹涵鍛汗闁稿鐩弫鎾剁玻閺嵮勬悙缂佺媭鍨堕弻锝夊箣閿濆憛鎾绘煃闁垮绗掗棁澶愭煥濠靛棙鍣规い銉ョ箻閺屾稑顫濋鐕佹闂佸搫澶囬崜婵嗩嚗閸曨剛绡�闁告洦浜ｅ鍛婁繆閻愵亜锟姐倝宕戦崟顐�娲敇閻戝棙缍庡┑鐐叉▕娴滄繈宕愰悜鑺ョ參婵☆垯璀﹀Σ绋库攽椤曪拷椤ユ挾妲愰幘瀛樺闁告繂瀚呴敐澶嬬厵闁告稑锕ラ崐鎰版煙椤曪拷缁犳牠骞冨鍫熷癄濠㈣泛鐬奸弳浼存⒒閸屾瑧璐伴柛娆忕箻濮婁粙宕熼锝嗙槑闂傚倸鍊搁崐鎼佸磹妞嬪海鐭嗗〒姘炬嫹妤犵偞鐗犻、鏇㈡晜缂佹ɑ娅堥梻浣虹《閸撴繈濡甸崒姘ｆ闁靛繒濮烽ˇ銊ヮ渻閵堝棙顥嗗鐟扮墦楠炴寮撮姀鈾�鎷虹紓鍌欑劍钃遍柍閿嬪浮閹绠涚�ｎ亜顫囧Δ鐘靛仜缁绘﹢骞冨鍫熷殟闁靛鍎扮紓鎾寸節閻㈤潧浠滈柣妤佸姇閳绘棃寮撮姀鐘殿槷缂備礁顑嗛娆忋�掓繝姘厪闁割偅绻冮崳瑙勩亜閹哄鐏查柡宀�鍠栭幃鐑芥偋閸繃鐏庨柣搴㈩問閸犳牠鈥﹂悜钘夌畺闁靛繈鍊曠粈鍌炴煟閹惧啿鍤遍柟鐑芥敱缁绘繂顫濋鐘插箻闂備浇顕栭崢鐣屾暜閹烘绀夋繝濠傜墛閻撴盯鏌涢埄鍐噧闁宠鐗婇幈銊︾節閸愨斂浠㈤梺璇″枤閸忔ê顕ｉ崼鏇炵妤犵儐鍠掗弲鐘差潖閾忚鍏滈柛娑卞枤瑜把囨⒑閹稿骸鍝洪柡宀嬬秮閺佹劙宕ㄩ鐔溾晛顪冮妶搴′簼缂侇喗鎹囧顐﹀箻鐎靛壊娴勯柣搴秵娴滅偤鎮鹃崫鍕ㄦ斀闁绘劕寮堕ˉ鐐烘煙鐏忔牗娅婄�殿噮鍋婂畷鍗炩槈濞嗘垵骞堥梺璇茬箳閸嬫稒鏅舵禒瀣瀬闁哄稁鍘介悡蹇擃熆鐠虹儤顥炴繛鍛閺屽秹鏌ㄧ�ｎ亝璇為梺鍝勬湰缁嬫挻绂掗敃鍌氱鐟滃酣宕抽纰辨富闁靛牆绻楅铏圭磼閻樺啿鐏撮柍銉畵瀹曠螖娴ｉ晲鐢婚梺姹囧焺閸ㄥジ宕板☉銏犺Е妞ゆ劧闄勯埛鎴︽偣閸ワ綇鎷烽搹顐ゅ讲缂傚倷鑳剁划顖滄崲閸岀偞鍋╅梺鍨儑闂勫嫮绱掔�ｎ収鍤﹂柕濞炬櫆閻撳繐顭跨拠鈥崇仩闁哄牜鍓濋崐鏉戔攽閻樺灚鏆╁┑顔惧厴瀵偊骞栨担鍝ワ紱闂佺粯鍔曢幖顐﹀垂閸屾稏浜滈柡宥庡亜娴犳粓鏌涢妸銉ワ拷鍧楀蓟濞戙垺鏅滈悹鍥ㄥ絻缁犵粯绻涢幋鐐村碍缂佸缍婂濠氬灳閹颁礁鎮戦柟鑲╄ˉ閿熻棄纾鎴︽⒒娴ｈ櫣甯涢柟绋跨埣瀹曟洟鎮界粙鑳憰闂佹寧绻傞ˇ顖炲础閹惰姤鐓熼柟閭﹀灱閸ゅ鏌熸搴″幋鐎规洜鍏橀、姗�濡搁敃锟介璺衡攽椤旂瓔鐒介柛瀣尵閿熻姤鐔幏锟�? by changhao
 */
public class CGetClanFightList extends __CGetClanFightList__ {
	@Override
	protected void process() {
		// protocol handle
		
		final long roleid = gnet.link.Onlines.getInstance().findRoleid(this);
		if (roleid < 0)
			return;
		
		mkdb.Procedure getclanfightlist = new mkdb.Procedure()
		{
			@Override
			protected boolean process()
			{
				long cur = System.currentTimeMillis();
				
				if (which != 0 && which != 1)
				{
					return false;
				}
				
				if (which == 0)
				{
					long mon1 = fire.pb.activity.clanfight.ActivityClanFightManager.GetMonday1500ByTime(cur);
					if (cur < mon1)
					{
						return false;
					}
				}
				
				if (which == 1)
				{
					long wed1 = fire.pb.activity.clanfight.ActivityClanFightManager.GetWednesday1500ByTime(cur);
					if (cur < wed1)
					{
						return false;
					}
				}
				
				long createtime = which == 0 ? fire.pb.activity.clanfight.ActivityClanFightManager.GetMonday1500ByTime(cur) : fire.pb.activity.clanfight.ActivityClanFightManager.GetWednesday1500ByTime(cur);
				
				int curweek = fire.pb.activity.clanfight.ActivityClanFightManager.getInstance().curweek.get();
				SGetClanFightList msg = new SGetClanFightList();
				
				if (curweek == -1)
				{
					msg.curweek = -1;
					mkdb.Procedure.psendWhileCommit(roleid, msg);					
					
					return true;
				}
				
				int curweekvalue = curweek % 8;
				
				msg.curweek = curweekvalue;
				
				int  result = 0;
				xbean.ClanFights clanfights = xtable.Clanfights.select(createtime);
				if (clanfights != null)
				{
					for (xbean.ClanFight c : clanfights.getClan1vschan2().values())
					{
						fire.pb.clan.fight.ClanFight f = new fire.pb.clan.fight.ClanFight();
						f.clanid1 = c.getClanindex1();
						f.clanname1 = c.getClanname1();
						f.clanid2 = c.getClanindex2();
						f.clanname2 = c.getClanname2();
						f.winner = c.getWinner();
						
						if (f.winner != -1)
						{
							result = 1;
						}
						
						msg.clanfightlist.add(f);
					}
				}
				
				msg.over = result;
				
				mkdb.Procedure.psendWhileCommit(roleid, msg);
				
				return true;
			}
		};
		
		getclanfightlist.submit();			
	}

	// {{{ RPCGEN_DEFINE_BEGIN
	// {{{ DO NOT EDIT THIS
	public static final int PROTOCOL_TYPE = 808532;

	public int getType() {
		return 808532;
	}

	public int whichweek; // 历史那一周(0-7周)(如果填-1表示当前周) by changhao
	public int which; // 0是周一那场，1是周三那场 by changhao

	public CGetClanFightList() {
	}

	public CGetClanFightList(int _whichweek_, int _which_) {
		this.whichweek = _whichweek_;
		this.which = _which_;
	}

	public final boolean _validator_() {
		return true;
	}

	public OctetsStream marshal(OctetsStream _os_) {
		if (!_validator_()) {
			throw new VerifyError("validator failed");
		}
		_os_.marshal(whichweek);
		_os_.marshal(which);
		return _os_;
	}

	public OctetsStream unmarshal(OctetsStream _os_) throws MarshalException {
		whichweek = _os_.unmarshal_int();
		which = _os_.unmarshal_int();
		if (!_validator_()) {
			throw new VerifyError("validator failed");
		}
		return _os_;
	}

	public boolean equals(Object _o1_) {
		if (_o1_ == this) return true;
		if (_o1_ instanceof CGetClanFightList) {
			CGetClanFightList _o_ = (CGetClanFightList)_o1_;
			if (whichweek != _o_.whichweek) return false;
			if (which != _o_.which) return false;
			return true;
		}
		return false;
	}

	public int hashCode() {
		int _h_ = 0;
		_h_ += whichweek;
		_h_ += which;
		return _h_;
	}

	public String toString() {
		StringBuilder _sb_ = new StringBuilder();
		_sb_.append("(");
		_sb_.append(whichweek).append(",");
		_sb_.append(which).append(",");
		_sb_.append(")");
		return _sb_.toString();
	}

	public int compareTo(CGetClanFightList _o_) {
		if (_o_ == this) return 0;
		int _c_ = 0;
		_c_ = whichweek - _o_.whichweek;
		if (0 != _c_) return _c_;
		_c_ = which - _o_.which;
		if (0 != _c_) return _c_;
		return _c_;
	}

	// DO NOT EDIT THIS }}}
	// RPCGEN_DEFINE_END }}}

}

