
package fire.pb.clan.fight;

// {{{ RPCGEN_IMPORT_BEGIN
// {{{ DO NOT EDIT THIS
import com.locojoy.base.Marshal.OctetsStream;
import com.locojoy.base.Marshal.MarshalException;

abstract class __CBattleFieldRankList__ extends mkio.Protocol { }

// DO NOT EDIT THIS }}}
// RPCGEN_IMPORT_END }}}

/**
 * 闂傚倸鍊搁崐鎼佸磹閹间礁纾归柟闂寸绾剧懓顪冪�ｎ亝鎹ｉ柣顓炴閵嗘帒顫濋悙顒�顏堕柣搴ゎ潐濞插繘宕曢幎鑺ユ櫢闁哄倶鍊楃粔鐢告煕閻樺磭澧卞瑙勬礋瀹曠螖娴ｅ搫骞嶉梻浣筋嚃閸ㄨ櫕鏅跺Δ鍚藉寰勯幇顒傤啇闂佸搫顦伴崺濠囩叕椤掑嫭鐓涢悘鐐额嚙閿熻姤绻堥獮濠傗攽鐎ｎ亞顓煎銈嗘閸嬫劖鏅堕姘ｆ斀闁绘劘灏欓幗鐘电磼椤旇偐鐏辩紒杈╁仦缁绘繈宕惰閹芥洖鈹戦悙鏉戠仧闁搞劎鎳撻弫顔戒繆閻愵亜锟芥牕顫忔繝姘偍鐟滄棃鏁愰悙鍝勭厸闁告劦浜為敍婵囩箾鏉堝墽鍒伴柟纰卞亰椤㈡捇骞橀崜浣猴紲闂佽偐鈷堥崜娆愮閸撗呯＜鐎癸拷閸愵喖鎽电紓浣虹帛缁诲牆鐣烽崼鏇熷殝闁割煈鍋呴悵顐⑩攽閻樺灚鏆╁┑顔芥尦閺佸啴濡舵径濠勬焾濡炪倖鍔х徊鑲╂崲閸℃稒鐓ｉ煫鍥ㄦ尰鐠愶紕鐥幑鎰棄闂囧鏌ㄥ┑鍡╂Ч婵炴嚪鍐ｆ斀闁炽儴灏欓惌娆撴煛鐏炶锟芥盯濡甸幇鏉跨闁哄啫鍊瑰В鍥⒒娴ｈ櫣銆婇柡鍌氬�垮畷鏇㈠箵閹烘繂娈梺鍛婃处閸ㄦ壆绮诲☉娆嶄簻闁圭儤鍨垫禍鐐烘煕閻旈鐒告慨濠勭帛閹峰懘宕ㄦ繝鍌涙畼闂備礁鎲″褰掑垂閸喚鏆︽繝闈涙閺嗗棝鏌ㄩ悢鐑樻珪闁告帗甯￠幊锟犲Χ閸℃褰存繝鐢靛仦濞兼瑩顢栭崱娑樻闁跨喍绮欏缁樻媴閾忕懓绗￠梺鍛婃⒐椤洦绂嶇粙搴撴瀻闁归偊鍘介悵宄扳攽閻愭潙鐏熼柛銊︽そ閹繝寮撮姀锛勫帾婵犵數鍋涢悘婵嬪礉濠婂牊鍋ｉ柟鏉垮缁★拷闂佸搫鏈惄顖炵嵁閹烘绠婚柧蹇ｅ亯閻т線鏌ｆ惔銏╁晱闁革綆鍣ｅ畷鎶芥晲閸涱垱娈炬繝闈涘�告竟濠囧极閸愵喗鐓ユ繝闈涙椤ョ偤鏌ｅ┑鎰簻闁宠鍨块幃鈺呭箛娴ｅ憡娅涢梻浣告憸婵敻銆冩繝鍥ф瀬闁告劦鍠栭悡娑㈡煕濞戝崬骞樻い锔诲幖閳规垿鎮欓弶鎴犱户闂佹悶鍔嶅钘夘嚕閺屻儱绠瑰ù锝呮贡閸欏啫鈹戦埥鍡楃仧閻狅拷閿曪拷铻ｉ柛顐犲劜閻撶喖鏌熼崜褍浠洪柛瀣ㄥ灲閺岋紕浠﹂棃鈺傚鐎规洖娲﹀▓鏇㈡⒑鐠恒劌鏋嶇紒顔界懃閻ｉ攱瀵奸弶鎴濆敤濡炪倖鎸鹃崑鐔兼偩閸濆嫧鏀介柣妯款嚋瀹搞儵鏌涘顓ㄨ�块柟顔哄灲瀹曟宕楅悡搴″闂備浇宕垫慨鏉懨洪悩缁樻櫢闁芥ê顦弳鍗烆熆閻熺増顥炵紒缁樼箘閸犲﹥寰勫畝锟介敍鐔兼⒑缁嬫鍎愰柛銊ョ仢閻ｇ兘骞囬弶璇狙囨煕濠婏拷閼冲爼宕崹顐ょ闁规儳顕崯鏌ユ煙閻戣姤鏁辨い銊ｅ劦閹瑩鎳犻鍌ゅ晪闂備浇妗ㄩ悞锕傚箲閸ヮ剙鏋侀柟鍓х帛閺呮悂鏌ㄩ悤鍌涘 by changhao
 */
public class CBattleFieldRankList extends __CBattleFieldRankList__ {
	@Override
	protected void process() {
		// protocol handle
		
		final long roleid = gnet.link.Onlines.getInstance().findRoleid(this);
		if (roleid < 0)
			return;
		
		mkdb.Procedure battlefieldranklist = new mkdb.Procedure()
		{
			@Override
			protected boolean process()  throws Exception
			{
				Long c1 = xtable.Roleid2clanfightid.select(roleid); //婵犵數濮烽弫鍛婃叏閻戣棄鏋侀柛娑橈攻閸欏繘鏌ｉ幋婵愭綗闁跨喕妫勯崐鍧楀箰婵犲啰鐝堕柍鍝勵儑缁夘喚锟借娲滈崰鏍�佸☉姗嗘僵濡插本鐗曢弫鎼佹⒒閸屾瑦绁版繛澶嬫礋瀹曟娊鏁冮崒姘鳖唵闂佽法鍣﹂幏锟�?婵犵數濮烽弫鍛婃叏閻戣棄鏋侀柛娑橈攻閸欏繘鏌ｉ幋锝嗩棄闁哄绶氶弻鐔兼⒒鐎靛壊妲紒鐐劤椤兘寮婚敐澶婄疀妞ゆ帊璁查弸娆撴⒑缂佹ê绗╁┑顔哄�楅幑銏犫槈閵忕姴鑰垮┑鈽嗗灣缁垶宕曟惔銊︹拺閺夌偞澹嗛ˇ锕傛倵濮橆偄宓嗙�殿喛顕ч埥澶愬閻橀潧濮堕梻浣告啞閸斞呯磽濮樿精濮抽柣銏犳啞閳锋垿鏌熺粙鎸庢崳缂佺姵鎸婚妵鍕晜鐠囪尙浠紓渚囧枛椤兘骞冮悜钘夌疇濠电姴鍊荤粔娲煛娴ｇ懓濮嶇�规洖宕埢搴ㄥ箛椤撶偞娅㈤梻浣藉吹閸嬬偟鍠婂鍥ㄥ床闁割偅绻嶅鏍磽娴ｈ偂鎴炲垔閹绢喗鐓熼柣鏃傚帶娴滀即鏌涢妶鍜佸剰闁宠鍨块幃娆戯拷鍨偠閸嬬偤姊洪崫鍕櫧濠电儑鎷烽梺缁樹緱閸犳稓绮诲☉妯锋婵炲棙鍨靛鎶芥⒑鐠囨彃鍤辩紓宥呮瀹曟粌鈽夐姀鈥冲墾闂佸壊鍋侀崕鏌ュ煕閹达附鍋ｉ柟顓熷笒婵″ジ鏌＄�ｎ亞肖缂佽鲸甯￠、娆撴偩鐏炴儳娅氶梻渚�娼уΛ鏃傛濮橆剦鍤曟い鏇嫹鐎规洜鍘ч埞鎴狅拷锝庝簼閺嗩亜鈹戦悩鍨毄濠电儑鎷峰┑鐐板尃閸ャ劌浜卞┑鐘诧工閻楀棛鎲撮敃鍌涚厱婵炴垵宕弸銈囩磼閳藉懏瀚圭紓鍌欑婢ц姤鏅跺Δ鍕噷婵＄偑鍊ら崑鍕晝椤忓牆钃熸繛鎴欏灩鎯熼梺鎸庢穿閹风兘鏌嶇紒妯荤闁跨喎锟界噥娼愭繛鍙壝叅闁绘棃鏅茬换鍡涙煕椤愶絾绀�闁绘劕锕ラ妵鍕疀閹惧磭褰呴梺鐐藉劜閺嬪ジ寮ㄩ懞銉ｄ簻闁哄喛鎷烽柡瀣帛缁楃喎鈽夐姀锛勫幈闂婎偄娲﹂弸鍌烆敂閸曨偆銈梻鍌欑婢瑰﹪宕戞笟锟藉畷鏇㈠蓟閵夛箑浜楅梺闈涱槴閺呮粓鎮￠悢鍏肩厸闁搞儮鏅涙禒婊堟煥閻旂粯顥夋繝锟介柆宥嗘櫢闁兼亽鍎抽崯鏌ユ煙閸戙倖瀚�? by changhao
				if (c1 == null)
				{
					return false;
				}
				
				xbean.EClanFightStatistics statistics = xtable.Roleid2clanfightstatistics.select(roleid);
				if (statistics == null)
				{
					return false;
				}
				
				long cur = System.currentTimeMillis();
				if (cur < statistics.getLastcbattlefieldrankliststamp() + 20000) //闂傚倸鍊搁崐鎼佸磹閹间礁纾归柟闂寸绾惧綊鏌ｉ幋锝呅撻柛銈呭閺屾盯顢曢敐鍡欙紩闂佽法鍠愰弸鑽ょ不閹惧磭鏆﹀┑鍌滎焾鍞銈嗘婵倕鈻嶉崼銉︹拻濞达綀娅ｉ妴濠囨煕閹惧绠樼紒顔界懇楠炴帒螖閿熺晫澹曢幐搴濈箚闁靛牆瀚板宄懊瑰鍕煉闁哄矉绻濆畷鎺戭潩閸欐妾搁梻浣瑰▕閺�鍗烆潖閼姐倖顫曢柟鐑橆殕閸嬫劙鏌ц箛锝呬航婵☆偄鍟村娲传閸曨剚鎷辩紓浣割儐閸ㄥ潡宕洪妷锕�绶炲┑鐐靛亾閻庡姊鸿ぐ鎺戜喊闁哥姵宀搁崺銏ｇ疀閺囩姷锛濋梺绋挎湰閻熝呮嫻娴煎瓨鐓曢悗锝庝簻椤忣偆绱掗鑺ヮ梿闁靛洦鍔欓獮鎺楀箣閿濆棙鍟哄┑鐘垫暩閸嬬偤宕归鐐叉槬闁告洦鍨伴弸渚�鏌涢幇闈涙灍闁绘挶鍎茬换婵嬫濞戞瑯妫″銈冨劤婵敻濡甸崟顖涙櫆闁告繂瀚～鍥р攽椤旂》鏀绘俊鐐扮矙閻涱噣骞囬鐔峰妳闂佹寧绻傞崰娑㈠箯閻戣棄绠虫俊銈勮兌閸橀亶姊虹紒妯忣亞澹曢鐔告珷妞ゅ繐鎳屾禍婊勩亜閹扳晛鐏紒鐘哄皺缁辨帞绱掑Ο鑲╃暤濡炪値鍋呯换鍫ャ�佸Δ鍛＜闁靛牆鏌婅閳规垿鏁嶉崟顐℃澀闂佺锕ラ悧婊堝极椤曪拷椤㈡棃宕煎┑鍫數闁诲海鎳撶�氼厽绔熺�ｎ喖缁╅柤鎭掑劘娴滄粓鏌￠崒姘变虎闁诡喗鍨块弻娑㈡偐缁涚锟藉潡鏌″畝瀣？濞寸媴绠撳畷婊嗩槼闁告帗鐩铏瑰寲閺囩喐鐝ㄧ紓浣介哺濞茬喖寮幘璇叉闁靛牆娲ㄦ牎闂備胶顭堥鍛拷姘嵆閵嗕線寮崼鐔告闂佽法鍣﹂幏锟� by changhao
				{
					return false;
				}
				
				SBattleFieldRankList msg = new SBattleFieldRankList();
				msg.myrank = -1;
				
				fire.pb.clan.fight.ClanFightBattleField bf = fire.pb.clan.fight.ClanFightFactory.getClanFightBattleField(c1, true);
				if (bf != null)
				{
					msg.clanscore1 = bf.getClanfightBean().getClanscore1();
					msg.clanscroe2 = bf.getClanfightBean().getClanscore2();
					
					int which = bf.getSideByRoleId(roleid);
					if (which != 0 && which != 1)
					{
						return false;
					}
					
					java.util.List<xbean.BattleFieldScroeRank> list = null;
					java.util.Map<Long, Integer> map = null;
					if (which == 0)
					{
						list = bf.getClanfightBean().getClan1roleranklist();
						map = bf.getClanfightBean().getClan1rolerankmap();
					}
					else if (which == 1)
					{
						list = bf.getClanfightBean().getClan2roleranklist();
						map = bf.getClanfightBean().getClan2rolerankmap();					
					}
					else
					{
						return false;
					}
					
					Integer rank = map.get(roleid);
					if (rank != null)
					{
						msg.myrank = rank;
						xbean.BattleFieldScroeRank r = list.get(rank);
						if (r != null)
						{
							msg.myscore = r.getScroe();
						}
					}
					
					int count = 0;
					for (xbean.BattleFieldScroeRank e : bf.getClanfightBean().getClan1roleranklist())
					{
						if (count >= 50) //闂傚倸鍊搁崐鎼佸磹閹间礁纾归柟闂寸绾惧綊鏌熼梻瀵割槮缁炬儳缍婇弻鐔兼⒒鐎靛壊妲紒鐐劤缂嶅﹪寮诲☉妯锋斀闁告洦鍋勬慨鐑芥⒑閻熸澘妲婚柛銏＄叀閿濈偛鈹戠�ｎ偄浜楅柟鑹版彧缁辨洟鎯堥崟顖涚厽閹兼番鍊ゅ鎰箾閸欏鐒介柟骞垮灲瀹曠厧鈹戦幇顒侇吙闂備礁婀遍搹搴ㄥ窗閺嶎叏缍栭柛娑樼摠閻撶喐淇婇娑橆嚋闁绘繍浜為幃顕�鏁愰崨顏呮杸闂佺粯顭堢亸娆徫涢崟顖涚厸濠㈣泛锕ら惃锟犳煙妞嬪孩鐒挎い锕侇潐椤ㄣ儵鎮欓懠顒傤唹濡炪倧濡囨晶妤呭箚閺冨牆顫呴柣妯夸含閻ュ懎鈹戦悩鍨毄闁稿绋戣灋婵炲棙鎸哥粻鏉课旈敐鍛殭闁活厽顨婇弻鐔煎礈瑜忕敮娑㈡煟閹惧瓨绀嬮柡灞炬礃瀵板嫬鈽夊顒�鐓傚┑鐘茬棄閵堝憛鎾绘煏閸パ冾伃濠碉紕鍏橀弫鍌滅驳鐎ｎ偒妫冮梻鍌欑閹碱偊寮甸鍌滅煓闁瑰墽绮弲鎼佹煛閸屾ê锟芥绮欐繝姘厸閻忕偠顕ф俊濂告偂閵堝鐓ラ柡鍥╁仜閿熻棄缍婂畷鎴﹀磼閻愬鍘搁梺鎼炲劗閺呮盯寮搁弮鍌滅＜闁绘宕甸悾娲煛鐏炲墽娲撮柛鈺佸瀹曟﹢鏁愰崱顓犵闂傚倷绀侀崥瀣矈閹绢喖鐤鹃柣鎰摠閸欏繘鏌涢幇顒佲枙婵炴挸顭烽幃妤呮晲鎼存繄鍑归梺鍦缁插潡鎯�椤忓牆绠氱憸瀣磻閵忋倖鐓涚�癸拷閿熶粙宕伴弽顓犲祦闁规崘顕х粻铏節闂堟稒顥滃鐟邦樀濮婅櫣鎷犻幓鎺濆妷闂佺粯妫忛崜鐔肩嵁韫囨稒鏅搁柨鐕傛嫹50濠电姷鏁告慨鐑藉极閸涘﹥鍙忛柣鎴ｆ閺嬩線鏌熼梻瀵割槮缁炬儳顭烽弻锝夊箛椤掍焦鍎撻梺鍝勫閸庨亶鍩為幋锔藉亹闁告瑥顦伴幃娆戠磽娴ｅ搫顎岄柛銊ョ埣瀵濡搁埡鍌氫簽闂佺鏈粙鎴︻敂閿燂拷? by changhao
						{
							break;
						}
						
						fire.pb.clan.fight.RoleBattleFieldRank r = new fire.pb.clan.fight.RoleBattleFieldRank();
						String name = bf.getClanfightBean().getEnterroleids().get(e.getRoleid());
						if (name != null)
						{
							r.rolename = name;
							r.rolescroe = e.getScroe();
							msg.ranklist1.add(r);
							count ++;							
						}
					}
					
					count = 0;
					for (xbean.BattleFieldScroeRank e : bf.getClanfightBean().getClan2roleranklist())
					{
						if (count >= 50) //闂傚倸鍊搁崐鎼佸磹閹间礁纾归柟闂寸绾惧綊鏌熼梻瀵割槮缁炬儳缍婇弻鐔兼⒒鐎靛壊妲紒鐐劤缂嶅﹪寮诲☉妯锋斀闁告洦鍋勬慨鐑芥⒑閻熸澘妲婚柛銏＄叀閿濈偛鈹戠�ｎ偄浜楅柟鑹版彧缁辨洟鎯堥崟顖涚厽閹兼番鍊ゅ鎰箾閸欏鐒介柟骞垮灲瀹曠厧鈹戦幇顒侇吙闂備礁婀遍搹搴ㄥ窗閺嶎叏缍栭柛娑樼摠閻撶喐淇婇娑橆嚋闁绘繍浜為幃顕�鏁愰崨顏呮杸闂佺粯顭堢亸娆徫涢崟顖涚厸濠㈣泛锕ら惃锟犳煙妞嬪孩鐒挎い锕侇潐椤ㄣ儵鎮欓懠顒傤唹濡炪倧濡囨晶妤呭箚閺冨牆顫呴柣妯夸含閻ュ懎鈹戦悩鍨毄闁稿绋戣灋婵炲棙鎸哥粻鏉课旈敐鍛殭闁活厽顨婇弻鐔煎礈瑜忕敮娑㈡煟閹惧瓨绀嬮柡灞炬礃瀵板嫬鈽夊顒�鐓傚┑鐘茬棄閵堝憛鎾绘煏閸パ冾伃濠碉紕鍏橀弫鍌滅驳鐎ｎ偒妫冮梻鍌欑閹碱偊寮甸鍌滅煓闁瑰墽绮弲鎼佹煛閸屾ê锟芥绮欐繝姘厸閻忕偠顕ф俊濂告偂閵堝鐓ラ柡鍥╁仜閿熻棄缍婂畷鎴﹀磼閻愬鍘搁梺鎼炲劗閺呮盯寮搁弮鍌滅＜闁绘宕甸悾娲煛鐏炲墽娲撮柛鈺佸瀹曟﹢鏁愰崱顓犵闂傚倷绀侀崥瀣矈閹绢喖鐤鹃柣鎰摠閸欏繘鏌涢幇顒佲枙婵炴挸顭烽幃妤呮晲鎼存繄鍑归梺鍦缁插潡鎯�椤忓牆绠氱憸瀣磻閵忋倖鐓涚�癸拷閿熶粙宕伴弽顓犲祦闁规崘顕х粻铏節闂堟稒顥滃鐟邦樀濮婅櫣鎷犻幓鎺濆妷闂佺粯妫忛崜鐔肩嵁韫囨稒鏅搁柨鐕傛嫹50濠电姷鏁告慨鐑藉极閸涘﹥鍙忛柣鎴ｆ閺嬩線鏌熼梻瀵割槮缁炬儳顭烽弻锝夊箛椤掍焦鍎撻梺鍝勫閸庨亶鍩為幋锔藉亹闁告瑥顦伴幃娆戠磽娴ｅ搫顎岄柛銊ョ埣瀵濡搁埡鍌氫簽闂佺鏈粙鎴︻敂閿燂拷? by changhao
						{
							break;
						}
						
						fire.pb.clan.fight.RoleBattleFieldRank r = new fire.pb.clan.fight.RoleBattleFieldRank();
						String name = bf.getClanfightBean().getEnterroleids().get(e.getRoleid());
						if (name != null)
						{
							r.rolescroe = e.getScroe();
							r.rolename = name;
							msg.ranklist2.add(r);
							count ++;
						}
					}
					
					psendWhileCommit(roleid, msg);
				}
				
				return true;
			}
		};
		
		battlefieldranklist.submit();			
	}

	// {{{ RPCGEN_DEFINE_BEGIN
	// {{{ DO NOT EDIT THIS
	public static final int PROTOCOL_TYPE = 808538;

	public int getType() {
		return 808538;
	}


	public CBattleFieldRankList() {
	}

	public final boolean _validator_() {
		return true;
	}

	public OctetsStream marshal(OctetsStream _os_) {
		if (!_validator_()) {
			throw new VerifyError("validator failed");
		}
		return _os_;
	}

	public OctetsStream unmarshal(OctetsStream _os_) throws MarshalException {
		if (!_validator_()) {
			throw new VerifyError("validator failed");
		}
		return _os_;
	}

	public boolean equals(Object _o1_) {
		if (_o1_ == this) return true;
		if (_o1_ instanceof CBattleFieldRankList) {
			return true;
		}
		return false;
	}

	public int hashCode() {
		int _h_ = 0;
		return _h_;
	}

	public String toString() {
		StringBuilder _sb_ = new StringBuilder();
		_sb_.append("(");
		_sb_.append(")");
		return _sb_.toString();
	}

	public int compareTo(CBattleFieldRankList _o_) {
		if (_o_ == this) return 0;
		int _c_ = 0;
		return _c_;
	}

	// DO NOT EDIT THIS }}}
	// RPCGEN_DEFINE_END }}}

}

