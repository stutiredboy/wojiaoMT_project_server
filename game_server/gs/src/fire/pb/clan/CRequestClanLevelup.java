
package fire.pb.clan;

import java.util.ArrayList;
import java.util.List;

import fire.log.beans.ClanBuildUPBean;
import fire.log.beans.FactionOpbean;
import fire.pb.clan.srv.ClanManage;
import fire.pb.clan.srv.ClanRank;
import fire.pb.talk.MessageMgr;


// {{{ RPCGEN_IMPORT_BEGIN
// {{{ DO NOT EDIT THIS
import com.locojoy.base.Marshal.OctetsStream;
import com.locojoy.base.Marshal.MarshalException;

abstract class __CRequestClanLevelup__ extends mkio.Protocol { }

// DO NOT EDIT THIS }}}
// RPCGEN_IMPORT_END }}}

public class CRequestClanLevelup extends __CRequestClanLevelup__ {
	@Override
	protected void process() {
		final long roleid = gnet.link.Onlines.getInstance().findRoleid(this);
		if (roleid < 0)
			return;
		
		/***
		 * 闂傚倸鍊搁崐鎼佸磹閹间礁纾归柟闂寸绾惧綊鏌熼梻瀵割槮缁惧墽鎳撻—鍐拷锝庝簼閹癸綁鏌ｉ鐐搭棞闁靛棙甯掗～婵嬫倷椤掞拷椤忚埖淇婇妶鍥ラ柛瀣洴钘濋柣銏㈩焾閸ㄥ倸螖閿濆懎鏆欑紒鐘崇☉闇夐柨婵嗘噺鐠愶紕绱掔�ｂ晞鍏岀紒杈ㄦ崌瀹曟帒顫濋濠冨闁绘垼濮ら崐鍧楁煥閺囩偛锟界敻鏁撻弬銈囩暤鐎规洖鐖奸崺锟犲礃瑜忛悷婵嗏攽鎺抽崐褏寰婃禒瀣柈妞ゆ牜鍋為崑鍌炴煏婢跺棙娅嗛柣鎾跺枛閺岋繝宕掑鍙樿檸濡炪倧绲炬繛濠囧蓟閿濆鏁囬柣鏃傚劋閸ｄ即姊洪崫鍕槵闁跨喕妫勭壕顓㈠汲閸℃稒鍊甸柨婵嗛婢т即鏌ｉ敃锟介悧鎾愁潖閻戞ɑ濮滈柟娈垮枛婵′粙姊虹憴鍕憙鐎规洜鏁搁崚鎺旓拷锝庡枛缁犳娊鏌￠崘鈺傚鞍閻庢艾缍婇弻銊モ攽閸℃侗锟芥霉濠婂嫮绠栫紒缁樼洴瀹曘劑顢欓崜褏鍘滄繝娈垮枛閿曘劌鈻嶉敐澶婄闁哄稁鍘奸崡鎶芥煟閹邦厾銈撮柟鏋�濆缁樻媴閸涘﹤鏆堝┑顔硷工濠�閬嶅极椤曪拷閹瑩鎮滃Ο鐑樼枀闂佸搫顦悧鍕礉鎼达絽濮柨鐔绘閳规垿顢欓弬銈勭返闂佸憡蓱閹倿鐛箛鎾佹椽顢旈崨顏呭闂備礁鎲＄粙鎴︽晝閿曞倸鐓″鑸靛姈閻撱儵鏌￠崶鏈电盎妞も晩鍓涚槐鎺楊敊绾拌京鍚嬪Δ鐘靛仦椤洨妲愰幒鎳崇喖鎮�涙ê顏堕梺鍓茬厛閸嬪懘宕ｈ箛鏂剧箚妞ゆ牗绮岀敮鍫曟偨椤栨氨鍩ｉ柡宀嬬磿閿熸枻绲婚崝宀勬晸閼恒儳绠炵�殿喛顕ч埥澶愬閳ュ厖姹楅梺鑽ゅТ濞壯囧礃瑜忛惌妤呮⒒閸屾瑦顦风紒槌栧枤缁辩偤宕堕埡鍌氬簥濠电娀娼ч鍛不閺嶎厽鐓熼柟閭﹀櫘閺嗘粓鏌熼悜绛嬫闁瑰弶鎸冲畷鐔碱敃閿濆棙鐦搃on2->role by changhao
		 */
		mkdb.Procedure requestfactionlevelup = new mkdb.Procedure()
		{
			@Override
			protected boolean process()
			{
				SClanLevelup sClanLevelup = new SClanLevelup();
				
				Long factionid = xtable.Roleidclan.select(roleid);
				xbean.ClanInfo clan = xtable.Clans.get(factionid);
				
				if (clan.getClanmaster() != roleid && clan.getClanvicemaster() != roleid)
				{
					fire.pb.talk.MessageMgr.sendMsgNotify(roleid, 150127, null);
					return true;
				}
				
				int money = clan.getMoney();
				int uplevel=0;//闂傚倸鍊搁崐鎼佸磹閹间礁纾归柟闂寸绾惧綊鏌熼梻瀵割槮缁惧墽鎳撻—鍐拷锝庝簼閹癸綁鏌ｉ鐐搭棞闁靛棙甯掗～婵嬫倷椤掞拷椤忚埖淇婇妶鍥ラ柛瀣洴钘濋柣銏㈩焾閺嬩線鏌熼崜褏甯涢柛瀣姈閵囧嫰寮撮悙鎼！闁诲孩鑹剧紞濠囧蓟濞戙垹绠涢梻鍫熺♁閻忓牓鎮楅悷鐗堝暈缂佽鍟存俊鐢稿礋椤栨氨顔婇梺鐟扮摠缁诲啴宕愰姘ｆ斀闁挎稑瀚禒鈺佲攽椤斿搫锟芥牜绮氭潏銊х瘈闁搞儜鍜佸晣濠电偠鎻紞锟芥い顐㈩槸閳诲秹宕卞▎鎴狅紳闂佺鏈悷褔宕濆澶嬬叆闁哄洦顨嗗▍濠勶拷瑙勬处閸ㄤ即顢橀崗鐓庣窞閻庯急鍕伜婵犵數鍋犻幓顏嗙礊閿熻姤銇勯銏╂█鐎规洘鍨块幃鈺冪磼濡厧骞堥梺鐟板悑閻ｎ亪宕瑰ú顏勎︽繝闈涚墳閹烽鎲撮崟顒傤槰缂備緡鍠栭惌鍌炲春閵忊剝鍎熼柕濞垮劤椤撴椽姊虹紒妯哄鐎殿喖鐖奸幃妤咁敇閵忊檧鎷绘繛杈剧悼閹虫捇顢氬鍕闁告瑥顦辨晶鐢碉拷瑙勬礃閸旀瑥鐣烽锕�唯鐟滃瞼绮径鎰仭婵犲﹤鎳庨。濂告偨椤栨稑绗ч柣銉海椤﹀綊鏌＄仦鍓ф创妞ゃ垺娲熼弫鎰板炊閳哄啯娈奸梻鍌欑劍婵炲﹪寮ㄩ崡鐑嗘綎闁煎鍊栭～鏇㈡煙閻戞ɑ顥栭柟椋庡厴閺佹劖鎯斿┑鍥ф灓闂備胶绮幐鎼佸Χ閹间礁钃熼柍銉ョ－閺嗗棝鎮楅敐搴″鐞氾箓姊绘担鑺ャ�冮柣鎺炵畵瀹曟繂鈻庤箛鏇熸闂佺粯鎸哥�垫帡鎮￠妷鈺傜厱闁硅埇鍔嶅▍鍛存煕閹捐埖鏆╃紒杈ㄦ崌瀹曟帒顫濋濠冨鐎瑰嫭鍣磋ぐ鎺戠倞闁靛绲肩划鎾绘⒑閸涘﹦缂氶柛搴㈢叀瀵啿顭ㄩ崼鐔哄幍闂佺粯鍨堕敃鈺佲枔閺冨牊鐓熼柟缁㈠灲閹风兘骞囨担鍝勬暩闂佽崵濮惧銊ф媰閿曞倹鍋傛い鎺嶈兌缁犲墽绱掑Δ锟介幖顐ｆ叏閸岀偞鐓涢悘鐐插⒔濞叉挳鏌涢埡浣割伃鐎规洘锕㈠畷婊嗩槻濠殿喖鐖煎缁樼瑹閿熻棄顭囪閳ワ箓顢橀悩鐢碉紳濠殿喗顭堟ご绋跨暦閺屻儲鐓曢柍鈺佸暟閳句線鏌ｉ幘宕囩闁哄本鐩、鏇㈡晲閸モ晝鏆梻浣烘嚀閸氬宕濋弽顓炍﹂柛鏇ㄥ墯閸庣喖鏌曡箛濠忔嫹瀹曞浄绱﹂梻鍌欑閹碱偊鎯夋總绋跨獥闁哄诞鍛濠电偛妫欓幐绋挎纯闂備胶纭堕崜婵嬨�冭箛鏂款嚤闁跨噦鎷�
				int cost=0;//濠电姷鏁告慨鐑藉极閸涘﹥鍙忛柣鎴ｆ閺嬩線鏌涘☉姗堟敾闁告瑥绻橀弻锝夊箣閿濆棭妫勯梺鍝勵儎缁舵岸寮婚悢鍏尖拻閻庨潧澹婂Σ顔剧磼閻愵剙鍔ゆい顓犲厴瀵鏁愭径濠勭杸濡炪倖甯婇悞锕傚磿閹剧粯鈷戦柟鑲╁仜婵″ジ鏌涙繝鍌涘仴鐎殿喖顭烽弫鎰緞婵犲孩缍傞梻浣虹帛閿氶柛鐔锋健瀵娊宕奸妷锔规嫼缂備礁顑嗛娆撳磿韫囨柣浜滈柟瀛樼箥濡拷閻庢鍠栭…閿嬩繆閹间礁鐓涢柛灞剧煯缁ㄤ粙姊绘担渚劸闁哄牜鍓涚划娆撳箣閿旂粯鏅滈梺璺ㄥ櫐閹凤拷??
				int opid=0;//
				if (id == ClanManage.Lobby) //婵犵數濮烽弫鍛婃叏閻戣棄鏋侀柛娑橈攻閸欏繘鏌ｉ幋锝嗩棄闁哄绶氶弻娑樷槈濮楀牊鏁鹃梺鍛婄懃缁绘劙婀侀梺绋跨箰閸氬绱為幋锔界厱闁靛鍎遍敓钘夘煼楠炲骞栨担鐟颁罕闂佸壊鍋呯换鍕偡閺屻儲鈷戠紒瀣儥閸庡繑銇勯敂鐐毈鐎殿喖顭峰鎾晬閸曨厽婢戦梺璇插嚱缂嶅棙绂嶉悜钘夌闁绘垼妫勯崡鎶芥煟濡吋鏆╅柣鎺戙偢濮婃椽宕ㄦ繝鍌毿曢梺鍝ュУ椤ㄥ﹪骞冮檱缁犳盯骞橀娑欐澑闂備胶绮…鍫焊濞嗘垹涓嶉柣妤�鐗勬禍婊堟煃閸濆嫸宸ュ褎鎸抽弻锛勪沪閻愵剛顦伴悗瑙勬礀瀹曨剝鐏掗梺鍛婄箓鐎氬嘲顭囧顓犵瘈婵炲牆鐏濋弸娑㈡煥閺囶亜顩柛鎺撳浮椤㈡盯鎮欓懠顒夊數闂備礁鎲＄粙鎺戭焽濞嗗浚鍟呮繝闈涙閺�浠嬫煟濡绲婚柨鐔烘櫕閹虫捇鍩㈤幘婢勭喓鎷嬪畷鍥╃暰闂備胶绮崝锔界濠婂牊鏅搁柤鎭掑劚閻忓锟借娲樼换鍌炴偩濠靛绀嬫い鎰╁�楅弸鍐⒑绾懎顥嶉柟娲讳簽瀵板﹪鎸婃径妯烘闂佸搫琚崕鏌ュ煕閹烘垯锟芥帒顫濋悙顒�顏舵繝鐢靛仒閸栫娀宕堕敐蹇斿闁挎洖鍋嗛弫鍥煟濞嗗繑鍣洪悗姘秺濮婂宕奸悢渚伇闁诲孩鐭崡鎶藉蓟瀹ュ洨纾兼俊顖濐嚙闂夊秶绱撴担绋匡拷鍦暜閻愮儤鏅搁柡鍌樺�楃粔鐢告煕鐎ｎ亝顥㈢�规洩缍佸畷鍗炩槈濞嗗本瀚肩紓鍌氬�烽悞锕佹懌缂備緤鎷烽柨鐔剁矙濮婅櫣绮欓崠鈥充紣濠电媴鎷烽梺顒�绉甸弲鎼佹煠閹帒鍔ら柛鐔哥叀閺岀喖宕欓妶鍡楊伓 by changhao
				{
					int level = clan.getClanlevel();
					int sumlevel = 0;
					sumlevel += clan.getHouse().get(ClanManage.GoldBank);
					sumlevel += clan.getHouse().get(ClanManage.DrugStone);
					sumlevel += clan.getHouse().get(ClanManage.Hotel);

					fire.pb.clan.SClanLobby lobby =  fire.pb.main.ConfigManager.getInstance().getConf(fire.pb.clan.SClanLobby.class).get(level);
					if (lobby == null)
					{
						fire.pb.talk.MessageMgr.sendMsgNotify(roleid, 143583, null);
						return true;
					}
				
					fire.pb.clan.SClanLobby l =  fire.pb.main.ConfigManager.getInstance().getConf(fire.pb.clan.SClanLobby.class).get(level + 1);
					if (l == null) //婵犵數濮烽弫鍛婃叏閻戣棄鏋侀柛娑橈攻閸欏繘鏌ｉ幋锝嗩棄闁哄绶氶弻鐔兼⒒鐎靛壊妲紒鐐劤椤兘寮婚敐澶婄疀妞ゆ帊鐒﹂崕鎾绘⒑閹肩偛濡奸柛濠傛健瀵鈽夐姀鈺傛櫇闂佹寧绻傚Λ娑⑺囬妷褏纾藉ù锝呮惈灏忛梺鍛婎殕婵炲﹤顕ｇ拠娴嬫婵☆垶鏀遍弬锟介梻浣告啞濞诧箓宕戦崟顒佸弿闁靛繈鍊栭埛鎴炵箾閼奸鍤欐鐐搭殜閺岀喖鎮烽悧鍫濇灎閻庢鍠栭…鐑藉极閹邦厼绶炲┑鐘插閸氬懘姊绘担鐟邦嚋缂佽鍊歌灋妞ゆ挾鍊ｅ☉銏犵妞ゆ挾濮烽敍婵囩箾閹剧澹橀柨鏇樺劤閿熻姤鑹剧紞濠傤潖閾忓湱鐭欓柟绋垮閹疯京绱撴担鍓插剱閻㈩垪锟藉磭鏆﹂柨婵嗙墢閻わ拷闂佸搫鍊告晶鐣岀不濮樿埖鈷戦梻鍫熺〒婢ф洟鏌熷畡閭﹀剶鐎规洘娲熼獮鍥偋閸繐鎷烽崹顐ｅ弿婵妫楁晶鎵磼婢跺銇濋柡宀�鍠栭、娆戠驳鐎ｎ偆鏆梻浣烘嚀瀵爼骞愰崘鑼殾闁绘梻鈷堥弫鍡涙煕鐏炶锟芥牞鈪烽梻鍌氬�搁崐鐑芥倿閿旀拝鎷风粭娑樻噹閺嬪牏锟藉箍鍎遍ˇ顖涱攰闂備礁鎲″ú锕傚垂閹殿喚涓嶅┑鐘崇閻撶喖鏌熼柇锕�鐏℃い銉ヮ槸闇夐柣娆欐嫹闁革綇缍侀獮鍐ㄎ旈崘鈺佹瀭闂佸憡娲﹂崜娑㈡晬濮楋拷濮婃椽宕ㄦ繝鍐ｆ嫻闂佹悶鍔屽鈩冧繆鐎涙ɑ濯撮柛鎾冲级瀵ゆ椽姊虹捄銊ユ瀺缂侇喗鐟╅悰顕�宕橀鍛櫆闂佸壊鍋呯换鍌滅玻濞戞﹩娓婚柕鍫濇婢ь剟鏌涢幋鐘冲殌閸楅亶寮堕崼娑樺缂佲槄鎷烽梻浣圭湽閸ㄨ棄顭囪閺嗏晠姊绘担鑺ャ�冮柣鎺炵畵楠炲啴宕掑杈ㄦ闂佺鎻梽鍕磻閹扮増鍋ｉ柛銉簻閻ㄧ儤銇勯弬鑳妞ゎ亜鍟存俊鍫曞川椤栨粠鍞堕梻浣虹帛椤ㄥ懎螞濞戞艾鍨濆┑鐘冲嚬閺佸秹鏌ｉ幇顒夊殶闁告瑥妫濆铏圭磼濡崵顦ラ梺绋匡工濠�閬嶆晸閼恒儳鍟查柟鍑ゆ嫹? by changhao
					{
						java.util.ArrayList<String> args = new java.util.ArrayList<String>();
						Integer s = level;
						args.add(s.toString());
						fire.pb.talk.MessageMgr.sendMsgNotify(roleid, 160226, args);
						return true;						
					}
					
					int sum = lobby.othersum;
					if (sumlevel < sum) //闂傚倸鍊搁崐鎼佸磹閹间礁纾归柟闂寸绾惧湱锟界懓瀚崳纾嬨亹閹烘垹鍊為悷婊冪箻瀵娊鏁冮崒娑氬幗闂侀潧绻堥崺鍕倿閸撗呯＜闁归偊鍙庡▓婊堟煛瀹�锟介崰鏍蓟閸ヮ剚鏅濋柨鐔剁矙瀹曟繈骞掗幘鍓侇啎閻庣懓澹婇崰鏇犺姳閼姐倗纾奸柣娆忔噽缁夘噣鏌＄仦璇插鐎殿噮鍣ｅ畷鍫曗�﹂幋鐑嗘闂傚倷娴囧▔鏇㈠窗閺囩倣娑㈠礋椤愵偆鍔烽梺璺ㄥ枔婵挳鎷戦悢鍏肩厪濠电偟鍋撳▍鍛存煕濡や礁鈻曢柡宀嬬秮楠炲洭顢涢敐鍛杺闂備礁缍婇ˉ鎾诲蓟婢舵劕桅闁圭増婢樼粻鎶芥煙鐎电顎撶紒杈╂暬濮婄粯鎷呮笟顖涙暞闂佽妞挎禍顏勵潖娴犲绀嬫い鏍ㄧ☉娴滄姊虹紒妯活棃闁哄懓灏欓幑銏ゅ幢濞戞瑧鍘梺鍓插亝缁诲嫮绮婚弻銉﹀�垫慨姗嗗墰缁夌儤鎱ㄦ繝鍛仩缂佽鲸甯掗～婊堝幢濡吋娈界紓鍌氬�烽懗鍓佸垝椤栫偞鏅濋柕蹇曞Х閺嗭附绻涘顔荤盎妞ゎ偄鎳橀弻鏇㈠醇濠靛洤娅ч梺娲诲亜鐎氭澘顫忛搹鍦煓閻犳亽鍔庨崝褰掓⒒閸屾艾顏╅悗姘煎櫍閺佹捇鎳為妷銈勫濡炪値鍋勯ˇ鐢稿Υ閸愵喖唯闁冲搫鍊搁敓鐣屽厴閺屻倗鍠婇崡鐐插箰闂佹儳绻愰柊锝咁潖濞差亜宸濆┑鐘插暊閹峰綊鎮楅惂鍛婂闂佸綊妫跨粈渚�鎷戦悢鍏肩厽闁哄啫鐗滃Λ鎴︽煛閸℃鍎旀慨濠冩そ椤㈡﹢濡歌閺嗙娀姊洪崨濠冨鞍婵犮垺锕㈤垾鏃堝礃椤斿槈褔骞栫划鐧告嫹閹颁焦浜ら梻鍌欑劍鐎笛兠洪敂鐣岊洸妞ゅ繐瀚烽崵鏇熴亜閹板墎鐣辩紒鐘哄吹缁辨挻鎷呴懖鈩冨灥閳诲秹濮�閵堝棌鎷洪柣鐘充航閸斿苯鈻嶉幇鐗堢厵闁告垯鍊栫�氾拷 by changhao
					{
						//java.util.List<String> parameters = new java.util.ArrayList<String>();
						//parameters.add(attr.name);
						fire.pb.talk.MessageMgr.sendMsgNotify(roleid, 160225, null);
						return true;
					}
				
					if (money < ClanUtils.getBuildLevelupMax(clan).get(ClanManage.Lobby)) //闂傚倸鍊搁崐鎼佸磹閹间礁纾归柟闂寸绾惧湱锟界懓瀚崳纾嬨亹閹烘垹鍊為悷婊冪箻瀵娊鏁冮崒娑氬幈濡炪値鍘介崹鍨濠靛鐓曟繛鍡楃箳缁犲鏌″畝瀣М濠殿噯鎷烽梺闈涚箚閺呮繈宕濋崫銉х＝濞撴艾锕ョ�氳绻濋姀锝呯厫闁告梹鐗犻幃锟犲Ψ閳哄倻鍘搁梺鎼炲劗閺呮稒绂掑鍫熺叆闁绘梻绮ˉ澶愭煙閼恒儳鐭岄柛鎺撳浮閺佹劙宕ㄩ崒娑欘棃鐎规洏鍔戦、娆撳箚瑜嶇粻浼存⒑鐠囨煡顎楃紒鐘茬Ч瀹曟洘娼忛…鎴烆啍闂佸憡绺块崕鏌ュ汲濠婂牊鐓熼柟閭﹀枛閸斿鏌ｉ幘瀛樼闁哄本娲樺鍕熼悜妯间邯濠电姭鎷冮崘鍓у悑闂佸搫澶囬崜婵嬪箯閸涙潙宸濆┑鐘插閿涘棝姊绘担鍛婃儓闁哄牜鍓熼幆鍕敍濮樼厧娈ㄩ梺鍦檸閸犳牗鍎梻渚�娼чˇ顓㈠磿閸濆嫷鐒藉┑鐘崇閳锋帒霉閿濆懏鍟為柛鐔哄仱閺岀喓浜搁弽銊︾彋閻庤娲╃紞浣哥暦濮楋拷閳ワ箓骞嬮悙鐢碘枆濠电姷鏁搁崑娑樜熸繝鍐洸婵犲﹤鍠氶崯鍛節闂堟稒顥戦柡锟芥禒瀣厽婵☆垵顕х徊濠氭煛閸℃鎳勯柕鍥у閺佸倻鎲撮崟顒傚綃婵犳鍠栭敃銉ヮ渻娴犲宓侀柡宥庡幗閸婄兘鏌熺紒妯轰刊闁诲骸鐡ㄧ换婵嬫偨闂堟刀鐐烘煕閵婏附銇濋柡浣稿暣婵拷闁靛牆鎳忓Σ顒勬⒑闂堟稓绠冲┑顖ｅ弮瀹曘儳锟斤綆浜堕悢鍡涙偣閸濆嫨鍋ㄩ柨鐔哄Т閻撴盯鏌涘☉鍗炴灓闁告ɑ鎹囧娲川婵犲嫮鐣甸柣搴㈠嚬閸撶喖寮幘缁樺仼閻忕偟鍋撳В鍫澪旈悩闈涗粶缂佺粯鍔楅崣鍛渻閵堝懐绠伴柟鍐差樀楠炲繐煤椤忓應鎷洪梺绋跨箻濡潡鎳滈鍫熺厱閹艰揪绱曟晥濡炪們鍨哄Λ鍐ㄧ暦閾忚宕夐柣鎴灻弸鐘差渻閵堝啫鐏紒瀣灴閳ワ箓濡搁埡浣哥獩濡炪倖鐗徊鍓х懅婵犵數濮烽弫鎼佸磻閻樿绠垫い蹇撴缁�濠囨煥閻旇袚缂佺粯鐩畷顏堝礃椤忓懎浠瑰┑鐘灱椤煤閻旈鏆︽俊銈呮噺閳锋帡鎮楅棃娑欐喐闁伙綁绠栧缁樼瑹閿熻棄顭囪閹囧幢濞嗘劕搴婇梺鐟邦嚟婵挳骞忓畡閭︽僵閺夊牄鍔屽▓灞筋渻閵堝簼绨婚柛鐔风摠娣囧﹪骞嗛幍顔炬澑闂佸搫娲ㄦ慨闈涒枔閻撳簶鏀介柣鎰皺閹界姷绱掗鑲╃劯闁诡喓鍎茬缓浠嬪川婵犲倷绮ф俊鐐�栧ú鈺呭箯妞嬪函鎷峰▓鍨灆缂侇喗鐟╅妴浣割潨閿熶粙骞冮姀銈呭窛濠电姴绨奸幋鐑芥⒒閸屾艾锟藉嘲霉閸パ�鏋栭柡鍥ュ灩闂傤垶鏌ㄩ弴鐐诧拷鍝ョ不椤栫偞鐓ラ柣鏇炲�圭�氾拷? by changhao
					{
						fire.pb.talk.MessageMgr.sendMsgNotify(roleid, 160224, null);
						return true;
					}
					
					//闂傚倸鍊搁崐鎼佸磹閹间礁纾归柟闂寸绾惧綊鏌熼梻瀵割槮缁惧墽鎳撻—鍐拷锝庝簼閹癸綁鏌ｉ鐐搭棞闂囧鏌ㄥ┑鍡╂Ч濞存嚎鍊濋弻銈夊级閹稿骸浠村┑顔硷攻濡炰粙銆佸Δ鍛櫢闁伙絽鐬奸惌鎾绘煛鐏炶鍔滈柡鍛倐閺岋箑螣娓氼垱笑闂佽法鍠曞Λ鍕焽閿熺姴违濞达絿纭堕弸搴ㄦ煙閹咃紞妞わ富鍙冮幃宄邦煥閸愵亞顔掗柦妯荤箖閵囧嫰寮介妸褋锟芥帞绱掗悩鑽ょ暫闁哄瞼鍠栭獮鍡氼檨闁搞倗鍠栭弻娑㈡偄閸濄儱寮ㄩ梺鍝勭灱閸犳牠骞冨鍫熷殟闁靛闄勫▓鍛婁繆閻愵亜锟芥垿宕濇繝鍥х？闁汇垻顭堢粻鏍ㄧ箾閸℃ɑ灏紒鐙欏洦鐓欓悗娑欘焽缁犮儲绻涢崗鐓庡摵婵﹦绮幏鍛存嚍閵夛綇鎷烽崘顔界厽闁硅櫣鍋熼悾鍨殽閻愭潙鐏寸�规洖鐖奸、妤呮晸娴犲鍑犲〒姘炬嫹闁哄瞼鍠栧畷婊嗩槾閻㈩垱鐩弻锟犲川椤旇棄锟芥劙鏌＄仦璇插闁诡喓鍊濆畷鎺戔槈濮楀棔绱� by changhao
					boolean ok = ClanManage.AddClanMoney(-lobby.levelupcost, clan);
					if (ok == false)
					{
						fire.pb.talk.MessageMgr.sendMsgNotify(roleid, 160224, null);
						return true;
					}
					
					clan.setClanlevel(level + 1);
					
					sClanLevelup.change.put(ClanManage.Lobby, level + 1);
					sClanLevelup.money = clan.getMoney();	
					uplevel=level + 1;//闂傚倸鍊搁崐鎼佸磹閹间礁纾归柟闂寸绾惧綊鏌熼梻瀵割槮缁惧墽鎳撻—鍐拷锝庝簼閹癸綁鏌ｉ鐐搭棞闁靛棙甯掗～婵嬫倷椤掞拷椤忚埖淇婇妶鍥ラ柛瀣洴钘濋柣銏㈩焾閺嬩線鏌熼崜褏甯涢柛瀣姈閵囧嫰寮撮悙鎼！闁诲孩鑹剧紞濠囧蓟濞戙垹绠涢梻鍫熺♁閻忓牓鎮楅悷鐗堝暈缂佽鍟存俊鐢稿礋椤栨氨顔婇梺鐟扮摠缁诲啴宕愰姘ｆ斀闁挎稑瀚禒鈺佲攽椤斿搫锟芥牜绮氭潏銊х瘈闁搞儜鍜佸晣濠电偠鎻紞锟芥い顐㈩槸閳诲秹宕卞▎鎴狅紳闂佺鏈悷褔宕濆澶嬬叆闁哄洦顨嗗▍濠勶拷瑙勬处閸ㄤ即顢橀崗鐓庣窞閻庯急鍕伜婵犵數鍋犻幓顏嗙礊閿熻姤銇勯銏╂█鐎规洘鍨块幃鈺冪磼濡厧骞堥梺鐟板悑閻ｎ亪宕瑰ú顏勎︽繝闈涚墳閹烽鎲撮崟顒傤槰缂備緡鍠栭惌鍌炲春閵忊剝鍎熼柕濞垮劤椤撴椽姊虹紒妯哄鐎殿喖鐖奸幃妤咁敇閵忊檧鎷绘繛杈剧悼閹虫捇顢氬鍕闁告瑥顦辨晶鐢碉拷瑙勬礃閸旀瑥鐣烽锕�唯鐟滃瞼绮径鎰仭婵犲﹤鎳庨。濂告偨椤栨稑绗ч柣銉海椤﹀綊鏌＄仦鍓ф创妞ゃ垺娲熼弫鎰板炊閳哄啯娈奸梻鍌欑劍婵炲﹪寮ㄩ崡鐑嗘綎闁煎鍊栭～鏇㈡煙閻戞ɑ顥栭柟椋庡厴閺佹劖鎯斿┑鍥ф灓闂備胶绮幐鎼佸Χ閹间礁钃熼柍銉ョ－閺嗗棝鎮楅敐搴″鐞氾箓姊绘担鑺ャ�冮柣鎺炵畵瀹曟繂鈻庤箛鏇熸闂佺粯鎸哥�垫帡鎮￠妷鈺傜厱闁硅埇鍔嶅▍鍛存煕閹捐埖鏆╃紒杈ㄦ崌瀹曟帒顫濋濠冨鐎瑰嫭鍣磋ぐ鎺戠倞闁靛绲肩划鎾绘⒑閸涘﹦缂氶柛搴㈢叀瀵啿顭ㄩ崼鐔哄幍闂佺粯鍨堕敃鈺佲枔閺冨牊鐓熼柟缁㈠灲閹风兘骞囨担鍝勬暩闂佽崵濮惧銊ф媰閿曞倹鍋傛い鎺嶈兌缁犲墽绱掑Δ锟介幖顐ｆ叏閸岀偞鐓涢悘鐐插⒔濞叉挳鏌涢埡浣割伃鐎规洘锕㈠畷婊嗩槻濠殿喖鐖煎缁樼瑹閿熻棄顭囪閳ワ箓顢橀悩鐢碉紳濠殿喗顭堟ご绋跨暦閺屻儲鐓曢柍鈺佸暟閳句線鏌ｉ幘宕囩闁哄本鐩、鏇㈡晲閸モ晝鏆梻浣烘嚀閸氬宕濋弽顓炍﹂柛鏇ㄥ墯閸庣喖鏌曡箛濠忔嫹瀹曞浄绱﹂梻鍌欑閹碱偊鎯夋總绋跨獥闁哄诞鍛濠电偛妫欓幐绋挎纯闂備胶纭堕崜婵嬨�冭箛鏂款嚤闁跨噦鎷�
					cost=lobby.levelupcost;//濠电姷鏁告慨鐑藉极閸涘﹥鍙忛柣鎴ｆ閺嬩線鏌涘☉姗堟敾闁告瑥绻橀弻锝夊箣閿濆棭妫勯梺鍝勵儎缁舵岸寮婚悢鍏尖拻閻庨潧澹婂Σ顔剧磼閻愵剙鍔ゆい顓犲厴瀵鏁愭径濠勭杸濡炪倖甯婇悞锕傚磿閹剧粯鈷戦柟鑲╁仜婵″ジ鏌涙繝鍌涘仴鐎殿喖顭烽弫鎰緞婵犲孩缍傞梻浣虹帛閿氶柛鐔锋健瀵娊宕奸妷锔规嫼缂備礁顑嗛娆撳磿韫囨柣浜滈柟瀛樼箥濡拷閻庢鍠栭…閿嬩繆閹间礁鐓涢柛灞剧煯缁ㄤ粙姊绘担渚劸闁哄牜鍓涚划娆撳箣閿旂粯鏅滈梺璺ㄥ櫐閹凤拷??
					opid=FactionOpbean.TYPE_LOBBY_UP;
					
					SendAllFactionMemeber(clan, ClanManage.Lobby, level + 1);
					
					//闂傚倸鍊搁崐鎼佸磹閹间礁纾归柟闂寸绾惧綊鏌熼梻瀵割槮缁惧墽鎳撻—鍐拷锝庝簼閹癸綁鏌ｉ鐐搭棞闁靛棙甯掗～婵嬫倷椤掞拷椤忚埖淇婇妶鍥ラ柛瀣仱閹囨偐濮瑰浄鎷锋笟锟藉鎾閻橀潧骞堟繝娈垮枟閿曗晠宕㈡禒瀣︽繝闈涙閺�浠嬫⒔閸ヮ剙鏄ラ柡宓苯娈梺鍛婃处閸欏繘骞忛悜鑺ユ櫜閹煎瓨绻勯懗鍝勨攽閳ュ啿绾ч柛鏃�鐟ラ～蹇曠磼濡偐鎳濋梺璺ㄥ枙濡嫰鈥﹂崶顏嶆▉婵犫拃鍕疄婵﹥妞藉畷顐﹀礋椤掞拷濞呫倝姊洪悜鈺傛珦闁搞劌鐖奸悰顔跨疀濞戞顓洪梺鎸庢濡嫭绂嶅鍫熺厽闊洦鎸剧粻锝夋煟閹虹偟鐣电�殿噮鍓熼弫鎾寸鐎ｎ偀鎷绘繛杈剧秬濞咃絿鏁☉銏＄叆婵ɑ鍞婚幏宄扳枔閸喗鐏堥梺缁樼墪閵堟悂鎮伴锟藉浠嬵敇閻愮數鏉告俊鐐�栭弻銊︽櫠娴犲鏅繝濠傜墛閳锋垿鎮归幁鎺戝闁哄绉剁槐鎺楊敊閻ｅ本鍣ч梺浼欑悼閸忔﹢鐛幒妤�绠ｉ柡鍐挎嫹妞ゎ偄绉瑰娲传閸曨厸鏋屾繝纰橈拷铏枠闁诡垰瀚幆鏃堝Ω閿旇瀚藉┑鐐舵彧缁茶偐鎷冮敃鍌氱哗濞寸厧鐡ㄩ悡娆愮箾閼奸鍞虹紒銊ф櫕閿熻棄鐏氬姗�鏁冮鍕殾婵犲﹤妫Σ濂告⒑缁嬭法绠茬紒顔芥崌瀵鈽夐姀鐘殿啋闂佽壈澹堝▔娑㈠储閿涘嫮纾奸柣鎰靛墮閸斻倝鏌曢崼鐔稿�愮�殿喖顭烽幃銏ゅ礂閼测晛濮洪梻浣瑰濞测晠骞忔搴嫹濞堝灝鏋ら柛瀣尵閹广垹鈽夐姀鐘诲敹闂佺粯娲戦懗鍫曞礉妞嬪海纾藉ù锝勭矙閸濇椽鎮介娑辨當妞ゎ厼娲╃粻娑樷槈濡壕鏅犻弻鏇熺珶椤栨碍鍣洪柛锝庡灦濮婂宕掑▎鎴М闂佹眹鍊曞ú銈堢亱闂佸憡娲﹂崹渚�宕堕澶嬫櫖闂佺粯鍨靛ú銊х矙韫囨挴鏀介柣妯款嚋瀹搞儵鏌ｅΔ锟藉Λ婵嬫偘椤曪拷婵拷闁炽儴灏欑粻姘渻閵堝棛澧紒顔兼湰缁傚秵绺介崨濠勫幈闂佸搫鍊藉▔鏇熺墡缂傚倷绀侀惌浣广仈閸濄儲宕叉繝闈涱儏閻愬﹥銇勯澶婂姱闁搞儯鍔庨崢閬嶆⒑闂堟侗妯堥柛鐘崇缁傛帡濮�閵堝棛鍘棅顐㈡储閸庡磭澹曠捄銊х＜闁绘ɑ褰冮埛鏃堟煥閻旂儤娅曢柟铏尰缁旂喐绻濋崶褏鐛ラ梺鍝勮癁鐏炶姤顓挎俊鐐�栧ú鈺呭箯閻戣姤鐓涚�癸拷鐎ｎ剙鍩岄梺瀹犳椤﹂潧鐣烽敓鐘冲�烽悗鐢殿焾缂嶅棗鈹戞幊閸婃鎱ㄩ悜钘夌；闁绘劕鐏氶弳婊堟煙閻戞ɑ绀堝ù婊勭懇濮婄粯鎷呴懞銉с�婇梺鍝ュУ閹瑰洤顕ｉ弻銉晝闁靛牆鎳庨悘濠冪節閻㈤潧校闁肩懓澧界划濠氼敋閿熶粙寮婚妶澶婄畳闁圭儤鍨垫慨銏ゆ⒑閸涘鎴﹀箖閸屾凹娼栨繛宸簻缁犲綊鏌ｉ幇顓炵祷濠殿喖鐭傚铏圭矙閹稿骸鏀俊鐐存綑閹诧紕绮氭潏銊х瘈闁告劦浜跺ù鍕煟鎼搭垳绉甸柛瀣瀹曘垽骞栨担鍏夋嫼缂備礁顑堝▔鏇㈡倿閸ф鈷掗柛鏇ㄥ亜椤忣偊鏌ㄩ悢璇残撻柣鏃戝墴楠炲繘鏁撻敓锟� by changhao
					mkdb.Procedure.pexecuteWhileCommit(new ClanRank(clan.toData()));
					mkdb.Procedure.pexecuteWhileCommit(new fire.pb.ranklist.proc.PFactionZongHeProc(clan.getKey(), false));
					mkdb.Procedure.pexecuteWhileCommit(new fire.pb.clan.fight.PClanFightUpdateClanLevel(clan.getKey(), clan.getClanlevel()));
				}
				else if (id == ClanManage.GoldBank)
				{
					int level = clan.getHouse().get(ClanManage.GoldBank);
					fire.pb.clan.SClanGoldBank bank =  fire.pb.main.ConfigManager.getInstance().getConf(fire.pb.clan.SClanGoldBank.class).get(level);
					if (bank == null)
					{
						fire.pb.talk.MessageMgr.sendMsgNotify(roleid, 143583, null);
						return true;
					}
				
					fire.pb.clan.SClanGoldBank l =  fire.pb.main.ConfigManager.getInstance().getConf(fire.pb.clan.SClanGoldBank.class).get(level + 1);
					if (l == null) //婵犵數濮烽弫鍛婃叏閻戣棄鏋侀柛娑橈攻閸欏繘鏌ｉ幋锝嗩棄闁哄绶氶弻鐔兼⒒鐎靛壊妲紒鐐劤椤兘寮婚敐澶婄疀妞ゆ帊鐒﹂崕鎾绘⒑閹肩偛濡奸柛濠傛健瀵鈽夐姀鈺傛櫇闂佹寧绻傚Λ娑⑺囬妷褏纾藉ù锝呮惈灏忛梺鍛婎殕婵炲﹤顕ｇ拠娴嬫婵☆垶鏀遍弬锟介梻浣告啞濞诧箓宕戦崟顒佸弿闁靛繈鍊栭埛鎴炵箾閼奸鍤欐鐐搭殜閺岀喖鎮烽悧鍫濇灎閻庢鍠栭…鐑藉极閹邦厼绶炲┑鐘插閸氬懘姊绘担鐟邦嚋缂佽鍊歌灋妞ゆ挾鍊ｅ☉銏犵妞ゆ挾濮烽敍婵囩箾閹剧澹橀柨鏇樺劤閿熻姤鑹剧紞濠傤潖閾忓湱鐭欓柟绋垮閹疯京绱撴担鍓插剱閻㈩垪锟藉磭鏆﹂柨婵嗙墢閻わ拷闂佸搫鍊告晶鐣岀不濮樿埖鈷戦梻鍫熺〒婢ф洟鏌熷畡閭﹀剶鐎规洘娲熼獮鍥偋閸繐鎷烽崹顐ｅ弿婵妫楁晶鎵磼婢跺銇濋柡宀�鍠栭、娆戠驳鐎ｎ偆鏆梻浣烘嚀瀵爼骞愰崘鑼殾闁绘梻鈷堥弫鍡涙煕鐏炶锟芥牞鈪烽梻鍌氬�搁崐鐑芥倿閿旀拝鎷风粭娑樻噹閺嬪牏锟藉箍鍎遍ˇ顖涱攰闂備礁鎲″ú锕傚垂閹殿喚涓嶅┑鐘崇閻撶喖鏌熼柇锕�鐏℃い銉ヮ槸闇夐柣娆欐嫹闁革綇缍侀獮鍐ㄎ旈崘鈺佹瀭闂佸憡娲﹂崜娑㈡晬濮楋拷濮婃椽宕ㄦ繝鍐ｆ嫻闂佹悶鍔屽鈩冧繆鐎涙ɑ濯撮柛鎾冲级瀵ゆ椽姊虹捄銊ユ瀺缂侇喗鐟╅悰顕�宕橀鍛櫆闂佸壊鍋呯换鍌滅玻濞戞﹩娓婚柕鍫濇婢ь剟鏌涢幋鐘冲殌閸楅亶寮堕崼娑樺缂佲槄鎷烽梻浣圭湽閸ㄨ棄顭囪閺嗏晠姊绘担鑺ャ�冮柣鎺炵畵楠炲啴宕掑杈ㄦ闂佺鎻梽鍕磻閹扮増鍋ｉ柛銉簻閻ㄧ儤銇勯弬鑳妞ゎ亜鍟存俊鍫曞川椤栨粠鍞堕梻浣虹帛椤ㄥ懎螞濞戞艾鍨濆┑鐘冲嚬閺佸秹鏌ｉ幇顒夊殶闁告瑥妫濆铏圭磼濡崵顦ラ梺绋匡工濠�閬嶆晸閼恒儳鍟查柟鍑ゆ嫹? by changhao
					{
						java.util.ArrayList<String> args = new java.util.ArrayList<String>();
						Integer s = level;
						args.add(s.toString());
						fire.pb.talk.MessageMgr.sendMsgNotify(roleid, 160226, args);
						return true;						
					}
					
					if (money < ClanUtils.getBuildLevelupMax(clan).get(ClanManage.GoldBank)) //闂傚倸鍊搁崐鎼佸磹閹间礁纾归柟闂寸绾惧湱锟界懓瀚崳纾嬨亹閹烘垹鍊為悷婊冪箻瀵娊鏁冮崒娑氬幈濡炪値鍘介崹鍨濠靛鐓曟繛鍡楃箳缁犲鏌″畝瀣М濠殿噯鎷烽梺闈涚箚閺呮繈宕濋崫銉х＝濞撴艾锕ョ�氳绻濋姀锝呯厫闁告梹鐗犻幃锟犲Ψ閳哄倻鍘搁梺鎼炲劗閺呮稒绂掑鍫熺叆闁绘梻绮ˉ澶愭煙閼恒儳鐭岄柛鎺撳浮閺佹劙宕ㄩ崒娑欘棃鐎规洏鍔戦、娆撳箚瑜嶇粻浼存⒑鐠囨煡顎楃紒鐘茬Ч瀹曟洘娼忛…鎴烆啍闂佸憡绺块崕鏌ュ汲濠婂牊鐓熼柟閭﹀枛閸斿鏌ｉ幘瀛樼闁哄本娲樺鍕熼悜妯间邯濠电姭鎷冮崘鍓у悑闂佸搫澶囬崜婵嬪箯閸涙潙宸濆┑鐘插閿涘棝姊绘担鍛婃儓闁哄牜鍓熼幆鍕敍濮樼厧娈ㄩ梺鍦檸閸犳牗鍎梻渚�娼чˇ顓㈠磿閸濆嫷鐒藉┑鐘崇閳锋帒霉閿濆懏鍟為柛鐔哄仱閺岀喓浜搁弽銊︾彋閻庤娲╃紞浣哥暦濮楋拷閳ワ箓骞嬮悙鐢碘枆濠电姷鏁搁崑娑樜熸繝鍐洸婵犲﹤鍠氶崯鍛節闂堟稒顥戦柡锟芥禒瀣厽婵☆垵顕х徊濠氭煛閸℃鎳勯柕鍥у閺佸倻鎲撮崟顒傚綃婵犳鍠栭敃銉ヮ渻娴犲宓侀柡宥庡幗閸婄兘鏌熺紒妯轰刊闁诲骸鐡ㄧ换婵嬫偨闂堟刀鐐烘煕閵婏附銇濋柡浣稿暣婵拷闁靛牆鎳忓Σ顒勬⒑闂堟稓绠冲┑顖ｅ弮瀹曘儳锟斤綆浜堕悢鍡涙偣閸濆嫨鍋ㄩ柨鐔哄Т閻撴盯鏌涘☉鍗炴灓闁告ɑ鎹囧娲川婵犲嫮鐣甸柣搴㈠嚬閸撶喖寮幘缁樺仼閻忕偟鍋撳В鍫澪旈悩闈涗粶缂佺粯鍔楅崣鍛渻閵堝懐绠伴柟鍐差樀楠炲繐煤椤忓應鎷洪梺绋跨箻濡潡鎳滈鍫熺厱閹艰揪绱曟晥濡炪們鍨哄Λ鍐ㄧ暦閾忚宕夐柣鎴灻弸鐘差渻閵堝啫鐏紒瀣灴閳ワ箓濡搁埡浣哥獩濡炪倖鐗徊鍓х懅婵犵數濮烽弫鎼佸磻閻樿绠垫い蹇撴缁�濠囨煥閻旇袚缂佺粯鐩畷顏堝礃椤忓懎浠瑰┑鐘灱椤煤閻旈鏆︽俊銈呮噺閳锋帡鎮楅棃娑欐喐闁伙綁绠栧缁樼瑹閿熻棄顭囪閹囧幢濞嗘劕搴婇梺鐟邦嚟婵挳骞忓畡閭︽僵閺夊牄鍔屽▓灞筋渻閵堝簼绨婚柛鐔风摠娣囧﹪骞嗛幍顔炬澑闂佸搫娲ㄦ慨闈涒枔閻撳簶鏀介柣鎰皺閹界姷绱掗鑲╃劯闁诡喓鍎茬缓浠嬪川婵犲倷绮ф俊鐐�栧ú鈺呭箯妞嬪函鎷峰▓鍨灆缂侇喗鐟╅妴浣割潨閿熶粙骞冮姀銈呭窛濠电姴绨奸幋鐑芥⒒閸屾艾锟藉嘲霉閸パ�鏋栭柡鍥ュ灩闂傤垶鏌ㄩ弴鐐诧拷鍝ョ不椤栫偞鐓ラ柣鏇炲�圭�氾拷? by changhao
					{
						fire.pb.talk.MessageMgr.sendMsgNotify(roleid, 160224, null);
						return true;
					}
					
					//闂傚倸鍊搁崐鎼佸磹閹间礁纾归柟闂寸绾惧綊鏌熼梻瀵割槮缁惧墽鎳撻—鍐拷锝庝簼閹癸綁鏌ｉ鐐搭棞闂囧鏌ㄥ┑鍡╂Ч濞存嚎鍊濋弻銈夊级閹稿骸浠村┑顔硷攻濡炰粙銆佸Δ鍛櫢闁伙絽鐬奸惌鎾绘煛鐏炶鍔滈柡鍛倐閺岋箑螣娓氼垱笑闂佽法鍠曞Λ鍕焽閿熺姴违濞达絿纭堕弸搴ㄦ煙閹咃紞妞わ富鍙冮幃宄邦煥閸愵亞顔掗柦妯荤箖閵囧嫰寮介妸褋锟芥帞绱掗悩鑽ょ暫闁哄瞼鍠栭獮鍡氼檨闁搞倗鍠栭弻娑㈡偄閸濄儱寮ㄩ梺鍝勭灱閸犳牠骞冨鍫熷殟闁靛闄勫▓鍛婁繆閻愵亜锟芥垿宕濇繝鍥х？闁汇垻顭堢粻鏍ㄧ箾閸℃ɑ灏紒鐙欏洦鐓欓悗娑欘焽缁犮儲绻涢崗鐓庡摵婵﹦绮幏鍛存嚍閵夛綇鎷烽崘顔界厽闁硅櫣鍋熼悾鍨殽閻愭潙鐏寸�规洖鐖奸、妤呮晸娴犲鍑犲〒姘炬嫹闁哄瞼鍠栧畷婊嗩槾閻㈩垱鐩弻锟犲川椤旇棄锟芥劙鏌＄仦璇插闁诡喓鍊濆畷鎺戔槈濮楀棔绱� by changhao
					boolean ok = ClanManage.AddClanMoney(-bank.levelupcost, clan);
					if (ok == false)
					{
						fire.pb.talk.MessageMgr.sendMsgNotify(roleid, 160224, null);
						return true;
					}
					
					clan.getHouse().put(ClanManage.GoldBank, level + 1);
					
					sClanLevelup.change.put(ClanManage.GoldBank, level + 1);
					sClanLevelup.money = clan.getMoney();	
					uplevel=level + 1;//闂傚倸鍊搁崐鎼佸磹閹间礁纾归柟闂寸绾惧綊鏌熼梻瀵割槮缁惧墽鎳撻—鍐拷锝庝簼閹癸綁鏌ｉ鐐搭棞闁靛棙甯掗～婵嬫倷椤掞拷椤忚埖淇婇妶鍥ラ柛瀣洴钘濋柣銏㈩焾閺嬩線鏌熼崜褏甯涢柛瀣姈閵囧嫰寮撮悙鎼！闁诲孩鑹剧紞濠囧蓟濞戙垹绠涢梻鍫熺♁閻忓牓鎮楅悷鐗堝暈缂佽鍟存俊鐢稿礋椤栨氨顔婇梺鐟扮摠缁诲啴宕愰姘ｆ斀闁挎稑瀚禒鈺佲攽椤斿搫锟芥牜绮氭潏銊х瘈闁搞儜鍜佸晣濠电偠鎻紞锟芥い顐㈩槸閳诲秹宕卞▎鎴狅紳闂佺鏈悷褔宕濆澶嬬叆闁哄洦顨嗗▍濠勶拷瑙勬处閸ㄤ即顢橀崗鐓庣窞閻庯急鍕伜婵犵數鍋犻幓顏嗙礊閿熻姤銇勯銏╂█鐎规洘鍨块幃鈺冪磼濡厧骞堥梺鐟板悑閻ｎ亪宕瑰ú顏勎︽繝闈涚墳閹烽鎲撮崟顒傤槰缂備緡鍠栭惌鍌炲春閵忊剝鍎熼柕濞垮劤椤撴椽姊虹紒妯哄鐎殿喖鐖奸幃妤咁敇閵忊檧鎷绘繛杈剧悼閹虫捇顢氬鍕闁告瑥顦辨晶鐢碉拷瑙勬礃閸旀瑥鐣烽锕�唯鐟滃瞼绮径鎰仭婵犲﹤鎳庨。濂告偨椤栨稑绗ч柣銉海椤﹀綊鏌＄仦鍓ф创妞ゃ垺娲熼弫鎰板炊閳哄啯娈奸梻鍌欑劍婵炲﹪寮ㄩ崡鐑嗘綎闁煎鍊栭～鏇㈡煙閻戞ɑ顥栭柟椋庡厴閺佹劖鎯斿┑鍥ф灓闂備胶绮幐鎼佸Χ閹间礁钃熼柍銉ョ－閺嗗棝鎮楅敐搴″鐞氾箓姊绘担鑺ャ�冮柣鎺炵畵瀹曟繂鈻庤箛鏇熸闂佺粯鎸哥�垫帡鎮￠妷鈺傜厱闁硅埇鍔嶅▍鍛存煕閹捐埖鏆╃紒杈ㄦ崌瀹曟帒顫濋濠冨鐎瑰嫭鍣磋ぐ鎺戠倞闁靛绲肩划鎾绘⒑閸涘﹦缂氶柛搴㈢叀瀵啿顭ㄩ崼鐔哄幍闂佺粯鍨堕敃鈺佲枔閺冨牊鐓熼柟缁㈠灲閹风兘骞囨担鍝勬暩闂佽崵濮惧銊ф媰閿曞倹鍋傛い鎺嶈兌缁犲墽绱掑Δ锟介幖顐ｆ叏閸岀偞鐓涢悘鐐插⒔濞叉挳鏌涢埡浣割伃鐎规洘锕㈠畷婊嗩槻濠殿喖鐖煎缁樼瑹閿熻棄顭囪閳ワ箓顢橀悩鐢碉紳濠殿喗顭堟ご绋跨暦閺屻儲鐓曢柍鈺佸暟閳句線鏌ｉ幘宕囩闁哄本鐩、鏇㈡晲閸モ晝鏆梻浣烘嚀閸氬宕濋弽顓炍﹂柛鏇ㄥ墯閸庣喖鏌曡箛濠忔嫹瀹曞浄绱﹂梻鍌欑閹碱偊鎯夋總绋跨獥闁哄诞鍛濠电偛妫欓幐绋挎纯闂備胶纭堕崜婵嬨�冭箛鏂款嚤闁跨噦鎷�
					cost=bank.levelupcost;//濠电姷鏁告慨鐑藉极閸涘﹥鍙忛柣鎴ｆ閺嬩線鏌涘☉姗堟敾闁告瑥绻橀弻锝夊箣閿濆棭妫勯梺鍝勵儎缁舵岸寮婚悢鍏尖拻閻庨潧澹婂Σ顔剧磼閻愵剙鍔ゆい顓犲厴瀵鏁愭径濠勭杸濡炪倖甯婇悞锕傚磿閹剧粯鈷戦柟鑲╁仜婵″ジ鏌涙繝鍌涘仴鐎殿喖顭烽弫鎰緞婵犲孩缍傞梻浣虹帛閿氶柛鐔锋健瀵娊宕奸妷锔规嫼缂備礁顑嗛娆撳磿韫囨柣浜滈柟瀛樼箥濡拷閻庢鍠栭…閿嬩繆閹间礁鐓涢柛灞剧煯缁ㄤ粙姊绘担渚劸闁哄牜鍓涚划娆撳箣閿旂粯鏅滈梺璺ㄥ櫐閹凤拷??
					opid=FactionOpbean.TYPE_GOLD_UP;
					
					SendAllFactionMemeber(clan, ClanManage.GoldBank, level + 1);
				}
				else if (id == ClanManage.DrugStone)
				{
					int level = clan.getHouse().get(ClanManage.DrugStone);
					fire.pb.clan.SClanDrugstore drugstone =  fire.pb.main.ConfigManager.getInstance().getConf(fire.pb.clan.SClanDrugstore.class).get(level);
					if (drugstone == null)
					{
						fire.pb.talk.MessageMgr.sendMsgNotify(roleid, 143583, null);
						return true;
					}
				
					fire.pb.clan.SClanDrugstore l =  fire.pb.main.ConfigManager.getInstance().getConf(fire.pb.clan.SClanDrugstore.class).get(level + 1);
					if (l == null) //婵犵數濮烽弫鍛婃叏閻戣棄鏋侀柛娑橈攻閸欏繘鏌ｉ幋锝嗩棄闁哄绶氶弻鐔兼⒒鐎靛壊妲紒鐐劤椤兘寮婚敐澶婄疀妞ゆ帊鐒﹂崕鎾绘⒑閹肩偛濡奸柛濠傛健瀵鈽夐姀鈺傛櫇闂佹寧绻傚Λ娑⑺囬妷褏纾藉ù锝呮惈灏忛梺鍛婎殕婵炲﹤顕ｇ拠娴嬫婵☆垶鏀遍弬锟介梻浣告啞濞诧箓宕戦崟顒佸弿闁靛繈鍊栭埛鎴炵箾閼奸鍤欐鐐搭殜閺岀喖鎮烽悧鍫濇灎閻庢鍠栭…鐑藉极閹邦厼绶炲┑鐘插閸氬懘姊绘担鐟邦嚋缂佽鍊歌灋妞ゆ挾鍊ｅ☉銏犵妞ゆ挾濮烽敍婵囩箾閹剧澹橀柨鏇樺劤閿熻姤鑹剧紞濠傤潖閾忓湱鐭欓柟绋垮閹疯京绱撴担鍓插剱閻㈩垪锟藉磭鏆﹂柨婵嗙墢閻わ拷闂佸搫鍊告晶鐣岀不濮樿埖鈷戦梻鍫熺〒婢ф洟鏌熷畡閭﹀剶鐎规洘娲熼獮鍥偋閸繐鎷烽崹顐ｅ弿婵妫楁晶鎵磼婢跺銇濋柡宀�鍠栭、娆戠驳鐎ｎ偆鏆梻浣烘嚀瀵爼骞愰崘鑼殾闁绘梻鈷堥弫鍡涙煕鐏炶锟芥牞鈪烽梻鍌氬�搁崐鐑芥倿閿旀拝鎷风粭娑樻噹閺嬪牏锟藉箍鍎遍ˇ顖涱攰闂備礁鎲″ú锕傚垂閹殿喚涓嶅┑鐘崇閻撶喖鏌熼柇锕�鐏℃い銉ヮ槸闇夐柣娆欐嫹闁革綇缍侀獮鍐ㄎ旈崘鈺佹瀭闂佸憡娲﹂崜娑㈡晬濮楋拷濮婃椽宕ㄦ繝鍐ｆ嫻闂佹悶鍔屽鈩冧繆鐎涙ɑ濯撮柛鎾冲级瀵ゆ椽姊虹捄銊ユ瀺缂侇喗鐟╅悰顕�宕橀鍛櫆闂佸壊鍋呯换鍌滅玻濞戞﹩娓婚柕鍫濇婢ь剟鏌涢幋鐘冲殌閸楅亶寮堕崼娑樺缂佲槄鎷烽梻浣圭湽閸ㄨ棄顭囪閺嗏晠姊绘担鑺ャ�冮柣鎺炵畵楠炲啴宕掑杈ㄦ闂佺鎻梽鍕磻閹扮増鍋ｉ柛銉簻閻ㄧ儤銇勯弬鑳妞ゎ亜鍟存俊鍫曞川椤栨粠鍞堕梻浣虹帛椤ㄥ懎螞濞戞艾鍨濆┑鐘冲嚬閺佸秹鏌ｉ幇顒夊殶闁告瑥妫濆铏圭磼濡崵顦ラ梺绋匡工濠�閬嶆晸閼恒儳鍟查柟鍑ゆ嫹? by changhao
					{
						java.util.ArrayList<String> args = new java.util.ArrayList<String>();
						Integer s = level;
						args.add(s.toString());
						fire.pb.talk.MessageMgr.sendMsgNotify(roleid, 160226, args);
						return true;						
					}
					
					if (money < ClanUtils.getBuildLevelupMax(clan).get(ClanManage.DrugStone)) //闂傚倸鍊搁崐鎼佸磹閹间礁纾归柟闂寸绾惧湱锟界懓瀚崳纾嬨亹閹烘垹鍊為悷婊冪箻瀵娊鏁冮崒娑氬幈濡炪値鍘介崹鍨濠靛鐓曟繛鍡楃箳缁犲鏌″畝瀣М濠殿噯鎷烽梺闈涚箚閺呮繈宕濋崫銉х＝濞撴艾锕ョ�氳绻濋姀锝呯厫闁告梹鐗犻幃锟犲Ψ閳哄倻鍘搁梺鎼炲劗閺呮稒绂掑鍫熺叆闁绘梻绮ˉ澶愭煙閼恒儳鐭岄柛鎺撳浮閺佹劙宕ㄩ崒娑欘棃鐎规洏鍔戦、娆撳箚瑜嶇粻浼存⒑鐠囨煡顎楃紒鐘茬Ч瀹曟洘娼忛…鎴烆啍闂佸憡绺块崕鏌ュ汲濠婂牊鐓熼柟閭﹀枛閸斿鏌ｉ幘瀛樼闁哄本娲樺鍕熼悜妯间邯濠电姭鎷冮崘鍓у悑闂佸搫澶囬崜婵嬪箯閸涙潙宸濆┑鐘插閿涘棝姊绘担鍛婃儓闁哄牜鍓熼幆鍕敍濮樼厧娈ㄩ梺鍦檸閸犳牗鍎梻渚�娼чˇ顓㈠磿閸濆嫷鐒藉┑鐘崇閳锋帒霉閿濆懏鍟為柛鐔哄仱閺岀喓浜搁弽銊︾彋閻庤娲╃紞浣哥暦濮楋拷閳ワ箓骞嬮悙鐢碘枆濠电姷鏁搁崑娑樜熸繝鍐洸婵犲﹤鍠氶崯鍛節闂堟稒顥戦柡锟芥禒瀣厽婵☆垵顕х徊濠氭煛閸℃鎳勯柕鍥у閺佸倻鎲撮崟顒傚綃婵犳鍠栭敃銉ヮ渻娴犲宓侀柡宥庡幗閸婄兘鏌熺紒妯轰刊闁诲骸鐡ㄧ换婵嬫偨闂堟刀鐐烘煕閵婏附銇濋柡浣稿暣婵拷闁靛牆鎳忓Σ顒勬⒑闂堟稓绠冲┑顖ｅ弮瀹曘儳锟斤綆浜堕悢鍡涙偣閸濆嫨鍋ㄩ柨鐔哄Т閻撴盯鏌涘☉鍗炴灓闁告ɑ鎹囧娲川婵犲嫮鐣甸柣搴㈠嚬閸撶喖寮幘缁樺仼閻忕偟鍋撳В鍫澪旈悩闈涗粶缂佺粯鍔楅崣鍛渻閵堝懐绠伴柟鍐差樀楠炲繐煤椤忓應鎷洪梺绋跨箻濡潡鎳滈鍫熺厱閹艰揪绱曟晥濡炪們鍨哄Λ鍐ㄧ暦閾忚宕夐柣鎴灻弸鐘差渻閵堝啫鐏紒瀣灴閳ワ箓濡搁埡浣哥獩濡炪倖鐗徊鍓х懅婵犵數濮烽弫鎼佸磻閻樿绠垫い蹇撴缁�濠囨煥閻旇袚缂佺粯鐩畷顏堝礃椤忓懎浠瑰┑鐘灱椤煤閻旈鏆︽俊銈呮噺閳锋帡鎮楅棃娑欐喐闁伙綁绠栧缁樼瑹閿熻棄顭囪閹囧幢濞嗘劕搴婇梺鐟邦嚟婵挳骞忓畡閭︽僵閺夊牄鍔屽▓灞筋渻閵堝簼绨婚柛鐔风摠娣囧﹪骞嗛幍顔炬澑闂佸搫娲ㄦ慨闈涒枔閻撳簶鏀介柣鎰皺閹界姷绱掗鑲╃劯闁诡喓鍎茬缓浠嬪川婵犲倷绮ф俊鐐�栧ú鈺呭箯妞嬪函鎷峰▓鍨灆缂侇喗鐟╅妴浣割潨閿熶粙骞冮姀銈呭窛濠电姴绨奸幋鐑芥⒒閸屾艾锟藉嘲霉閸パ�鏋栭柡鍥ュ灩闂傤垶鏌ㄩ弴鐐诧拷鍝ョ不椤栫偞鐓ラ柣鏇炲�圭�氾拷? by changhao
					{
						fire.pb.talk.MessageMgr.sendMsgNotify(roleid, 160224, null);
						return true;
					}
					
					//闂傚倸鍊搁崐鎼佸磹閹间礁纾归柟闂寸绾惧綊鏌熼梻瀵割槮缁惧墽鎳撻—鍐拷锝庝簼閹癸綁鏌ｉ鐐搭棞闂囧鏌ㄥ┑鍡╂Ч濞存嚎鍊濋弻銈夊级閹稿骸浠村┑顔硷攻濡炰粙銆佸Δ鍛櫢闁伙絽鐬奸惌鎾绘煛鐏炶鍔滈柡鍛倐閺岋箑螣娓氼垱笑闂佽法鍠曞Λ鍕焽閿熺姴违濞达絿纭堕弸搴ㄦ煙閹咃紞妞わ富鍙冮幃宄邦煥閸愵亞顔掗柦妯荤箖閵囧嫰寮介妸褋锟芥帞绱掗悩鑽ょ暫闁哄瞼鍠栭獮鍡氼檨闁搞倗鍠栭弻娑㈡偄閸濄儱寮ㄩ梺鍝勭灱閸犳牠骞冨鍫熷殟闁靛闄勫▓鍛婁繆閻愵亜锟芥垿宕濇繝鍥х？闁汇垻顭堢粻鏍ㄧ箾閸℃ɑ灏紒鐙欏洦鐓欓悗娑欘焽缁犮儲绻涢崗鐓庡摵婵﹦绮幏鍛存嚍閵夛綇鎷烽崘顔界厽闁硅櫣鍋熼悾鍨殽閻愭潙鐏寸�规洖鐖奸、妤呮晸娴犲鍑犲〒姘炬嫹闁哄瞼鍠栧畷婊嗩槾閻㈩垱鐩弻锟犲川椤旇棄锟芥劙鏌＄仦璇插闁诡喓鍊濆畷鎺戔槈濮楀棔绱� by changhao
					boolean ok = ClanManage.AddClanMoney(-drugstone.levelupcost, clan);
					if (ok == false)
					{
						fire.pb.talk.MessageMgr.sendMsgNotify(roleid, 160224, null);
						return true;
					}
					
					clan.getHouse().put(ClanManage.DrugStone, level + 1);
					
					sClanLevelup.change.put(ClanManage.DrugStone, level + 1);
					sClanLevelup.money = clan.getMoney();
					
					uplevel=level + 1;//闂傚倸鍊搁崐鎼佸磹閹间礁纾归柟闂寸绾惧綊鏌熼梻瀵割槮缁惧墽鎳撻—鍐拷锝庝簼閹癸綁鏌ｉ鐐搭棞闁靛棙甯掗～婵嬫倷椤掞拷椤忚埖淇婇妶鍥ラ柛瀣洴钘濋柣銏㈩焾閺嬩線鏌熼崜褏甯涢柛瀣姈閵囧嫰寮撮悙鎼！闁诲孩鑹剧紞濠囧蓟濞戙垹绠涢梻鍫熺♁閻忓牓鎮楅悷鐗堝暈缂佽鍟存俊鐢稿礋椤栨氨顔婇梺鐟扮摠缁诲啴宕愰姘ｆ斀闁挎稑瀚禒鈺佲攽椤斿搫锟芥牜绮氭潏銊х瘈闁搞儜鍜佸晣濠电偠鎻紞锟芥い顐㈩槸閳诲秹宕卞▎鎴狅紳闂佺鏈悷褔宕濆澶嬬叆闁哄洦顨嗗▍濠勶拷瑙勬处閸ㄤ即顢橀崗鐓庣窞閻庯急鍕伜婵犵數鍋犻幓顏嗙礊閿熻姤銇勯銏╂█鐎规洘鍨块幃鈺冪磼濡厧骞堥梺鐟板悑閻ｎ亪宕瑰ú顏勎︽繝闈涚墳閹烽鎲撮崟顒傤槰缂備緡鍠栭惌鍌炲春閵忊剝鍎熼柕濞垮劤椤撴椽姊虹紒妯哄鐎殿喖鐖奸幃妤咁敇閵忊檧鎷绘繛杈剧悼閹虫捇顢氬鍕闁告瑥顦辨晶鐢碉拷瑙勬礃閸旀瑥鐣烽锕�唯鐟滃瞼绮径鎰仭婵犲﹤鎳庨。濂告偨椤栨稑绗ч柣銉海椤﹀綊鏌＄仦鍓ф创妞ゃ垺娲熼弫鎰板炊閳哄啯娈奸梻鍌欑劍婵炲﹪寮ㄩ崡鐑嗘綎闁煎鍊栭～鏇㈡煙閻戞ɑ顥栭柟椋庡厴閺佹劖鎯斿┑鍥ф灓闂備胶绮幐鎼佸Χ閹间礁钃熼柍銉ョ－閺嗗棝鎮楅敐搴″鐞氾箓姊绘担鑺ャ�冮柣鎺炵畵瀹曟繂鈻庤箛鏇熸闂佺粯鎸哥�垫帡鎮￠妷鈺傜厱闁硅埇鍔嶅▍鍛存煕閹捐埖鏆╃紒杈ㄦ崌瀹曟帒顫濋濠冨鐎瑰嫭鍣磋ぐ鎺戠倞闁靛绲肩划鎾绘⒑閸涘﹦缂氶柛搴㈢叀瀵啿顭ㄩ崼鐔哄幍闂佺粯鍨堕敃鈺佲枔閺冨牊鐓熼柟缁㈠灲閹风兘骞囨担鍝勬暩闂佽崵濮惧銊ф媰閿曞倹鍋傛い鎺嶈兌缁犲墽绱掑Δ锟介幖顐ｆ叏閸岀偞鐓涢悘鐐插⒔濞叉挳鏌涢埡浣割伃鐎规洘锕㈠畷婊嗩槻濠殿喖鐖煎缁樼瑹閿熻棄顭囪閳ワ箓顢橀悩鐢碉紳濠殿喗顭堟ご绋跨暦閺屻儲鐓曢柍鈺佸暟閳句線鏌ｉ幘宕囩闁哄本鐩、鏇㈡晲閸モ晝鏆梻浣烘嚀閸氬宕濋弽顓炍﹂柛鏇ㄥ墯閸庣喖鏌曡箛濠忔嫹瀹曞浄绱﹂梻鍌欑閹碱偊鎯夋總绋跨獥闁哄诞鍛濠电偛妫欓幐绋挎纯闂備胶纭堕崜婵嬨�冭箛鏂款嚤闁跨噦鎷�
					cost=drugstone.levelupcost;//濠电姷鏁告慨鐑藉极閸涘﹥鍙忛柣鎴ｆ閺嬩線鏌涘☉姗堟敾闁告瑥绻橀弻锝夊箣閿濆棭妫勯梺鍝勵儎缁舵岸寮婚悢鍏尖拻閻庨潧澹婂Σ顔剧磼閻愵剙鍔ゆい顓犲厴瀵鏁愭径濠勭杸濡炪倖甯婇悞锕傚磿閹剧粯鈷戦柟鑲╁仜婵″ジ鏌涙繝鍌涘仴鐎殿喖顭烽弫鎰緞婵犲孩缍傞梻浣虹帛閿氶柛鐔锋健瀵娊宕奸妷锔规嫼缂備礁顑嗛娆撳磿韫囨柣浜滈柟瀛樼箥濡拷閻庢鍠栭…閿嬩繆閹间礁鐓涢柛灞剧煯缁ㄤ粙姊绘担渚劸闁哄牜鍓涚划娆撳箣閿旂粯鏅滈梺璺ㄥ櫐閹凤拷??
					opid=FactionOpbean.TYPE_DRUGSTONE_UP;
					
					SendAllFactionMemeber(clan, ClanManage.DrugStone, level + 1);
					//婵犵數濮烽弫鍛婃叏閻戣棄鏋侀柛娑橈攻閸欏繘鏌ｉ幋锝嗩棄闁哄绶氶弻娑樷槈濮楀牊鏁鹃梺鍛婄懃缁绘劙婀侀梺绋跨箰閸氬绱為幋锔界厱闁靛鍎遍敓钘夋健瀵鏁愭径濠勵啋閻庤娲栧ú銈夊传濞差亝鈷戦柛婵嗗閸庢劙鏌ｅΔ渚囨畼闁瑰箍鍨归埥澶愬閻樻鍚呴梻浣虹帛閸旀瑥顭囪瀵娊鏁撻悩鏂ユ嫼闂佽崵鍠愬妯何ｆ繝姘厱闁靛骏绱曢崣锟介梺鎸庣箘閸嬫盯鍩為幋鐙呮嫹閿濆骸浜滃ù婊勵殜閺岀喖宕楅懖鈺傛闂佹悶鍔嶅Σ鎺楀Φ閹邦厽鍎熸い顐幘缁犳岸姊洪棃娑氬婵炲眰鍊曢弳鈺呮⒒娴ｄ警鐒炬い鎴濇閹嫰顢涘杈ㄦ濡炪倖鐗滈崕鎰板极瀹ュ棛绡�濠电姴鍊搁鈺呭箹閺夋埊宸ラ柍瑙勫灴閹晝绱掑Ο濠氭暘婵＄偑鍊栭崹鐢稿箠閹邦喖鍨濋柛顐犲劚缁�鍐┿亜閺冨倹娅曢柛妯圭矙濮婃椽鏌呭☉妯虹ギ濠电偘鍖犻崶褍鍋嶉梺鍛婄缚閸庡磭澹曢崗绗轰簻闁哄洨鍋為崳褰掓煟韫囥儳纾跨紒杈ㄥ笧缁辨帒螣閼测晝鏆梻浣告憸婵挳鏁冮妶鍫航婵犵數鍋犵亸娆戝垝椤栨粎绀婂鑸靛姈閳锋帒霉閿濆牜娼愰柛瀣█閺屾盯寮敓浠嬪垂閸撲胶鐭夌�广儱顦柋鍥煛閸ヮ煉鍏柟鐑芥敱缁楃喖鏁撻挊澶樺殨闁稿﹦鍣ュΣ鐑芥⒑閸濆嫷鍎忛梺甯秮瀵鎮㈤悡搴ｇ暰閻熸粌绻樺鎼佸礃椤忓懎浠忓┑鐘绘涧椤戝棝鍩涢幒鎳ㄥ綊鏁愰崼顐ｇ秷闂佺顑囨繛锟介柡灞剧♁閹棃濮�鎺虫禒銏ゆ倵鐟欏嫭绀冪紒顔肩焸閿濈偛鈹戠�ｎ偄娈濋梻鍌氱墛缁嬫劗鑺遍悽鍛娾拻濞达絽鎲￠幆鍫熺箾鐏炲倸鐏茬�规洜鎳撶叅妞ゅ繐鎳庢禍妤�鈹戦悙鍙夘棡闁圭顭烽幃锟犳偄閸忚偐鍘甸柣搴ｆ暩椤牓鏁撻懞銉у⒌妤犵偛顑夐弫鍐晸娴犲鍋傞柡鍥ュ灪閻撴瑩鏌熷▓鍨灈妞わ絽銈搁弻锝夊箻鐠虹儤鐏堥梺鍝勭灱閸犳牠骞冨鍏剧喖鎳￠妶搴⑿炵紓鍌欒兌閾忓酣宕㈡總鍛婂亯濠靛倻顭堥拑鐔兼煏婵炵偓娅嗛柛瀣閺屾盯骞嬪▎蹇ユ嫹閺嶎偓鎷峰顒傜Ш闁哄矉缍佸鏉戭潩閸楃偛顬夌紓鍌氬�哥粔鎾偋閹炬剚娼栨繛宸簼閸嬶繝鏌ｅΔ锟介悧鍡涘汲閸儲鈷戦悹鍥ｏ拷铏亪闂佺锕ラ幃鍌炲箖妤ｅ啯鍊婚柦妯侯槺閻わ拷闂備礁鎼ˇ顖氼焽閿熺姴鏋佹繝濠傚暊閺�浠嬪箳閹惰棄纾圭憸鏃堢嵁韫囨稒鍊婚柤鎭掑劤閸欏啴姊洪崨濠傚Е濞存粍绮撳绋库槈閵忥紕鍘搁柣蹇曞仜婢т粙鍩ユ径鎰厓闁芥ê顦藉Σ鎼佹煃鐠囨煡鍙勬鐐叉喘椤㈡瑩鏌ㄩ娑氾拷濂告⒒閸屾艾锟介绮堟笟锟介獮澶愭晸閻樺啿浠梺闈涱槴閺呮粓寮插┑鍥ヤ簻闊洦鎸炬晶娑㈡煕鐎ｎ亜锟藉綊濡甸崟顖氱疀闁告挷鑳堕弳鐘绘⒑缂佹ê濮囬柨鏇ㄤ邯瀵寮撮悢铏圭槇闂婎偄娲﹂幖鈺伱洪鐑嗘富闁靛牆绻楃粈瀣煕鎼达紕锛嶆俊鍙夊姍楠炴锟芥稒锚椤庢捇鏌ｉ悢鍝ユ噧閻庢艾鍢茶灋闁哄稁鍘介埛鎴︽煟閻斿憡绶叉繛鍫氭櫊閺岀喖宕欓妶鍡楊伓
					if(level==0){
						mkdb.Procedure proc=fire.pb.clan.srv.ClanManage.refreshMedic(clan.getKey());
						mkdb.Procedure.pexecuteWhileCommit(proc);
					}
				}
				else if (id == ClanManage.Hotel)
				{
					int level = clan.getHouse().get(ClanManage.Hotel);
					fire.pb.clan.SClanHotel hotel =  fire.pb.main.ConfigManager.getInstance().getConf(fire.pb.clan.SClanHotel.class).get(level);
					if (hotel == null)
					{
						fire.pb.talk.MessageMgr.sendMsgNotify(roleid, 143583, null);
						return true;
					}
				
					fire.pb.clan.SClanDrugstore l =  fire.pb.main.ConfigManager.getInstance().getConf(fire.pb.clan.SClanDrugstore.class).get(level + 1);
					if (l == null) //婵犵數濮烽弫鍛婃叏閻戣棄鏋侀柛娑橈攻閸欏繘鏌ｉ幋锝嗩棄闁哄绶氶弻鐔兼⒒鐎靛壊妲紒鐐劤椤兘寮婚敐澶婄疀妞ゆ帊鐒﹂崕鎾绘⒑閹肩偛濡奸柛濠傛健瀵鈽夐姀鈺傛櫇闂佹寧绻傚Λ娑⑺囬妷褏纾藉ù锝呮惈灏忛梺鍛婎殕婵炲﹤顕ｇ拠娴嬫婵☆垶鏀遍弬锟介梻浣告啞濞诧箓宕戦崟顒佸弿闁靛繈鍊栭埛鎴炵箾閼奸鍤欐鐐搭殜閺岀喖鎮烽悧鍫濇灎閻庢鍠栭…鐑藉极閹邦厼绶炲┑鐘插閸氬懘姊绘担鐟邦嚋缂佽鍊歌灋妞ゆ挾鍊ｅ☉銏犵妞ゆ挾濮烽敍婵囩箾閹剧澹橀柨鏇樺劤閿熻姤鑹剧紞濠傤潖閾忓湱鐭欓柟绋垮閹疯京绱撴担鍓插剱閻㈩垪锟藉磭鏆﹂柨婵嗙墢閻わ拷闂佸搫鍊告晶鐣岀不濮樿埖鈷戦梻鍫熺〒婢ф洟鏌熷畡閭﹀剶鐎规洘娲熼獮鍥偋閸繐鎷烽崹顐ｅ弿婵妫楁晶鎵磼婢跺銇濋柡宀�鍠栭、娆戠驳鐎ｎ偆鏆梻浣烘嚀瀵爼骞愰崘鑼殾闁绘梻鈷堥弫鍡涙煕鐏炶锟芥牞鈪烽梻鍌氬�搁崐鐑芥倿閿旀拝鎷风粭娑樻噹閺嬪牏锟藉箍鍎遍ˇ顖涱攰闂備礁鎲″ú锕傚垂閹殿喚涓嶅┑鐘崇閻撶喖鏌熼柇锕�鐏℃い銉ヮ槸闇夐柣娆欐嫹闁革綇缍侀獮鍐ㄎ旈崘鈺佹瀭闂佸憡娲﹂崜娑㈡晬濮楋拷濮婃椽宕ㄦ繝鍐ｆ嫻闂佹悶鍔屽鈩冧繆鐎涙ɑ濯撮柛鎾冲级瀵ゆ椽姊虹捄銊ユ瀺缂侇喗鐟╅悰顕�宕橀鍛櫆闂佸壊鍋呯换鍌滅玻濞戞﹩娓婚柕鍫濇婢ь剟鏌涢幋鐘冲殌閸楅亶寮堕崼娑樺缂佲槄鎷烽梻浣圭湽閸ㄨ棄顭囪閺嗏晠姊绘担鑺ャ�冮柣鎺炵畵楠炲啴宕掑杈ㄦ闂佺鎻梽鍕磻閹扮増鍋ｉ柛銉簻閻ㄧ儤銇勯弬鑳妞ゎ亜鍟存俊鍫曞川椤栨粠鍞堕梻浣虹帛椤ㄥ懎螞濞戞艾鍨濆┑鐘冲嚬閺佸秹鏌ｉ幇顒夊殶闁告瑥妫濆铏圭磼濡崵顦ラ梺绋匡工濠�閬嶆晸閼恒儳鍟查柟鍑ゆ嫹? by changhao
					{
						java.util.ArrayList<String> args = new java.util.ArrayList<String>();
						Integer s = level;
						args.add(s.toString());
						fire.pb.talk.MessageMgr.sendMsgNotify(roleid, 160226, args);
						return true;						
					}
					
					if (money < ClanUtils.getBuildLevelupMax(clan).get(ClanManage.Hotel)) //闂傚倸鍊搁崐鎼佸磹閹间礁纾归柟闂寸绾惧湱锟界懓瀚崳纾嬨亹閹烘垹鍊為悷婊冪箻瀵娊鏁冮崒娑氬幈濡炪値鍘介崹鍨濠靛鐓曟繛鍡楃箳缁犲鏌″畝瀣М濠殿噯鎷烽梺闈涚箚閺呮繈宕濋崫銉х＝濞撴艾锕ョ�氳绻濋姀锝呯厫闁告梹鐗犻幃锟犲Ψ閳哄倻鍘搁梺鎼炲劗閺呮稒绂掑鍫熺叆闁绘梻绮ˉ澶愭煙閼恒儳鐭岄柛鎺撳浮閺佹劙宕ㄩ崒娑欘棃鐎规洏鍔戦、娆撳箚瑜嶇粻浼存⒑鐠囨煡顎楃紒鐘茬Ч瀹曟洘娼忛…鎴烆啍闂佸憡绺块崕鏌ュ汲濠婂牊鐓熼柟閭﹀枛閸斿鏌ｉ幘瀛樼闁哄本娲樺鍕熼悜妯间邯濠电姭鎷冮崘鍓у悑闂佸搫澶囬崜婵嬪箯閸涙潙宸濆┑鐘插閿涘棝姊绘担鍛婃儓闁哄牜鍓熼幆鍕敍濮樼厧娈ㄩ梺鍦檸閸犳牗鍎梻渚�娼чˇ顓㈠磿閸濆嫷鐒藉┑鐘崇閳锋帒霉閿濆懏鍟為柛鐔哄仱閺岀喓浜搁弽銊︾彋閻庤娲╃紞浣哥暦濮楋拷閳ワ箓骞嬮悙鐢碘枆濠电姷鏁搁崑娑樜熸繝鍐洸婵犲﹤鍠氶崯鍛節闂堟稒顥戦柡锟芥禒瀣厽婵☆垵顕х徊濠氭煛閸℃鎳勯柕鍥у閺佸倻鎲撮崟顒傚綃婵犳鍠栭敃銉ヮ渻娴犲宓侀柡宥庡幗閸婄兘鏌熺紒妯轰刊闁诲骸鐡ㄧ换婵嬫偨闂堟刀鐐烘煕閵婏附銇濋柡浣稿暣婵拷闁靛牆鎳忓Σ顒勬⒑闂堟稓绠冲┑顖ｅ弮瀹曘儳锟斤綆浜堕悢鍡涙偣閸濆嫨鍋ㄩ柨鐔哄Т閻撴盯鏌涘☉鍗炴灓闁告ɑ鎹囧娲川婵犲嫮鐣甸柣搴㈠嚬閸撶喖寮幘缁樺仼閻忕偟鍋撳В鍫澪旈悩闈涗粶缂佺粯鍔楅崣鍛渻閵堝懐绠伴柟鍐差樀楠炲繐煤椤忓應鎷洪梺绋跨箻濡潡鎳滈鍫熺厱閹艰揪绱曟晥濡炪們鍨哄Λ鍐ㄧ暦閾忚宕夐柣鎴灻弸鐘差渻閵堝啫鐏紒瀣灴閳ワ箓濡搁埡浣哥獩濡炪倖鐗徊鍓х懅婵犵數濮烽弫鎼佸磻閻樿绠垫い蹇撴缁�濠囨煥閻旇袚缂佺粯鐩畷顏堝礃椤忓懎浠瑰┑鐘灱椤煤閻旈鏆︽俊銈呮噺閳锋帡鎮楅棃娑欐喐闁伙綁绠栧缁樼瑹閿熻棄顭囪閹囧幢濞嗘劕搴婇梺鐟邦嚟婵挳骞忓畡閭︽僵閺夊牄鍔屽▓灞筋渻閵堝簼绨婚柛鐔风摠娣囧﹪骞嗛幍顔炬澑闂佸搫娲ㄦ慨闈涒枔閻撳簶鏀介柣鎰皺閹界姷绱掗鑲╃劯闁诡喓鍎茬缓浠嬪川婵犲倷绮ф俊鐐�栧ú鈺呭箯妞嬪函鎷峰▓鍨灆缂侇喗鐟╅妴浣割潨閿熶粙骞冮姀銈呭窛濠电姴绨奸幋鐑芥⒒閸屾艾锟藉嘲霉閸パ�鏋栭柡鍥ュ灩闂傤垶鏌ㄩ弴鐐诧拷鍝ョ不椤栫偞鐓ラ柣鏇炲�圭�氾拷? by changhao
					{
						fire.pb.talk.MessageMgr.sendMsgNotify(roleid, 160224, null);
						return true;
					}
					
					//闂傚倸鍊搁崐鎼佸磹閹间礁纾归柟闂寸绾惧綊鏌熼梻瀵割槮缁惧墽鎳撻—鍐拷锝庝簼閹癸綁鏌ｉ鐐搭棞闂囧鏌ㄥ┑鍡╂Ч濞存嚎鍊濋弻銈夊级閹稿骸浠村┑顔硷攻濡炰粙銆佸Δ鍛櫢闁伙絽鐬奸惌鎾绘煛鐏炶鍔滈柡鍛倐閺岋箑螣娓氼垱笑闂佽法鍠曞Λ鍕焽閿熺姴违濞达絿纭堕弸搴ㄦ煙閹咃紞妞わ富鍙冮幃宄邦煥閸愵亞顔掗柦妯荤箖閵囧嫰寮介妸褋锟芥帞绱掗悩鑽ょ暫闁哄瞼鍠栭獮鍡氼檨闁搞倗鍠栭弻娑㈡偄閸濄儱寮ㄩ梺鍝勭灱閸犳牠骞冨鍫熷殟闁靛闄勫▓鍛婁繆閻愵亜锟芥垿宕濇繝鍥х？闁汇垻顭堢粻鏍ㄧ箾閸℃ɑ灏紒鐙欏洦鐓欓悗娑欘焽缁犮儲绻涢崗鐓庡摵婵﹦绮幏鍛存嚍閵夛綇鎷烽崘顔界厽闁硅櫣鍋熼悾鍨殽閻愭潙鐏寸�规洖鐖奸、妤呮晸娴犲鍑犲〒姘炬嫹闁哄瞼鍠栧畷婊嗩槾閻㈩垱鐩弻锟犲川椤旇棄锟芥劙鏌＄仦璇插闁诡喓鍊濆畷鎺戔槈濮楀棔绱� by changhao
					boolean ok = ClanManage.AddClanMoney(-hotel.levelupcost, clan);
					if (ok == false)
					{
						fire.pb.talk.MessageMgr.sendMsgNotify(roleid, 160224, null);
						return true;
					}
					
					clan.getHouse().put(ClanManage.Hotel, level + 1);
					
					sClanLevelup.change.put(ClanManage.Hotel, level + 1);
					sClanLevelup.money = clan.getMoney();
					uplevel=level + 1;//闂傚倸鍊搁崐鎼佸磹閹间礁纾归柟闂寸绾惧綊鏌熼梻瀵割槮缁惧墽鎳撻—鍐拷锝庝簼閹癸綁鏌ｉ鐐搭棞闁靛棙甯掗～婵嬫倷椤掞拷椤忚埖淇婇妶鍥ラ柛瀣洴钘濋柣銏㈩焾閺嬩線鏌熼崜褏甯涢柛瀣姈閵囧嫰寮撮悙鎼！闁诲孩鑹剧紞濠囧蓟濞戙垹绠涢梻鍫熺♁閻忓牓鎮楅悷鐗堝暈缂佽鍟存俊鐢稿礋椤栨氨顔婇梺鐟扮摠缁诲啴宕愰姘ｆ斀闁挎稑瀚禒鈺佲攽椤斿搫锟芥牜绮氭潏銊х瘈闁搞儜鍜佸晣濠电偠鎻紞锟芥い顐㈩槸閳诲秹宕卞▎鎴狅紳闂佺鏈悷褔宕濆澶嬬叆闁哄洦顨嗗▍濠勶拷瑙勬处閸ㄤ即顢橀崗鐓庣窞閻庯急鍕伜婵犵數鍋犻幓顏嗙礊閿熻姤銇勯銏╂█鐎规洘鍨块幃鈺冪磼濡厧骞堥梺鐟板悑閻ｎ亪宕瑰ú顏勎︽繝闈涚墳閹烽鎲撮崟顒傤槰缂備緡鍠栭惌鍌炲春閵忊剝鍎熼柕濞垮劤椤撴椽姊虹紒妯哄鐎殿喖鐖奸幃妤咁敇閵忊檧鎷绘繛杈剧悼閹虫捇顢氬鍕闁告瑥顦辨晶鐢碉拷瑙勬礃閸旀瑥鐣烽锕�唯鐟滃瞼绮径鎰仭婵犲﹤鎳庨。濂告偨椤栨稑绗ч柣銉海椤﹀綊鏌＄仦鍓ф创妞ゃ垺娲熼弫鎰板炊閳哄啯娈奸梻鍌欑劍婵炲﹪寮ㄩ崡鐑嗘綎闁煎鍊栭～鏇㈡煙閻戞ɑ顥栭柟椋庡厴閺佹劖鎯斿┑鍥ф灓闂備胶绮幐鎼佸Χ閹间礁钃熼柍銉ョ－閺嗗棝鎮楅敐搴″鐞氾箓姊绘担鑺ャ�冮柣鎺炵畵瀹曟繂鈻庤箛鏇熸闂佺粯鎸哥�垫帡鎮￠妷鈺傜厱闁硅埇鍔嶅▍鍛存煕閹捐埖鏆╃紒杈ㄦ崌瀹曟帒顫濋濠冨鐎瑰嫭鍣磋ぐ鎺戠倞闁靛绲肩划鎾绘⒑閸涘﹦缂氶柛搴㈢叀瀵啿顭ㄩ崼鐔哄幍闂佺粯鍨堕敃鈺佲枔閺冨牊鐓熼柟缁㈠灲閹风兘骞囨担鍝勬暩闂佽崵濮惧銊ф媰閿曞倹鍋傛い鎺嶈兌缁犲墽绱掑Δ锟介幖顐ｆ叏閸岀偞鐓涢悘鐐插⒔濞叉挳鏌涢埡浣割伃鐎规洘锕㈠畷婊嗩槻濠殿喖鐖煎缁樼瑹閿熻棄顭囪閳ワ箓顢橀悩鐢碉紳濠殿喗顭堟ご绋跨暦閺屻儲鐓曢柍鈺佸暟閳句線鏌ｉ幘宕囩闁哄本鐩、鏇㈡晲閸モ晝鏆梻浣烘嚀閸氬宕濋弽顓炍﹂柛鏇ㄥ墯閸庣喖鏌曡箛濠忔嫹瀹曞浄绱﹂梻鍌欑閹碱偊鎯夋總绋跨獥闁哄诞鍛濠电偛妫欓幐绋挎纯闂備胶纭堕崜婵嬨�冭箛鏂款嚤闁跨噦鎷�
					cost=hotel.levelupcost;//濠电姷鏁告慨鐑藉极閸涘﹥鍙忛柣鎴ｆ閺嬩線鏌涘☉姗堟敾闁告瑥绻橀弻锝夊箣閿濆棭妫勯梺鍝勵儎缁舵岸寮婚悢鍏尖拻閻庨潧澹婂Σ顔剧磼閻愵剙鍔ゆい顓犲厴瀵鏁愭径濠勭杸濡炪倖甯婇悞锕傚磿閹剧粯鈷戦柟鑲╁仜婵″ジ鏌涙繝鍌涘仴鐎殿喖顭烽弫鎰緞婵犲孩缍傞梻浣虹帛閿氶柛鐔锋健瀵娊宕奸妷锔规嫼缂備礁顑嗛娆撳磿韫囨柣浜滈柟瀛樼箥濡拷閻庢鍠栭…閿嬩繆閹间礁鐓涢柛灞剧煯缁ㄤ粙姊绘担渚劸闁哄牜鍓涚划娆撳箣閿旂粯鏅滈梺璺ㄥ櫐閹凤拷??
					opid=FactionOpbean.TYPE_HOTEL_UP;
					
					SendAllFactionMemeber(clan, ClanManage.Hotel, level + 1);
					//闂傚倸鍊搁崐鎼佸磹閹间礁纾归柟闂寸绾惧綊鏌熼梻瀵割槮缁惧墽鎳撻—鍐拷锝庝簼閹癸綁鏌ｉ鐐搭棞闁靛棙甯掗～婵嬫倷椤掞拷椤忚埖淇婇妶鍥ラ柛瀣仱閹囨偐濮瑰浄鎷锋笟锟藉鎾閻橀潧骞堟繝娈垮枟閿曗晠宕㈡禒瀣︽繝闈涙閺�浠嬫⒔閸ヮ剙鏄ラ柡宓苯娈梺鍛婃处閸欏繘骞忛悜鑺ユ櫜閹煎瓨绻勯懗鍝勨攽閳ュ啿绾ч柛鏃�鐟ラ～蹇曠磼濡偐鎳濋梺璺ㄥ枙濡嫰鈥﹂崶顏嶆▉婵犫拃鍕疄婵﹥妞藉畷顐﹀礋椤掞拷濞呫倝姊洪悜鈺傛珦闁搞劌鐖奸悰顔跨疀濞戞顓洪梺鎸庢濡嫭绂嶅鍫熺厽闊洦鎸剧粻锝夋煟閹虹偟鐣电�殿噮鍓熼弫鎾寸鐎ｎ偀鎷绘繛杈剧秬濞咃絿鏁☉銏＄叆婵ɑ鍞婚幏宄扳枔閸喗鐏堥梺缁樼墪閵堟悂鎮伴锟藉浠嬵敇閻愮數鏉告俊鐐�栭弻銊︽櫠娴犲鏅繝濠傜墛閳锋垿鎮归幁鎺戝闁哄绉剁槐鎺楊敊閻ｅ本鍣ч梺浼欑悼閸忔﹢鐛幒妤�绠ｉ柡鍐挎嫹妞ゎ偄绉瑰娲传閸曨厸鏋屾繝纰橈拷铏枠闁诡垰瀚幆鏃堝Ω閿旇瀚藉┑鐐舵彧缁茶偐鎷冮敃鍌氱哗濞寸厧鐡ㄩ悡娆愮箾閼奸鍞虹紒銊ф櫕閿熻棄鐏氬姗�鏁冮鍕殾婵犲﹤妫Σ濂告⒑缁嬭法绠茬紒顔芥崌瀵鈽夐姀鐘殿啋闂佽壈澹堝▔娑㈠储閿涘嫮纾奸柣鎰靛墮閸斻倝鏌曢崼鐔稿�愮�殿喖顭烽幃銏ゅ礂閼测晛濮洪梻浣瑰濞测晠骞忔搴嫹濞堝灝鏋ら柛瀣尵閹广垹鈽夐姀鐘诲敹闂佺粯娲戦懗鍫曞礉妞嬪海纾藉ù锝勭矙閸濇椽鎮介娑辨當妞ゎ厼娲╃粻娑樷槈濡壕鏅犻弻鏇熺珶椤栨碍鍣洪柛锝庡灦濮婂宕掑▎鎴М闂佹眹鍊曞ú銈堢亱闂佸憡娲﹂崹渚�宕堕澶嬫櫖闂佺粯鍨靛ú銊х矙韫囨挴鏀介柣妯款嚋瀹搞儵鏌ｅΔ锟藉Λ婵嬫偘椤曪拷婵拷闁炽儴灏欑粻姘渻閵堝棛澧紒顔兼湰缁傚秵绺介崨濠勫幈闂佸搫鍊藉▔鏇熺墡缂傚倷绀侀惌浣广仈閸濄儲宕叉繝闈涱儏閻愬﹥銇勯澶婂姱闁搞儯鍔庨崢閬嶆⒑闂堟侗妯堥柛鐘崇缁傛帡濮�閵堝棛鍘棅顐㈡储閸庡磭澹曠捄銊х＜闁绘ɑ褰冮埛鏃堟煥閻旂儤娅曢柟铏尰缁旂喐绻濋崶褏鐛ラ梺鍝勮癁鐏炶姤顓挎俊鐐�栧ú鈺呭箯閻戣姤鐓涚�癸拷鐎ｎ剙鍩岄梺瀹犳椤﹂潧鐣烽敓鐘冲�烽悗鐢殿焾缂嶅棗鈹戞幊閸婃鎱ㄩ悜钘夌；闁绘劕鐏氶弳婊堟煙閻戞ɑ绀堝ù婊勭懇濮婄粯鎷呴懞銉с�婇梺鍝ュУ閹瑰洤顕ｉ弻銉晝闁靛牆鎳庨悘濠冪節閻㈤潧校闁肩懓澧界划濠氼敋閿熶粙寮婚妶澶婄畳闁圭儤鍨垫慨銏ゆ⒑閸涘鎴﹀箖閸屾凹娼栨繛宸簻缁犲綊鏌ｉ幇顓炵祷濠殿喖鐭傚铏圭矙閹稿骸鏀俊鐐存綑閹诧紕绮氭潏銊х瘈闁告劦浜跺ù鍕煟鎼搭垳绉甸柛瀣瀹曘垽骞栨担鍏夋嫼缂備礁顑堝▔鏇㈡倿閸ф鈷掗柛鏇ㄥ亜椤忣偊鏌ㄩ悢璇残撻柣鏃戝墴楠炲繘鏁撻敓锟� by changhao
					mkdb.Procedure.pexecuteWhileCommit(new ClanRank(clan.toData()));
					mkdb.Procedure.pexecuteWhileCommit(new fire.pb.ranklist.proc.PFactionZongHeProc(clan.getKey(), false));
				}
				
				sClanLevelup.costmax.putAll(ClanUtils.getBuildLevelupMax(clan));
				mkdb.Procedure.psendWhileCommit(clan.getMembers().keySet(), sClanLevelup); //闂傚倸鍊搁崐鎼佸磹閹间礁纾归柟闂寸绾惧綊鏌熼梻瀵割槮缁惧墽鎳撻—鍐拷锝庝簼閹癸綁鏌ｉ鐐搭棞闁靛棙甯掗～婵嬫倷椤掞拷椤忚埖淇婇妶鍥ラ柛瀣洴钘濋柣銏㈩焾閺嬩線鏌熼崜褏甯涢柛瀣姍閺屾盯骞囬姘卞闂佹眹鍨归…宄邦潖缂佹ɑ濯撮柣鐔煎亰閸ゅ鈹戦悙鎻掔骇闁绘濮撮悾鐑藉箛閺夎法顔愭繛杈剧悼椤牓鎮楅銏♀拺缂佸娉曢悘閬嶆煕鐎ｎ剙浠遍柟顕嗙節婵＄兘鍩￠崒婊冨箺闂備礁鎼ú銊╁磻濞戙垺鏅搁柦妯侯槹鐠愶繝鏌ㄩ悢璇残撻柣鏃戝墴楠炲繘鏁撻敓锟�?濠电姷鏁告慨鐑藉极閸涘﹥鍙忛柣鎴ｆ閺嬩線鏌熼梻瀵割槮缁炬儳顭烽弻锝呂熷▎鎯ф缂備胶濮撮悘姘跺Φ閸曨喚鐤�闁圭偓鎯屽Λ銈囩磽娓氬﹥瀚规繝鐢靛Т濞诧箓鎮￠妷鈺傜厽闁哄啫娴傞崵娆戞偖濮樿京纾藉ù锝堟鐢盯鏌ｉ埡濠傜仩闁伙絿鍏橀、鏃堝醇濠靛牜妲版俊鐐�曠换鎰板蓟婵犲偆鐓ラ柛顐ゅ暱閹疯櫣绱掔紒銏犲箹闁瑰啿绻橀幃鐢割敂閸℃瑧锛滃銈嗘婵倗浜搁銏＄厽闁挎繂顦伴弫杈╃磼閾忚娅曠紒顔界懇瀹曞綊顢欓懖鈹垮仏闂傚倸鍊烽懗鍓佸垝椤栫偛钃熼柕濞炬櫅缁犺銇勯幇璺侯洭鐎规挷鑳堕敓钘夌畭閸庨亶藝娴兼潙鐓曢柟鐑樺殮瑜版帗鏅查柛顐ｇ渤閹惧墎妫い鎾跺仧閸╋綁鏌＄仦鍓ф创闁轰焦鍔樼粻娑㈠即閻樿櫕顔撳┑掳鍊楁慨鐑藉磻濞戞碍宕叉慨妤嬫嫹鐎殿噮鍋婇獮妯肩磼濡粯顏熼梻浣芥硶閸ｏ箓骞忛敓锟�?闂傚倸鍊搁崐鎼佸磹閹间礁纾归柟闂寸绾惧綊鏌熼梻瀵割槮缁惧墽鎳撻—鍐拷锝庝簼閹癸綁鏌ｉ鐐搭棞闁靛棙甯掗～婵嬫倷椤掞拷椤忚埖淇婇妶鍥ラ柛瀣仱閹囨偐濮瑰浄鎷锋笟锟藉鎾閳╁啯鐝曢梻浣藉Г閿氭い锔诲枤缁辨棃寮撮姀鈾�鎷绘繛杈剧秬濞咃綁濡存繝鍥ㄧ厱闁规儳顕粻鐐烘煙閽樺锟藉鏁撻弬銈囩У闁哥姵鐗犻幃娆愮節閸愶缚绨婚梺鍦劋閸╁牆危瑜版帗鐓涢柛娑变簼濞呭﹥鎱ㄦ繝鍛仩缂佽鲸甯掕灒闁告繂瀚呴弴銏♀拺闁告稑锕ラ幆鍫㈢磼閻樺啿鐏撮柍銉畵瀹曞爼顢楁担闀愮盎闂備礁鎲＄缓鍧楀磿閹剁瓔鏁婇柡鍥ュ灪閳锋垿鏌涘┑鍡楊伌婵℃彃缍婇弻娑㈠Ω瑜庨弳顒侇殽閻愭彃鏆ｆ鐐差儔閹瑩鎮藉▓鍨櫗闂傚倷鑳堕…鍫㈡崲濡ゅ懎纾婚柟鐗堟緲缁犵娀鏌涢幇銊︽澓濞存粍绮撻弻锟犲磼濠靛洨銆婄紓浣哄Т椤兘寮婚埄鍐╁閻熸瑥瀚壕鎶芥⒑鏉炴壆鍔嶉柟鐟版喘瀵偊骞樼紒妯绘闂佽法鍣﹂幏锟�? by changhao
				//闂傚倸鍊搁崐鎼佸磹閹间礁纾归柟闂寸绾剧懓顪冪�ｎ亝鎹ｉ柣顓炴閵嗘帒顫濋悙顒�顏舵俊銈囧Х閸嬬偤鎮ч悩姹囷拷渚�寮村杈┬㈤梻浣规偠閸庢椽宕滈敃鍌氭瀬闁告劦鍠楅悡銉╂煛閸ユ湹绨奸悗姘秺濮婂搫效閸パ嶆嫹濡ゅ懎纾婚柟鎹愬煐瀹曞弶绻濋棃娑欏窛缂佲槄鎷烽梻浣侯焾閺堫剛鍒掑畝鍕╋拷鍌炴惞閸︻厾锛濇繛鎾磋壘閿曘儳锟芥俺顫夌换婵嬪閿濆棛銆愬銈嗗灥濡繂鐣烽敐鍫㈢杸闁哄倸澧界粻姘舵⒑闂堟稓澧曢柟宄邦儔瀹曟洟骞囬悧鍫濓拷鍨叏濡潡鍝洪柛銈忔嫹闂佸墽绮悧鐘诲蓟閿濆拋娼ㄩ柨鐔绘椤洩顦崇紒鍌涘笒椤劑宕熼鍡欑暰婵＄偑鍊栭崝褏寰婄捄銊т笉闁绘劗顣幏宄扳枔閸喗鐝梺绋款儏閿曨亪鎮伴鍢夌喓娑甸柨瀣伓闂傚倸鐗婄粙鎴λ夎箛鏃傜闁哄鍨甸顓㈡煛瀹�瀣ɑ闁诡垱妫冮、娑橆煥閸涘拑缍佸铏圭矙濞嗘儳鍓板┑鈽嗗亝缁诲倿鎮鹃悜钘夘潊闁靛牆鎳愰鎰箾鏉堝墽鍒伴柛妯荤矒楠炲繐煤椤忓應鎷洪梺鍛婄☉閿曪箓鍩ユ径鎰叆闁哄洦锚閿熻姤鐗犻獮鍫ュΩ椤垶鞋缂傚倷娴囨ご鍝ユ暜閿熺姴绠栭柍鍝勬噹缁�鍐煠绾板崬鍘哥紒杈ㄧ箞閺岋絾鎯旈妶搴㈢秷濠电偛寮堕…鍥箲閵忋倕纾奸柣鎴濇川缁嬪繐鈹戦悩缁樻锭婵炶濡囩槐鐐哄炊椤掍胶鍘撻梺鍛婄箓鐎氼剟寮搁敂鍓х＜閺夊牄鍔岀徊濠氭煃鐟欏嫬鐏撮柟顔界懅閿熻姤绋掗…鍥╃矙閸ヮ剚鈷戦柛娑橈龚婢规ɑ銇勯幋婵愭█妤犵偛鍟撮幃婊堟嚍閵夛附鐝曢梻浣筋潐閸庢娊骞婅箛鏇嫹濮樻剚娼愰柟渚垮妼铻ｉ柣鎾崇凹婢规洟鏌ｆ惔銏㈠暡闁瑰嚖鎷�
				ClanBuildUPBean factionOpbean=new ClanBuildUPBean(clan.getKey(),opid, uplevel -1, uplevel,cost);
				fire.log.YYLogger.factionBuildUPLog(roleid,factionOpbean);
				
				return true;
			}
		};
		
		requestfactionlevelup.submit();	
	}
	
	public void SendAllFactionMemeber(xbean.ClanInfo clanInfo, int type, int data)
	{
		List<String> paras = new ArrayList<String>();
		paras.add(String.valueOf(data));
		int msgid = 160200;
		if (type == ClanManage.GoldBank)
		{
			msgid = 160219;
		}
		else if (type == ClanManage.DrugStone)
		{
			msgid = 160220;
		}
		else if (type == ClanManage.Hotel)
		{
			msgid = 160221;
		}
		
		for (long roleid : clanInfo.getMembers().keySet())
		{
			MessageMgr.psendSystemMessageToRole(roleid, msgid, paras);				
		}
		
		//婵犵數濮烽弫鍛婃叏閻戣棄鏋侀柛娑橈攻閸欏繘鏌ｉ幋锝嗩棄闁哄绶氶弻娑樷槈濮楀牊鏁鹃梺鍛婄懃缁绘劙婀侀梺绋跨箰閸氬绱為幋锔界厱闁靛鍎遍敓钘夋健瀵鏁愭径濠勵啋閻庤娲栧ú銈夊传濞差亝鈷戦柛婵嗗閸庢劙鏌ｅΔ渚囨畼闁瑰箍鍨归埥澶愬閻樻鍚呴梻浣虹帛閸旀瑥顭囪瀵娊鏁撻悩鏂ユ嫼闂佽崵鍠愬妯何ｆ繝姘厱闁靛骏绱曢崣锟介梺鎸庣箘閸嬫盯鍩為幋鐙呮嫹閿濆骸浜滃ù婊勵殜閺岀喖宕楅懖鈺傛闂佹悶鍔嶅Σ鎺楀Φ閹邦厽鍎熸い顐幘缁犳岸姊洪棃娑氬婵炲眰鍊曢弳鈺呮⒒娴ｄ警鐒炬い鎴濇閹嫰顢涘杈ㄦ濡炪倖鐗滈崕鎰板极瀹ュ棛绡�濠电姴鍊搁鈺呭箹閺夋埊宸ラ柍瑙勫灴閹晝绱掑Ο濠氭暘婵＄偑鍊栭崹鐢稿箠閹邦喖鍨濋柛顐緛閹风兘鏁愭惔鈥茬按婵炲瓨绮嶇划鎾诲蓟閻旂厧浼犻柛鏇ㄥ帨閵堝鐓曢柡鍌濇硶鏍￠梺闈涙搐鐎氭澘顕ｉ鍕閹肩补妲呭Σ鍗炩攽閻戝洨鍒版繛灞傚�濋弫鍐敂閸繄鐣哄┑鐐叉閹尖晠寮崒鐐寸厱闁哄洠锟藉磭鍘柣搴㈣壘缂嶅﹪寮婚垾鎰佸悑閹艰揪绲肩划璺衡攽閻愭潙鐏﹂柣鐕傞檮閸掑﹪骞橀钘変画濠电偛妫楃换鎰邦敂閳哄喛鎷峰▓鍨灈婵炲皷锟芥剚娼栨繛宸簼椤ュ牊绻涢幋鐐跺妞わ絽鎼—鍐Χ韫囨洜绐楅梺鍛婎殔閸熷潡鎮鹃悜钘夌疀妞ゆ挾濮烽惁鍫濃攽椤旀枻渚涢柛姗�绠栧畷锝夊幢濞戞瑢鎷洪梺鍛婄箓鐎氼厾绮婇埡浼辩懓顭ㄩ崟顓犵暭闂佽法鍠曟慨銈夋嚌閸撗呯濠电姴鍋嗗鏍р攽閻樺疇澹橀柣鎰功閹茬顭ㄩ崗鎾呯秮瀹曠兘顢橀悩纰夌床缂傚倸鍊烽悞锕傗�﹂崶鈺冧笉闁哄稁鍋嗙壕鑲╃磽娴ｈ鐒界紒鐘靛仧閿熷�燁潐濞叉鏁幒妤嬬稏婵犻潧顑愰弫鍥煟濡搫鑸规い銉﹀哺濮婂宕掑顒婃嫹閻戣姤鍤勯柛顐ｆ磵閿熸枻绠撳畷濂告偆娴ｈ鍟嶉梻浣告啞缁哄潡宕曟繝姘鐎瑰嫭澹嬪Σ鍫ユ煙閻戞ɑ灏伴柣婵囩墵濮婃椽鎮烽幍顔炬殯闂佹悶鍔岀紞濠囧春閵夛箑绶為柟閭﹀墻濞煎﹪姊虹紒姗嗙劸閻忓浚浜弫鎾绘寠婢跺奔铏庡銈庝簻閸熷瓨淇婇崼鏇炲耿婵☆垳鍎ゅ▓顐︽⒒娴ｅ憡鎲稿┑顔芥尦閺屽﹪鏁愭径鍫嫹娓氾拷瀵噣宕奸悢鍛婎仧闂備浇娉曢崳锕傚箯閿燂拷
		fire.pb.clan.srv.ClanManage.addDealClanEventInfo(clanInfo,fire.pb.clan.srv.ClanManage.EVENT_BUILD_UP,0,fire.pb.clan.srv.ClanManage.getClanBuildNameByType(type),data+"","");
		
	}

	// {{{ RPCGEN_DEFINE_BEGIN
	// {{{ DO NOT EDIT THIS
	public static final int PROTOCOL_TYPE = 808472;

	public int getType() {
		return 808472;
	}

	public int id; // 1大厅2金库3药店4旅馆 by changhao

	public CRequestClanLevelup() {
	}

	public CRequestClanLevelup(int _id_) {
		this.id = _id_;
	}

	public final boolean _validator_() {
		return true;
	}

	public OctetsStream marshal(OctetsStream _os_) {
		if (!_validator_()) {
			throw new VerifyError("validator failed");
		}
		_os_.marshal(id);
		return _os_;
	}

	public OctetsStream unmarshal(OctetsStream _os_) throws MarshalException {
		id = _os_.unmarshal_int();
		if (!_validator_()) {
			throw new VerifyError("validator failed");
		}
		return _os_;
	}

	public boolean equals(Object _o1_) {
		if (_o1_ == this) return true;
		if (_o1_ instanceof CRequestClanLevelup) {
			CRequestClanLevelup _o_ = (CRequestClanLevelup)_o1_;
			if (id != _o_.id) return false;
			return true;
		}
		return false;
	}

	public int hashCode() {
		int _h_ = 0;
		_h_ += id;
		return _h_;
	}

	public String toString() {
		StringBuilder _sb_ = new StringBuilder();
		_sb_.append("(");
		_sb_.append(id).append(",");
		_sb_.append(")");
		return _sb_.toString();
	}

	public int compareTo(CRequestClanLevelup _o_) {
		if (_o_ == this) return 0;
		int _c_ = 0;
		_c_ = id - _o_.id;
		if (0 != _c_) return _c_;
		return _c_;
	}

	// DO NOT EDIT THIS }}}
	// RPCGEN_DEFINE_END }}}

}

