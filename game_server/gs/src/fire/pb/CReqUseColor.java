
package fire.pb;
import java.util.HashMap;
import java.util.Map;
import java.util.Map.Entry;

import org.apache.log4j.Logger;

import fire.msp.move.GRoleEquipChange;
import fire.pb.common.SCommon;
import fire.pb.item.BagTypes;
import fire.pb.item.EquipItemType;
import fire.pb.item.ItemMaps;
import fire.pb.item.Module;
import fire.pb.main.ConfigManager;
import fire.pb.role.SRoleRColorConfig;
import mkdb.Procedure;



// {{{ RPCGEN_IMPORT_BEGIN
// {{{ DO NOT EDIT THIS
import com.locojoy.base.Marshal.OctetsStream;
import com.locojoy.base.Marshal.MarshalException;

abstract class __CReqUseColor__ extends mkio.Protocol { }

// DO NOT EDIT THIS }}}
// RPCGEN_IMPORT_END }}}

public class CReqUseColor extends __CReqUseColor__ {
	public static final Logger logger = Logger.getLogger("SYSTEM");
	@Override
	protected void process() {
		// protocol handle
		//濠电姷鏁告慨鐑藉极閹间礁纾婚柣妯款嚙缁犲灚銇勮箛鎾搭棤缂侊拷婵犲洦鐓ラ柣鏃囶嚙琚氱紓浣虹帛缁嬫帒顕ラ崟顓ㄦ嫹閿濆骸浜炴い锔垮嵆閹鈻撻崹顔界彯闂佺顑呴敃銉︾┍婵犲洦鍤嬮梻鍫熺〒缁愮偞绻濋悽闈浶㈤柟鍐茬箻楠炲瀵肩�涙ǚ鎷绘繛杈剧悼閸庛倝宕甸敓鑺ョ節閳凤拷閸屾粎鐓撳Δ鐘靛仜閿曨亪鐛锟藉畷娆撳级濞嗙偓歇缂備胶濮电粙鎴﹀煡婢跺ň鏋庨柟瀛樼箓缁犵偤姊婚崒娆戭槮闁圭⒈鍋婂畷顖烆敃閿曪拷绾惧綊鏌熼梻瀵割槮闁告垹濮电换娑㈠幢濡闉嶉梺缁樻尰濞茬喖鎮￠锕�鐐婇柕澶堝劚婵洟鏌ｆ惔銏㈠暡闁瑰嚖鎷�
		final long roleid = gnet.link.Onlines.getInstance().findRoleid(this);
		if(roleid < 0) {
			return;
		}
		new mkdb.Procedure() {
			@Override
			protected boolean process() throws Exception {
				xbean.Properties prop=xtable.Properties.get(roleid);
				if(prop==null){
					return false;
				}
				Map<Integer, SRoleRColorConfig> sRoleRColorConfig = ConfigManager.getInstance().getConf(SRoleRColorConfig.class);
				if(sRoleRColorConfig==null){
					logger.info("闂傚倸鍊搁崐宄懊归崶褏鏆﹂柣銏㈩焾缁愭鏌熼幍顔碱暭闁稿绻濋弻銊╁籍閸屾矮澹曢梺鍝勬缁捇寮婚敐澶婃闁圭瀛╅崰鎰版⒑缂佹绠氭繛澶嬬洴閸╃偤骞嬮敃锟界壕鍏肩節婵犲倹濯奸柛搴嫹 "+roleid+"闂傚倸鍊搁崐鎼佸磹妞嬪海鐭嗗〒姘炬嫹妤犵偞鐗犻、鏇㈡晝閿熺晫锟芥艾顦伴妵鍕箳閹存繍浠肩紓浣哄У瑜板啴婀侀梺鎸庣箓閹冲繒鎷归敓鐘崇厽婵犻潧妫涢崺锝夋煛鐏炶濮傞柟顔哄�濆畷鎺戔槈濮楀棔绱�"+"\t闂傚倸鍊搁崐鎼佸磹瀹勬噴褰掑炊瑜滃ù鏍煏婵炵偓娅嗛柛銈呭閺屻倗绮欑捄銊ょ驳濠电偛鎳愭慨鍨┍婵犲洤围闊洦鏌ㄩ鍫曟⒒娴ｉ涓茬紒韫矙閹ê顫濇潏鈺冪暥闂佺粯鏌ㄩ崥瀣疾缁嬫５褰掓偐瀹割喖鍓伴梺钘夊暟閸犳牠寮婚弴鐔虹闁割煈鍠栨慨澶愭⒑閸濆嫷鍎忛梺甯秮瀵鎮㈤崗鐓庯拷缁樹繆椤栨繂浜归柣锝夋涧閳规垿鎮欓懠顒�鈷婇梺鐟板殩閹凤拷");
					return false;
				}
				if(rolecolorinfo.colorpos1==0&&rolecolorinfo.colorpos2==0){
					logger.info("闂傚倸鍊搁崐宄懊归崶褏鏆﹂柣銏㈩焾缁愭鏌熼幍顔碱暭闁稿绻濋弻銊╁籍閸屾矮澹曢梺鍝勬缁捇寮婚敐澶婃闁圭瀛╅崰鎰版⒑缂佹绠氭繛澶嬬洴閸╃偤骞嬮敃锟界壕鍏肩節婵犲倹濯奸柛搴嫹 "+roleid+"闂傚倸鍊搁崐鎼佸磹妞嬪海鐭嗗〒姘炬嫹妤犵偞鐗犻、鏇㈡晝閿熺晫锟芥艾顦伴妵鍕箳閹存繍浠肩紓浣哄У瑜板啴婀侀梺鎸庣箓閹冲繒鎷归敓鐘崇厽婵犻潧妫涢崺锝夋煛鐏炶濮傞柟顔哄�濆畷鎺戔槈濮楀棔绱�"+"\t闂傚倸鍊峰ù鍥х暦閻㈢绐楅柟閭﹀枛閸ㄦ繈骞栧ǎ顒�鐏繛鍛У娣囧﹪濡堕崨顔兼缂備胶濮抽崡鎶藉蓟濞戞ǚ妲堟慨妤�鐗婇弫鎯р攽閻愬弶鍣藉┑鐑囨嫹闂佸搫鐭夌徊鍊熺亽濠电偛妫欓崕鍐测枔椤撱垺鈷戦柦妯侯槸閺嗙喖鏌涢悩宕囧⒌鐎殿喖顭烽幃銏ゆ偂鎼达綆妲堕柣鐔哥矊闁帮絽鐣烽悽鍛婃櫢闁芥ê顦藉〒濠氭煏閸繂鏆欓柛鏃�姘ㄧ槐鎺旂磼濮楀牐锟借法锟芥鍠栭…鐑藉极閹剧粯鍋愰柤纰卞墾缁卞弶绻濋悽闈浶㈤柣蹇斿哺瀹曟繈寮介銈囶槸闂佸壊鍋呯换宥呫�掓繝姘厪闁割偅绻傞弳娆撴煟韫囧﹥娅囩紒杈ㄥ笚瀵板嫭绻濋崟顓夈劌螖閻橀潧浠滄俊顐ｇ箓閻ｇ兘鎮㈢喊杈ㄦ櫍闂佺粯顭囬弫鎼佸储椤栫偞鈷掑ù锝呮啞鐠愨剝銇勯鐐靛妞ゃ劊鍎甸獮鏍ㄦ媴鐟欏嫭顏熷┑鐐差嚟婵挳顢栭崟顖氱疅濡わ絽鍟悡娑㈡倶閻愰鍤欏┑鈥炽偢閺屽秹鎸婃径妯恍﹂柧浼欑悼缁辨挻鎷呴懖鈩冨灩閿熻姤淇哄▍鏇犳崲濠靛牆鏋堟俊顖涙た濞兼垿姊虹粙娆惧剮缂佽埖鑹鹃悾鐑藉箛椤戣姤鏂�闂佸摜濯崰妤呮儎椤栫偛鏋侀柟鍓х帛閺呮悂鏌ㄩ悤鍌涘?闂傚倸鍊搁崐鎼佸磹妞嬪海鐭嗗〒姘炬嫹妤犵偞鐗犻、鏇㈡晝閿熺晫锟芥艾顦伴妵鍕箳閹存繍浠肩紓浣哄У瑜板啴婀侀梺鎸庣箓閹冲繒鎷归敓鐘崇厽婵犻潧妫涢崺锝夋煛鐏炶濮傞柟顔哄�濆畷鎺戔槈濮楀棔绱�");
					fire.pb.talk.MessageMgr.sendMsgNotify(roleid, 160380, null);
					return false;
				}
				if(rolecolorinfo.colorpos1<0||rolecolorinfo.colorpos2<0){
					logger.info("闂傚倸鍊搁崐宄懊归崶褏鏆﹂柣銏㈩焾缁愭鏌熼幍顔碱暭闁稿绻濋弻銊╁籍閸屾矮澹曢梺鍝勬缁捇寮婚敐澶婃闁圭瀛╅崰鎰版⒑缂佹绠氭繛澶嬬洴閸╃偤骞嬮敃锟界壕鍏肩節婵犲倹濯奸柛搴嫹 "+roleid+"闂傚倸鍊搁崐鎼佸磹妞嬪海鐭嗗〒姘炬嫹妤犵偞鐗犻、鏇㈡晝閿熺晫锟芥艾顦伴妵鍕箳閹存繍浠肩紓浣哄У瑜板啴婀侀梺鎸庣箓閹冲繒鎷归敓鐘崇厽婵犻潧妫涢崺锝夋煛鐏炶濮傞柟顔哄�濆畷鎺戔槈濮楀棔绱�"+"\t闂傚倸鍊搁崐鎼佸磹瀹勬噴褰掑炊瑜滃ù鏍煏婵炵偓娅嗛柛銈呭閺屻倗绮欑捄銊ょ驳濠电偛鎳愭慨鍨┍婵犲洤围闊洦鏌ㄩ鍫曟⒒娴ｉ涓茬紒韫矙閹ê顫濇潏鈺冪暥闂佺粯鏌ㄩ崥瀣疾缁嬫５褰掓偐瀹割喖鍓伴梺钘夊暟閸犳牠寮婚弴鐔虹闁割煈鍠栨慨澶愭⒑閸濆嫷鍎忛梺甯秮瀵鎮㈤崗鐓庯拷缁樹繆椤栨繂浜归柣锝夋涧閳规垿鎮欓懠顒�鈷婇梺鐟板殩閹凤拷");
					return false;
				}
				
				//闂傚倸鍊搁崐鎼佸磹妞嬪海鐭嗗〒姘炬嫹妤犵偛顦甸弫宥夊礋椤掍焦顔囬梻浣规偠閸庢椽宕滃▎鎴濐棜鐟滅増甯楅悡娑氾拷骞垮劚妤犳悂鐛弽顓熺參闁告劦浜滈弸娑㈡煛鐏炲墽娲村┑锛勫厴椤㈡瑩鎮℃惔顔戒氦闂傚倷绀侀幉锟犳偡閵夆晜鏅濋柕澶嗘櫅妗呴梺鍛婃处閸ㄤ即宕橀敓浠嬫⒑闂堟丹娑氫沪閻愵剦鍟囬梻鍌氬�烽懗鍫曗�﹂崼鐕佹闁归棿鐒﹂弲婵囥亜韫囨挾澧曢柦鍐枑缁绘盯骞嬮悜鍥︾返闂佺粯鎸堕崕鐢稿蓟濞戙垹绠涢柛蹇撴憸閺佹牠姊洪崨濠冾棓闁革綇绲介～蹇旂節濮橆剛锛滃┑顕嗙稻濠㈡﹢鎮ч幘鎰佸殨闁圭粯甯╅悡銉╂煕濞戝崬鐏ｉ柣鎾存尰缁绘繈濮�閿濆棛銆愬銈嗗灥濞层劌顕ｈ閺佹挻绂掔�ｎ偀鎷洪梺鍛婄☉閿曘儲寰勯崟顖涚厱闁规儳顕ú瀵革拷娈垮枟婵炲﹪骞冮埡鍐＜婵☆垶鏀辩�氬ジ姊绘担鍛婂暈缂佽鍊婚敓鑺ュ嚬閸樺ジ鏁冮姀鈥愁嚤閻庢稒顭囬崢鐢告⒒娓氬洤浜濈紒瀣崌瀹曟繂顓奸崶鈺冿紲闂佸搫鍟崐鎼佸几閹寸姷纾肩紓浣诡焽缁犵偟锟借娲橀崕濂杆囬搹顐犱簻闁靛濡囩粻鐐烘煛瀹�瀣М闁诡喓鍨藉畷顐﹀Ψ閿曪拷濞呮垿姊虹拠鎻掝劉婵ǜ鍔戝畷妤�螣娓氼垰娈ㄩ梺闈浥堥弲娑氱不椤曪拷閺屻倝骞侀幒鎴濆Б闂佸憡眉缁瑥顫忓ú顏勭闁告瑥顦伴崕鎾绘⒑閸濄儱校鐎癸拷閹间礁绠栭柣鎰暘閸嬪懘鏌涢幇銊︽珖闁告﹢娼ч—鍐Χ閸℃顦ュ┑鈽嗗亝閻熝囨晸閼恒儳鍟查柟鍑ゆ嫹
				int curpos1=prop.getRolecolor1();
				int curpos2=prop.getRolecolor2();
				if(rolecolorinfo.colorpos1==curpos1&&rolecolorinfo.colorpos2==curpos2){
					logger.info("闂傚倸鍊搁崐宄懊归崶褏鏆﹂柣銏㈩焾缁愭鏌熼幍顔碱暭闁稿绻濋弻銊╁籍閸屾矮澹曢梺鍝勬缁捇寮婚敐澶婃闁圭瀛╅崰鎰版⒑缂佹绠氭繛澶嬬洴閸╃偤骞嬮敃锟界壕鍏肩節婵犲倹濯奸柛搴嫹 "+roleid+"闂傚倸鍊搁崐鎼佸磹妞嬪海鐭嗗〒姘炬嫹妤犵偞鐗犻、鏇㈡晝閿熺晫锟芥艾顦伴妵鍕箳閹存繍浠肩紓浣哄У瑜板啴婀侀梺鎸庣箓閹冲繒鎷归敓鐘崇厽婵犻潧妫涢崺锝夋煛鐏炶濮傞柟顔哄�濆畷鎺戔槈濮楀棔绱�"+"\t闂傚倸鍊峰ù鍥х暦閻㈢绐楅柟閭﹀枛閸ㄦ繈骞栧ǎ顒�鐏繛鍛У娣囧﹪濡堕崨顔兼缂備胶濮抽崡鎶藉蓟濞戞ǚ妲堟慨妤�鐗婇弫鎯р攽閻愬弶鍣藉┑鐑囨嫹闂佸搫鐭夌徊鍊熺亽濠电偛妫欓崕鍐测枔椤撱垺鈷戦柦妯侯槸閺嗙喖鏌涢悩宕囧⒌鐎殿喖顭烽幃銏ゆ偂鎼达綆妲堕柣鐔哥矊闁帮絽鐣烽悽鍛婃櫢闁芥ê顦藉〒濠氭煏閸繂鏆欓柛鏃�姘ㄧ槐鎺旂磼濮楀牐锟借法锟芥鍠栭…鐑藉极閹剧粯鍋愰柤纰卞墾缁卞弶绻濋悽闈浶㈤柣蹇斿哺瀹曟繈寮介銈囶槸闂佸壊鍋呯换宥呫�掓繝姘厪闁割偅绻傞弳娆撴煟韫囧﹥娅囩紒杈ㄥ笚瀵板嫭绻濋崟顓夈劌螖閻橀潧浠滄俊顐ｇ箓閻ｇ兘鎮㈢喊杈ㄦ櫍闂佺粯顭囬弫鎼佸储椤栫偞鈷掑ù锝呮啞鐠愨剝銇勯鐐靛妞ゃ劊鍎甸獮鏍ㄦ媴鐟欏嫭顏熷┑鐐差嚟婵挳顢栭崟顖氱疅濡わ絽鍟悡娑㈡倶閻愰鍤欏┑鈥炽偢閺屽秹鎸婃径妯恍﹂柧浼欑悼缁辨挻鎷呴懖鈩冨灩閿熻姤淇哄▍鏇犳崲濠靛牆鏋堟俊顖涙た濞兼垿姊虹粙娆惧剮缂佽埖鑹鹃悾鐑藉箛椤戣姤鏂�闂佸摜濯崰妤呮儎椤栫偛鏋侀柟鍓х帛閺呮悂鏌ㄩ悤鍌涘?闂傚倸鍊搁崐鎼佸磹妞嬪海鐭嗗〒姘炬嫹妤犵偞鐗犻、鏇㈡晝閿熺晫锟芥艾顦伴妵鍕箳閹存繍浠肩紓浣哄У瑜板啴婀侀梺鎸庣箓閹冲繒鎷归敓鐘崇厽婵犻潧妫涢崺锝夋煛鐏炶濮傞柟顔哄�濆畷鎺戔槈濮楀棔绱�");
					fire.pb.talk.MessageMgr.sendMsgNotify(roleid, 160380, null);
					return false;
				}
				SRoleRColorConfig sRoleRColorConfig1=null;
				SRoleRColorConfig sRoleRColorConfig2=null;
				if(rolecolorinfo.colorpos1!=0&&rolecolorinfo.colorpos1!=curpos1){
					//闂傚倸鍊搁崐鎼佸磹妞嬪海鐭嗗〒姘炬嫹妤犵偛顦甸弫宥夊礋椤掍焦顔囬梻浣规偠閸庢椽宕滃▎鎴濐棜鐟滅増甯楅悡娑氾拷骞垮劚妤犳悂鐛弽顓熺參闁告劦浜滈弸娑㈡煛鐏炲墽娲村┑锛勫厴椤㈡瑩鎮℃惔顔芥祰闂傚倷鑳剁划顖滄暜閿涘嫮涓嶉柡宥庡幖閽冪喖鏌￠崶鈺佹灁缂佺娀绠栭弻娑⑩�﹂幋婵囩彲闂佺懓鍢查崲鑼剁亙闂佸憡鍔︽禍鐐烘偂鐎ｎ喗鈷戦柛锔诲弨濡炬悂鏌涢悩鎰佹疁闁诡噯绻濋幃銏ゅ礂閼测晛甯惧┑鐘垫暩閸嬫盯鎮樺┑瀣婵﹩鍘规禍婊堢叓閸ラ瀵奸梺顓у灦閺岋紕浠﹂棃鈺傚鐎规洖娲﹀▓鏇㈡⒑鐠恒劌鏋嶇紒顔界懃閻ｇ兘鎮ч崼鐔峰妳闂侀潧顭紞鍥箯閻戣棄宸濇い鏃堢畺濡绢喚绱撴担鍓插剰婵炵》绻濆畷顒勫醇閺囩啿鎷虹紓鍌欑劍钃遍柍閿嬪姍閺屾盯寮幐搴℃畻闂佽桨绀侀崯鏉戠暦閹烘垟妲堟慨姗嗗墮缁犵偛鈹戦悩鎰佸晱闁哥姵顨婇弫瀣節閳凤拷閸屾粎鐓撻梺璇″櫍缁犳牠寮婚崱妤婂悑闁糕剝鐟ラ獮妤呮⒑閸︻厼鍔嬪┑鐐诧工閻ｅ嘲鈹戠�ｎ亞顓哄┑鐘绘涧閻楀﹤鈻撴ィ鍐┾拺閻犳亽鍔屽▍鎰版煙閸戙倖瀚�?
					sRoleRColorConfig1=sRoleRColorConfig.get(rolecolorinfo.colorpos1);
					//闂傚倸鍊搁崐鎼佸磹妞嬪海鐭嗗〒姘炬嫹妤犵偛顦甸弫宥夊礋椤掍焦顔囬梻浣规偠閸庢椽宕滃▎鎴濐棜鐟滅増甯楅悡娑氾拷骞垮劚妤犳悂鐛弽顓熺參闁告劦浜滈弸娑㈡煛鐏炲墽娲村┑锛勫厴椤㈡瑩鎮℃惔顔戒氦闂傚倷绀侀幉锟犳偡閵夆晜鏅濋柕澶嗘櫅妗呴梺鍛婃处閸ㄤ即宕橀敓浠嬫⒑闂堟丹娑氫沪閻愵剦鍟囬梻鍌氬�烽懗鍫曗�﹂崼鐕佹闁归棿鐒﹂弲婵囥亜韫囨挾澧曢柦鍐枛閺屻劑鎮㈤崫鍕戙垻绱掗敓鐣岋拷锝庡枟閳锋帡鏌涢銈呮灁闁靛棙甯掗湁闁绘娅曢崐鎰叏婵犲懏顏犵紒顔界懇瀹曠螖婵犲繑瀚规俊銈呮噺閻撶喖骞掗幎钘夌闁硅揪濡囧畵渚�鐓崶銊р檨闁哄懏鎮傞弻銊╂偆閸屾稑顏�?1
					if(sRoleRColorConfig1.getRolepos()!=1){
						logger.info("闂傚倸鍊搁崐宄懊归崶褏鏆﹂柣銏㈩焾缁愭鏌熼幍顔碱暭闁稿绻濋弻銊╁籍閸屾矮澹曢梺鍝勬缁捇寮婚敐澶婃闁圭瀛╅崰鎰版⒑缂佹绠氭繛澶嬬洴閸╃偤骞嬮敃锟界壕鍏肩節婵犲倹濯奸柛搴嫹 "+roleid+"闂傚倸鍊搁崐鎼佸磹妞嬪海鐭嗗〒姘炬嫹妤犵偞鐗犻、鏇㈡晝閿熺晫锟芥艾顦伴妵鍕箳閹存繍浠肩紓浣哄У瑜板啴婀侀梺鎸庣箓閹冲繒鎷归敓鐘崇厽婵犻潧妫涢崺锝夋煛鐏炶濮傞柟顔哄�濆畷鎺戔槈濮楀棔绱�"+"\t闂傚倸鍊搁崐宄懊归崶顒夋晪鐟滃酣銆冮妷鈺佷紶闁靛／鍌滅憹闁诲骸绠嶉崕閬嵥囬鐐插瀭闁稿本绋撶粻鍓э拷鐟板閸犳洜鑺辨繝姘厸闁告洍鏅涢崝婊呯磼缂佹娲存鐐差儔閹瑧锟介潧鎲￠濠氭⒒娴ｅ憡鍟炴い銊ユ閸犲﹤顓兼径濞箓鏌涢弴銊ョ仩闁告劧鎷烽梻渚�娼ч…鍫ュ礉瀹�鍕婂鈹戦崼銏紳婵炶揪绲块…鍫㈢棯瑜庢穱濠囨倷閼告妫勫銈庡亜缁绘劗鍙呭銈呯箰缁夌敻寮插┑瀣拺闁圭娴烽埥澶愭倵濮樼厧澧ǎ鍥э攻缁傛帞锟斤綆鍋�閹锋椽姊洪崨濠勭畵閻庢凹鍙冭棢闁绘绮悡鏇㈡煟濡櫣锛嶅褏鏁婚弻锝呪槈閸楃偞鐝濆Δ鐘靛仜椤戝寮崒婊呯＜婵☆垳绮悵銊╂⒒閸屾瑦绁版繛澶嬫礋瀹曟澘顓奸崶褍鐏婂┑鐐叉濞存岸宕甸弴鐔翠簻闁规澘澧庨幃鑲╃磼閳藉懏瀚归梻鍌欑閹测�趁洪敃鍌氱婵炲棙鎸婚崑鐔兼煥閻曞倹瀚�?");
						return false;
					}
				}
				if(rolecolorinfo.colorpos2!=0&&rolecolorinfo.colorpos2!=curpos2){
					//闂傚倸鍊搁崐鎼佸磹妞嬪海鐭嗗〒姘炬嫹妤犵偛顦甸弫宥夊礋椤掍焦顔囬梻浣规偠閸庢椽宕滃▎鎴濐棜鐟滅増甯楅悡娑氾拷骞垮劚妤犳悂鐛弽顓熺參闁告劦浜滈弸娑㈡煛鐏炲墽娲村┑锛勫厴椤㈡瑩鎮℃惔顔芥祰闂傚倷鑳剁划顖滄暜閿涘嫮涓嶉柡宥庡幖閽冪喖鏌￠崶鈺佹灁缂佺娀绠栭弻娑⑩�﹂幋婵囩彲闂佺懓鍢查崲鑼剁亙闂佸憡鍔︽禍鐐烘偂鐎ｎ喗鈷戦柛锔诲弨濡炬悂鏌涢悩鎰佹疁闁诡噯绻濋幃銏ゅ礂閼测晛甯惧┑鐘垫暩閸嬫盯鎮樺┑瀣婵﹩鍘规禍婊堢叓閸ラ瀵奸梺顓у灦閺岋紕浠﹂棃鈺傚鐎规洖娲﹀▓鏇㈡⒑鐠恒劌鏋嶇紒顔界懃閻ｇ兘鎮ч崼鐔峰妳闂侀潧顭紞鍥箯閻戣棄宸濇い鏃堢畺濡绢喚绱撴担鍓插剰婵炵》绻濆畷顒勫醇閺囩啿鎷虹紓鍌欑劍钃遍柍閿嬪姍閺屾盯寮幐搴℃畻闂佽桨绀侀崯鏉戠暦閹烘垟妲堟慨姗嗗墮缁犵偛鈹戦悩鎰佸晱闁哥姵顨婇弫瀣節閳凤拷閸屾粎鐓撻梺璇″櫍缁犳牠寮婚崱妤婂悑闁糕剝鐟ラ獮妤呮⒑閸︻厼鍔嬪┑鐐诧工閻ｅ嘲鈹戠�ｎ亞顓哄┑鐘绘涧閻楀﹤鈻撴ィ鍐┾拺閻犳亽鍔屽▍鎰版煙閸戙倖瀚�?
					sRoleRColorConfig2=sRoleRColorConfig.get(rolecolorinfo.colorpos2);
					//闂傚倸鍊搁崐鎼佸磹妞嬪海鐭嗗〒姘炬嫹妤犵偛顦甸弫宥夊礋椤掍焦顔囬梻浣规偠閸庢椽宕滃▎鎴濐棜鐟滅増甯楅悡娑氾拷骞垮劚妤犳悂鐛弽顓熺參闁告劦浜滈弸娑㈡煛鐏炲墽娲村┑锛勫厴椤㈡瑩鎮℃惔顔戒氦闂傚倷绀侀幉锟犳偡閵夆晜鏅濋柕澶嗘櫅妗呴梺鍛婃处閸ㄤ即宕橀敓浠嬫⒑闂堟丹娑氫沪閻愵剦鍟囬梻鍌氬�烽懗鍫曗�﹂崼鐕佹闁归棿鐒﹂弲婵囥亜韫囨挾澧曢柦鍐枛閺屻劑鎮㈤崫鍕戙垻绱掗敓鐣岋拷锝庡枟閳锋帡鏌涢銈呮灁闁靛棙甯掗湁闁绘娅曢崐鎰叏婵犲懏顏犵紒顔界懇瀹曠螖婵犲繑瀚规俊銈呮噺閻撶喖骞掗幎钘夌闁硅揪濡囧畵渚�鐓崶銊р檨闁哄懏鎮傞弻銊╂偆閸屾稑顏�?2
					if(sRoleRColorConfig2.getRolepos()!=2){
						logger.info("闂傚倸鍊搁崐宄懊归崶褏鏆﹂柣銏㈩焾缁愭鏌熼幍顔碱暭闁稿绻濋弻銊╁籍閸屾矮澹曢梺鍝勬缁捇寮婚敐澶婃闁圭瀛╅崰鎰版⒑缂佹绠氭繛澶嬬洴閸╃偤骞嬮敃锟界壕鍏肩節婵犲倹濯奸柛搴嫹 "+roleid+"闂傚倸鍊搁崐鎼佸磹妞嬪海鐭嗗〒姘炬嫹妤犵偞鐗犻、鏇㈡晝閿熺晫锟芥艾顦伴妵鍕箳閹存繍浠肩紓浣哄У瑜板啴婀侀梺鎸庣箓閹冲繒鎷归敓鐘崇厽婵犻潧妫涢崺锝夋煛鐏炶濮傞柟顔哄�濆畷鎺戔槈濮楀棔绱�"+"\t闂傚倸鍊搁崐宄懊归崶顒夋晪鐟滃酣銆冮妷鈺佷紶闁靛／鍌滅憹闁诲骸绠嶉崕閬嵥囬鐐插瀭闁稿本绋撶粻鍓э拷鐟板閸犳洜鑺辨繝姘厸闁告洍鏅涢崝婊呯磼缂佹娲存鐐差儔閹瑧锟介潧鎲￠濠氭⒒娴ｅ憡鍟炴い銊ユ閸犲﹤顓兼径濞箓鏌涢弴銊ョ仩闁告劧鎷烽梻渚�娼ч…鍫ュ礉瀹�鍕婂鈹戦崼銏紳婵炶揪绲块…鍫㈢棯瑜庢穱濠囨倷閼告妫勫銈庡亜缁绘劗鍙呭銈呯箰缁夌敻寮插┑瀣拺闁圭娴烽埥澶愭倵濮樼厧澧ǎ鍥э攻缁傛帞锟斤綆鍋�閹锋椽姊洪崨濠勭畵閻庢凹鍙冭棢闁绘绮悡鏇㈡煟濡櫣锛嶅褏鏁婚弻锝呪槈閸楃偞鐝濆Δ鐘靛仜椤戝寮崒婊呯＜婵☆垳绮悵銊╂⒒閸屾瑦绁版繛澶嬫礋瀹曟澘顓奸崶褍鐏婂┑鐐叉濞存岸宕甸弴鐔翠簻闁规澘澧庨幃鑲╃磼閳藉懏瀚归梻鍌欑閹测�趁洪敃鍌氱婵炲棙鎸婚崑鐔兼煥閻曞倹瀚�?");
						return false;
					}
				}
				//濠电姷鏁告慨鐑藉极閸涘﹥鍙忛柣鎴濐潟閿熻棄鍊圭粋鎺旓拷锝庡亝濞呫垽姊洪懞銉冾亪藝椤栫偛姹查梺顒�绉甸悡銉╂煟閺冨倻甯涙い銉ヮ槺缁辨挸顓奸崪鍐惈濡ょ姷鍋涢崯顐ョ亽闁荤姴娲╃亸娆戠玻閻愮儤鈷戠憸鐗堝笒娴滀即鏌涢幘瀵哥疄妤犵偞顨婂鎾閳撅拷閹锋椽姊洪懡銈呮瀾婵犮垺锕㈤崺娑㈠籍閸喓鍘甸梺鎯ф禋閸嬪懎鐣峰畝鍕癄闁绘棁鍋愰崣鎾绘煕閵夛絽濡块柍鍙ョ窔閺屽秹鏌ㄧ�ｎ亞浠搁梺闈涙搐鐎氭澘顕ｉ鍕閹兼番鍨归崜闈涒攽閻樿尙妫勯柕鍫濇－娴犫晝绱撴担浠嬪摵闁瑰憡鎮傞、姗�鎳濋幍顔炬澑闂佸搫鍊归娆愬閿燂拷1闂傚倸鍊搁崐鎼佸磹妞嬪孩顐芥慨姗嗗墻閻掕棄鈹戦悩瀹犲缂佺媭鍨堕弻銊╂偆閸屾稑顏�?2闂傚倸鍊搁崐鎼佸磹閹间礁纾瑰瀣椤愪粙鏌ㄩ悢鍝勑㈢紒鎰殕娣囧﹪濡堕崨顔兼闂佹悶鍔岄崐鍦崲濠靛顥堟繛鎴炶壘椤わ拷闂佽瀛╅懝楣冣�﹂悜钘夎摕闁挎繂顦猾宥夋煕閵夘喚鍘涘ù鐘櫊濮婂搫煤鐠囨彃绠洪悗鐧告嫹闁归棿绀侀拑鐔兼煥濠靛棙濯兼繛灏栨櫆閵囧嫰骞掗幋顓熜﹀┑鐐茬墕婢у海妲愰幘瀵哥懝濠电姴鍟璺衡攽閻橆喖鐏遍柛鈺傜墵瀹曟繈寮介鐔蜂簵濠电偞鍨崹娲偂閺囥垺鐓欓柡澶婄仢閹胶绱掗妸銉吋闁哄苯绉堕幏鐘绘嚑椤掞拷椤わ拷缂傚倷鑳剁划顖炴儎椤栫偟宓佹俊顖濇閺嗭箓鏌涢妷鎴濇噹楠炴姊虹拠鎻掝劉妞ゆ梹鐗犲畷浼村冀椤撴冻鎷烽敃鍌涘�婚柣锝呰嫰缁侊箑鈹戦绛嬫闁归鍏橀弻鐔碱敊閹冨箣闂佸搫鑻ú顓㈠极閸屾粎椹抽悗锝庡亽濡拷
				if(sRoleRColorConfig1==null&&sRoleRColorConfig2==null){
					logger.info("闂傚倸鍊搁崐宄懊归崶褏鏆﹂柣銏㈩焾缁愭鏌熼幍顔碱暭闁稿绻濋弻銊╁籍閸屾矮澹曢梺鍝勬缁捇寮婚敐澶婃闁圭瀛╅崰鎰版⒑缂佹绠氭繛澶嬬洴閸╃偤骞嬮敃锟界壕鍏肩節婵犲倹濯奸柛搴嫹 "+roleid+"闂傚倸鍊搁崐鎼佸磹妞嬪海鐭嗗〒姘炬嫹妤犵偞鐗犻、鏇㈡晝閿熺晫锟芥艾顦伴妵鍕箳閹存繍浠肩紓浣哄У瑜板啴婀侀梺鎸庣箓閹冲繒鎷归敓鐘崇厽婵犻潧妫涢崺锝夋煛鐏炶濮傞柟顔哄�濆畷鎺戔槈濮楀棔绱�"+"\t闂傚倸鍊峰ù鍥х暦閻㈢绐楅柟閭﹀枛閸ㄦ繈骞栧ǎ顒�鐏繛鍛У娣囧﹪濡堕崨顔兼缂備胶濮抽崡鎶藉蓟濞戞ǚ妲堟慨妤�鐗婇弫鎯р攽閻愬弶鍣藉┑鐑囨嫹闂佸搫鐭夌徊鍊熺亽濠电偛妫欓崕鍐测枔椤撱垺鈷戦柦妯侯槸閺嗙喖鏌涢悩宕囧⒌鐎殿喖顭烽幃銏ゆ偂鎼达綆妲堕柣鐔哥矊闁帮絽鐣烽悽鍛婃櫢闁芥ê顦藉〒濠氭煏閸繂鏆欓柛鏃�姘ㄧ槐鎺旂磼濮楀牐锟借法锟芥鍠栭…鐑藉极閹剧粯鍋愰柤纰卞墾缁卞弶绻濋悽闈浶㈤柣蹇斿哺瀹曟繈寮介銈囶槸闂佸壊鍋呯换宥呫�掓繝姘厪闁割偅绻傞弳娆撴煟韫囧﹥娅囩紒杈ㄥ笚瀵板嫭绻濋崟顓夈劌螖閻橀潧浠滄俊顐ｇ箓閻ｇ兘鎮㈢喊杈ㄦ櫍闂佺粯顭囬弫鎼佸储椤栫偞鈷掑ù锝呮啞鐠愨剝銇勯鐐靛妞ゃ劊鍎甸獮鏍ㄦ媴鐟欏嫭顏熷┑鐐差嚟婵挳顢栭崟顖氱疅濡わ絽鍟悡娑㈡倶閻愰鍤欏┑鈥炽偢閺屽秹鎸婃径妯恍﹂柧浼欑悼缁辨挻鎷呴懖鈩冨灩閿熻姤淇哄▍鏇犳崲濠靛牆鏋堟俊顖涙た濞兼垿姊虹粙娆惧剮缂佽埖鑹鹃悾鐑藉箛椤戣姤鏂�闂佸摜濯崰妤呮儎椤栫偛鏋侀柟鍓х帛閺呮悂鏌ㄩ悤鍌涘?闂傚倸鍊搁崐鎼佸磹妞嬪海鐭嗗〒姘炬嫹妤犵偞鐗犻、鏇㈡晝閿熺晫锟芥艾顦伴妵鍕箳閹存繍浠肩紓浣哄У瑜板啴婀侀梺鎸庣箓閹冲繒鎷归敓鐘崇厽婵犻潧妫涢崺锝夋煛鐏炶濮傞柟顔哄�濆畷鎺戔槈濮楀棔绱�");
					fire.pb.talk.MessageMgr.sendMsgNotify(roleid, 160380, null);
					return false;
				}
				//闂傚倸鍊搁崐宄懊归崶褏鏆﹂柛顭戝亝閸欏繒锟借娲栧ú锕傤敃娴犲鐓忛柛顐ｇ箖婢跺嫭銇勯锝嗙闁哄矉绻濆畷鍫曞Ψ閵壯傜棯闂備胶顭堥鍌炲疾濞戙垹鐓橀柟杈鹃檮閸嬫劙鏌ц箛锝呬簽婵炲牄鍊濋幃妤冩喆閸曨剙鐭紓浣藉煐瀹�绋款嚕婵犳艾围濠㈣泛锕﹂鎰箾鏉堝墽绉い顐㈩樀閺屻劑顢橀姀鈾�鎷洪梺鍛婂姈瑜板啫危閼姐倗纾肩紓浣光棨椤忓牞缍栭煫鍥ㄦ⒒缁★拷濠殿喗锕╅崜娑⑺囨导瀛樷拺閻庡湱濮甸妴鍐磼闊彃锟芥繈鐛箛娑欏�婚柦妯侯槸閸炪劌顪冮妶鍡楀闁稿﹥顨婇幃锛勶拷锝庡枟閳锋垹绱撴担濮戭亪鎮橀崡鐐╂斀妞ゆ柨鎼敓鑺ョ箓閻ｇ兘鎮介崨濠冩闂佽法鍣﹂幏锟�?
				double delpre=1;//闂傚倸鍊搁崐鎼佸磹妞嬪海鐭嗗〒姘炬嫹妤犵偞鐗犻、鏇㈡晝閿熺晫锟芥艾顦伴妵鍕箳閹存繍浠肩紓浣哄У瑜板啴婀侀梺鎸庣箓閹冲繒鎷归敓鐘崇厽婵犻潧锕ョ涵楣冩煃鐟欏嫬鐏撮柟顔规櫊楠炴捇骞掑┑鍛／闂傚倷鑳堕…鍫ヮ敄閸℃稒鏅濋柕蹇嬪�曢拑鐔兼煏婵炲灝鍔楅柡锟芥禒瀣厱闁斥晛鍠涙笟娑欎繆椤愮姴锟芥繂顫忓ú顏勫窛濠电偞纰嶉崹鍧楀箖閿熺姵鏅搁柣妯垮蔼閹芥洟姊虹紒妯荤叆闁告艾顑夊畷鐢碉拷锝庡枟閻撶喐銇勯幒鎴Х缂併劌銈搁弻娑㈠Ω瑜庨弳顒勬煙椤曪拷缁犳牠骞冨鍛┏閻庯綆鍋呭▍鏍ㄧ節閻㈤潧孝闁挎洏鍊濆畷顖烆敃閿旂粯鏅悷婊冪箳濡叉劙骞樼拠鑼紲濠电偛妫欓崹鍨繆娴犲鐓㈤柛鎰靛弮閸濊櫣绱掔紒妯兼创鐎规洖銈搁、妤佹媴閸撹弓绱�
				boolean ischange1=rolecolorinfo.colorpos1!=curpos1;//闂傚倸鍊搁崐鎼佸磹妞嬪海鐭嗗〒姘炬嫹妤犵偞鐗犻、鏇㈠Χ韫囨柨顏跺┑顔矫畷顒勫储鐎甸潻鎷风憴鍕妞ゎ偄顦遍敓浠嬫涧閵堢顕ｉ崼鏇炵闁绘ê鐏氬В搴㈢節閻㈤潧浠﹂柟绋款煼閹垽顢楅崟顐ゎ唵婵＄偛顑呴崙浠嬪箯瀹勬壋鏋旈柛顭戝枟閻忎線姊洪崨濠冣拹闁搞劌娼￠悰顕�宕橀钘夛拷濠氭煢濡警妲哄Δ鐘叉喘閺岋綁鎮╅崗鍛板焻闂佸憡鏌ㄥ锕傚焻閿燂拷
				boolean ischange2=rolecolorinfo.colorpos2!=curpos2;//闂傚倸鍊搁崐鎼佸磹妞嬪海鐭嗗〒姘炬嫹妤犵偞鐗犻、鏇㈠Χ韫囨柨顏跺┑顔矫畷顒勫储鐎甸潻鎷风憴鍕妞ゎ偄顦遍敓浠嬫涧閵堢顕ｉ崼鏇炵闁绘ê鐏氬В搴㈢節閻㈤潧浠﹂柟绋款煼閹垽顢楅崟顐ゎ唵婵＄偛顑呴崙浠嬪箯瀹勬壋鏋旈柛顭戝枟閻忎線姊洪崨濠冣拹闁搞劌娼￠悰顕�宕橀钘夛拷濠氭煢濡警妲哄Δ鐘叉喘閺岋綁鎮╅崗鍛板焻闂佸憡鏌ㄥ锕傚焻閿燂拷
				
				
				//闂傚倸鍊搁崐鎼佸磹妞嬪海鐭嗗〒姘炬嫹妤犵偛顦甸弫宥夊礋椤掍焦顔囬梻浣规偠閸庢椽宕滃▎鎴濐棜鐟滅増甯楅悡娑氾拷骞垮劚妤犳悂鐛弽顓熺參闁告劦浜滈弸娑㈡煛鐏炲墽娲村┑锛勫厴椤㈡瑩鎳￠妶鍡橆唫婵犵數鍋涢悺銊у垝瀹�锟界槐鐐寸節閸パ嗘憰闂佺粯姊婚崢褏绮诲杈ㄥ枑鐎广儱顦Ч鏌ュ级閸稑濡稿ù婊勭矒閺屾洟宕煎┑鍥ф闂佹悶鍊曞ú顓㈠蓟閳ュ磭鏆嗛悗锝庡墰閻﹀牓鎮楃憴鍕闁哥姵鐗曡灋闁告劑鍔夊Σ鍫熸叏濮楀棗浜滈柟钘夘儔濮婂宕掑▎鎰偘濡炪倖娲橀悧鐘茬暦瑜版帩鏁嶆繝濠傚閸嬨劌鈹戦鏂や緵闁告挻鐩鎶芥晝閸屾稓鍘介梺纭呮彧缁查箖藟婢舵劕绠氶柣鏂垮悑閳锋垿姊婚崼鐔剁繁闁绘搩鍘剧槐鎾愁吋閸涱喖鏋犲Δ鐘靛仜缁绘﹢骞冨鍫熷癄濠㈣泛鐭夌槐鍙夌節濞堝灝鏋熼柨姘舵煕濮橆剦鍎忔い鏇熺懃鐓ゆい蹇撴噳閹锋椽姊洪崨濠勨槈闁挎洩绠撻獮濠囧礋椤戝彞绨诲銈嗘尵閸嬬喐鏅堕敂鎾呮嫹鐟欏嫭纾搁柛銊ょ矙閵嗕礁螖閸涱厾顦板銈嗗釜閹风兘鏌ㄩ悢缁橆棄闁诲繑姘ㄩ幑銏犫槈閵忕姷顓洪梺缁樺灥濡棃鎯�椤忓嫷娓婚柕鍫濇噽缁犱即鎮楀顓熷�愰柟铏崌楠炴劖鎯斿☉妤冪泿闂傚鍋勫ú锕傚箰婵犳艾闂柛婵嗗▕閻熸壋鏀﹂柛顭戝櫙閹风兘寮介锝呭簥濠电偞鍨崹褰掔嵁閵忊�茬箚闁靛牆鎳忛崳鍦拷娈垮枙閸楀啿顫忓ú顏勭闁绘劘顕滈幏鐑藉即閵忊晜鏅炴繝銏ｅ煐閸旀洟鎷戦悢鍏肩叆婵炴垶锚椤徰勭箾瀹�濠侀偗闁哄矉缍侀獮鍥濞戞﹩娼荤紓渚�绠栭弫顕�寮插鍛床婵犻潧顑呴～鍛存煏韫囧鎷烽搹顐ゆ殮闂傚倷鐒︾�笛兠洪敂鐣岊洸婵犲﹤鐗滈弫瀣煥濠靛棭妯堥柡浣告閺屾稓浠﹂崜褉妲堥梺鍝勵儏閸婂灝顫忓ú顏勫窛濠电姴鍟伴ˇ銉╂⒑鐠囪尙绠茬�癸拷缁嬫鍤曟い鎰堕檮閸嬨劑鏌涘☉妯戝牓骞忓ú顏呪拺闁革富鍙庨悞鐐箾鐎电鍘撮柛鈹垮劜瀵板嫰骞囬鐘插箻婵犵數鍋犵亸顏堫敋瑜旈幃姗�鏁冮崒娑氬幍濡炪倖妫佹慨銈夊Φ濠靛棌鏀介柍鈺佸暞閸婃劙鏌涢埞鎯у⒉闁瑰嘲鎳橀幃鐑藉箥椤斿搫浠╅梻鍌氬�搁崐椋庢濮橆剦鐒界憸鏃堝灳閿曞偆鏁囬柣鏂垮缁犳岸姊洪幖鐐插姶闁告挻鐟╁畷鎺楀Ω閳哄倻鍘藉┑鈽嗗灥閸嬫劗鏁☉銏＄厽闁规崘娉涢埢鍫ユ煛瀹�瀣М闁诡喓鍨藉畷銊︾節閸曨偄娈ョ紓鍌氬�烽懗鍓侊拷姘箻瀹曞爼濡歌楠炴劙鏌ｆ惔锝嗩仧闁归鍏橀弻銊╂偄閸撲胶鐓撻悗瑙勬礈婢ф骞嗛弮鍫澪╅柨婵嗙箲鐎氬綊鏌涘☉鍗炴灓闂傚嫬瀚槐鎺旓拷锝庝簼閸嬨儵鏌涢悙鑼煟婵﹥妞藉Λ鍐ㄢ槈鏉堫煈锟藉棛绱撻崒姘拷鐟邦潩閵娾晛绀嗛柟鐑橆殢閺佸秹鏌ｉ幇顒夊殶闁告ü绮欏铏圭磼濡崵鍙嗛梺纭咁嚋缁辨洘绔熼弴鐔虹瘈婵﹩鍘鹃崢浠嬫⒑绾懏顏犻柛瀣ㄥ�曢‖濠囶敋閿熶粙寮婚敓鐘插窛妞ゆ挾濮撮悡鐔兼⒑鏉炴壆顦﹂柛鐔告綑閻ｇ兘骞掗幋顓熷兊婵℃彃鏈悧鏇㈠极閿燂拷?
				boolean havetype=false;
				for(xbean.RoleColorType type:prop.getColorroomlist()){
					if(type!=null&&type.getColorpos1()==rolecolorinfo.colorpos1&&type.getColorpos2()==rolecolorinfo.colorpos2){
						havetype=true;
						break;
					}
				}
				//闂傚倸鍊搁崐宄懊归崶褏鏆﹂柛顭戝亝閸欏繒锟借娲栧ú锕傤敃娴犲鐓忛柛顐ｇ箖婢跺嫭銇勯锝嗙闁哄矉绻濆畷鍫曞Ψ閵壯傜棯闂備胶顭堥鍌炲疾閻樿绠栫憸鐗堝笒閻愬﹪鏌曟繛褌绀佹禒锔界節绾版ê澧茬憸鏉垮暣閹囧箻鐠囪尪鎽曞┑鐐村灟閸╁嫰寮崘鈹夸簻闁瑰搫绉堕ˇ锔姐亜韫囥儲瀚�??
				if(havetype){
					Map<Integer, SCommon> commonMap = ConfigManager.getInstance().getConf(SCommon.class);
					if(commonMap!=null){
						SCommon sCommon=commonMap.get(226);
						if(sCommon!=null){
							delpre=Double.parseDouble(sCommon.getValue());
						}
					}
				}
				ItemMaps bagContainer = Module.getInstance().getItemMaps(roleid, BagTypes.BAG, false);//闂傚倸鍊搁崐鎼佸磹閻戣姤鍤勯柛顐ｆ磸閿熸垝鐒︾换婵嬪炊妞嬪海鈼ゅ┑鐘灱閸╂牠宕濋弴鐘电焼濠㈣泛顑勭换鍡樸亜閺嶃劎绠撳ù婊冪秺閺岋綁顢橀悜鍡樷枅闂佸搫鐬奸崰鏍箖濠婂喚娼ㄩ柛鈩冾焽閺嗭箓姊绘担渚劸濡ょ姴鎽滅划鏃囥亹閹烘垼鎽曞┑鐐村灟閸ㄥ綊宕￠幎鑺ョ厪濠电偛鐏濋敓鑺ヮ殜瀹曟瑨銇愰幒鎾嫼濠电偠灏濠勮姳妞嬪海纾兼い鏃傛櫕閹冲洨锟芥鍠栭…閿嬩繆閼搁潧绶炲┑鐘插濡蹭即姊绘担钘夘棈濠㈢懓鐗嗛埢鏂库槈閵忊晜鏅滃銈嗘尪閸ㄦ椽鎮￠悢鐓庣閺夊牆澧界壕鍨归悩宕団檨闁靛洤瀚伴、姗�鎮欓弶鎴炵亷闂備浇妗ㄩ悞锕傚箲閸ヮ剙绠板┑鐘插暙缁剁偤鎮楅敐搴″箻妞ゃ垹鎳樺缁樻媴娓氼垱鏁┑鐐叉噺濞茬喖鐛幇鏉跨濞达絽鎽滈崢娲倵楠炲灝鍔氭い锔垮嵆瀵煡骞栨担鍦弳闂佺粯娲栭崐鍦拷姘炬嫹
				if(bagContainer==null){
					logger.info("闂傚倸鍊搁崐宄懊归崶褏鏆﹂柣銏㈩焾缁愭鏌熼幍顔碱暭闁稿绻濋弻銊╁籍閸屾矮澹曢梺鍝勬缁捇寮婚敐澶婃闁圭瀛╅崰鎰版⒑缂佹绠氭繛澶嬬洴閸╃偤骞嬮敃锟界壕鍏肩節婵犲倹濯奸柛搴嫹 "+roleid+"闂傚倸鍊搁崐鎼佸磹妞嬪海鐭嗗〒姘炬嫹妤犵偞鐗犻、鏇㈡晝閿熺晫锟芥艾顦伴妵鍕箳閹存繍浠肩紓浣哄У瑜板啴婀侀梺鎸庣箓閹冲繒鎷归敓鐘崇厽婵犻潧妫涢崺锝夋煛鐏炶濮傞柟顔哄�濆畷鎺戔槈濮楀棔绱�"+"\t闂傚倸鍊搁崐鎼佸磹閻戣姤鍤勯柛顐ｆ礀閸屻劎鎲搁弬璺ㄦ殾妞ゆ牜鍋涢柨銈嗕繆閵堝嫮顦︽繛鍫到椤啴濡堕崱娆忣潷缂備緡鍣紞渚�鐛箛娑欏�婚柦妯侯槸閻庮厼顪冮妶鍡楀Е闁告挻绻堥弫鎾绘寠婢跺浠撮梺鍝勭焿缁辨洘绂掗敂鐐珰闁圭粯甯╅悗鎶芥⒒娴ｅ摜鏋冩い鏇嗗洦鐓�闁挎繂顦卞畵渚�鏌熼悜妯虹亶闁猴拷娴犲鐓曢柍鈺佸枦娓氭盯鏌涢悜鍥ㄥ");
					return false;
				}
				
				HashMap<Integer, Integer> costitems=new HashMap<Integer, Integer>();
				//闂傚倸鍊搁崐鎼佸磹妞嬪海鐭嗗〒姘炬嫹妤犵偛顦甸弫宥夊礋椤掍焦顔囬梻浣规偠閸庢椽宕滃▎鎴濐棜鐟滅増甯楅悡娑氾拷骞垮劚妤犳悂鐛弽顓熺參闁告劦浜滈弸娑㈡煛鐏炲墽娲村┑锛勫厴椤㈡瑩鎮℃惔顔芥祰闂傚倷鑳剁划顖滄暜閹烘围闁归棿绀侀拑鐔兼煟閺冨倸甯剁紒鐘虫皑閹茬顓兼径濠冭緢闁哄鐗冮弲顏堝箯閻戣姤鍋ㄩ梻鍫熶緱閺嗩厼鈹戦埥鍡椾簻闁哥喐娼欓锝嗙節濮橆厽娅㈤梺缁橆焾鐏忔瑩藝娴煎瓨鈷掗柛灞炬皑婢ф稓绱掔�ｎ偅灏扮紒鍌涘浮閸╋繝宕ㄩ瑙勫闂佽崵濮村ú鐘绘晸閽樺锛嶅ù鐘欏洦鈷戦柣鎾抽閺嗛亶鏌ｉ弽褋鍋㈤柣娑卞櫍瀵粙濡搁敐鍛凹闂備礁鎲￠崝鎴﹀礉鎼淬剫鍥Ω閳哄倸锟界敻鏌ｉ悢鍛婄凡妞ゃ儱绻橀弻娑㈡偐閹颁焦鐤佸銈冨灪閹瑰洭寮幘缁樻櫢闁跨噦鎷�
				dealCostItemNum(roleid,delpre,sRoleRColorConfig1,ischange1,costitems);//闂傚倸鍊搁崐鎼佸磹閹间礁纾瑰瀣椤愪粙鏌ㄩ悢鍝勑㈢紒锟介崼鐔稿弿婵☆垱瀵х涵鍓х磼閻樺崬宓嗛柡宀�鍠栧鑽わ拷闈涘濡差噣姊哄ú璇插箺妞ゃ劌锕濠氬Ω閳哄倸浜為梺绋挎湰缁嬫垿顢旈敓锟�1
				dealCostItemNum(roleid,delpre,sRoleRColorConfig2,ischange2,costitems);//闂傚倸鍊搁崐鎼佸磹閹间礁纾瑰瀣椤愪粙鏌ㄩ悢鍝勑㈢紒锟介崼鐔稿弿婵☆垱瀵х涵鍓х磼閻樺崬宓嗛柡宀�鍠栧鑽わ拷闈涘濡差噣姊哄ú璇插箺妞ゃ劌锕濠氬Ω閳哄倸浜為梺绋挎湰缁嬫垿顢旈敓锟�2
				String loginfo="";
				for (Entry<Integer, Integer> entry : costitems.entrySet()) {
					if(entry.getKey()>0&&entry.getValue()>0){
						int havenum=bagContainer.getItemNum(entry.getKey(), 0);
						if(havenum<entry.getValue()){
							fire.pb.talk.MessageMgr.sendMsgNotify(roleid, 150058, null);
							return false;
						}
						//闂傚倸鍊搁崐鎼佸磹妞嬪海鐭嗗ù锝夋交閼板潡姊洪锟界粔鏌ユ晸閽樺锟藉潡銆佸▎鎾崇鐟滃繘藝椤栨稓绠鹃弶鍫濆⒔閹偐鐥鐐靛煟鐎殿喚顭堥鍏煎緞婵犲嫷鍟囨繝鐢靛剳缂嶅棝宕滃▎鎰箚濞寸姴顑嗛悡鐔兼煙閻戞ê鐏熼柛瀣ㄥ灲閺屸�崇暆閿熶粙宕伴弽顓犲祦闁糕剝鍑瑰Σ濠氭⒑閸濆嫭顥″ù婊庡墴閺佹挻绂掔�ｎ偅閿柟鐓庣摠缁捇鐛箛娑欐櫢闁跨噦鎷�
						int delnum=bagContainer.removeItemById(entry.getKey(), entry.getValue(), fire.log.enums.YYLoggerTuJingEnum.tujing_Value_ranse, entry.getKey(), "闂傚倸鍊搁崐宄懊归崶褏鏆﹂柣銏㈩焾缁愭鏌熼幍顔碱暭闁稿绻濋弻銊╁籍閸屾矮澹曢梺鍝勬缁捇寮婚敐澶婃闁圭瀛╅崰鎰版⒑缂佹绠氭繛澶嬬洴閸╃偤骞嬮敂钘変汗闂佸憡鐟ラˇ浼村箖濞嗘挻鈷戦柦妯侯槸閺嗙喖鏌涢悩宕囧⒌鐎殿喖顭烽幃銏ゆ偂鎼达綆妲堕柣鐔哥矊闁帮絽鐣烽悽鍛婃櫢闁芥ê顦藉〒濠氭煏閸繂鏆欓柛鏃傛暬閺岀喖宕欓妶鍡楊伓");
						if(delnum!=entry.getValue()){
							return false;
						}
						loginfo="闂傚倸鍊搁崐宄懊归崶褏鏆﹂柣銏㈩焾缁愭鏌熼幍顔碱暭闁稿绻濋弻銊╁籍閸屾矮澹曢梺鍝勬缁捇寮婚敐澶婃闁圭瀛╅崰鎰版⒑缂佹绠氭繛澶嬬洴閸╃偤骞嬮敃锟界壕鍏肩節婵犲倹濯奸柛搴嫹 "+roleid+"闂傚倸鍊搁崐鎼佸磹妞嬪海鐭嗗〒姘炬嫹妤犵偞鐗犻、鏇㈡晝閿熺晫锟芥艾顦伴妵鍕箳閹存繍浠肩紓浣哄У瑜板啴婀侀梺鎸庣箓閹冲繒鎷归敓鐘崇厽婵犻潧妫涢崺锝夋煛鐏炶濮傞柟顔哄�濆畷鎺戔槈濮楀棔绱�"+"\t闂傚倸鍊搁崐鎼佸磹妞嬪海鐭嗗ù锝夋交閼板潡姊洪锟界粔鏌ユ晸閽樺锟藉潡銆佸▎鎾崇鐟滃繘藝椤栨稓绠鹃弶鍫濆⒔閹偐鐥鐐靛煟鐎殿喚顭堥鍏煎緞婵犲嫷鍟囨繝鐢靛剳缂嶅棝宕滃▎鎰箚濞寸姴顑嗛悡鐔兼煙閻戞ê鐏熼柛瀣ㄥ灲閺屸�崇暆閿熶粙宕伴弽顓犲祦闁糕剝鍑瑰Σ濠氭⒑閸濆嫭顥″ù婊庡墴閺佹捇鎮剧仦鐐瘎婵犫拃鍕垫當閾荤偤鏌涢幇闈涙灈闁藉啰鍠栭弻鏇熺箾閸喖濮夊┑鈩冨絻閻楀﹥绌辨繝鍥舵晬婵犻潧妫斿Ч妤佺箾鐎电甯舵繛璇у閹广垹鈹戠�ｎ亞鍘遍梺璺ㄥ枍缁瑥鐣峰锟介崺鈩冩媴闁垮鈻曢梻浣筋嚙濮橈箓锝炴径濞掓椽鏁冮崒姘憋紱闂佸憡渚楅崹鎶芥儗濞嗗繆鏀介柣妯哄级婢跺嫰鏌涚�ｃ劌濮傞柡灞诲姂閹倝宕掑☉姗嗕紦"+entry.getKey()+"闂傚倸鍊搁崐鎼佸磹瀹勬噴褰掑炊瑜滃ù鏍煏婵炲灝鍔存繛鎾愁煼閺岀喖鎮滃鍡樼暥缂佺虎鍙忛幏鐑芥⒒娴ｇ瓔娼愰柛搴ｅ帶铻為柛鏇ㄥ灡閳锋帗銇勯弽顐沪闁绘挶鍎甸弻锝夊即閻愯鎷烽崷顓ㄦ嫹濮樼偓瀚�"+entry.getValue();
					}
				}
				
				logger.info(loginfo);
				
				//闂傚倸鍊搁崐宄懊归崶褏鏆﹂柛顭戝亝閸欏繒锟借娲栧ú銊╂儗閸℃褰掓晲閸偅缍堝┑鐐叉噽婵挳婀侀梺缁樏Ο濠囧磿閹扮増鐓曢悗锝呭悁闁垶鏌＄仦鍓ф创闁糕晛瀚板畷姗�顢旀担璇℃綌闂傚倷娴囧Λ鍕疮娴兼潙绐楅柡宥庡幖閽冪喖鏌ｉ弮鍌氬付缂侊拷閸垺鍠愰幖娣妼閸氬綊鏌ㄩ悢缁橆棄妞ゎ亜鍟存俊鍫曞礃閵娿儱顫撶紓鍌欒兌缁垶宕濆Ο瑁や汗濞撴熬鎷锋慨濠冩そ楠炴牠鎮欓幓鎺懶ョ紓鍌欐祰鐏忣亝鎱ㄩ妶澶婄柧闁割偅娲栫粻鐢告煙鐟欏嫷娈旀繝锟介崡鐐╂闁汇垹鎲￠悡銉╂倵閿濆簼鎲惧ù纭锋嫹
				prop.setRolecolor1(rolecolorinfo.colorpos1);
				prop.setRolecolor2(rolecolorinfo.colorpos2);
				
				//闂傚倸鍊搁崐鎼佸磹閹间礁纾瑰瀣椤愪粙鏌ㄩ悢鍝勑㈢痪鎯ь煼閺屾稑鈽夐崡鐐插濠电偛鐨烽弲鐘诲蓟閺囩喓绠鹃柣鎰靛墯閻濇洟姊虹粙娆惧剰闁稿﹤娼″濠氬Ω閳哄倸浜滈梺鍛婄箓鐎氬懘濮�閵堝棛鍘甸梺鑽ゅ枑婢瑰棝宕洪敐澶嬬厸鐎癸拷鐎ｎ剛袦濡ょ姷鍋涢澶愬箖濞嗘挸骞㈡俊顖濇娴煎矂姊虹拠鈥虫灓闁轰礁顭烽妴浣糕槈濮楀棙鍍甸梺鎸庣箓濡厼顭囬弮鍫熲拻濞达絿鍎ら崵锟介梺璇茬箲缁诲牆鐣烽鐑嗘晝闁挎梹鍎崇粊锕�鈹戦埥鍡楃仴鐎规洜鏁哥划缁樸偅閸愨晝鍘卞銈嗗姂閸婃洟寮告惔銊︾厽闊洦鎼╅崵鐔兼煥閻斿嚖鎷烽悤浣圭秷濠电偛寮堕敃銏ゅΥ閸愨晝绡�闁稿被鍊曞▓銊╂⒑濮瑰洤鐏╅柟璇х節瀹曟垿濡搁埡鍌滃幗闂侀潧绻掓慨鐢稿疮閻愮儤鐓欐い鏍ㄨ壘閺嗘瑩鏌嶇憴鍕伌闁诡喗鐟╅幊鐘活敆娴ｇ懓鏋涚紓鍌氬�风欢锟犲窗閺嶎灐褰掓煥鐎ｎ剦娲搁梺褰掓？缁�浣瑰劔闁荤喐绮岄柊锝夋晲閻愬搫鍗抽柣鏃囨閻﹀牓姊婚崒姘卞濞撴碍顨婇幃鐐哄箚椤紕鎳撻…銊╁礃椤忓柊銊╂⒑閸濆嫮鐏遍柛鐘崇墵閻涱噣宕卞鍏夹╅梻浣告惈濡粍銇旈幖浣肝﹂柛鏇ㄥ灠鍥撮梺鍛婁緱閸犳牕鈻嶉敐澶嬧拻闁搞儜灞拘х紓浣虹帛缁诲啰鎹㈠┑瀣＜婵炴垼椴搁敍浣逛繆閻愵亜锟芥洜鎹㈤幒鎾村弿闁圭虎鍠掗敓鏂ょ畵閹虫顢涢敐鍠邦亪姊虹拠鍙夋崳闁荤喐濞婂畷姗�骞嗚椤斿倿姊绘担鍛婂暈婵炶绠撳畷瑙勫閺夋垹顦ㄩ梺璺ㄥ枍缁瑩骞冨畡閭︾叆闁告洦鍋嗘导宀勬倵鐟欏嫭绀�闁圭⒈鍋婇幃鎯р攽鐎ｎ亞顦板銈嗗笒閸婃悂鐛崼鐔虹瘈闁汇垽娼ф禒婊勪繆椤愶絿鎳囩�规洘顨嗛幆鏃堚�﹂幋鐐存珕闂備胶纭跺Σ鍛村储閻ｅ矉鎷峰顒佽础闁汇儺浜璺衡枎閻愵儷褔鏌ｆ惔銏㈠暡闁瑰嚖鎷�
				//婵犵數濮烽弫鍛婃叏閻戣棄鏋侀柟闂寸绾剧粯绻涢幋鏃�鍤嶉柛銉墻閺佸洭鏌曡箛鏇炐ユい锔诲櫍閹鐛崹顔煎濡炪倧瀵岄崹宕囧垝閸儱閱囬柕澶涘閸樿棄鈹戞幊閸娧囧箯閻戣姤鐓熸俊銈忔嫹闁挎洏鍎崇划瀣吋婢跺á褔鏌涢埄鍐噮妞ゆ梹娲熷铏瑰寲閺囩偛鈷夐柦鍐憾閹绠涢敐鍛缂備胶绮惄顖氱暦椤忓牆绀冩い蹇撴濡插洭姊绘担鍛婃儓闁哄牜鍓涚划娆撳箣閿旂櫢鎷烽敃鍌毼╅柍杞拌兌椤︺劌顪冮妶鍡樺暗闁稿孩鍔栫�靛ジ宕橀埡锟界换鍡涙煟閹板吀绨婚柨鐔诲Г閻楃娀鐛幇鏉夸紶闁靛／鍜佹Ц濠电姷鏁告慨鏉懨洪妸銉ф殼濞撴熬鎷烽柟顔筋殜閺佹劖鎯旈垾鑼跺焻婵犵鍓濊ぐ鍐礊婵犲洨宓侀柡宥庡幖缁犺銇勯幘璺轰沪闁诲繐妫涚槐鎾存媴娴犲鎽甸梺鍦嚀濞层倝锝炶箛鎾佹椽顢旈崟顏嗙倞闂備礁鎲″ú锕傚储濠婂喚鐓ラ柛顐ゅ枔閸欏棝姊虹紒妯活梿妞ゆ泦鍡╂毐闂傚倷绀侀幉锟犲箰鐠囪尙鏆嗙紒瀣硶閺嗭箓鏌ｉ姀鐘冲暈闁稿鍔楃槐鎾存媴鐠囷紕鍔烽梺鍛娒肩划娆忣潖濞差亝顥堟繛鎴ｄ含閸旀悂姊虹粙鍧楀弰濞存粌鐖奸妴渚�寮崼顐ｆ櫆闂佸憡渚楅崜娑氱不濮樿埖鈷戠紓浣姑慨鍫㈡喐閺夊灝鏆ｉ柡浣规崌閹稿﹥寰勭仦鑹版闂備椒绱徊鍧楀礂濮楋拷閻涱噣宕堕澶嬫櫈闂佸吋浜介崕鎶芥晸閽樺鐓兼慨濠冩そ閹兘寮舵惔鎾村瘱缂傚倷鑳剁划顖滄崲閸曨垰绀嗛柟鐑橆殢閺佸秹鏌ｉ幇顒夊殶闁告ü绮欏铏圭磼濡崵鍙嗛梺纭咁嚋缁辨洘绔熼弴鐔虹瘈婵﹩鍘搁幏濠氭⒑閸涘﹤濮�闁哄懏绻堥幃椋庣矈閸嶎檲asicOctets闂傚倸鍊搁崐鎼佸磹妞嬪孩顐芥慨姗嗗墻閻掍粙鏌ゆ慨鎰拷鏍拷姘煼閺岋綁寮崒姘粯缂備緤鎷峰鑸靛姉閸欐捇鏌涢妷锝呭缂侊拷閸愵亷鎷风憴鍕闁绘搫绻濆濠氬灳閹颁礁鎮戦柟鑲╄ˉ閿熻棄纾鎴︽⒒娴ｈ櫣甯涢柟鍛婃倐瀹曟劖绻濆顓熸闂佷紮绲介張顒勵敂閻斿吋鐓欏瀣閸樻挳鏌＄仦鍓ф创鐎殿喗鎸虫俊鎼佸Ψ閵夘喗娴囬梻鍌欑窔濞佳兾涘Δ鍛柈妞ゆ劧绠戦悡姗�鏌熸潏楣冩闁稿﹤顭烽弻娑㈠Ψ閵忊剝鐝栭悶姘剧稻娣囧﹪鎮欓鍕舵嫹閺嵮�鏋栭柨鏇炲�哥粈瀣亜閹虹偞瀚归悗娈垮枛濞尖�愁潖閾忓湱纾兼俊顖氭惈椤骸顪冮妶蹇曠У闁革綇缍侀悰顔跨疀閹捐埖娈濋梺閫涚祷濞呮洟锝炲鍛斀闁绘劕寮堕ˉ鐐烘嫅闁秵鐓熼柨婵嗘噹濡茬粯銇勯鍕殻濠碘�崇埣瀹曞崬螣閻撳骸姹查梻鍌欑劍濡炲潡宕㈡總绋跨９闁割煈鍣崵鏇熴亜閹扳晛鐒洪柛姘儔閺屾盯濡烽鐐搭�嶉梺鍛婃礀閸熸潙顫忛搹鍦＜婵☆垰鎼闂備胶顭堝ù鐑藉礂濮楋拷瀵偊宕橀鑲╋紲濠电偞鍨堕懝楣冪嵁閸儲鈷掑ù锝囨嚀椤曟粍鎱ㄦ繝鍜佸殭闁宠绉规慨锟介柕鍫濇噽椤斿棝姊虹紒妯虹伇濠殿喓鍊濆鏌ュ箹娴ｅ湱鍙嗛梺缁樻礀閸婂湱锟芥熬鎷�:\MT-G\server\server\protocols\move.xml闂傚倸鍊搁崐椋庣矆娓氾拷楠炴牠顢曚綅閸ヮ剦鏁冮柨鏇嫹闁汇倗鍋撶换婵囩節閸屾粌顤�闂佺顑戠换婵嬪蓟閺囥垹閱囨繝鍨姈鏁堥梻浣虹帛閹告悂宕愰崷顓熷床婵犻潧娲ㄧ弧锟介梺绋挎湰缁矂銆傞搹鍦＜缂備降鍨瑰鍧楁煙妞嬪骸鍘存慨濠勭帛缁绘繃鎯旈垾鑼泿婵犵數鍋犻婊呯不閹惧磭鏆︽繛鍡樺竾娴滃綊鏌熼悜妯虹伇闁糕晝鍋ゅ娲捶椤撯剝顎楅梺鍝ュУ椤ㄥ﹪宕哄☉銏犵闁挎梻鏅崢鐢电磽閸屾瑧鍔嶉柨姘辩磼濡烇箑娲﹂悡鐔兼煙閻戞ɑ绀冪痪顓炲缁辨帗娼忛妸銉х懖濠电偟鍘х换妯讳繆濮濆矈妲鹃梺姹囧�曠�氭澘顫忛搹瑙勫珰闁炽儴娅曢悘宥嗙節閻㈤潧浠滈柨鏇樺�濋、姘舵晲婢跺﹪鍞堕梺鍝勬川閸嬬喖顢欓崶顒佺厵闁稿繗鍋愰弳姗�鏌涙繝鍐╃妤犵偛妫濆畷濂稿Ψ閿旇瀚藉┑鐐舵彧缁茶偐鎷冮敃鍌涘�块柛鎾楀懐锛滅紓鍌欑劍閿氬┑顔肩Ч閺岀喖顢欓妸銉︽悙鐎瑰憡绻冮妵鍕冀閵娧呯厒闂佷紮缍�閸╂牜鎹㈠┑瀣潊闁挎繂鎳愰崢顐︽⒑閸涘﹥鈷愭繛鍙夌矌閸掓帡宕奸妷锔芥闂佽法鍣﹂幏锟�?
//				Role addRole = RoleManager.getInstance().getRoleByID(roleid);
//				SAddUserScreen sadduser = new SAddUserScreen();
//				sadduser.rolelist.add(addRole.getRoleBasic());
//				gnet.link.Onlines.getInstance().send(roleid, sadduser);
				
				GRoleEquipChange notifymap = new GRoleEquipChange();
				notifymap.roleid = roleid;
				notifymap.pos = EquipItemType.ROLE_COLOR1;
				notifymap.itemid = rolecolorinfo.colorpos1;
				notifymap.ride = -1;
				notifymap.effect = 0;
				GsClient.pSendWhileCommit(notifymap);
				
				SReqUseColor sReqUseColor=new SReqUseColor();
				sReqUseColor.rolecolorinfo.colorpos1=prop.getRolecolor1();
				sReqUseColor.rolecolorinfo.colorpos2=prop.getRolecolor2();
//				gnet.link.Onlines.getInstance().send(roleid, sReqUseColor);
				Procedure.psendWhileCommit(roleid, sReqUseColor);
				fire.pb.talk.MessageMgr.sendMsgNotify(roleid, 160432, null);
				//濠电姷鏁告慨鐑藉极閹间礁纾块柟瀵稿Т缁躲倝鏌﹀Ο渚＆婵炲樊浜濋弲婊堟煟閹伴潧澧幖鏉戯躬濮婅櫣绮欑捄銊т紘闂佺顑囬崑銈呯暦閹达箑围濠㈣泛顑囬崢顏呯節閻㈤潧浠ч柛瀣尭閳诲秹宕ㄩ婊咃紲闂佽法鍠嶇划娆忕暦閸楃偐妲堟繛鍡樺灥楠炲秹鏌ｆ惔锝嗗殌閻庢凹鍘介崚濠冪鐎ｅ墎绋忛梺鎸庢礀閸婂綊鎮￠妷鈺傜厽闁哄啫鍊荤敮娑欍亜閵夈儺妯�闁哄本绋掔换婵嬪礃閳轰緤鎷烽幇鐗堢叆婵犻潧鐗嗘禒婊勩亜椤撴粌濮傜�规洜鍠栭、妤呭磼濠х偑鍊栨穱濠囨倷椤忓嫸鎷烽弽顓炵闁硅揪绠戠壕瑙勪繆閵堝懏濯奸柡浣革工椤潡鎳滈棃娑橆潔闂佹娊鏀遍崹鍧楀蓟閻斿吋鍤冮柍杞版缁爼姊洪崨濠冪厽闁稿﹥绻堝璇测槈濮樼偓瀚归柨婵嗛婢ь噣鏌嶇拠鑼闁宠鍨块崺鍕礃閳轰礁鏀柣搴ゎ潐濞叉鏁幒妤嬬稏婵犻潧顑呯粈鍌炴煟閹捐櫕鎹ｇ紒鎲嬬畵濮婂宕掑▎鎴М闂佺顕滅换婵嬪箖閻戣姤鏅滈柣鎰靛墰閻ｅ磭绱撻崒姘拷宄懊归崶顒夋晪鐟滃秷鐏嬪┑鐘绘涧椤戝懘鎷戦悢鍏肩厽闁哄倸鐏濋幃鎴︽煛閸涱喗鍊愰柡灞诲姂閹倝宕掑☉姗嗕紦?
				saveColor(roleid,prop);
				
				fire.pb.team.Team team = fire.pb.team.TeamManager.selectTeamByRoleId(roleid);
				if (team != null){
					team.updateTeamMemberBasic2Others(roleid);
				}
				logger.info("闂傚倸鍊搁崐宄懊归崶褏鏆﹂柣銏㈩焾缁愭鏌熼幍顔碱暭闁稿绻濋弻銊╁籍閸屾矮澹曢梺鍝勬缁捇寮婚敐澶婃闁圭瀛╅崰鎰版⒑缂佹绠氭繛澶嬬洴閸╃偤骞嬮敃锟界壕鍏肩節婵犲倹濯奸柛搴嫹 "+roleid+"闂傚倸鍊搁崐鎼佸磹妞嬪海鐭嗗〒姘炬嫹妤犵偞鐗犻、鏇㈡晝閿熺晫锟芥艾顦伴妵鍕箳閹存繍浠肩紓浣哄У瑜板啴婀侀梺鎸庣箓閹冲繒鎷归敓鐘崇厽婵犻潧锕ョ涵楣冩煃鐟欏嫬鐏撮柟顔规櫊瀹曪絾寰勭�ｎ偄锟介绱撻崒娆掑厡濠殿垰顕槐鐐寸瑹閿熻棄顕ｆ繝姘亜闁稿繗鍋愰崝鐑芥⒑閹稿孩绌块柟宄板槻椤儻顧侀柛鐘愁殜婵＄敻宕熼锝嗘櫇闂侀潧鐗嗛幊澶愬几閸涘瓨鈷戦柛婵嗗椤箓鏌涢弬璺ㄧ劯闁糕斂鍎插鍕箾閵忋垹鏋涚�规洖缍婇、姘跺川椤掑倻锛炵紓鍌氬�搁崐鎼佸磹閹间礁纾归柛婵勫劤閻捇鏌熺紒銏犳珮闁轰礁瀚…璺ㄦ崉閻氭潙濮涢梺鍝勬４闂勫嫮鎹㈠┑鍥╃瘈闁稿本纰嶉悘鎾绘⒑閸涘﹨澹樻い鎴濐樀瀵鈽夐姀鐘靛姶闂佸憡鍔︽禍婵嬪闯瑜旈弻锝夊閳轰胶浼囬梺鍛婃尵閸犲酣锝炶箛鎾佹椽顢旈崨顓熺暟闂備礁鍟块幖顐﹀磹缁嬪簱鏋旂�癸拷閸曨剙锟藉灚绻涢崼婵堜虎闁哄鐩弻锝夊冀椤愩垹浠樺銈嗘穿缁插墽鎹㈠┑鍡╂僵妞ゆ挾鍋樼花璇测攽閻樼粯娑ч柛濠冩倐钘濋柟娈垮枤閻鏌ㄩ悤鍌涘?"+prop.getRolecolor1()+" "+prop.getRolecolor2());
				return true;
			}
		}.submit();
	}
	
	/**
	 * 濠电姷鏁告慨鐑藉极閹间礁纾块柟瀵稿Т缁躲倝鏌﹀Ο渚＆婵炲樊浜濋弲婊堟煟閹伴潧澧幖鏉戯躬濮婅櫣绮欑捄銊т紘闂佺顑囬崑銈呯暦閹达箑围濠㈣泛顑囬崢顏呯節閻㈤潧浠ч柛瀣尭閳诲秹宕ㄧ�涙鍙冮梺鍛婂姦娴滄粓寮稿☉銏＄厸鐎癸拷閿熶粙宕伴弽褏鏆︽繝濠傛－濡插ジ姊洪幖鐐诧拷褔骞忛柨瀣╃箚闁绘劦浜滈敓鑺ュ灴瀹曟洘娼忛埡鍌氬簥濠殿喗顨愰幏椋庯拷娈垮枛椤兘寮幘缁樺亹闁肩⒈鍓ㄧ槐鍙夌節閻㈤潧孝闁诲繑宀稿畷婵嬪冀椤愩倗顦梺鍓插亝缁诲秴銆掓繝姘厪闁割偅绻傞銏㈢磼閼哥數娲撮柡宀�鍠栧畷娆撳Χ閸℃浼�
	 * @param roleid
	 * @param prop
	 */
	public void saveColor(long roleid,xbean.Properties prop){
		boolean havetype=false;
		java.util.List<xbean.RoleColorType> list=prop.getColorroomlist();
		for(xbean.RoleColorType type:list){
			if(type!=null&&type.getColorpos1()==prop.getRolecolor1()&&type.getColorpos2()==prop.getRolecolor2()){
				havetype=true;
				break;
			}
		}
		if(havetype==true){
			return ;
		}
		int max=0;
		Map<Integer, SCommon> commonMap = ConfigManager.getInstance().getConf(SCommon.class);
		if(commonMap!=null){
			SCommon sCommon=commonMap.get(228);
			if(sCommon!=null){
				max=Integer.parseInt(sCommon.getValue());
			}
		}
//		if(prop.getColorroomlist().size()>=max){
//			return ;
//		}
		xbean.RoleColorType roleColorType=xbean.Pod.newRoleColorType();
		roleColorType.setColorpos1(prop.getRolecolor1());
		roleColorType.setColorpos2(prop.getRolecolor2());
		prop.getColorroomlist().add(roleColorType);
		
		CReqColorRoomView.sendColorRoomInfo(roleid);
	}

	
	
	/**
	 * 闂傚倸鍊搁崐宄懊归崶褏鏆﹂柛顭戝亝閸欏繒锟借娲栧ú锕傤敃娴犲鐓忛柛顐ｇ箖婢跺嫭銇勯锝嗙闁哄矉绻濆畷鍫曞Ψ閵壯傜棯闂備胶顭堥鍌炲疾濞戙垹鐓橀柟杈鹃檮閸嬫劗锟借娲栧ù鍌炲汲閳ユ剚娓婚柕鍫濆暙閸旂敻鏌熼崙銈嗗?闂傚倸鍊搁崐宄懊归崶褏鏆﹂柣銏㈩焾缁愭鏌熼柇锕�鍔掓繛宸簻缁狅綁鏌ㄩ弮鍥棄婵炲牊鍨块弻锝夋偐閼姐倗绐楅梺闈涙４閹风兘姊洪崫鍕靛剱婵☆偄鍟村濠氭偄閸涘﹦绉舵俊銈忕到閸燁垶顢撳澶嬧拺缂備焦锚缁楁帡鏌曢崼鐔稿�愮�殿喖顭烽幃銏ゆ偂鎼达絿鏆伴柣鐔哥矊缁夌懓顕ｉ搹顐ｇ秶闁冲搫顑嗙�氬綊鏌ｉ姀銈嗘锭妞わ絽鍚嬫穱濠囶敃閵忕姵娈婚悗娈垮枛椤兘宕洪崟顖氱闁宠桨绶￠敓鑺ユ崌閹鎮烽弶娆句痪濠电姰鍨洪…鍥╁垝婵犲浂鏁嬮柨鐔绘椤繐煤椤忓拋妫冮梺鍐叉惈閸熸媽鍊撮梻鍌欒兌閹虫捇宕甸弽顓炵闁跨噦鎷�
	 * @param roleid
	 * @param delpre
	 * @param sRoleRColorConfig1
	 * @return
	 */
	public void dealCostItemNum(long roleid,double delpre,SRoleRColorConfig sRoleRColorConfig1,boolean flag,HashMap<Integer, Integer> costitems){
		if(sRoleRColorConfig1!=null&&flag==true){
			int costnum=(int) Math.ceil(sRoleRColorConfig1.getItemnum()*delpre);
			if(costnum<0){
				return ;
			}
			Integer num= costitems.get(sRoleRColorConfig1.getItemcode());
			if(num==null){
				costitems.put(sRoleRColorConfig1.getItemcode(), costnum);
			}else{
				costitems.put(sRoleRColorConfig1.getItemcode(), costnum+num);
			}
		}
	}
	
	
	

	// {{{ RPCGEN_DEFINE_BEGIN
	// {{{ DO NOT EDIT THIS
	public static final int PROTOCOL_TYPE = 786538;

	public int getType() {
		return 786538;
	}

	public fire.pb.RoleColorType rolecolorinfo; // 染色信息

	public CReqUseColor() {
		rolecolorinfo = new fire.pb.RoleColorType();
	}

	public CReqUseColor(fire.pb.RoleColorType _rolecolorinfo_) {
		this.rolecolorinfo = _rolecolorinfo_;
	}

	public final boolean _validator_() {
		if (!rolecolorinfo._validator_()) return false;
		return true;
	}

	public OctetsStream marshal(OctetsStream _os_) {
		if (!_validator_()) {
			throw new VerifyError("validator failed");
		}
		_os_.marshal(rolecolorinfo);
		return _os_;
	}

	public OctetsStream unmarshal(OctetsStream _os_) throws MarshalException {
		rolecolorinfo.unmarshal(_os_);
		if (!_validator_()) {
			throw new VerifyError("validator failed");
		}
		return _os_;
	}

	public boolean equals(Object _o1_) {
		if (_o1_ == this) return true;
		if (_o1_ instanceof CReqUseColor) {
			CReqUseColor _o_ = (CReqUseColor)_o1_;
			if (!rolecolorinfo.equals(_o_.rolecolorinfo)) return false;
			return true;
		}
		return false;
	}

	public int hashCode() {
		int _h_ = 0;
		_h_ += rolecolorinfo.hashCode();
		return _h_;
	}

	public String toString() {
		StringBuilder _sb_ = new StringBuilder();
		_sb_.append("(");
		_sb_.append(rolecolorinfo).append(",");
		_sb_.append(")");
		return _sb_.toString();
	}

	public int compareTo(CReqUseColor _o_) {
		if (_o_ == this) return 0;
		int _c_ = 0;
		_c_ = rolecolorinfo.compareTo(_o_.rolecolorinfo);
		if (0 != _c_) return _c_;
		return _c_;
	}

	// DO NOT EDIT THIS }}}
	// RPCGEN_DEFINE_END }}}

}

