
package fire.msp.task;

import fire.pb.battle.PNewBattle;
import fire.pb.buff.BuffAgent;
import fire.pb.buff.BuffConstant;
import fire.pb.buff.BuffRoleImpl;
import fire.pb.mission.MissionBattleEndHandler;
import fire.pb.mission.MissionColumn;
import fire.pb.mission.Module;
import fire.pb.mission.RoleMission;
import fire.pb.mission.SUseMissionItemFail;

// {{{ RPCGEN_IMPORT_BEGIN
// {{{ DO NOT EDIT THIS
import com.locojoy.base.Marshal.OctetsStream;
import com.locojoy.base.Marshal.MarshalException;

abstract class __MScenarioQuestUseItemVerifyPosSucc__ extends mkio.Protocol { }

// DO NOT EDIT THIS }}}
// RPCGEN_IMPORT_END }}}

public class MScenarioQuestUseItemVerifyPosSucc extends __MScenarioQuestUseItemVerifyPosSucc__ {
	@Override
	protected void process() {
		// protocol handle
		dealUseItem(roleid, scenarioquestid, useitemid);
	}
	private static void onFail(final long roleid) {
		if (mkdb.Transaction.current() == null)
			gnet.link.Onlines.getInstance().send(roleid, new SUseMissionItemFail());
		else
			mkdb.Procedure.psend(roleid, new SUseMissionItemFail());
	}
	public static boolean dealUseItem(final long roleid, final int scenarioquestid, final int useitemid) {
		RoleMission task = new MissionColumn(roleid, true).getMission(scenarioquestid);
		if (task == null) {
			return false;
		}
		Module.logger.info("闂傚倸鍊搁崐鎼佸磹閹间礁纾归柟闂寸绾惧湱锟界懓瀚崳纾嬨亹閹烘垹鍊為悷婊冪箻瀵娊鏁冮崒娑氬幗闂侀潧绻堥崺鍕倿閸撗呯＜闁归偊鍙庡▓婊堟煛瀹�锟介崰鏍嵁瀹ュ鏁婄痪鎷岄哺濮ｅ姊绘担渚劸妞ゆ垶鍨归幑銏犫攽鐎ｎ亣鎽曢梺闈浥堥弲娑氱尵瀹ュ鐓曢悘鐐插⒔閻擃垰顭跨憴鍕婵﹥妞藉畷顐﹀礋椤掑锛佺紓鍌欑贰閸犳骞戦崶褜鍤曞┑鐘崇閺呮彃顭跨捄鐚存敾妞ゃ儲绻堝娲捶椤撗呭姼闁诲孩绋堥弲鐘茬暦娴兼潙绠涢柣妤�鐗冮幏铏圭磽閸屾瑧鍔嶆い顓炴川缁顫濋鐘殿啎婵犮垼娉涢鍥洪幘顔界厱闁冲搫鍟禒杈殽閻愬樊鍎旈柡浣稿暣閺佹捇鎮剧仦绛嬫婵犻潧鍊搁幉锟犳偂閵夆晜鐓涢柛鎰╁妽婢跺嫭銇勯妷銉Ч闁靛洤瀚粻娑㈠Ψ閿曪拷椤忥拷" + roleid + "]婵犵數濮烽弫鍛婃叏閻戣棄鏋侀柛娑橈攻閸欏繘鏌ｉ幋锝嗩棄闁哄绶氶弻鐔兼⒒鐎靛壊妲紒鐐劤椤兘寮婚敐鍛傜喎鈻庨幆褎顔勭紓鍌欒兌婵挳鎮樺璺何﹂柛鏇ㄥ枤閻わ拷闂佸湱鍋撻幆灞轿涢妶鍥╃＝濞撴艾锕ョ�氳绻濋悽闈浶㈡繛璇х畵閹繝濡烽埡鍌滃幗闂佸搫鍟ù鍌炲吹濞嗘垶鍋栨慨妯夸含绾捐棄霉閿濆牊顏犻悽顖涚〒缁辨帞锟斤綆鍋勭粭鎺撱亜閺囨ê鍔︾�规洜鍠栭、姗�濡搁敃锟介鍫曟⒑閹稿海绠撳Δ鐘叉啞缁傚秹鎮欏ǎ顑跨盎闂佹寧鏌ㄩ悘婵嗙暤閸℃稒鐓欐い鏃傜摂濞堟棃鏌嶇紒妯诲磳鐎规洖缍婇、娆撴偩鐏炲�熸嫬闂傚倸鍊烽懗鍫曗�﹂崼銉晞闁告稑鐡ㄩ弲婵嬫煏婢舵稑顩柍鐟扮Т閳规垿鎮╅崣澶婎槱闂佹悶鍊曢澶婎潖婵犳艾閱囬柣鏃�浜介敓鑺ュ笧缁辨帡骞囬闂存闂佸搫鐭夌徊楣冨箚閺冨牜鏁嶆繝濠傛啗閿濆鈷戦柛娑橈攻鐏忎即鏌ｉ悤鍌滅暤妤犵偛鐗撴俊鎼佸煛娴ｄ警鍟囧┑鐐舵彧缁蹭粙宕㈠鍫濈缂備焦顭囩粻楣冨级閸繂鈷旈柟顔笺偢閺岋綁鍩勯崘鈺冨弳濡炪値鍘煎ú顓㈢嵁閸ヮ剚鍋嬮柛顐犲灩楠炲牓姊洪悷鏉挎倯闁伙綆浜畷纭呫亹閹烘垹鍘洪梺鍝勬川婵挳骞忔搴㈠枂闁告洦鍓欓ˇ鈺呮⒑閹肩偛濮�婵炲鐩幃楣冩偪椤栨ü姹楅梺鍦劋缁诲啴寮查鍫熲拺闁告稑锕ｇ欢閬嶆煕濡湱鐭欐い銏＄懇瀹曟帡鎮欑划瑙勫濠电偠鎻徊鍧楀磿閵堝鍚归柨鐔剁矙閺岋綀绠涢幘鍓侇唶闂佺娅曢敃銏ゆ偘椤旇法鐤�婵炴垶鐟﹀▍銏ゆ⒑鐠恒劌娅愰柟鍑ゆ嫹" + useitemid + "],婵犵數濮烽弫鍛婃叏閻戣棄鏋侀柛娑橈攻閸欏繘鏌ｉ幋锝嗩棄闁哄绶氶弻鐔兼⒒鐎靛壊妲紒鎯у⒔缁垳鎹㈠☉銏犵婵炲棗绻掗崝鎾⒑鏉炴壆顦︽い鎴濇婵＄敻宕熼姘鳖啋闁荤姾娅ｉ崕銈夋倵妤ｅ啯鈷戦柛娑橈功閹冲啰绱掔紒妯哄闁诲繐鍟村娲箰鎼达絿鐣甸梺鐟板暱闁帮絽顕ｉ幖浣肝у璺侯儑閸樺憡绻涙潏鍓у埌濠㈢懓锕畷鏇㈠箣閿旂晫鍘甸梺鍦帛鐢宕悙鐑樼厵妞ゆ牗绋掗ˉ鍫濃攽閳╁啯鍊愬┑锛勬焿椤︽挳鏌℃径澶岀煓婵﹦绮粭鐔兼晸閽樺鐒界憸鎴炴櫠濠靛鈷戦柛婵嗗閸ｈ櫣绱掗鑺ュ碍闁伙絿鍏橀獮鍥级閸ф鏆呮繝寰锋澘锟芥捇鎳楅崼鏇炵煑闁糕剝绋掗埛鎴犵磽娴ｈ偂鎴犵矆閿熶粙姊虹粙鍖″伐婵狅拷闁秵鏅搁柤鎭掑劤閸熸煡鏌熼崙銈嗗" + scenarioquestid + "]!");
		if (task.getConf().aiInfo.aIID != 0) {
			PNewBattle battle = new PNewBattle(roleid, task.getConf().aiInfo.aIID, 
					new MissionBattleEndHandler(scenarioquestid, task.getConf().aiInfo.battleResult
							, roleid));
			if (mkdb.Transaction.current() == null)
				battle.submit();
			else
				battle.call();
			return true;
		//	gnet.link.Onlines.getInstance().send(roleid, new SUseTaskItemFail());
		} else {
			BuffAgent buffagent = new BuffRoleImpl(roleid,true);
			if (buffagent.existBuff(BuffConstant.StateType.STATE_TEAM) && buffagent.existBuff(BuffConstant.StateType.STATE_TEAM_LEADER)) {
				if (task.getConf().exeIndo.teamState == 0) {
				//	onFail(roleid);
					Module.logger.info("闂傚倸鍊搁崐鎼佸磹閹间礁纾归柟闂寸绾惧湱锟界懓瀚崳纾嬨亹閹烘垹鍊為悷婊冪箻瀵娊鏁冮崒娑氬幗闂侀潧绻堥崺鍕倿閸撗呯＜闁归偊鍙庡▓婊堟煛瀹�锟介崰鏍嵁瀹ュ鏁婄痪鎷岄哺濮ｅ姊绘担渚劸妞ゆ垶鍨归幑銏犫攽鐎ｎ亣鎽曢梺闈浥堥弲娑氱尵瀹ュ鐓曢悘鐐插⒔閻擃垰顭跨憴鍕婵﹥妞藉畷顐﹀礋椤掑锛佺紓鍌欑贰閸犳骞戦崶褜鍤曞┑鐘崇閺呮彃顭跨捄鐚存敾妞ゃ儲绻堝娲捶椤撗呭姼闁诲孩绋堥弲鐘茬暦娴兼潙绠涢柣妤�鐗冮幏铏圭磽閸屾瑧鍔嶆い顓炴川缁顫濋鐘殿啎婵犮垼娉涢鍥洪幘顔界厱闁冲搫鍟禒杈殽閻愬樊鍎旈柡浣稿暣閺佹捇鎮剧仦绛嬫婵犻潧鍊搁幉锟犳偂閵夆晜鐓涢柛鎰╁妽婢跺嫭銇勯妷銉Ч闁靛洤瀚粻娑㈠Ψ閿曪拷椤忥拷" + roleid + "]婵犵數濮烽弫鍛婃叏閻戣棄鏋侀柛娑橈攻閸欏繘鏌ｉ幋锝嗩棄闁哄绶氶弻鐔兼⒒鐎靛壊妲紒鐐劤椤兘寮婚敐鍛傜喎鈻庨幆褎顔勭紓鍌欒兌婵挳鎮樺璺何﹂柛鏇ㄥ枤閻わ拷闂佸湱鍋撻幆灞轿涢妶鍥╃＝濞撴艾锕ョ�氳绻濋悽闈浶㈡繛璇х畵閹繝濡烽埡鍌滃幗闂佸搫鍟ù鍌炲吹濞嗘垶鍋栨慨妯夸含绾捐棄霉閿濆牊顏犻悽顖涚〒缁辨帞锟斤綆鍋勭粭鎺撱亜閺囨ê鍔︾�规洜鍠栭、姗�濡搁敃锟介鍫曟⒑閹稿海绠撳Δ鐘叉啞缁傚秹鎮欏ǎ顑跨盎闂佹寧鏌ㄩ悘婵嗙暤閸℃稒鐓欐い鏃傜摂濞堟棃鏌嶇紒妯诲磳鐎规洖缍婇、娆撴偩鐏炲�熸嫬闂傚倸鍊烽懗鍫曗�﹂崼銉晞闁告稑鐡ㄩ弲婵嬫煏婢舵稑顩柍鐟扮Т閳规垿鎮╅崣澶婎槱闂佹悶鍊曢澶婎潖婵犳艾閱囬柣鏃�浜介敓鑺ュ笧缁辨帡骞囬闂存闂佸搫鐭夌徊楣冨箚閺冨牜鏁嶆繝濠傛啗閿濆鈷戦柛娑橈攻鐏忎即鏌ｉ悤鍌滅暤妤犵偛鐗撴俊鎼佸煛娴ｄ警鍟囧┑鐐舵彧缁蹭粙宕㈠鍫濈缂備焦顭囩粻楣冨级閸繂鈷旈柟顔笺偢閺岋綁鍩勯崘鈺冨弳濡炪値鍘煎ú顓㈢嵁閸ヮ剚鍋嬮柛顐犲灩楠炲牓姊洪悷鏉挎倯闁伙綆浜畷纭呫亹閹烘垹鍘洪梺鍝勬川婵挳骞忔搴㈠枂闁告洦鍓欓ˇ鈺呮⒑閹肩偛濮�婵炲鐩幃楣冩偪椤栨ü姹楅梺鍦劋缁诲啴寮查鍫熲拺闁告稑锕ｇ欢閬嶆煕濡湱鐭欐い銏＄懇瀹曟帡鎮欑划瑙勫濠电偠鎻徊鍧楀磿閵堝鍚归柨鐔剁矙閺岋綀绠涢幘鍓侇唶闂佺娅曢敃銏ゆ偘椤旇法鐤�婵炴垶鐟﹀▍銏ゆ⒑鐠恒劌娅愰柟鍑ゆ嫹" + useitemid + "],婵犵數濮烽弫鍛婃叏閻戣棄鏋侀柛娑橈攻閸欏繘鏌ｉ幋锝嗩棄闁哄绶氶弻鐔兼⒒鐎靛壊妲紒鎯у⒔缁垳鎹㈠☉銏犵婵炲棗绻掗崝鎾⒑鏉炴壆顦︽い鎴濇婵＄敻宕熼姘鳖啋闁荤姾娅ｉ崕銈夋倵妤ｅ啯鈷戦柛娑橈功閹冲啰绱掔紒妯哄闁诲繐鍟村娲箰鎼达絿鐣甸梺鐟板暱闁帮絽顕ｉ幖浣肝у璺侯儑閸樺憡绻涙潏鍓у埌濠㈢懓锕畷鏇㈠箣閿旂晫鍘甸梺鍦帛鐢宕悙鐑樼厵妞ゆ牗绋掗ˉ鍫濃攽閳╁啯鍊愬┑锛勬焿椤︽挳鏌℃径澶岀煓婵﹦绮粭鐔兼晸閽樺鐒界憸鎴炴櫠濠靛鈷戦柛婵嗗閸ｈ櫣绱掗鑺ュ碍闁伙絿鍏橀獮鍥级閸ф鏆呮繝寰锋澘锟芥捇鎳楅崼鏇炵煑闁糕剝绋掗埛鎴犵磽娴ｈ偂鎴犵矆閿熶粙姊虹粙鍖″伐婵狅拷闁秵鏅搁柤鎭掑劤閸熸煡鏌熼崙銈嗗" + scenarioquestid + "],闂傚倸鍊搁崐鎼佸磹閹间礁纾归柟闂寸绾惧綊鏌熼梻瀵割槮缁惧墽鎳撻—鍐拷锝庝簼閹癸綁鏌ｉ鐐搭棞闁靛棙甯掗～婵嬫倷椤掞拷椤忚埖淇婇妶鍥ラ柛瀣仱閹囨偐濮瑰浄鎷锋笟锟藉鎾閳╁啯鐝曢梻浣藉Г閿氭い锔诲枤缁辨棃寮撮姀鈾�鎷绘繛杈剧秬濞咃綁濡存繝鍥ㄧ厱闁规儳顕粻鐐烘煙閽樺锟藉鏁撻弬銈囩У闁哥姵鐗犻幃娆愮節閸愶缚绨婚梺鐟版惈缁夊墎鎷归悧鍫滅箚妞ゆ劑鍨归弳娆撴煃鐟欏嫬鐏撮柟顔界懃椤斿繘顢欓崗纰卞晙濠碉紕鍋戦崐鏍暜閻旇桨鐒婃繛鍡樺灦椤洟鏌ｉ幇顒夊殶闁荤喎缍婇弻銊╂偄缂佹﹩妫勫銈嗘穿缂嶄線銆侀弴銏℃櫇闁跨喓鏅竟鏇熺附閸涘﹦鍘介梺褰掑亰閸樼晫绱為幋锔界厽鐟滃秶锟芥凹鍘鹃幑銏犫攽鐎ｎ亶娼婇梺鎸庣箓閹虫劙宕㈤锔解拺闁圭娴烽。鑼磼缂佹娲寸�规洜鍘ч埞鎴﹀礋椤愨�冲灊闂傚倷绀侀幖顐︽儗婢跺苯绶ゅΔ锝呭暙缁犳岸鏌￠崘銊у闁哄拋鍓熼弻娑㈠即閵娿儱绠哄┑鐐茬墱閸ㄨ泛顫忕紒妯诲濞撴凹鍨抽崝绋库攽椤旀枻鍏梻鍕缁顓兼径妯绘櫌闂佸憡娲﹂崜姘枍閵忋倖鈷戦柛蹇涙？閼割亪鏌涙惔銊ゆ喚鐎规洜鏁婚、妤呭礋椤掑倸骞堥梻浣瑰缁诲倻鎹㈤幒鏃傜煋妞ゆ梻鐡斿▓浠嬫煟閹邦厼绲婚柡鍡秮閺岀喖顢欓悾宀�鐓傜紓渚囧枤閺佹悂鏁撻弬銈囩У闁稿鎳庨埢宥呯暆閸曨兘鎷绘繛杈剧秬婵倗娑甸崼鏇熺厱闁绘灏欒倴闂佸憡甯楃敮鎺楀煝鎼淬劌绠婚柧蹇ｅ亝琚ｉ梻鍌欑窔濞佳嚶ㄩ敓鐣岀磼閻樺啿鐏╂繛鍡愬灲閹瑩鎮滃Ο鐓庡箥闂傚倷绶￠崣蹇曠不閹寸偞娅犻柣妤�鐗勬禍婊堟煛閸愭寧瀚归柣銏╁灲缁绘繂顕ｆ繝姘櫜闁糕剝锚閸斿懘姊洪棃娑氱畾闁瑰啿娲ら‖濠囧Ω閳哄倻鍘鹃梺鍓茬厜缁犳垿宕㈤幑鎰╀汗闁圭儤鎸告禍鐟邦渻閵堝棙顥嗛柛瀣姈缁傛帗绺介崨濞炬嫼闁诲骸婀辨刊顓烆焽閹扮増鐓曢柕濞垮劤娴犮垺銇勯锟介敃銉ヮ焽韫囨稑惟闁挎繂瀚惄搴ㄦ⒒娴ｅ憡鎯堟繛灞傚姂瀹曚即骞樼紒妯哄壒閻庣櫢鎷烽柨鐔烘櫕濡叉劙骞掑Δ濠冩櫓缂佺偓濯芥禍顒勫触鐎ｎ�棃鎮╅棃娑楁勃闂佹寧娲忛崹浠嬫偘椤曪拷瀹曞爼濡搁敃锟介鎾绘⒑闂堚晛鐦滈柛姗�绠栭崺銏″緞閹邦厸鎷婚梺绋挎湰閻燂妇绮婇悧鍫㈢濠㈣泛顑嗙粈瀣拷瑙勬礃婵炲﹪寮崘顔肩＜婵﹢纭搁崬鐢告⒒娴ｈ姤纭堕柛锝忕畵楠炲繘鏁撻敓锟�?,婵犵數濮烽弫鍛婃叏閻戣棄鏋侀柛娑橈攻閸欏繘鏌ｉ幋锝嗩棄闁哄绶氶弻鐔兼⒒鐎靛壊妲紒鐐劤椤兘寮婚敐鍛傜喎鈻庨幆褎顔勭紓鍌欒兌婵挳鎮樺璺何﹂柛鏇ㄥ枤閻わ拷闂佸湱鍋撻幆灞轿涢悙鐢电＝濞达絿鏅崼顏堟煕婵犲啰绠炵�殿喖顭烽弫鍐晸閸婄喓浜介梻浣虹帛閼归箖顢氶鐘电焼闁糕剝銇涢弨浠嬫煟閹邦厽缍戦柣蹇ョ畵閹筹綁濡舵径瀣幐闂佽法鍠曟慨銈囩矉閹烘棑鎷烽敐搴′簻闁跨喓鏅弫濠氬蓟閵娿儮鏀介柛鈩冪懃閸ゎ剛绱撴担闈涘妞ゎ厾鍏樺璇测槈濮樼偓瀚归柨婵嗙凹缁ㄤ粙寮崼婵冩斀妞ゆ梻銆嬮弨缁樹繆閻愯埖顥夐摶鐐烘煕閹扳晛濡锋俊鎻掔墛閹便劌顫滈崱妤�鈷掗梺鍝勬－閸嬪懐鎹㈠┑瀣仺闂傚牊绋愮划鍫曟⒑濞茶绨烽柛妤�鍟块悾宄扳攽閸ャ劌鍔呴梺闈涚箞閸ㄦ槒銇愭ィ鍐┾拺闁告繂瀚婵嬫煕閻樺弶顥㈢�规洘鍨垮畷銊э拷娑欘焽閸橀亶姊虹涵鍛劷闁告柨绉撮埢宥夊炊椤掍胶鍘卞┑鈽嗗灠濠�閬嶆儗濞嗘劖鍙忓┑鐘插暞閵囨繃顨ラ悙鏉戝闁诡垱妫冮弫鎰板炊閳哄倹顔撻梻鍌氬�烽懗鍫曞箠閹捐鐤柛褎顧傞崶顒佸仺缂佸瀵ч悗顒勬⒑鐟欏嫬鍔ゅ褍瀛╅妵娆撳箮閼恒儱锟界敻鏌ㄥ┑鍡涱�楀ù婊勭矌閿熺晫鎳撻幗婊堬綖閹跨灜ate==0.");
					fire.pb.talk.MessageMgr.sendMsgNotify(roleid, 141711, null);
					return false;
				}
				if (task.getConf().exeIndo.share == 0) {
					//婵犵數濮烽弫鍛婃叏閻戣棄鏋侀柛娑橈攻閸欏繘鏌ｉ幋锝嗩棄闁哄绶氶弻鐔兼⒒鐎靛壊妲紒鐐劤椤兘寮婚敐澶婄疀妞ゆ帊鐒﹂崕鎾绘⒑閹肩偛濡奸柛濠傛健瀵鈽夐姀鈺傛櫇闂佹寧绻傚Λ娑⑺囬妷褏纾藉ù锝呮惈灏忛梺鍛婎殕婵炲﹤顕ｇ拠娴嬫婵☆垶鏀遍弬锟介梻浣告啞濞诧箓宕戦崟顒佸弿闁靛繈鍊栭埛鎴炵箾閼奸鍤欐鐐搭殜閺岀喖鎮烽悧鍫濇灎閻庢鍠栭…鐑藉箖閵忋倖鎯為柛锔诲弿缁辨煡姊绘笟锟藉褏鎹㈤幒鎾村弿闁汇垹鎲￠崐鍫曟煕椤愮姴鍔滈柍閿嬪灦缁绘盯鎳犳０婵嗘濡ょ姷鍋為〃鍡涘Φ閸曨垰惟闁靛鍨甸崥顐︽倵濞堝灝鏋︽い鏇嗗浂鏁囬柛蹇曞帶缁剁偛鈹戦悩鎻掝仼妤犵偞鍔曢埞鎴︽倷閼搁潧娑х紓浣藉紦缁瑩鐛径鎰伋闁哄倶鍎查悘渚�鏌ｉ悩鐑樸�冮悹锟介敃锟介妴鎺撶節濮橆厾鍘梺鍓插亝缁诲倿鏁撻悾灞惧殌闁宠绉瑰顕�宕奸悢鍝勫箥闂備礁鎲￠崹顖炲磹閺嶎偓鎷峰鐐?
					fire.pb.mission.PCommitMajorMission taskproc=
							new fire.pb.mission.PCommitMajorMission(roleid, scenarioquestid, true, true);
					if (mkdb.Transaction.current() == null)
						taskproc.submit();
					else
						taskproc.call();
				} else {
					//闂傚倸鍊搁崐鎼佸磹閹间礁纾归柟闂寸绾惧綊鏌熼梻瀵割槮缁炬儳缍婇弻锝夊箣閿濆憛鎾绘煕閵堝懎顏柡灞剧洴椤㈡洟鏁愰崱娆欑穿闂備浇娉曢崰鎰板几閼姐倗涓嶉柟鎯х－閺嗭箑鈹戦崒婊庣劸妞ゎ偄鎳橀弻宥夊Ψ閵夈儲姣愮紓浣靛妸閸庨潧顫忕紒妯诲闁告縿鍎虫闂備胶顭堥鍛存晝椤忓嫮鏆︾憸鐗堝俯閺佸棗霉閿濆嫯顒熸繛鍙夋倐濮婃椽鎳￠妶鍛亪闂佺顑呴敃顏堝箖閵忋倕骞㈡繛鎴炵懅閸橀箖姊鸿ぐ鎺擄紵闁绘帪绠戦埥澶庮槻闁宠鍨块、娆撴嚃閳轰緡鏉搁梻渚�娼уú銈囷拷姘卞娣囧﹪鎮滈挊澹┿劍銇勯弽銊х畵闁诡垰鐗撳缁樻媴閸涘﹥鍎撻梺鍏兼た閸ㄥ磭鍒掗弮鍫熷仭闁规鍠楀▓鎯ь渻閵堝棗濮х紒鐘冲灩缁牏锟斤綆鍋佹禍婊堟煙娴煎瓨娑у褜鍨堕幃妤�顫濇潏銊ユ畬闂佸疇顫夐崹鍧楀箖閳哄喛鎷烽崷顓炐㈡い銉︾箞濮婅櫣绱掑Ο璇查瀺缂備浇顕ч悧鎾愁嚕婵犳碍鏅搁柣妯垮皺閸婄偤姊洪棃娑辨Ф闁稿氦娅曠粋鎺撱偅閸愨斁鎷虹紓鍌欑劍钃遍悘蹇曟暬閺屾盯鎮╁畷鍥р拰閻庢鍠栭…鐑藉极閹剧粯鍋愰柤纰卞墾缁卞弶绻濋悽闈涗沪闁搞劌鐖奸弫鍐煛閸涱厼鎯為柣搴秵閸犳鍩涢幋锔藉仭婵炲棗绻愰鈺冪磼閹绘帩鐓奸柡宀�鍠撻幏鐘侯槾缂佲槄鎷锋俊銈囧Х閸嬫盯鎮ч幘缈犵箚闁归棿鐒﹂弲婊堟煕閹炬鎳忛～宀勬⒒閸屾瑧鍔嶉柟顔肩埣瀹曟洟顢氶敓钘夘嚕閹绘巻鏀介悗锝庝簼鏉堝牆顪冮妶鍡楀Ё闂傚嫬瀚伴崺娑㈠箣閿旂晫鍘卞┑鐘绘涧濡顢旈锔界厽闁圭儤娲樼涵鍓佺磼鏉堛劍灏い鎾炽偢瀹曠喖顢橀悩闈涘簥闂佽瀛╅鏍闯椤曪拷瀹曟垶绻濋崶鈺佺ウ濠碘槅鍨甸崑鎰閸忛棿绻嗘い鏍ㄧ矌鐢稒銇勮箛鏇炴灈婵﹦绮幏鍛存嚍閵壯侊拷濠囨⒑闂堚晝绉剁紒鐘虫崌閻涱喛绠涘☉娆愭闂佽法鍣﹂幏锟�?
					fire.pb.mission.PCommitMajorMission taskproc=
							new fire.pb.mission.PCommitMajorMission(roleid, scenarioquestid, true, true);
					if (mkdb.Transaction.current() == null)
						taskproc.submit();
					else
						taskproc.call();
				}
			} else if(buffagent.existBuff(BuffConstant.StateType.STATE_TEAM) && !buffagent.existBuff(BuffConstant.StateType.STATE_TEAM_LEADER)) {
				Module.logger.info("闂傚倸鍊搁崐鎼佸磹閹间礁纾归柟闂寸绾惧湱锟界懓瀚崳纾嬨亹閹烘垹鍊為悷婊冪箻瀵娊鏁冮崒娑氬幗闂侀潧绻堥崺鍕倿閸撗呯＜闁归偊鍙庡▓婊堟煛瀹�锟介崰鏍嵁瀹ュ鏁婄痪鎷岄哺濮ｅ姊绘担渚劸妞ゆ垶鍨归幑銏犫攽鐎ｎ亣鎽曢梺闈浥堥弲娑氱尵瀹ュ鐓曢悘鐐插⒔閻擃垰顭跨憴鍕婵﹥妞藉畷顐﹀礋椤掑锛佺紓鍌欑贰閸犳骞戦崶褜鍤曞┑鐘崇閺呮彃顭跨捄鐚存敾妞ゃ儲绻堝娲捶椤撗呭姼闁诲孩绋堥弲鐘茬暦娴兼潙绠涢柣妤�鐗冮幏铏圭磽閸屾瑧鍔嶆い顓炴川缁顫濋鐘殿啎婵犮垼娉涢鍥洪幘顔界厱闁冲搫鍟禒杈殽閻愬樊鍎旈柡浣稿暣閺佹捇鎮剧仦绛嬫婵犻潧鍊搁幉锟犳偂閵夆晜鐓涢柛鎰╁妽婢跺嫭銇勯妷銉Ч闁靛洤瀚粻娑㈠Ψ閿曪拷椤忥拷" + roleid + "]婵犵數濮烽弫鍛婃叏閻戣棄鏋侀柛娑橈攻閸欏繘鏌ｉ幋锝嗩棄闁哄绶氶弻鐔兼⒒鐎靛壊妲紒鐐劤椤兘寮婚敐鍛傜喎鈻庨幆褎顔勭紓鍌欒兌婵挳鎮樺璺何﹂柛鏇ㄥ枤閻わ拷闂佸湱鍋撻幆灞轿涢妶鍥╃＝濞撴艾锕ョ�氳绻濋悽闈浶㈡繛璇х畵閹繝濡烽埡鍌滃幗闂佸搫鍟ù鍌炲吹濞嗘垶鍋栨慨妯夸含绾捐棄霉閿濆牊顏犻悽顖涚〒缁辨帞锟斤綆鍋勭粭鎺撱亜閺囨ê鍔︾�规洜鍠栭、姗�濡搁敃锟介鍫曟⒑閹稿海绠撳Δ鐘叉啞缁傚秹鎮欏ǎ顑跨盎闂佹寧鏌ㄩ悘婵嗙暤閸℃稒鐓欐い鏃傜摂濞堟棃鏌嶇紒妯诲磳鐎规洖缍婇、娆撴偩鐏炲�熸嫬闂傚倸鍊烽懗鍫曗�﹂崼銉晞闁告稑鐡ㄩ弲婵嬫煏婢舵稑顩柍鐟扮Т閳规垿鎮╅崣澶婎槱闂佹悶鍊曢澶婎潖婵犳艾閱囬柣鏃�浜介敓鑺ュ笧缁辨帡骞囬闂存闂佸搫鐭夌徊楣冨箚閺冨牜鏁嶆繝濠傛啗閿濆鈷戦柛娑橈攻鐏忎即鏌ｉ悤鍌滅暤妤犵偛鐗撴俊鎼佸煛娴ｄ警鍟囧┑鐐舵彧缁蹭粙宕㈠鍫濈缂備焦顭囩粻楣冨级閸繂鈷旈柟顔笺偢閺岋綁鍩勯崘鈺冨弳濡炪値鍘煎ú顓㈢嵁閸ヮ剚鍋嬮柛顐犲灩楠炲牓姊洪悷鏉挎倯闁伙綆浜畷纭呫亹閹烘垹鍘洪梺鍝勬川婵挳骞忔搴㈠枂闁告洦鍓欓ˇ鈺呮⒑閹肩偛濮�婵炲鐩幃楣冩偪椤栨ü姹楅梺鍦劋缁诲啴寮查鍫熲拺闁告稑锕ｇ欢閬嶆煕濡湱鐭欐い銏＄懇瀹曟帡鎮欑划瑙勫濠电偠鎻徊鍧楀磿閵堝鍚归柨鐔剁矙閺岋綀绠涢幘鍓侇唶闂佺娅曢敃銏ゆ偘椤旇法鐤�婵炴垶鐟﹀▍銏ゆ⒑鐠恒劌娅愰柟鍑ゆ嫹" + useitemid + "],婵犵數濮烽弫鍛婃叏閻戣棄鏋侀柛娑橈攻閸欏繘鏌ｉ幋锝嗩棄闁哄绶氶弻鐔兼⒒鐎靛壊妲紒鎯у⒔缁垳鎹㈠☉銏犵婵炲棗绻掗崝鎾⒑鏉炴壆顦︽い鎴濇婵＄敻宕熼姘鳖啋闁荤姾娅ｉ崕銈夋倵妤ｅ啯鈷戦柛娑橈功閹冲啰绱掔紒妯哄闁诲繐鍟村娲箰鎼达絿鐣甸梺鐟板暱闁帮絽顕ｉ幖浣肝у璺侯儑閸樺憡绻涙潏鍓у埌濠㈢懓锕畷鏇㈠箣閿旂晫鍘甸梺鍦帛鐢宕悙鐑樼厵妞ゆ牗绋掗ˉ鍫濃攽閳╁啯鍊愬┑锛勬焿椤︽挳鏌℃径澶岀煓婵﹦绮粭鐔兼晸閽樺鐒界憸鎴炴櫠濠靛鈷戦柛婵嗗閸ｈ櫣绱掗鑺ュ碍闁伙絿鍏橀獮鍥级閸ф鏆呮繝寰锋澘锟芥捇鎳楅崼鏇炵煑闁糕剝绋掗埛鎴犵磽娴ｈ偂鎴犵矆閿熶粙姊虹粙鍖″伐婵狅拷闁秵鏅搁柤鎭掑劤閸熸煡鏌熼崙銈嗗" + scenarioquestid + "],闂傚倸鍊搁崐鎼佸磹閹间礁纾归柟闂寸绾惧綊鏌熼梻瀵割槮缁惧墽鎳撻—鍐拷锝庝簼閹癸綁鏌ｉ鐐搭棞闁靛棙甯掗～婵嬫倷椤掞拷椤忚埖淇婇妶鍥ラ柛瀣仱閹囨偐濮瑰浄鎷锋笟锟藉鎾閳╁啯鐝曢梻浣藉Г閿氭い锔诲枤缁辨棃寮撮姀鈾�鎷绘繛杈剧秬濞咃綁濡存繝鍥ㄧ厱闁规儳顕粻鐐烘煙閽樺锟藉鏁撻弬銈囩У闁哥姵鐗犻幃娆愮節閸愶缚绨婚梺鐟版惈缁夊墎鎷归悧鍫滅箚妞ゆ劑鍨归弳娆撴煃鐟欏嫬鐏撮柟顔界懃椤斿繘顢欓崗纰卞晙濠碉紕鍋戦崐鏍暜閻旇桨鐒婃繛鍡樺灦椤洟鏌ｉ幇顒夊殶闁荤喎缍婇弻銊╂偄缂佹﹩妫勫銈嗘穿缂嶄線銆侀弴銏℃櫇闁跨喓鏅竟鏇熺附閸涘﹦鍘介梺褰掑亰閸樼晫绱為幋锔界厽鐟滃秶锟芥凹鍘鹃幑銏犫攽鐎ｎ亶娼婇梺鎸庣箓閹虫劙宕㈤锔解拺闁圭娴烽。鑼磼缂佹娲寸�规洜鍘ч埞鎴﹀礋椤愨�冲灊闂傚倷绀侀幖顐︽儗婢跺苯绶ゅΔ锝呭暙缁犳岸鏌￠崘銊у闁哄拋鍓熼弻娑㈠即閵娿儱绠哄┑鐐茬墱閸ㄨ泛顫忕紒妯诲濞撴凹鍨抽崝绋库攽椤旀枻鍏梻鍕缁顓兼径妯绘櫌闂佸憡娲﹂崜姘枍閵忋倖鈷戦柛蹇涙？閼割亪鏌涙惔銊ゆ喚鐎规洜鏁婚、妤呭礋椤掑倸骞堥梻浣瑰缁诲倻鎹㈤幒鏃傜煋妞ゆ梻鐡斿▓浠嬫煟閹邦厼绲婚柡鍡秮閺岀喖顢欓悾宀�鐓傜紓渚囧枤閺佹悂鏁撻弬銈囩У闁稿鎳庨埢宥呯暆閸曨兘鎷绘繛杈剧秬婵倗娑甸崼鏇熺厱闁绘灏欒倴闂佸憡甯楃敮鎺楀煝鎼淬劌绠婚柧蹇ｅ亝琚ｉ梻鍌欑窔濞佳嚶ㄩ敓鐣岀磼閻樺啿鐏╂繛鍡愬灲閹瑩鎮滃Ο鐓庡箥闂傚倷绶￠崣蹇曠不閹寸偞娅犻柣妤�鐗勬禍婊堟煛閸愭寧瀚归柣銏╁灲缁绘繈鐛崘銊庢棃宕橀埡浣圭�梻浣告啞濞诧箓宕滃☉鈶哄洭濡烽妷銏℃杸闂佺粯鍔曞Ο濠傤瀶瑜忕槐鎺楁偐閾忣偄纾抽悗娈垮櫘閸嬪﹪鐛Ο鑲╃＜婵☆垵妗ㄥЧ妤呮⒒娴ｅ憡鍟為柛鏃�锚椤曪綁骞樼拠鑼槺闂佸搫绋侀崢浠嬪煕閹烘嚚褰掓晲閸涱喗鍠愮紓浣割槹濡炰粙寮诲☉姘炬嫹閿濆簼鎮嶉棅顒夊墰閿熷�燁潐濞叉垿宕￠崘宸殨濞寸姴顑愰弫鍥煟閹邦厼绲绘繛鍫涘�栫换婵嬫偨闂堟稐娌梺鎼炲妼閻栧ジ骞冮悜鑺ユ櫇闁稿本姘ㄩ悡鎴︽椤愩垺澶勯柟鍛婃尦瀵劍绂掔�ｎ偆鍘藉┑鈽嗗灥椤曆呭緤婵犳碍鐓ラ柣鏃傜帛椤ュ鏌ｉ弽顐㈠付闁伙絿鍏橀獮瀣晝閿熶粙锝為崨瀛樼厪闁割偅绻冮ˉ鐘绘煕濮楋拷濞佳団�旈崘顔嘉ч柛鈩冾焽閸欏棝姊洪崷顓涙嫛闁稿锕獮鍐潨閿熶粙骞婇悩娲绘晢濠电姴鍟鍫曟煟閻斿摜鎳冮悗姘煎幘缁牓宕橀埞澶哥盎闂侀潧顭堥崕璇差啅閵夆晜鐓熼柨婵嗘噹濡插鎽堕弽顓熺厱婵炴垵宕弸娑欑箾閸喎濮嶆慨濠冩そ瀹曟﹢宕ｆ径瀣壍闂備胶顭堥敃銉╁礉濞嗘挸鏋侀柟鍓х帛閺呮悂鏌ㄩ悤鍌涘.");
				fire.pb.mission.PCommitMajorMission taskproc=
						new fire.pb.mission.PCommitMajorMission(roleid, scenarioquestid, true, true);
				if (mkdb.Transaction.current() == null)
					taskproc.submit();
				else
					taskproc.call();
			} else {
				if (task.getConf().exeIndo.teamState == 2) {
					Module.logger.info("闂傚倸鍊搁崐鎼佸磹閹间礁纾归柟闂寸绾惧湱锟界懓瀚崳纾嬨亹閹烘垹鍊為悷婊冪箻瀵娊鏁冮崒娑氬幗闂侀潧绻堥崺鍕倿閸撗呯＜闁归偊鍙庡▓婊堟煛瀹�锟介崰鏍嵁瀹ュ鏁婄痪鎷岄哺濮ｅ姊绘担渚劸妞ゆ垶鍨归幑銏犫攽鐎ｎ亣鎽曢梺闈浥堥弲娑氱尵瀹ュ鐓曢悘鐐插⒔閻擃垰顭跨憴鍕婵﹥妞藉畷顐﹀礋椤掑锛佺紓鍌欑贰閸犳骞戦崶褜鍤曞┑鐘崇閺呮彃顭跨捄鐚存敾妞ゃ儲绻堝娲捶椤撗呭姼闁诲孩绋堥弲鐘茬暦娴兼潙绠涢柣妤�鐗冮幏铏圭磽閸屾瑧鍔嶆い顓炴川缁顫濋鐘殿啎婵犮垼娉涢鍥洪幘顔界厱闁冲搫鍟禒杈殽閻愬樊鍎旈柡浣稿暣閺佹捇鎮剧仦绛嬫婵犻潧鍊搁幉锟犳偂閵夆晜鐓涢柛鎰╁妽婢跺嫭銇勯妷銉Ч闁靛洤瀚粻娑㈠Ψ閿曪拷椤忥拷" + roleid + "]婵犵數濮烽弫鍛婃叏閻戣棄鏋侀柛娑橈攻閸欏繘鏌ｉ幋锝嗩棄闁哄绶氶弻鐔兼⒒鐎靛壊妲紒鐐劤椤兘寮婚敐鍛傜喎鈻庨幆褎顔勭紓鍌欒兌婵挳鎮樺璺何﹂柛鏇ㄥ枤閻わ拷闂佸湱鍋撻幆灞轿涢妶鍥╃＝濞撴艾锕ョ�氳绻濋悽闈浶㈡繛璇х畵閹繝濡烽埡鍌滃幗闂佸搫鍟ù鍌炲吹濞嗘垶鍋栨慨妯夸含绾捐棄霉閿濆牊顏犻悽顖涚〒缁辨帞锟斤綆鍋勭粭鎺撱亜閺囨ê鍔︾�规洜鍠栭、姗�濡搁敃锟介鍫曟⒑閹稿海绠撳Δ鐘叉啞缁傚秹鎮欏ǎ顑跨盎闂佹寧鏌ㄩ悘婵嗙暤閸℃稒鐓欐い鏃傜摂濞堟棃鏌嶇紒妯诲磳鐎规洖缍婇、娆撴偩鐏炲�熸嫬闂傚倸鍊烽懗鍫曗�﹂崼銉晞闁告稑鐡ㄩ弲婵嬫煏婢舵稑顩柍鐟扮Т閳规垿鎮╅崣澶婎槱闂佹悶鍊曢澶婎潖婵犳艾閱囬柣鏃�浜介敓鑺ュ笧缁辨帡骞囬闂存闂佸搫鐭夌徊楣冨箚閺冨牜鏁嶆繝濠傛啗閿濆鈷戦柛娑橈攻鐏忎即鏌ｉ悤鍌滅暤妤犵偛鐗撴俊鎼佸煛娴ｄ警鍟囧┑鐐舵彧缁蹭粙宕㈠鍫濈缂備焦顭囩粻楣冨级閸繂鈷旈柟顔笺偢閺岋綁鍩勯崘鈺冨弳濡炪値鍘煎ú顓㈢嵁閸ヮ剚鍋嬮柛顐犲灩楠炲牓姊洪悷鏉挎倯闁伙綆浜畷纭呫亹閹烘垹鍘洪梺鍝勬川婵挳骞忔搴㈠枂闁告洦鍓欓ˇ鈺呮⒑閹肩偛濮�婵炲鐩幃楣冩偪椤栨ü姹楅梺鍦劋缁诲啴寮查鍫熲拺闁告稑锕ｇ欢閬嶆煕濡湱鐭欐い銏＄懇瀹曟帡鎮欑划瑙勫濠电偠鎻徊鍧楀磿閵堝鍚归柨鐔剁矙閺岋綀绠涢幘鍓侇唶闂佺娅曢敃銏ゆ偘椤旇法鐤�婵炴垶鐟﹀▍銏ゆ⒑鐠恒劌娅愰柟鍑ゆ嫹" + useitemid + "],婵犵數濮烽弫鍛婃叏閻戣棄鏋侀柛娑橈攻閸欏繘鏌ｉ幋锝嗩棄闁哄绶氶弻鐔兼⒒鐎靛壊妲紒鎯у⒔缁垳鎹㈠☉銏犵婵炲棗绻掗崝鎾⒑鏉炴壆顦︽い鎴濇婵＄敻宕熼姘鳖啋闁荤姾娅ｉ崕銈夋倵妤ｅ啯鈷戦柛娑橈功閹冲啰绱掔紒妯哄闁诲繐鍟村娲箰鎼达絿鐣甸梺鐟板暱闁帮絽顕ｉ幖浣肝у璺侯儑閸樺憡绻涙潏鍓у埌濠㈢懓锕畷鏇㈠箣閿旂晫鍘甸梺鍦帛鐢宕悙鐑樼厵妞ゆ牗绋掗ˉ鍫濃攽閳╁啯鍊愬┑锛勬焿椤︽挳鏌℃径澶岀煓婵﹦绮粭鐔兼晸閽樺鐒界憸鎴炴櫠濠靛鈷戦柛婵嗗閸ｈ櫣绱掗鑺ュ碍闁伙絿鍏橀獮鍥级閸ф鏆呮繝寰锋澘锟芥捇鎳楅崼鏇炵煑闁糕剝绋掗埛鎴犵磽娴ｈ偂鎴犵矆閿熶粙姊虹粙鍖″伐婵狅拷闁秵鏅搁柤鎭掑劤閸熸煡鏌熼崙銈嗗" + scenarioquestid + "],濠电姷鏁告慨鐑藉极閸涘﹥鍙忛柣鎴ｆ閺嬩線鏌涘☉姗堟敾闁告瑥绻橀弻锝夊箣閿濆棭妫勯梺鍝勵儎缁舵岸寮婚悢鍏尖拻閻庨潧澹婂Σ顔剧磼閹冣挃缂侇噮鍨抽幑銏犫槈閵忕姷顓洪梺缁樺姇閻忔岸宕宠缁辨挻鎷呯粙娆炬殺闂佺顑冮崐婵嗩嚕鐠囨祴妲堥柕蹇曞閵婏负浜滈柡鍐ㄥ�哥敮鑸点亜椤愮喐娅囩紒杈ㄦ尰缁楃喐绻濋崘顭戜紦闂傚倷绀佹竟濠囧磻閸℃稑绐楅柟鎹愭硾婵剟鏌ㄩ悢鍓佺煓婵﹤顭峰畷鎺戭潩閸楃儐鏉哥紓鍌欑椤戝棛鏁敓鐘叉瀬鐎广儱顦猾宥夋煕椤愩倕鏋旈柛姗�绠栧娲传閸曞灚歇濠电偛顦板ú妯肩矉閹烘顫呴柕鍫濇閸橆亪姊虹化鏇炲⒉闁挎氨绱掑Δ浣哥瑲闁靛洤瀚伴、鏇㈡晲閸モ晝鏉介梻浣筋嚃閸犳鎮烽埡鍛拷浣肝旈崨顔芥婵炲濮撮鎰板极閸岀偞鐓犻柛婵勫劜閺嗏晝绱掗埥鍛濠电姷鏁搁崑娑㈡偋閸℃稒鍊舵繝闈涱儏閸戠姵绻涢幋娆忕仾闁绘挶鍎甸弻锟犲炊椤浜弫鎾绘嚍閵壯呯暫婵烇絽娲ら敃顏勭暦婵傜鍗抽柣鎰問閸熷洤鈹戦悙鑸靛涧缂佽弓绮欓獮妤�顭ㄩ崼鐔蜂患濠电偛妯婃禍婵嬪煕閹达附鈷掗柛顐ゅ枔閵嗘帞绱掗悩闈涗槐闁哄本绋掔换婵嬪礃閳哄喚妲剁紓鍌欑贰閸犳牠鎮ч幘宕囨殾闁绘挸瀵掗悢鍡樼節闂堟稒顥犵紒澶嬫そ閺屸剝鎷呴悷鏉款潚閻庤娲滈崰鏍�佸璺哄窛妞ゆ挾鍊ｉ妶鍛斀闁绘灏欏Λ鍕煏閸繈顎楁繛鍫熺箞濮婃椽鎮烽弶鎸庮唨闂佺懓鍤栭幏锟�,婵犵數濮烽弫鍛婃叏閻戣棄鏋侀柛娑橈攻閸欏繘鏌ｉ幋锝嗩棄闁哄绶氶弻鐔兼⒒鐎靛壊妲紒鐐劤椤兘寮婚敐鍛傜喎鈻庨幆褎顔勭紓鍌欒兌婵挳鎮樺璺何﹂柛鏇ㄥ枤閻わ拷闂佸湱鍋撻幆灞轿涢悙鐢电＝濞达絿鏅崼顏堟煕婵犲啯绀嬫繝锟芥笟锟藉铏圭磼濡浚浜滆灒濠电姴娲ょ壕鍧楃叓閸ャ劎鈾侀柣鎾寸洴閹鏁愰崒娑欑彇缂備焦鍔栧Λ鍐蓟閿涘嫪娌柛鎾楀嫬鍨遍梻浣筋嚃閸犳鍒掗幘宕囨殾闁割偅娲栨儫闂侀潧顦介崰鏇犳椤╁檲State==2.");
					onFail(roleid);
					return false;
				}
				Module.logger.info("闂傚倸鍊搁崐鎼佸磹閹间礁纾归柟闂寸绾惧湱锟界懓瀚崳纾嬨亹閹烘垹鍊為悷婊冪箻瀵娊鏁冮崒娑氬幗闂侀潧绻堥崺鍕倿閸撗呯＜闁归偊鍙庡▓婊堟煛瀹�锟介崰鏍嵁瀹ュ鏁婄痪鎷岄哺濮ｅ姊绘担渚劸妞ゆ垶鍨归幑銏犫攽鐎ｎ亣鎽曢梺闈浥堥弲娑氱尵瀹ュ鐓曢悘鐐插⒔閻擃垰顭跨憴鍕婵﹥妞藉畷顐﹀礋椤掑锛佺紓鍌欑贰閸犳骞戦崶褜鍤曞┑鐘崇閺呮彃顭跨捄鐚存敾妞ゃ儲绻堝娲捶椤撗呭姼闁诲孩绋堥弲鐘茬暦娴兼潙绠涢柣妤�鐗冮幏铏圭磽閸屾瑧鍔嶆い顓炴川缁顫濋鐘殿啎婵犮垼娉涢鍥洪幘顔界厱闁冲搫鍟禒杈殽閻愬樊鍎旈柡浣稿暣閺佹捇鎮剧仦绛嬫婵犻潧鍊搁幉锟犳偂閵夆晜鐓涢柛鎰╁妽婢跺嫭銇勯妷銉Ч闁靛洤瀚粻娑㈠Ψ閿曪拷椤忥拷" + roleid + "]婵犵數濮烽弫鍛婃叏閻戣棄鏋侀柛娑橈攻閸欏繘鏌ｉ幋锝嗩棄闁哄绶氶弻鐔兼⒒鐎靛壊妲紒鐐劤椤兘寮婚敐鍛傜喎鈻庨幆褎顔勭紓鍌欒兌婵挳鎮樺璺何﹂柛鏇ㄥ枤閻わ拷闂佸湱鍋撻幆灞轿涢妶鍥╃＝濞撴艾锕ョ�氳绻濋悽闈浶㈡繛璇х畵閹繝濡烽埡鍌滃幗闂佸搫鍟ù鍌炲吹濞嗘垶鍋栨慨妯夸含绾捐棄霉閿濆牊顏犻悽顖涚〒缁辨帞锟斤綆鍋勭粭鎺撱亜閺囨ê鍔︾�规洜鍠栭、姗�濡搁敃锟介鍫曟⒑閹稿海绠撳Δ鐘叉啞缁傚秹鎮欏ǎ顑跨盎闂佹寧鏌ㄩ悘婵嗙暤閸℃稒鐓欐い鏃傜摂濞堟棃鏌嶇紒妯诲磳鐎规洖缍婇、娆撴偩鐏炲�熸嫬闂傚倸鍊烽懗鍫曗�﹂崼銉晞闁告稑鐡ㄩ弲婵嬫煏婢舵稑顩柍鐟扮Т閳规垿鎮╅崣澶婎槱闂佹悶鍊曢澶婎潖婵犳艾閱囬柣鏃�浜介敓鑺ュ笧缁辨帡骞囬闂存闂佸搫鐭夌徊楣冨箚閺冨牜鏁嶆繝濠傛啗閿濆鈷戦柛娑橈攻鐏忎即鏌ｉ悤鍌滅暤妤犵偛鐗撴俊鎼佸煛娴ｄ警鍟囧┑鐐舵彧缁蹭粙宕㈠鍫濈缂備焦顭囩粻楣冨级閸繂鈷旈柟顔笺偢閺岋綁鍩勯崘鈺冨弳濡炪値鍘煎ú顓㈢嵁閸ヮ剚鍋嬮柛顐犲灩楠炲牓姊洪悷鏉挎倯闁伙綆浜畷纭呫亹閹烘垹鍘洪梺鍝勬川婵挳骞忔搴㈠枂闁告洦鍓欓ˇ鈺呮⒑閹肩偛濮�婵炲鐩幃楣冩偪椤栨ü姹楅梺鍦劋缁诲啴寮查鍫熲拺闁告稑锕ｇ欢閬嶆煕濡湱鐭欐い銏＄懇瀹曟帡鎮欑划瑙勫濠电偠鎻徊鍧楀磿閵堝鍚归柨鐔剁矙閺岋綀绠涢幘鍓侇唶闂佺娅曢敃銏ゆ偘椤旇法鐤�婵炴垶鐟﹀▍銏ゆ⒑鐠恒劌娅愰柟鍑ゆ嫹" + useitemid + "],婵犵數濮烽弫鍛婃叏閻戣棄鏋侀柛娑橈攻閸欏繘鏌ｉ幋锝嗩棄闁哄绶氶弻鐔兼⒒鐎靛壊妲紒鎯у⒔缁垳鎹㈠☉銏犵婵炲棗绻掗崝鎾⒑鏉炴壆顦︽い鎴濇婵＄敻宕熼姘鳖啋闁荤姾娅ｉ崕銈夋倵妤ｅ啯鈷戦柛娑橈功閹冲啰绱掔紒妯哄闁诲繐鍟村娲箰鎼达絿鐣甸梺鐟板暱闁帮絽顕ｉ幖浣肝у璺侯儑閸樺憡绻涙潏鍓у埌濠㈢懓锕畷鏇㈠箣閿旂晫鍘甸梺鍦帛鐢宕悙鐑樼厵妞ゆ牗绋掗ˉ鍫濃攽閳╁啯鍊愬┑锛勬焿椤︽挳鏌℃径澶岀煓婵﹦绮粭鐔兼晸閽樺鐒界憸鎴炴櫠濠靛鈷戦柛婵嗗閸ｈ櫣绱掗鑺ュ碍闁伙絿鍏橀獮鍥级閸ф鏆呮繝寰锋澘锟芥捇鎳楅崼鏇炵煑闁糕剝绋掗埛鎴犵磽娴ｈ偂鎴犵矆閿熶粙姊虹粙鍖″伐婵狅拷闁秵鏅搁柤鎭掑劤閸熸煡鏌熼崙銈嗗" + scenarioquestid + "],濠电姷鏁告慨鐑藉极閸涘﹥鍙忛柣鎴ｆ閺嬩線鏌涘☉姗堟敾闁告瑥绻橀弻锝夊箣閿濆棭妫勯梺鍝勵儎缁舵岸寮婚悢鍏尖拻閻庨潧澹婂Σ顔剧磼閹冣挃缂侇噮鍨抽幑銏犫槈閵忕姷顓洪梺缁樺姇閻忔岸宕宠缁辨挻鎷呯粙娆炬殺闂佺顑冮崐婵嗩嚕鐠囨祴妲堥柕蹇曞閵婏负浜滈柡鍐ㄥ�哥敮鑸点亜椤愮喐娅囩紒杈ㄦ尰缁楃喐绻濋崘顭戜紦闂傚倷绀佹竟濠囧磻閸℃稑绐楅柟鎹愭硾婵剟鏌ㄩ悢鍓佺煓婵﹤顭峰畷鎺戭潩閸楃儐鏉哥紓鍌欑椤戝棛鏁敓鐘叉瀬鐎广儱顦猾宥夋煕椤愩倕鏋旈柛姗�绠栧娲传閸曞灚歇濠电偛顦板ú妯肩矉閹烘顫呴柕鍫濇閸橆亪姊虹化鏇炲⒉闁挎氨绱掑Δ浣哥瑲闁靛洤瀚伴、鏇㈡晲閸モ晝鏉介梻浣筋嚃閸犳鎮烽埡鍛拷浣肝旈崨顔芥婵炲濮撮鎰板极閸岀偞鐓犻柛婵勫劜閺嗏晝绱掗埥鍛濠电姷鏁搁崑娑㈡偋閸℃稒鍊舵繝闈涱儏閸戠姵绻涢幋娆忕仾闁绘挶鍎甸弻锟犲炊椤浜弫鎾绘嚍閵壯呯暫婵烇絽娲ら敃顏勭暦婵傜鍗抽柣鎰問閸熷洤鈹戦悙鑸靛涧缂佽弓绮欓獮妤�顭ㄩ崼鐔蜂患濠电偛妯婃禍婵嬪煕閹达附鈷掗柛顐ゅ枔閵嗘帞绱掗悩闈涗槐闁哄本绋掔换婵嬪礃閳哄喚妲剁紓鍌欑贰閸犳牠鎮ч幘宕囨殾闁绘挸瀵掗悢鍡樼節闂堟稒顥犵紒澶嬫そ閺屸剝鎷呴悷鏉款潚閻庤娲滈崰鏍�佸璺哄窛妞ゆ挾鍊ｉ妶鍛斀闁绘灏欏Λ鍕煏閸繈顎楁繛鍫熺箞濮婃椽鎮烽弶鎸庮唨闂佺懓鍤栭幏锟�.");
				fire.pb.mission.PCommitMajorMission taskproc=
						new fire.pb.mission.PCommitMajorMission(roleid, scenarioquestid, true, true);
				if (mkdb.Transaction.current() == null)
					taskproc.submit();
				else
					taskproc.call();
			}
			mkdb.Procedure p = new mkdb.Procedure() {
				@Override
				protected boolean process() {
					return fire.pb.item.Module.getInstance().unlockAndDelItem(roleid, useitemid);
				}
			};
			if (mkdb.Transaction.current() == null) {
				p.submit();
			} else {
				p.call();
			}
			return true;
		}
	}
//	private boolean checkAIBattle() {
//		MissionConfig conf = MissionManager.getInstance().getTaskConfig( scenarioquestid );
//		if ( conf == null ) {
//			return false;
//		}
//		if ( Helper.getTaskFinishRequireType( conf.activeInfo.missionType ) == TaskFinishRequire.AREA || 
//				Helper.getTaskExeType( conf.activeInfo.missionType ) == TaskExecuteTypes.USE ) {
//			if ( conf.aiInfo.aIID != 0 ) {
//				new TaskBattle( roleid, conf.aiInfo.aIID, 
//					new TaskAIBattleEndHandler( scenarioquestid, conf.aiInfo.battleResult ),
//					conf.scenarioInfo.animationID ).submit();
//				gnet.link.Onlines.getInstance().send(roleid, new SUseTaskItemFail());
//				return true;
//			}
//		}
//		return false;
//	}
//	private final class PCommitMajorMission extends fire.pb.mission.PCommitMajorMission {
//		private final long memid;
//		PCommitMajorMission( final long memid ) {
//			super(memid, scenarioquestid, new fire.pb.mission.NullCommitParam() );
//			this.memid = memid;
//		}
//		@Override
//		protected boolean taskProcess() {
////			fire.pb.mission.TaskScenarioColumn sml =
////				new fire.pb.mission.TaskScenarioColumn( memid, false );
//			if (roleid == memid) {
//				fire.pb.item.Module.getInstance().unlockAndDelItem( memid );
//			}
//			return super.taskProcess();
////			fire.pb.mission.TaskScenario task = sml.getTask( scenarioquestid );
////			
////			return sml.(scenarioquestid);
//				
//		}
//		
//	}

	// {{{ RPCGEN_DEFINE_BEGIN
	// {{{ DO NOT EDIT THIS
	public static final int PROTOCOL_TYPE = 739904;

	public int getType() {
		return 739904;
	}

	public long roleid;
	public int scenarioquestid;
	public int useitemid;

	public MScenarioQuestUseItemVerifyPosSucc() {
	}

	public MScenarioQuestUseItemVerifyPosSucc(long _roleid_, int _scenarioquestid_, int _useitemid_) {
		this.roleid = _roleid_;
		this.scenarioquestid = _scenarioquestid_;
		this.useitemid = _useitemid_;
	}

	public final boolean _validator_() {
		return true;
	}

	public OctetsStream marshal(OctetsStream _os_) {
		if (!_validator_()) {
			throw new VerifyError("validator failed");
		}
		_os_.marshal(roleid);
		_os_.marshal(scenarioquestid);
		_os_.marshal(useitemid);
		return _os_;
	}

	public OctetsStream unmarshal(OctetsStream _os_) throws MarshalException {
		roleid = _os_.unmarshal_long();
		scenarioquestid = _os_.unmarshal_int();
		useitemid = _os_.unmarshal_int();
		if (!_validator_()) {
			throw new VerifyError("validator failed");
		}
		return _os_;
	}

	public boolean equals(Object _o1_) {
		if (_o1_ == this) return true;
		if (_o1_ instanceof MScenarioQuestUseItemVerifyPosSucc) {
			MScenarioQuestUseItemVerifyPosSucc _o_ = (MScenarioQuestUseItemVerifyPosSucc)_o1_;
			if (roleid != _o_.roleid) return false;
			if (scenarioquestid != _o_.scenarioquestid) return false;
			if (useitemid != _o_.useitemid) return false;
			return true;
		}
		return false;
	}

	public int hashCode() {
		int _h_ = 0;
		_h_ += (int)roleid;
		_h_ += scenarioquestid;
		_h_ += useitemid;
		return _h_;
	}

	public String toString() {
		StringBuilder _sb_ = new StringBuilder();
		_sb_.append("(");
		_sb_.append(roleid).append(",");
		_sb_.append(scenarioquestid).append(",");
		_sb_.append(useitemid).append(",");
		_sb_.append(")");
		return _sb_.toString();
	}

	public int compareTo(MScenarioQuestUseItemVerifyPosSucc _o_) {
		if (_o_ == this) return 0;
		int _c_ = 0;
		_c_ = Long.signum(roleid - _o_.roleid);
		if (0 != _c_) return _c_;
		_c_ = scenarioquestid - _o_.scenarioquestid;
		if (0 != _c_) return _c_;
		_c_ = useitemid - _o_.useitemid;
		if (0 != _c_) return _c_;
		return _c_;
	}

	// DO NOT EDIT THIS }}}
	// RPCGEN_DEFINE_END }}}

}

