
package fire.msp.task;

import fire.pb.battle.PNewBattle;
import fire.pb.buff.BuffAgent;
import fire.pb.buff.BuffConstant;
import fire.pb.buff.BuffRoleImpl;
import fire.pb.mission.MissionBattleEndHandler;
import fire.pb.mission.MissionColumn;
import fire.pb.mission.Module;
import fire.pb.mission.RoleMission;
import fire.pb.mission.SUseMissionItemFail;

// {{{ RPCGEN_IMPORT_BEGIN
// {{{ DO NOT EDIT THIS
import com.locojoy.base.Marshal.OctetsStream;
import com.locojoy.base.Marshal.MarshalException;

abstract class __MScenarioQuestUseItemVerifyPosSucc__ extends mkio.Protocol { }

// DO NOT EDIT THIS }}}
// RPCGEN_IMPORT_END }}}

public class MScenarioQuestUseItemVerifyPosSucc extends __MScenarioQuestUseItemVerifyPosSucc__ {
	@Override
	protected void process() {
		// protocol handle
		dealUseItem(roleid, scenarioquestid, useitemid);
	}
	private static void onFail(final long roleid) {
		if (mkdb.Transaction.current() == null)
			gnet.link.Onlines.getInstance().send(roleid, new SUseMissionItemFail());
		else
			mkdb.Procedure.psend(roleid, new SUseMissionItemFail());
	}
	public static boolean dealUseItem(final long roleid, final int scenarioquestid, final int useitemid) {
		RoleMission task = new MissionColumn(roleid, true).getMission(scenarioquestid);
		if (task == null) {
			return false;
		}
		Module.logger.info("闂傚倸鍊搁崐鎼佸磹閹间礁纾归柟闂寸绾惧綊鏌熼梻瀵割槮缁炬儳婀遍敓鐣屾嚀鐎氼參宕崇壕瀣ㄤ汗闁圭儤鍨归崐鐐烘偡濠婂啰绠荤�殿喗濞婇弫鍐磼濞戞艾骞楅梻渚�娼х换鍫ュ春閸曨垱鍊块柛鎾楀懐锛滈梺褰掑亰閸欏骸鈻撳鍫熺厸鐎癸拷閿熶粙宕伴弽顓犲祦鐎广儱顦介弫濠勭棯閹峰矂鍝烘慨锝咁樀濮婄粯鎷呮笟顖滃姼濡炪倖鍨堕崹褰掑箲閵忕姭鏀介悗锝庝海閹芥洟姊洪棃娴ュ牓寮插☉姘卞暗鐎广儱顦伴悡鏇㈡倶閻愭彃鈷旈柣鎿冨灠椤法鎲撮崟顒傤槹濠殿喖锕ュ钘夌暦椤愶箑绀嬫い鎺戭槹閿涗胶绱撻崒娆戣窗闁哥姵顨婇獮鎴﹀炊瑜滈崵鏇炩攽閻樺磭顣查柡鍛絻椤法鎹勯悮瀛樻暰濡炪們鍎茬换鍫濐潖濞差亜鎹舵い鎾楀懎濮奸梺璇插缁嬪牓寮查悩鑼殾濞村吋娼欑粻娑㈡煟濡わ拷閻楀啴骞忛搹鍦＝闁稿本鐟ч崝宥嗐亜椤撶偞宸濈紒顔款嚙椤繈顢橀悩娈垮晭濠电姰鍨煎▔娑㈩敄閸ヮ灐娲箻椤旂晫鍘遍梺鍐叉惈閸燁偅绂掓潏顭戞闁绘劕妯婇崕鏃堟煛娴ｇ鏆ｉ柡浣规崌閹墽浠︾粵瀣棥濠电娀娼ч崐鎼佸箟閿熺姵鍋傞柕澶嗘櫆閻撴盯鏌涢幇鈺佸濠㈣泛瀚妵鍕Ψ閵夘喗效闂侀潧娲ょ�氼垳绮诲☉銏犖ㄩ柨鏇嫹妞ゅ骏鎷�" + roleid + "]濠电姷鏁告慨鐑藉极閸涘﹥鍙忛柣鎴ｆ閺嬩線鏌涘☉姗堟敾闁告瑥绻橀弻锝夊箣閿濆棭妫勯梺鍝勵儎缁舵岸寮婚悢鍏尖拻閻庨潧澹婂Σ顔剧磼閻愵剙鍔ゆい顓犲厴瀵鏁愰崨鍌滃枎閳诲酣骞嗚椤斿嫮绱撻崒娆掑厡濠殿喗鎸抽幃妯侯潩鐠轰綍锕傛煕閺囥劌鏋ら柣銈忔嫹闂備礁婀遍崑鎾诲箚鐏炶娇娑㈠Χ閸モ晝锛濇繛鎾磋壘閿曘儳锟芥俺顫夌换婵嬫偨闂堟刀銏＄箾鐠囇呯暤闁诡噯绻濇俊鐑藉煛閸屾粌骞楅梻浣告惈閸燁偄霉閸岀偛鍚规繛鍡樺灦閸嬫牗鎱ㄥΟ澶稿惈缁炬崘妫勯湁闁挎繂鐗婇鐘绘偨椤栨稓銆掔紒杈ㄥ笧閿熸枻缍嗛崑鍕箔閹烘挶浜滈柡鍥崝锔撅拷瑙勬礈閸犳牠銆佸锟芥俊鎼佹晝閿熶粙顢旈崼鏇熲拺闁圭娴风粻鎾澄旈悩鍙夊暈缂佸倸绉归幃娆徢庨璺ㄧ泿闂備焦瀵ч弻銊╂倶濠靛棛鏆ら柛鈩冪♁閻撴瑦銇勯弮鍌滄憘婵炲牊妫冮弻宥囩磼濡纾抽悗瑙勬礀缂嶅﹪銆佸▎鎾村仼閻忕偛锟界喐瀚梻鍌氬�搁崐鐑芥嚄閸洍锟斤箓宕奸妷顔芥櫈闂佸憡绋戦悺銊╁疾濠靛鐓忓鑸电☉椤╊剟鏌嶉悷鎵㈤柍瑙勫灴閹晠宕ｆ径濠庢П闂備焦鎮堕崐鏇㈩敄婢跺娼栧┑鐘宠壘闁卞洭鏌ｉ弮锟芥禍浠嬫晸閼恒儱绗х紒杈ㄥ浮楠炲洭顢欓梻瀛橆潟闂備礁鎼惌澶屽緤妤ｅ啫绠氶柡鍐ㄧ墱閺佸秵绻濇繝鍌涘晽闁挎繂顦伴埛鎴︽煕濞戞﹫鏀婚悘蹇庡嵆閺岋綁鎮ら崒婊呮殼濡ょ姷鍋涢悧鎾翠繆閹间礁鐓涘ù锝勮閸熷洤鈹戦悙鑸靛涧缂佽弓绮欏畷銏狀煥閸繄顔嗙紓鍌欑劍椤洨绮绘ィ鍐ㄧ骇闁割偅绻傞埛鏃堟煙椤旂鍋㈤柡宀嬬秮閸╁嫰宕橀埡鍐ㄥ汲婵＄偑鍊ら崢鐓幟洪銏㈠祦闁搞儺鍓氶崑瀣煕椤愮姴鐏╂鐐茬墦濮婃椽鎮烽弶鎸庡�梺浼欑秵娴滎亜鐣风涵鍛汗闁圭儤鍨归崢娲⒑閸濆嫭宸濆┑顖涙尦楠炲繑顦版惔銏犳瀭闂佸憡娲﹂崜娆撍囬埡鍛拺闁硅偐鍋涙慨锟藉┑鐐差槹閻╊垶骞冩ィ鍐╁仾妞ゆ牗眉濮规姊洪崷顓炲妺缂佽鍟村鏌ヮ敂閸啿鎷洪梺鍛婄☉閿曪絿娆㈤柆宥嗙厱婵☆垰婀遍惌娆愩亜閵忥紕鎳囩�规洘甯￠幃娆戝垝鐟欏嫬顏烘繝鐢靛仩閹活亞寰婇崸妤�纾块柕鍫濐槸閸氬綊鏌ㄩ悢鍓佺煓闁哄矉缍�缁犳盯骞橀崜渚囧敹闂備胶顢婂▍鏇㈡晝閵忋倖鍋樻い鏃囨硶閻わ拷濠电偞鍨堕悷锕�鈻嶉姀銈嗏拺閻犳亽鍔屽▍鎰版煙閸戙倖瀚�" + useitemid + "],濠电姷鏁告慨鐑藉极閸涘﹥鍙忛柣鎴ｆ閺嬩線鏌涘☉姗堟敾闁告瑥绻橀弻锝夊箣閿濆棭妫勯梺鍝勵儎缁舵岸寮婚悢鍏尖拻閻庨潧澹婂Σ顔剧磼閹冣挃缂侇噮鍨抽幑銏犫槈閵忕姷顓哄┑鐐叉缁绘帡宕濋幘顔解拺閺夌偞澹嗛ˇ锔姐亜閹存繃顥㈠┑锛勬暬瀹曠喖顢涘槌栧晪闂佽崵濮惧▍锝夊磿閵堝鍊靛Δ锝呭暞閳锋垿鏌涘☉姗堝姛闁瑰啿鍟扮槐鎺旂磼濡搫顫戦梺璇茬箰閸熸潙顫忓ú顏勭閹艰揪绲块悾鐢告⒑閻熸澘鏆遍梺甯到椤曪綁骞栨担鑲澭冾熆鐠轰警鍎戦柛妯烘啞缁绘稒娼忛崜褍鍩屾繝銏㈡嚀閿曨亜鐣烽弴銏犵闁挎梻鏅崢鐢告⒑閸︻厾甯涢悽顖涱殜瀹曨垶鎮欓悜妯煎幍濡炪倖鐗楃粙鎺椝夐崼婵冩斀闁斥晛鍟崐鎰攽閿涘嫭鐒挎い锔芥尦閺屸剝寰勬径宀�鐓撳┑顔硷功缁垳绮悢鍏兼櫢闁芥ê顦介悞鐣屾喐閹寸偞娅犳繝闈涱儐閳锋垿鏌涘┑鍡楊仾闁革綀娅ｇ槐鎺楊敊閼恒儱纰嶉梺浼欑悼閸忔﹢鐛崶顒�绾ч柛褎顨嗛弳鍛節瀵伴攱婢橀敓鑺ユ崌閹虫宕奸弴鐐电厬闂佺硶鍓濈粙鎺楀煕閹寸姷纾藉ù锝堝亗閹寸姷鐭嗛柨鐔剁矙濮婅櫣绮欓崠鈥充紣濠电媴鎷烽梺顒�绉甸弲鎼佹煠閹帒鍔ら柛鐔哥叀閺岀喖宕欓妶鍡楊伓" + scenarioquestid + "]!");
		if (task.getConf().aiInfo.aIID != 0) {
			PNewBattle battle = new PNewBattle(roleid, task.getConf().aiInfo.aIID, 
					new MissionBattleEndHandler(scenarioquestid, task.getConf().aiInfo.battleResult
							, roleid));
			if (mkdb.Transaction.current() == null)
				battle.submit();
			else
				battle.call();
			return true;
		//	gnet.link.Onlines.getInstance().send(roleid, new SUseTaskItemFail());
		} else {
			BuffAgent buffagent = new BuffRoleImpl(roleid,true);
			if (buffagent.existBuff(BuffConstant.StateType.STATE_TEAM) && buffagent.existBuff(BuffConstant.StateType.STATE_TEAM_LEADER)) {
				if (task.getConf().exeIndo.teamState == 0) {
				//	onFail(roleid);
					Module.logger.info("闂傚倸鍊搁崐鎼佸磹閹间礁纾归柟闂寸绾惧綊鏌熼梻瀵割槮缁炬儳婀遍敓鐣屾嚀鐎氼參宕崇壕瀣ㄤ汗闁圭儤鍨归崐鐐烘偡濠婂啰绠荤�殿喗濞婇弫鍐磼濞戞艾骞楅梻渚�娼х换鍫ュ春閸曨垱鍊块柛鎾楀懐锛滈梺褰掑亰閸欏骸鈻撳鍫熺厸鐎癸拷閿熶粙宕伴弽顓犲祦鐎广儱顦介弫濠勭棯閹峰矂鍝烘慨锝咁樀濮婄粯鎷呮笟顖滃姼濡炪倖鍨堕崹褰掑箲閵忕姭鏀介悗锝庝海閹芥洟姊洪棃娴ュ牓寮插☉姘卞暗鐎广儱顦伴悡鏇㈡倶閻愭彃鈷旈柣鎿冨灠椤法鎲撮崟顒傤槹濠殿喖锕ュ钘夌暦椤愶箑绀嬫い鎺戭槹閿涗胶绱撻崒娆戣窗闁哥姵顨婇獮鎴﹀炊瑜滈崵鏇炩攽閻樺磭顣查柡鍛絻椤法鎹勯悮瀛樻暰濡炪們鍎茬换鍫濐潖濞差亜鎹舵い鎾楀懎濮奸梺璇插缁嬪牓寮查悩鑼殾濞村吋娼欑粻娑㈡煟濡わ拷閻楀啴骞忛搹鍦＝闁稿本鐟ч崝宥嗐亜椤撶偞宸濈紒顔款嚙椤繈顢橀悩娈垮晭濠电姰鍨煎▔娑㈩敄閸ヮ灐娲箻椤旂晫鍘遍梺鍐叉惈閸燁偅绂掓潏顭戞闁绘劕妯婇崕鏃堟煛娴ｇ鏆ｉ柡浣规崌閹墽浠︾粵瀣棥濠电娀娼ч崐鎼佸箟閿熺姵鍋傞柕澶嗘櫆閻撴盯鏌涢幇鈺佸濠㈣泛瀚妵鍕Ψ閵夘喗效闂侀潧娲ょ�氼垳绮诲☉銏犖ㄩ柨鏇嫹妞ゅ骏鎷�" + roleid + "]濠电姷鏁告慨鐑藉极閸涘﹥鍙忛柣鎴ｆ閺嬩線鏌涘☉姗堟敾闁告瑥绻橀弻锝夊箣閿濆棭妫勯梺鍝勵儎缁舵岸寮婚悢鍏尖拻閻庨潧澹婂Σ顔剧磼閻愵剙鍔ゆい顓犲厴瀵鏁愰崨鍌滃枎閳诲酣骞嗚椤斿嫮绱撻崒娆掑厡濠殿喗鎸抽幃妯侯潩鐠轰綍锕傛煕閺囥劌鏋ら柣銈忔嫹闂備礁婀遍崑鎾诲箚鐏炶娇娑㈠Χ閸モ晝锛濇繛鎾磋壘閿曘儳锟芥俺顫夌换婵嬫偨闂堟刀銏＄箾鐠囇呯暤闁诡噯绻濇俊鐑藉煛閸屾粌骞楅梻浣告惈閸燁偄霉閸岀偛鍚规繛鍡樺灦閸嬫牗鎱ㄥΟ澶稿惈缁炬崘妫勯湁闁挎繂鐗婇鐘绘偨椤栨稓銆掔紒杈ㄥ笧閿熸枻缍嗛崑鍕箔閹烘挶浜滈柡鍥崝锔撅拷瑙勬礈閸犳牠銆佸锟芥俊鎼佹晝閿熶粙顢旈崼鏇熲拺闁圭娴风粻鎾澄旈悩鍙夊暈缂佸倸绉归幃娆徢庨璺ㄧ泿闂備焦瀵ч弻銊╂倶濠靛棛鏆ら柛鈩冪♁閻撴瑦銇勯弮鍌滄憘婵炲牊妫冮弻宥囩磼濡纾抽悗瑙勬礀缂嶅﹪銆佸▎鎾村仼閻忕偛锟界喐瀚梻鍌氬�搁崐鐑芥嚄閸洍锟斤箓宕奸妷顔芥櫈闂佸憡绋戦悺銊╁疾濠靛鐓忓鑸电☉椤╊剟鏌嶉悷鎵㈤柍瑙勫灴閹晠宕ｆ径濠庢П闂備焦鎮堕崐鏇㈩敄婢跺娼栧┑鐘宠壘闁卞洭鏌ｉ弮锟芥禍浠嬫晸閼恒儱绗х紒杈ㄥ浮楠炲洭顢欓梻瀛橆潟闂備礁鎼惌澶屽緤妤ｅ啫绠氶柡鍐ㄧ墱閺佸秵绻濇繝鍌涘晽闁挎繂顦伴埛鎴︽煕濞戞﹫鏀婚悘蹇庡嵆閺岋綁鎮ら崒婊呮殼濡ょ姷鍋涢悧鎾翠繆閹间礁鐓涘ù锝勮閸熷洤鈹戦悙鑸靛涧缂佽弓绮欏畷銏狀煥閸繄顔嗙紓鍌欑劍椤洨绮绘ィ鍐ㄧ骇闁割偅绻傞埛鏃堟煙椤旂鍋㈤柡宀嬬秮閸╁嫰宕橀埡鍐ㄥ汲婵＄偑鍊ら崢鐓幟洪銏㈠祦闁搞儺鍓氶崑瀣煕椤愮姴鐏╂鐐茬墦濮婃椽鎮烽弶鎸庡�梺浼欑秵娴滎亜鐣风涵鍛汗闁圭儤鍨归崢娲⒑閸濆嫭宸濆┑顖涙尦楠炲繑顦版惔銏犳瀭闂佸憡娲﹂崜娆撍囬埡鍛拺闁硅偐鍋涙慨锟藉┑鐐差槹閻╊垶骞冩ィ鍐╁仾妞ゆ牗眉濮规姊洪崷顓炲妺缂佽鍟村鏌ヮ敂閸啿鎷洪梺鍛婄☉閿曪絿娆㈤柆宥嗙厱婵☆垰婀遍惌娆愩亜閵忥紕鎳囩�规洘甯￠幃娆戝垝鐟欏嫬顏烘繝鐢靛仩閹活亞寰婇崸妤�纾块柕鍫濐槸閸氬綊鏌ㄩ悢鍓佺煓闁哄矉缍�缁犳盯骞橀崜渚囧敹闂備胶顢婂▍鏇㈡晝閵忋倖鍋樻い鏃囨硶閻わ拷濠电偞鍨堕悷锕�鈻嶉姀銈嗏拺閻犳亽鍔屽▍鎰版煙閸戙倖瀚�" + useitemid + "],濠电姷鏁告慨鐑藉极閸涘﹥鍙忛柣鎴ｆ閺嬩線鏌涘☉姗堟敾闁告瑥绻橀弻锝夊箣閿濆棭妫勯梺鍝勵儎缁舵岸寮婚悢鍏尖拻閻庨潧澹婂Σ顔剧磼閹冣挃缂侇噮鍨抽幑銏犫槈閵忕姷顓哄┑鐐叉缁绘帡宕濋幘顔解拺閺夌偞澹嗛ˇ锔姐亜閹存繃顥㈠┑锛勬暬瀹曠喖顢涘槌栧晪闂佽崵濮惧▍锝夊磿閵堝鍊靛Δ锝呭暞閳锋垿鏌涘☉姗堝姛闁瑰啿鍟扮槐鎺旂磼濡搫顫戦梺璇茬箰閸熸潙顫忓ú顏勭閹艰揪绲块悾鐢告⒑閻熸澘鏆遍梺甯到椤曪綁骞栨担鑲澭冾熆鐠轰警鍎戦柛妯烘啞缁绘稒娼忛崜褍鍩屾繝銏㈡嚀閿曨亜鐣烽弴銏犵闁挎梻鏅崢鐢告⒑閸︻厾甯涢悽顖涱殜瀹曨垶鎮欓悜妯煎幍濡炪倖鐗楃粙鎺椝夐崼婵冩斀闁斥晛鍟崐鎰攽閿涘嫭鐒挎い锔芥尦閺屸剝寰勬径宀�鐓撳┑顔硷功缁垳绮悢鍏兼櫢闁芥ê顦介悞鐣屾喐閹寸偞娅犳繝闈涱儐閳锋垿鏌涘┑鍡楊仾闁革綀娅ｇ槐鎺楊敊閼恒儱纰嶉梺浼欑悼閸忔﹢鐛崶顒�绾ч柛褎顨嗛弳鍛節瀵伴攱婢橀敓鑺ユ崌閹虫宕奸弴鐐电厬闂佺硶鍓濈粙鎺楀煕閹寸姷纾藉ù锝堝亗閹寸姷鐭嗛柨鐔剁矙濮婅櫣绮欓崠鈥充紣濠电媴鎷烽梺顒�绉甸弲鎼佹煠閹帒鍔ら柛鐔哥叀閺岀喖宕欓妶鍡楊伓" + scenarioquestid + "],闂傚倸鍊搁崐鎼佸磹閹间礁纾归柟闂寸绾惧綊鏌熼梻瀵割槮缁炬儳缍婇弻鐔兼⒒鐎靛壊妲紒鎯у⒔閹虫捇鈥旈崘顏庢嫹閿濆簼绨奸柟鐧哥秮閺岋綁顢橀悙鎼闂侀潧妫欑敮鎺楋綖濠靛鍊锋い鎺炴嫹妞ゅ繗鍩栨穱濠囧Χ閸ヮ灝銉╂煕鐎ｎ剙浠遍柟顔ㄥ洦鍋愭慨鐟版祫閹烽攱绗熼敓钘夘嚕閹绢喖顫呴柍鈺佸暞閻濇洟姊绘担钘壭撻柨姘亜閿旇鏋ょ紒杈ㄦ瀵挳濮�閳撅拷閹风粯绻涙潏鍓хК婵炲拑缍佹俊瀛樼節閸ャ劎鍘遍梺瑙勫劤椤曨厾绮婚悙鐑樼厵闁芥ê顦敓钘夘煼閺佹捇寮妶鍥┬ｉ梺鍝ュУ閻楃娀骞冨▎鎰瘈闁告劧缂氱花濠氭⒑閻熺増鎯堢紒澶婂閹峰綊鎮ч崼婊呯畾濡炪倖鍔戦崹褰掑汲濞嗘挻鐓冮悷娆忓閻忔挳鏌熼鐣屾噧妞ゆ柨绻橀、娆撳礂绾板崬鏅欐繝纰夌磿閸嬫垿宕愰弽顐ｆ殰闁绘棁妗ㄩ悞濠冪箾閸℃ê鐏︽い顐ｆ礋閺岋綁骞囬澶婃闂佽崵鍠庣紞濠囧蓟閵娾晜鍋勭紓浣癸供濡嫬顪冮妶鍡樼┛缂傚秳绶氶妴渚�寮撮姀鈩冩珖闂佽法鍠撻弲顐ｇ珶閺囩喓闄勯柛娑橈功閸樹粙姊鸿ぐ鎺戜喊闁告鏅槐鐐哄箣閿旂晫鍘介悷婊冪Ф閿熻姤鍑归崢楣冨箲閵忕姭鏀介悗锝庝憾濞煎﹪姊洪幐搴ｇ畵闁硅櫕鍔欏畷銏ゎ敃閿旇В鎷洪梺鍦焾濞寸兘銆傞懠顒傜＜缂備焦顭囧ú瀵革拷瑙勬礈閸樠囧煘閹达箑绀嬫い鎰拷鍐茬亰闂傚倸鍊风粈渚�骞栭锔藉剹濠㈣泛鑻欢銈呂旈敐鍛殭缂佺姵宀搁弻锟犲礃閵娧冾杸闂佸搫鎷嬮崜鐔煎蓟濞戙垹鍗抽柕濞垮劚缁犲搫鈹戦悙鑼⒈闁搞劏娉涢～蹇曠磼濡顎撴繛鎾村嚬閸ㄦ娊宕濈粙搴撴斀妞ゆ梹鏋婚崗顒勬⒒閸曨偄顏紒顔碱儏椤撳吋寰勫Ο缁樻珜闂備礁鎲″ú锕傚礈濮橆兘鏋嶉柕蹇嬪�栭埛鎴︽煕韫囨稒锛熼柤鍓蹭邯閺屾稒鎯旈妸銈嗗枤閻庤娲滈弫濠氥�佸Δ鍛妞ゆ帒鍊搁獮鍫ユ⒒娴ｇ懓顕滅紒璇插�婚幑銏ゅ箳閺冨倻鐓嬪銈嗘⒒閻℃柨鈻撴禒瀣厽闁归偊鍘肩徊濠氭煛閸☆厾绉柡宀�鍠栭、娆撴偩瀹�锟介悡鍌滅磽娓氬洤鏋ら柡浣规倐閺佹捇寮妶鍥┬ｉ梺绋款儏閹冲酣鍩㈠鍛殕闁告洦鍏橀幏缁樼箾鏉堝墽绉┑顔哄�楀☉鐢稿醇閺囩喓鍘遍梺缁橆焾鐏忔瑨鍊撮梻浣告啞鐢鏁幒妤�鐓濋幖娣妼缁犲鏌ц箛锝呬簼鐞氾綁姊婚崒娆戠獢婵炰匠鍤躲劑鏁撻悾宀�纾奸柣妯哄暱閻忊晜绻涢崱鎰伈闁诡喗鐟╅幃婊兾熼悡搴＄闂傚倸鍊风欢锟犲矗韫囨洜涓嶉柟瀵稿仦濞呯娀鏌ｅΔ锟介悧鍕濠婂牊鐓涢柛鎰鐎氬綊鏌ｉ姀鈺佺伈缂佺粯绻傞锝嗙節濮橆厽娅滈梺绯曞墲閿氶柛鏂挎嚇濮婃椽妫冨☉姘辩暰闂佺懓鍟垮ú銈夆�栨繝鍥╅柍鍝勫�婚崢楣冩⒑閸撹尙鍘滅紒鐘冲灴瀹曘垽骞戦幇鈺�姹楅梺鍦劋閹稿憡绂嶉悷閭︽富闁靛牆妫欓ˉ鍡涙煕鐎ｎ偄濮堢紒鍌涘笚缁轰粙宕ㄦ繛鐐闂佽楠稿﹢杈ㄥ垔椤撶儐鐒介柟鎵閻撴洟鏌曟繛鍨姢濞寸姰鍨洪妵鍕敆閿熶粙鏁冮妷銉劷闊洦绋戞儫闂佹寧绻傜�氼噣鎯勬惔銊︹拻濞达絽鎲￠幆鍫熺箾鐏炲倸濮傜�规洑鍗抽獮妯肩磼濡搫澹掗柣搴ｆ閹风兘鏌ㄩ悢鐑樻珪婵″弶鍔欓獮鎺懳旀繝鍐╂珦缂備胶鍋撴刊鑺ョ椤掑嫬瑙﹂悗锝庯拷顓熸閹晠妫冨☉妤佸媰闂備焦瀵уú蹇涘垂娴犲鍋樻い鏇嫹鐎规洖鐖兼俊鎼佹晝閿熶粙顢撻幘缁樷拺闂傚牃鏅涢惁婊堟煕濮楋拷缁犳牠宕洪姀鈥崇窞闁归偊鍘搁幏濠氭⒑缁嬫寧婀伴柣鐕傚缁﹪鎮ч崼銏㈩啎婵犮垼娉涢鍡欑矆鐎ｎ剨鎷风憴鍕濠电偛锕顐﹀礃椤旇偐锛滃┑顔斤耿绾悂宕悽鍛娾拻濞达綀濮ょ涵鍫曟煕閿濆繒鐣垫鐐茬箻閺佹捇鏁撻敓锟�?,濠电姷鏁告慨鐑藉极閸涘﹥鍙忛柣鎴ｆ閺嬩線鏌涘☉姗堟敾闁告瑥绻橀弻锝夊箣閿濆棭妫勯梺鍝勵儎缁舵岸寮婚悢鍏尖拻閻庨潧澹婂Σ顔剧磼閻愵剙鍔ゆい顓犲厴瀵鏁愰崨鍌滃枎閳诲酣骞嗚椤斿嫮绱撻崒娆掑厡濠殿喗鎸抽幃妯侯潩鐠轰綍锕傛煕閺囥劌鏋ら柣銈忔嫹闂備礁婀遍崑鎾诲箚鐏炶娇娑㈡倷閻㈢數锛濇繛杈剧悼閺咁偊宕奸鍫熺厱濠电姴鍟扮粻鐐碉拷娈垮枛椤兘寮崘顔芥櫢闁稿﹦鍠撴禍浠嬫⒒娴ｈ櫣甯涢柤褰掔畺椤㈡岸顢橀悩鐢电劶闂佺硶鍓濋妵娑㈠绩娴犲鐓熼柟閭﹀幗缂嶆垿鏌ｈ箛銉х暤闁圭缍佹俊鑸靛緞鐎ｎ剙骞愰梻浣芥硶閸犳洘鎱ㄩ妶鍥╃焿闁圭儤妫戦幏鐑芥晲鎼粹�茬盎闂佽法鍠撻弲顐﹀极婵犳艾钃熼柕濞垮劗閺�浠嬫煕閳╁啰鎳冮柛銈庡墰缁辨挻鎷呴棃娑橆瀳濡炪値鍘鹃崗妯侯嚕鐠囨祴妲堟慨妯煎亾鐎氬綊鏌ㄥ┑鍡欏嚬缂併劋绮欏顐﹀醇濠靛啯鏂�濡炪倖姊婚妴瀣绩缂佹ü绻嗛柣鎰煐椤ュ鎽堕悙鐑樼厱闁规壋鏅涙俊閿嬩繆閹绘帞澧涢柟渚垮妼椤粓宕卞Δ锟介埛鎺楁⒑閸濆嫭锛嶉柛瀣噽閹广垹鈹戠�ｎ偄浠洪梻鍌氱墛缁嬫劗鍒掗崼鏇熲拺婵炶尪顔婄花鐑芥煕濡わ拷閸熷潡鎮惧畡鎵虫斀闁搞儯鍔岄崝鍛存⒑闂堟稓绠為柛銊︽閵囨劖銈ｉ崘鈹炬嫼闂佸憡绻傜�氼厼顔忓┑瀣厱闁绘ê寮堕ˉ銏拷瑙勬礃閸ㄥ灝鐣烽妸褝鎷峰☉娆樼劷闁告﹢浜跺铏规兜閸涱厾鍔烽梺鍛婃煥缁夋挳鍩㈠澶婄倞妞ゆ帊鑳堕崢鍗炩攽閳藉棗鐏犳繝锟介柆宥嗗剹婵炲棙鍔栭崣蹇撯攽閻樻彃鏆為柕鍥ㄧ箖椤ㄣ儵鎮欓弶鎴濐潔闂佽鍨卞Λ鍐极閹版澘鐐婇柍鍝勫�归鎾绘⒒閸屾艾锟界兘鎳楅崼鏇炵疇闁规崘顕ч悿顕�鏌涜椤у倿宕堕浣镐缓缂備礁顑嗙�笛囨倵椤掑嫭鈷戦悷娆忓閸斻倕顭胯鐎涒晠濡靛▎鎾崇闁兼亽鍎遍敓鐣屾暬閺屻劌鈹戦崱娑憋拷妤�霉濠婂嫮鐭岄柨鐔烘櫕閹虫捇骞楀鍫稏闁硅法鐏渁te==0.");
					fire.pb.talk.MessageMgr.sendMsgNotify(roleid, 141711, null);
					return false;
				}
				if (task.getConf().exeIndo.share == 0) {
					//濠电姷鏁告慨鐑藉极閸涘﹥鍙忛柣鎴ｆ閺嬩線鏌涘☉姗堟敾闁告瑥绻橀弻锝夊箣閿濆棭妫勯梺鍝勵儎缁舵岸寮婚悢鍏尖拻閻庨潧澹婂Σ顔剧磼閻愵剙鍔ゆい顓犲厴瀵鏁愭径濠勭杸濡炪倖甯婇悞锕傚磿閹剧粯鈷戦柟鑲╁仜婵″ジ鏌涙繝鍌涘仴鐎殿喛顕ч埥澶愬閳哄倹娅囬梻浣瑰缁诲倸螞濞戔懞鍥Ψ瑜忕壕钘壝归敐鍛儓鐏忓繘姊洪崨濠庢畷濠电偛锕ら锝囨嫚濞村顫嶅┑鈽嗗灦閺�閬嶅棘閿熶粙姊绘担鍛婂暈婵炶绠撳畷鎴﹀礋椤掍礁寮块梺闈涚箞閸婃牠鍩涢幋鐐电闁煎ジ顤傞崵娆愵殽閻愭惌娈滈柡宀�鍠栭幃鐑芥偋閸繃鐏庨柣搴㈩問閸犳牠鈥﹂悜钘夌畺闁靛繈鍊栭幆鐐烘煕閿旇寮跨紒杈ㄧ叀濮婄粯绗熼敓钘夘焽瑜忛幑銏ゅ箳閹炬潙寮块梺姹囧灩閹诧繝宕愰崼鏇熺厱妞ゆ劗濮撮崝婊堟煃闁垮鐏︾紒缁樼洴閹崇姵锛愬┑鍡橆唲婵°倗濮烽崑鐐恒�冮崱娑樜﹂柛鏇ㄥ灠鎯熼梺闈涱樈閸ㄧ敻宕ラ锔藉�垫繛鍫濈仢閺嬶附銇勯弴鍡楁祩閺佸洭鏌涜箛鏇炲付缂佸墎鍋涢埞鎴︽偐閹绘帩浠煎Δ鐘靛仦閸旀洟鍩為幋锔藉�烽柤鎼佹涧濞懷呯磽娴ｈ棄绱︾紒顔界懇閻涱喗寰勯幇顒備紜闂佸搫鍊堕崕鏌ユ倶娓氾拷閺岋綁鎮╅悜妯革拷鍐偣閿熶粙鏁冮敓浠嬪Υ閹烘挾绡�婵﹩鍘鹃崢顏堟⒑閸撴彃浜濈紒璇插�块弫鎾绘偩鐏炴儳娈岄梺瀹狀嚙缁夌懓顕ｉ锟藉畷濂告偄閸濆嫬绠ラ梻鍌欑閹诧繝宕归鐐茬９闁哄稁鍋撻幏宄邦潩閻愵剙顏�?
					fire.pb.mission.PCommitMajorMission taskproc=
							new fire.pb.mission.PCommitMajorMission(roleid, scenarioquestid, true, true);
					if (mkdb.Transaction.current() == null)
						taskproc.submit();
					else
						taskproc.call();
				} else {
					//闂傚倸鍊搁崐鎼佸磹閹间礁纾归柟闂寸绾惧綊鏌熼梻瀵割槮缁炬儳缍婇弻鐔兼⒒鐎靛壊妲紒鐐劤缂嶅﹪寮婚敐澶婄闁挎繂鎲涢幘缁樼厱闁靛牆鎳庨顓㈡煛鐏炲墽娲存い銏℃礋閺佹劙宕卞▎娆戠┛闂傚倷娴囧▔鏇㈠窗閹版澘鍑犻柤濮愬�楁稉宥夋煙閹咃紞闁哄棴绠戦埞鎴﹀磼濠婂海鍔稿銈庡亜閹虫﹢寮诲澶娢ㄩ柕澶堝劜濮ｆ劗绱撴担闈涘Ω闁稿酣娼ч～蹇曠磼濡顎撻梺鍛婄缚閸庤櫕顨欓梻鍌欒兌椤牓顢栭崨瀛樻櫇妞ゅ繐瀚弳锔炬喐閻楀牆淇柡浣告闇夐柨婵嗗椤掔喐绻涢崣澶嬪�愭慨濠冩そ閹筹繝濡堕崨顔句邯闂備胶顭堥鍛存晝椤忓牆绠栭柕蹇嬪�曢獮銏＄箾閹寸偟鎳呴柛姗�绠栧楦裤亹閹烘搫绱甸梺缁樺釜缁犳垿鍩ユ径搴Щ闂佸疇顫夐崹鍧椼�佸▎鎾村殐闁宠桨绶￠弶鎼佹⒒娓氾拷濞佳兠洪妶鍥锋嫹濮樺崬顣煎ǎ鍥э躬閹粓鎸婃竟鈹垮妽閵囧嫰寮介妸褏鐣甸梺璇″灠閻楁挸顫忕紒妯诲闁告稑锕ラ崕鎾绘⒑閸忓吋銇熼柛銊ョ－閸掓帡寮崼鐔蜂画闂佽顔栭崰妤�鈻撻幆褜娓婚柕鍫濇婵呯磼閻樺啿鐏╃紒顔肩墢閿熸枻缍嗛崑浣圭濠婂牊鐓欏ù鐓庣摠濞懷冾熆瑜滈崹鍫曞箖濡わ拷椤繃娼忛妸銉︾暚闂備礁鐤囬～澶愬垂閸ф绠栭柍鍝勫枦閹风兘宕烽鐐愩垺銇勯妷锔剧疄婵﹨娅ｇ槐鎺懳熺拠鏌ョ�虹紓鍌欐祰椤曆囨偋閹炬剚鍤曞┑鐘崇閺呮悂鏌ｅΟ鍨毢闁稿﹦鍋ゅ娲濞戣鲸肖闂佺姘﹀▍鏇犵矉閹烘挶鍋呴柛鎰ㄦ杹閹疯櫣绱撻崒娆戝妽閽冮亶鎮樿箛鏇熸毈闁哄本鐩幃鈺佺暦閸パ�鎷伴柣搴㈩問閸犳牠鈥﹂悜钘夋瀬闁瑰墽绮崑鎰版煠绾板崬澧剧紒鍗炲级缁绘繈鎮介棃娑楁勃闂佹悶鍔岄悥濂稿极閸愵喖鐓涢柛娑卞幖閹偤鏌ｆ惔顖滅У闁哥姵顨婇崺娑㈠箣閿旇棄浠┑鐐叉缁绘劙顢旈埡鍐＜闁圭粯甯╅悡濂告煛瀹�锟介崰鎾诲箯閻樹警妲剧紓浣叉閹烽攱淇婇妶鍥ラ柛瀣洴閹囧箻缂堢姷绠氶梺褰掓？閻掞箓寮插鍫熺厱闁圭偓顨呴幊蹇涳綖瀹�鍕拻闁稿本鐟ч崝宥夋煙椤旇偐鍩ｇ�规洘娲熼、姘舵晸閽樺鍤曢柟缁樺坊閺�浠嬫倵閿濆簼绨奸弶鍫濈墕椤啴濡堕崱妤�衼闂傚倸瀚�氫即宕哄☉銏犵闁挎梻鏅崢鍗炩攽閻樼粯娑ф俊顐ｎ殜椤㈡棃顢曢敂鐣屽幗闂佸湱鍎ゅú妯兼兜閸撲胶纾奸弶鍫涘妽鐏忣厽銇勯幘鐐藉仮鐎规洜鍠栭、姗�鎮╅棃娑樼哎闂備浇顕х�涒晠顢欓弽顓為棷妞ゆ洩鎷风�规洘鍨剁换婵嬪炊閳轰胶銈︽繝纰樻閸ㄧ敻宕戦幇顔碱棜闁稿繘妫跨换鍡樸亜閺嶃劎鐭岄悽顖涚♁閵囧嫯绠涢弴鐐寸亪濠殿喖锕︾划顖炲箯閸涘瓨鍤嶉柕澹緤鎷锋繝鍥ㄢ拺闂傚牃鏅濈粔鍓佺磼閻樿櫕宕岄柣娑卞枦缁犳稑鈽夊▎鎰仧闂備浇娉曢崳锕傚箯閿燂拷?
					fire.pb.mission.PCommitMajorMission taskproc=
							new fire.pb.mission.PCommitMajorMission(roleid, scenarioquestid, true, true);
					if (mkdb.Transaction.current() == null)
						taskproc.submit();
					else
						taskproc.call();
				}
			} else if(buffagent.existBuff(BuffConstant.StateType.STATE_TEAM) && !buffagent.existBuff(BuffConstant.StateType.STATE_TEAM_LEADER)) {
				Module.logger.info("闂傚倸鍊搁崐鎼佸磹閹间礁纾归柟闂寸绾惧綊鏌熼梻瀵割槮缁炬儳婀遍敓鐣屾嚀鐎氼參宕崇壕瀣ㄤ汗闁圭儤鍨归崐鐐烘偡濠婂啰绠荤�殿喗濞婇弫鍐磼濞戞艾骞楅梻渚�娼х换鍫ュ春閸曨垱鍊块柛鎾楀懐锛滈梺褰掑亰閸欏骸鈻撳鍫熺厸鐎癸拷閿熶粙宕伴弽顓犲祦鐎广儱顦介弫濠勭棯閹峰矂鍝烘慨锝咁樀濮婄粯鎷呮笟顖滃姼濡炪倖鍨堕崹褰掑箲閵忕姭鏀介悗锝庝海閹芥洟姊洪棃娴ュ牓寮插☉姘卞暗鐎广儱顦伴悡鏇㈡倶閻愭彃鈷旈柣鎿冨灠椤法鎲撮崟顒傤槹濠殿喖锕ュ钘夌暦椤愶箑绀嬫い鎺戭槹閿涗胶绱撻崒娆戣窗闁哥姵顨婇獮鎴﹀炊瑜滈崵鏇炩攽閻樺磭顣查柡鍛絻椤法鎹勯悮瀛樻暰濡炪們鍎茬换鍫濐潖濞差亜鎹舵い鎾楀懎濮奸梺璇插缁嬪牓寮查悩鑼殾濞村吋娼欑粻娑㈡煟濡わ拷閻楀啴骞忛搹鍦＝闁稿本鐟ч崝宥嗐亜椤撶偞宸濈紒顔款嚙椤繈顢橀悩娈垮晭濠电姰鍨煎▔娑㈩敄閸ヮ灐娲箻椤旂晫鍘遍梺鍐叉惈閸燁偅绂掓潏顭戞闁绘劕妯婇崕鏃堟煛娴ｇ鏆ｉ柡浣规崌閹墽浠︾粵瀣棥濠电娀娼ч崐鎼佸箟閿熺姵鍋傞柕澶嗘櫆閻撴盯鏌涢幇鈺佸濠㈣泛瀚妵鍕Ψ閵夘喗效闂侀潧娲ょ�氼垳绮诲☉銏犖ㄩ柨鏇嫹妞ゅ骏鎷�" + roleid + "]濠电姷鏁告慨鐑藉极閸涘﹥鍙忛柣鎴ｆ閺嬩線鏌涘☉姗堟敾闁告瑥绻橀弻锝夊箣閿濆棭妫勯梺鍝勵儎缁舵岸寮婚悢鍏尖拻閻庨潧澹婂Σ顔剧磼閻愵剙鍔ゆい顓犲厴瀵鏁愰崨鍌滃枎閳诲酣骞嗚椤斿嫮绱撻崒娆掑厡濠殿喗鎸抽幃妯侯潩鐠轰綍锕傛煕閺囥劌鏋ら柣銈忔嫹闂備礁婀遍崑鎾诲箚鐏炶娇娑㈠Χ閸モ晝锛濇繛鎾磋壘閿曘儳锟芥俺顫夌换婵嬫偨闂堟刀銏＄箾鐠囇呯暤闁诡噯绻濇俊鐑藉煛閸屾粌骞楅梻浣告惈閸燁偄霉閸岀偛鍚规繛鍡樺灦閸嬫牗鎱ㄥΟ澶稿惈缁炬崘妫勯湁闁挎繂鐗婇鐘绘偨椤栨稓銆掔紒杈ㄥ笧閿熸枻缍嗛崑鍕箔閹烘挶浜滈柡鍥崝锔撅拷瑙勬礈閸犳牠銆佸锟芥俊鎼佹晝閿熶粙顢旈崼鏇熲拺闁圭娴风粻鎾澄旈悩鍙夊暈缂佸倸绉归幃娆徢庨璺ㄧ泿闂備焦瀵ч弻銊╂倶濠靛棛鏆ら柛鈩冪♁閻撴瑦銇勯弮鍌滄憘婵炲牊妫冮弻宥囩磼濡纾抽悗瑙勬礀缂嶅﹪銆佸▎鎾村仼閻忕偛锟界喐瀚梻鍌氬�搁崐鐑芥嚄閸洍锟斤箓宕奸妷顔芥櫈闂佸憡绋戦悺銊╁疾濠靛鐓忓鑸电☉椤╊剟鏌嶉悷鎵㈤柍瑙勫灴閹晠宕ｆ径濠庢П闂備焦鎮堕崐鏇㈩敄婢跺娼栧┑鐘宠壘闁卞洭鏌ｉ弮锟芥禍浠嬫晸閼恒儱绗х紒杈ㄥ浮楠炲洭顢欓梻瀛橆潟闂備礁鎼惌澶屽緤妤ｅ啫绠氶柡鍐ㄧ墱閺佸秵绻濇繝鍌涘晽闁挎繂顦伴埛鎴︽煕濞戞﹫鏀婚悘蹇庡嵆閺岋綁鎮ら崒婊呮殼濡ょ姷鍋涢悧鎾翠繆閹间礁鐓涘ù锝勮閸熷洤鈹戦悙鑸靛涧缂佽弓绮欏畷銏狀煥閸繄顔嗙紓鍌欑劍椤洨绮绘ィ鍐ㄧ骇闁割偅绻傞埛鏃堟煙椤旂鍋㈤柡宀嬬秮閸╁嫰宕橀埡鍐ㄥ汲婵＄偑鍊ら崢鐓幟洪銏㈠祦闁搞儺鍓氶崑瀣煕椤愮姴鐏╂鐐茬墦濮婃椽鎮烽弶鎸庡�梺浼欑秵娴滎亜鐣风涵鍛汗闁圭儤鍨归崢娲⒑閸濆嫭宸濆┑顖涙尦楠炲繑顦版惔銏犳瀭闂佸憡娲﹂崜娆撍囬埡鍛拺闁硅偐鍋涙慨锟藉┑鐐差槹閻╊垶骞冩ィ鍐╁仾妞ゆ牗眉濮规姊洪崷顓炲妺缂佽鍟村鏌ヮ敂閸啿鎷洪梺鍛婄☉閿曪絿娆㈤柆宥嗙厱婵☆垰婀遍惌娆愩亜閵忥紕鎳囩�规洘甯￠幃娆戝垝鐟欏嫬顏烘繝鐢靛仩閹活亞寰婇崸妤�纾块柕鍫濐槸閸氬綊鏌ㄩ悢鍓佺煓闁哄矉缍�缁犳盯骞橀崜渚囧敹闂備胶顢婂▍鏇㈡晝閵忋倖鍋樻い鏃囨硶閻わ拷濠电偞鍨堕悷锕�鈻嶉姀銈嗏拺閻犳亽鍔屽▍鎰版煙閸戙倖瀚�" + useitemid + "],濠电姷鏁告慨鐑藉极閸涘﹥鍙忛柣鎴ｆ閺嬩線鏌涘☉姗堟敾闁告瑥绻橀弻锝夊箣閿濆棭妫勯梺鍝勵儎缁舵岸寮婚悢鍏尖拻閻庨潧澹婂Σ顔剧磼閹冣挃缂侇噮鍨抽幑銏犫槈閵忕姷顓哄┑鐐叉缁绘帡宕濋幘顔解拺閺夌偞澹嗛ˇ锔姐亜閹存繃顥㈠┑锛勬暬瀹曠喖顢涘槌栧晪闂佽崵濮惧▍锝夊磿閵堝鍊靛Δ锝呭暞閳锋垿鏌涘☉姗堝姛闁瑰啿鍟扮槐鎺旂磼濡搫顫戦梺璇茬箰閸熸潙顫忓ú顏勭閹艰揪绲块悾鐢告⒑閻熸澘鏆遍梺甯到椤曪綁骞栨担鑲澭冾熆鐠轰警鍎戦柛妯烘啞缁绘稒娼忛崜褍鍩屾繝銏㈡嚀閿曨亜鐣烽弴銏犵闁挎梻鏅崢鐢告⒑閸︻厾甯涢悽顖涱殜瀹曨垶鎮欓悜妯煎幍濡炪倖鐗楃粙鎺椝夐崼婵冩斀闁斥晛鍟崐鎰攽閿涘嫭鐒挎い锔芥尦閺屸剝寰勬径宀�鐓撳┑顔硷功缁垳绮悢鍏兼櫢闁芥ê顦介悞鐣屾喐閹寸偞娅犳繝闈涱儐閳锋垿鏌涘┑鍡楊仾闁革綀娅ｇ槐鎺楊敊閼恒儱纰嶉梺浼欑悼閸忔﹢鐛崶顒�绾ч柛褎顨嗛弳鍛節瀵伴攱婢橀敓鑺ユ崌閹虫宕奸弴鐐电厬闂佺硶鍓濈粙鎺楀煕閹寸姷纾藉ù锝堝亗閹寸姷鐭嗛柨鐔剁矙濮婅櫣绮欓崠鈥充紣濠电媴鎷烽梺顒�绉甸弲鎼佹煠閹帒鍔ら柛鐔哥叀閺岀喖宕欓妶鍡楊伓" + scenarioquestid + "],闂傚倸鍊搁崐鎼佸磹閹间礁纾归柟闂寸绾惧綊鏌熼梻瀵割槮缁炬儳缍婇弻鐔兼⒒鐎靛壊妲紒鎯у⒔閹虫捇鈥旈崘顏庢嫹閿濆簼绨奸柟鐧哥秮閺岋綁顢橀悙鎼闂侀潧妫欑敮鎺楋綖濠靛鍊锋い鎺炴嫹妞ゅ繗鍩栨穱濠囧Χ閸ヮ灝銉╂煕鐎ｎ剙浠遍柟顔ㄥ洦鍋愭慨鐟版祫閹烽攱绗熼敓钘夘嚕閹绢喖顫呴柍鈺佸暞閻濇洟姊绘担钘壭撻柨姘亜閿旇鏋ょ紒杈ㄦ瀵挳濮�閳撅拷閹风粯绻涙潏鍓хК婵炲拑缍佹俊瀛樼節閸ャ劎鍘遍梺瑙勫劤椤曨厾绮婚悙鐑樼厵闁芥ê顦敓钘夘煼閺佹捇寮妶鍥┬ｉ梺鍝ュУ閻楃娀骞冨▎鎰瘈闁告劧缂氱花濠氭⒑閻熺増鎯堢紒澶婂閹峰綊鎮ч崼婊呯畾濡炪倖鍔戦崹褰掑汲濞嗘挻鐓冮悷娆忓閻忔挳鏌熼鐣屾噧妞ゆ柨绻橀、娆撳礂绾板崬鏅欐繝纰夌磿閸嬫垿宕愰弽顐ｆ殰闁绘棁妗ㄩ悞濠冪箾閸℃ê鐏︽い顐ｆ礋閺岋綁骞囬澶婃闂佽崵鍠庣紞濠囧蓟閵娾晜鍋勭紓浣癸供濡嫬顪冮妶鍡樼┛缂傚秳绶氶妴渚�寮撮姀鈩冩珖闂佽法鍠撻弲顐ｇ珶閺囩喓闄勯柛娑橈功閸樹粙姊鸿ぐ鎺戜喊闁告鏅槐鐐哄箣閿旂晫鍘介悷婊冪Ф閿熻姤鍑归崢楣冨箲閵忕姭鏀介悗锝庝憾濞煎﹪姊洪幐搴ｇ畵闁硅櫕鍔欏畷銏ゎ敃閿旇В鎷洪梺鍦焾濞寸兘銆傞懠顒傜＜缂備焦顭囧ú瀵革拷瑙勬礈閸樠囧煘閹达箑绀嬫い鎰拷鍐茬亰闂傚倸鍊风粈渚�骞栭锔藉剹濠㈣泛鑻欢銈呂旈敐鍛殭缂佺姵宀搁弻锟犲礃閵娧冾杸闂佸搫鎷嬮崜鐔煎蓟濞戙垹鍗抽柕濞垮劚缁犲搫鈹戦悙鑼⒈闁搞劏娉涢～蹇曠磼濡顎撴繛鎾村嚬閸ㄦ娊宕濈粙搴撴斀妞ゆ梹鏋婚崗顒勬⒒閸曨偄顏紒顔碱儏椤撳吋寰勫Ο缁樻珜闂備礁鎲″ú锕傚礈濮橆兘鏋嶉柕蹇嬪�栭埛鎴︽煕韫囨稒锛熼柤鍓蹭邯閺屾稒鎯旈妸銈嗗枤閻庤娲滈弫濠氥�佸Δ鍛妞ゆ帒鍊搁獮鍫ユ⒒娴ｇ懓顕滅紒璇插�婚幑銏ゅ箳閺冨倻鐓嬪銈嗘⒒閻℃柨鈻撴禒瀣厽闁归偊鍘肩徊濠氭煛閸☆厾绉柡宀�鍠栭、娆撴偩瀹�锟介悡鍌滅磽娓氬洤鏋ら柡浣规倐閺佹捇寮妶鍥┬ｉ梺绋款儏閹冲酣鍩㈠鍛殕闁告洦鍏橀幏缁樼箾鏉堝墽绉┑顔哄�楀☉鐢稿醇閺囩喓鍘遍梺缁橆焾鐏忔瑨鍊撮梻浣告啞鐢鏁幒妤�鐓濋幖娣妼缁犲鏌ц箛锝呬簼鐞氾綁姊婚崒娆戠獢婵炰匠鍤躲劑鏁撻悾宀�纾奸柣妯哄暱閻忊晜绻涢崱鎰伈闁诡喗鐟╅幃婊兾熼悡搴＄闂傚倸鍊风欢锟犲矗韫囨洜涓嶉柟瀵稿仦濞呯娀鏌ｅΔ锟介悧鍕濠婂牊鐓涢柛鎰鐎氬綊鏌ｉ姀鈺佺伈缂佺粯绻堥悰顕�宕橀妸搴㈡瀹曟﹢鍩℃担鍦拷顓㈡⒒娴ｅ憡鍟炴繛璇х畵瀹曟粌鈽夐埗鍝勬喘婵＄兘濡烽姀鈩冩澑闂備胶绮崝鏇炍熸繝鍌ょ�剁憸蹇曟閹烘鍋愰柧蹇ｅ亜绾炬娊鎮楀▓鍨珮闁稿锕悰顔嘉熼懖鈺冿紲濠碘槅鍨靛銊バуΔ鍛拻濞达絽鎲￠崯鐐烘煕閺冿拷閿氭い鏇秮楠炴鎷犻懠顒夋Ш闂備礁鎼粙渚�宕㈡禒瀣厱闁圭儤鍤氳ぐ鎺撴櫜闁告侗鍠楅崰鎰磽娴ｅ壊妲规俊鐐扮矙瀵鈽夊鐐闁挎繂绨奸幃宥夋椤掑澧伴柨鐔凤拷鐕佹綈婵炲弶鍨垮畷锟犲礃瀹割喖娈ㄦ繛瀵稿Т椤戞劙寮崶顒佺厽闁归偊鍘肩徊缁樼箾閸稑锟芥牜鎹㈠┑瀣仺闂傚牊绋愬▽顏堟⒑閹肩偛濡奸柣鏍с偢楠炲啴鎮滈懞銉︽珖闂佺鏈銊╂偂閹达附顥婃い鎰╁灪婢跺嫰鏌熼崨濠冨唉鐎殿喓鍔嶇粋鎺旓拷锝庡亞閸樿棄鈹戦埥鍡楃仴妞ゆ泦鍛筏濠电姵纰嶉悡銉╂煟閺冨倻甯涙い銉ヮ樀閺岋綁寮介銏犱粯闂佷紮绲块崗姗�鐛�ｎ喗鏅濋柨鐔剁矙閿濈偤宕ㄧ�涙鍘梺鍓插亝缁诲啴藟閻樼粯鐓曟慨妤嬫嫹婵炰匠鍥ｏ拷鏃堝礃椤斿槈褔鏌涢埄鍐剧劷闁告瑥妫濆娲捶椤撴稒瀚涢梺绋款儏閿曨亪鐛崘顭戞建闁跨喍绮欓獮濠囨偐濞茬粯鏅㈡繝鐢靛Т閸燁偊顢旈崼鏇熺厽闁绘柨鎽滈幊鍐倵濮樼厧骞樼紒顔肩墦瀹曟﹢鍩炴径鍝ョ泿闂備線娼ч…鍫ュ磿鐠囧樊鍟呴柕澶嗘櫆閻撶喖鏌ㄥ┑鍡樺櫣婵℃彃顭烽幗鍫曞冀椤撶喓鍘卞┑鐐村灥瀹曨剟寮稿☉娆戠闁割偆鍠庢慨宥嗘叏婵犲啯銇濈�规洘锕㈠畷锝嗗緞鐎ｎ亜澹嶉梻鍌欒兌椤牓鏁冮妷鈺佺婵炲棙鎸搁弸渚�鏌熼崜褏甯涢柡鍛倐閺屻劑鎮ら崒娑橆伓.");
				fire.pb.mission.PCommitMajorMission taskproc=
						new fire.pb.mission.PCommitMajorMission(roleid, scenarioquestid, true, true);
				if (mkdb.Transaction.current() == null)
					taskproc.submit();
				else
					taskproc.call();
			} else {
				if (task.getConf().exeIndo.teamState == 2) {
					Module.logger.info("闂傚倸鍊搁崐鎼佸磹閹间礁纾归柟闂寸绾惧綊鏌熼梻瀵割槮缁炬儳婀遍敓鐣屾嚀鐎氼參宕崇壕瀣ㄤ汗闁圭儤鍨归崐鐐烘偡濠婂啰绠荤�殿喗濞婇弫鍐磼濞戞艾骞楅梻渚�娼х换鍫ュ春閸曨垱鍊块柛鎾楀懐锛滈梺褰掑亰閸欏骸鈻撳鍫熺厸鐎癸拷閿熶粙宕伴弽顓犲祦鐎广儱顦介弫濠勭棯閹峰矂鍝烘慨锝咁樀濮婄粯鎷呮笟顖滃姼濡炪倖鍨堕崹褰掑箲閵忕姭鏀介悗锝庝海閹芥洟姊洪棃娴ュ牓寮插☉姘卞暗鐎广儱顦伴悡鏇㈡倶閻愭彃鈷旈柣鎿冨灠椤法鎲撮崟顒傤槹濠殿喖锕ュ钘夌暦椤愶箑绀嬫い鎺戭槹閿涗胶绱撻崒娆戣窗闁哥姵顨婇獮鎴﹀炊瑜滈崵鏇炩攽閻樺磭顣查柡鍛絻椤法鎹勯悮瀛樻暰濡炪們鍎茬换鍫濐潖濞差亜鎹舵い鎾楀懎濮奸梺璇插缁嬪牓寮查悩鑼殾濞村吋娼欑粻娑㈡煟濡わ拷閻楀啴骞忛搹鍦＝闁稿本鐟ч崝宥嗐亜椤撶偞宸濈紒顔款嚙椤繈顢橀悩娈垮晭濠电姰鍨煎▔娑㈩敄閸ヮ灐娲箻椤旂晫鍘遍梺鍐叉惈閸燁偅绂掓潏顭戞闁绘劕妯婇崕鏃堟煛娴ｇ鏆ｉ柡浣规崌閹墽浠︾粵瀣棥濠电娀娼ч崐鎼佸箟閿熺姵鍋傞柕澶嗘櫆閻撴盯鏌涢幇鈺佸濠㈣泛瀚妵鍕Ψ閵夘喗效闂侀潧娲ょ�氼垳绮诲☉銏犖ㄩ柨鏇嫹妞ゅ骏鎷�" + roleid + "]濠电姷鏁告慨鐑藉极閸涘﹥鍙忛柣鎴ｆ閺嬩線鏌涘☉姗堟敾闁告瑥绻橀弻锝夊箣閿濆棭妫勯梺鍝勵儎缁舵岸寮婚悢鍏尖拻閻庨潧澹婂Σ顔剧磼閻愵剙鍔ゆい顓犲厴瀵鏁愰崨鍌滃枎閳诲酣骞嗚椤斿嫮绱撻崒娆掑厡濠殿喗鎸抽幃妯侯潩鐠轰綍锕傛煕閺囥劌鏋ら柣銈忔嫹闂備礁婀遍崑鎾诲箚鐏炶娇娑㈠Χ閸モ晝锛濇繛鎾磋壘閿曘儳锟芥俺顫夌换婵嬫偨闂堟刀銏＄箾鐠囇呯暤闁诡噯绻濇俊鐑藉煛閸屾粌骞楅梻浣告惈閸燁偄霉閸岀偛鍚规繛鍡樺灦閸嬫牗鎱ㄥΟ澶稿惈缁炬崘妫勯湁闁挎繂鐗婇鐘绘偨椤栨稓銆掔紒杈ㄥ笧閿熸枻缍嗛崑鍕箔閹烘挶浜滈柡鍥崝锔撅拷瑙勬礈閸犳牠銆佸锟芥俊鎼佹晝閿熶粙顢旈崼鏇熲拺闁圭娴风粻鎾澄旈悩鍙夊暈缂佸倸绉归幃娆徢庨璺ㄧ泿闂備焦瀵ч弻銊╂倶濠靛棛鏆ら柛鈩冪♁閻撴瑦銇勯弮鍌滄憘婵炲牊妫冮弻宥囩磼濡纾抽悗瑙勬礀缂嶅﹪銆佸▎鎾村仼閻忕偛锟界喐瀚梻鍌氬�搁崐鐑芥嚄閸洍锟斤箓宕奸妷顔芥櫈闂佸憡绋戦悺銊╁疾濠靛鐓忓鑸电☉椤╊剟鏌嶉悷鎵㈤柍瑙勫灴閹晠宕ｆ径濠庢П闂備焦鎮堕崐鏇㈩敄婢跺娼栧┑鐘宠壘闁卞洭鏌ｉ弮锟芥禍浠嬫晸閼恒儱绗х紒杈ㄥ浮楠炲洭顢欓梻瀛橆潟闂備礁鎼惌澶屽緤妤ｅ啫绠氶柡鍐ㄧ墱閺佸秵绻濇繝鍌涘晽闁挎繂顦伴埛鎴︽煕濞戞﹫鏀婚悘蹇庡嵆閺岋綁鎮ら崒婊呮殼濡ょ姷鍋涢悧鎾翠繆閹间礁鐓涘ù锝勮閸熷洤鈹戦悙鑸靛涧缂佽弓绮欏畷銏狀煥閸繄顔嗙紓鍌欑劍椤洨绮绘ィ鍐ㄧ骇闁割偅绻傞埛鏃堟煙椤旂鍋㈤柡宀嬬秮閸╁嫰宕橀埡鍐ㄥ汲婵＄偑鍊ら崢鐓幟洪銏㈠祦闁搞儺鍓氶崑瀣煕椤愮姴鐏╂鐐茬墦濮婃椽鎮烽弶鎸庡�梺浼欑秵娴滎亜鐣风涵鍛汗闁圭儤鍨归崢娲⒑閸濆嫭宸濆┑顖涙尦楠炲繑顦版惔銏犳瀭闂佸憡娲﹂崜娆撍囬埡鍛拺闁硅偐鍋涙慨锟藉┑鐐差槹閻╊垶骞冩ィ鍐╁仾妞ゆ牗眉濮规姊洪崷顓炲妺缂佽鍟村鏌ヮ敂閸啿鎷洪梺鍛婄☉閿曪絿娆㈤柆宥嗙厱婵☆垰婀遍惌娆愩亜閵忥紕鎳囩�规洘甯￠幃娆戝垝鐟欏嫬顏烘繝鐢靛仩閹活亞寰婇崸妤�纾块柕鍫濐槸閸氬綊鏌ㄩ悢鍓佺煓闁哄矉缍�缁犳盯骞橀崜渚囧敹闂備胶顢婂▍鏇㈡晝閵忋倖鍋樻い鏃囨硶閻わ拷濠电偞鍨堕悷锕�鈻嶉姀銈嗏拺閻犳亽鍔屽▍鎰版煙閸戙倖瀚�" + useitemid + "],濠电姷鏁告慨鐑藉极閸涘﹥鍙忛柣鎴ｆ閺嬩線鏌涘☉姗堟敾闁告瑥绻橀弻锝夊箣閿濆棭妫勯梺鍝勵儎缁舵岸寮婚悢鍏尖拻閻庨潧澹婂Σ顔剧磼閹冣挃缂侇噮鍨抽幑銏犫槈閵忕姷顓哄┑鐐叉缁绘帡宕濋幘顔解拺閺夌偞澹嗛ˇ锔姐亜閹存繃顥㈠┑锛勬暬瀹曠喖顢涘槌栧晪闂佽崵濮惧▍锝夊磿閵堝鍊靛Δ锝呭暞閳锋垿鏌涘☉姗堝姛闁瑰啿鍟扮槐鎺旂磼濡搫顫戦梺璇茬箰閸熸潙顫忓ú顏勭閹艰揪绲块悾鐢告⒑閻熸澘鏆遍梺甯到椤曪綁骞栨担鑲澭冾熆鐠轰警鍎戦柛妯烘啞缁绘稒娼忛崜褍鍩屾繝銏㈡嚀閿曨亜鐣烽弴銏犵闁挎梻鏅崢鐢告⒑閸︻厾甯涢悽顖涱殜瀹曨垶鎮欓悜妯煎幍濡炪倖鐗楃粙鎺椝夐崼婵冩斀闁斥晛鍟崐鎰攽閿涘嫭鐒挎い锔芥尦閺屸剝寰勬径宀�鐓撳┑顔硷功缁垳绮悢鍏兼櫢闁芥ê顦介悞鐣屾喐閹寸偞娅犳繝闈涱儐閳锋垿鏌涘┑鍡楊仾闁革綀娅ｇ槐鎺楊敊閼恒儱纰嶉梺浼欑悼閸忔﹢鐛崶顒�绾ч柛褎顨嗛弳鍛節瀵伴攱婢橀敓鑺ユ崌閹虫宕奸弴鐐电厬闂佺硶鍓濈粙鎺楀煕閹寸姷纾藉ù锝堝亗閹寸姷鐭嗛柨鐔剁矙濮婅櫣绮欓崠鈥充紣濠电媴鎷烽梺顒�绉甸弲鎼佹煠閹帒鍔ら柛鐔哥叀閺岀喖宕欓妶鍡楊伓" + scenarioquestid + "],婵犵數濮烽弫鍛婃叏閻戣棄鏋侀柛娑橈攻閸欏繘鏌ｉ幋锝嗩棄闁哄绶氶弻娑樷槈濮楀牊鏁鹃梺鍛婄懃缁绘﹢寮婚敐澶婄闁挎繂妫Λ鍕⒑閸濆嫷鍎庣紒鑸靛哺瀵鎮㈤崗灏栨嫽闁诲酣娼ф竟濠偽ｉ鍓х＜闁诡垎鍐ｆ寖缂備緡鍣崹鎶藉箲閵忕姭妲堥柕蹇曞Х椤撴椽姊虹紒妯哄闁诲繑宀稿畷瀹狀槾缂佽鲸鎸婚幏鍛矙濞嗙偓娈洪梻浣侯焾椤戝啴宕愬┑鍡╁殨閻犲洦绁村Σ鍫ユ煏韫囨洖顫嶉柕濠忚礋娴滄粓鏌￠崘銊ワ拷鍝ユ暜閼哥偣浜滄い鎰枑濞呭洨绱掓潏銊﹀鞍缂佹鍠愮换婵嬪礃椤垳绱﹂梻鍌氬�风粈浣圭珶婵犲洤纾婚柛鈩冪☉缁愭鏌熼幑鎰【濠殿噮鍓熼弻銊╂偄閸撲胶鐓撳┑顔硷工椤嘲鐣烽幒鎴僵闁告鍎愰弶鍝ョ磽閸屾瑧顦︽い鎴濇閺侇噣鏁撻悩鍙夌�悗骞垮劚椤︻垳鐚惧澶嬬厱妞ゆ劑鍊曢弸鏃堟煕濮楋拷缁犳牕顫忓ú顏勪紶闁告洖鐏氭瓏婵犵數鍋涢ˇ鏉棵哄Ο鑲╃焿闁圭儤顨呴～鍛存煏閸繃顥犻柛姗嗕邯濮婅櫣鍖栭弴鐐测拤闂佹寧姘ㄧ槐鎺懳旀担鍝ョ懖闂侀潧娲ょ�氫即銆侀弴銏℃櫜闁搞儮鏅濋弶浠嬫⒒娴ｇ瓔鍤冮柛鐘愁殜閹兘鍩￠崨顐嫹娴ｈ倽鏃堝川椤旇姤顏熷┑鐐差嚟婵挳顢栭幇鏉挎瀬闁稿瞼鍋為悡鐘绘煕濠靛嫬鍔滈柡鍡忔櫇缁辨帡鍩ラ崨顔碱伓婵犵數濮烽弫鎼佸磻濞戙垺鍋嬮柛鈩冪♁閸婅埖绻濋棃娑卞剰闁告垹濮电换娑㈠箣濞嗗繒浠鹃梺缁樻尪閸庣敻寮婚敓鐘茬倞妞ゎ厼顑愭禍顏堝极閹剧粯鍤嶉柕澹懐鏆┑鐑囩到濞层倝鏁冮鍕殾濠靛倻顭堥崡鎶芥煟閹邦収鍟忛柛鐔锋搐閳规垿鎮欓懜闈涙锭缂備浇寮撶划娆撶嵁濡わ拷椤劑宕奸悢铚傛偅婵犵數鍋涘Ο濠冪濠靛鐓曢柟杈鹃檮閳锋帡鏌涢銈呮灁闁靛棙甯炵槐鎺楁偐闂堟稐妲愰梺鍝勬湰缁嬫帞鎹㈠┑瀣闁冲搫鍠氬Σ鍓佺磽閸屾瑧璐伴柛鐘崇墵閹囧箻瀹曞洦娈鹃梺缁樻尭鐎垫帡鎮㈤崱妯肩瘈闂傚牊绋掗ˉ鐘电磼婢跺銇濋柡灞稿墲閹峰懘鎮烽弶娆炬綒闁诲氦顫夊ú婊堝窗閺嶎厹锟戒礁顫濈捄鍝勭獩濡炪倖鎸鹃崐锝夊Χ閸涱亝鏂�闂佺粯顭堢亸娆徫涢崟顖涚厪闁割偅绻堥妤佺箾閸喓绠炴慨濠冩そ閹兘寮堕幐搴敤闂備胶鎳撻崵鏍箯閿燂拷,濠电姷鏁告慨鐑藉极閸涘﹥鍙忛柣鎴ｆ閺嬩線鏌涘☉姗堟敾闁告瑥绻橀弻锝夊箣閿濆棭妫勯梺鍝勵儎缁舵岸寮婚悢鍏尖拻閻庨潧澹婂Σ顔剧磼閻愵剙鍔ゆい顓犲厴瀵鏁愰崨鍌滃枎閳诲酣骞嗚椤斿嫮绱撻崒娆掑厡濠殿喗鎸抽幃妯侯潩鐠轰綍锕傛煕閺囥劌鏋ら柣銈忔嫹闂備礁婀遍崑鎾诲箚鐏炶娇娑㈡倷閻㈢數锛濇繛杈剧悼閺咁偊宕奸鍫熺厱濠电姴鍟粈瀣節閿熻姤绗熼敓钘夘潖閾忓湱纾兼俊顖氭禋娴滄粏鐏掓繝鐢靛Т濞层倗澹曢崸妤冨彄闁搞儯鍔庨埦渚�鏌ｉ幘瀵告创闁诡喗顨婇弫鎰板磼濞戞瑧褰囩紓鍌欑劍閸旀牕螞閸愵喖钃熼柨娑樺濞岊亪鏌涢幘妤�瀚崹閬嶆⒒娴ｇ瓔鍤冮柛鐘愁殘閸掓帡骞樺畷鍥ㄦ闂佸壊鍋呭ú鏍ㄥ劔闂備線娼чˇ浠嬪窗閺囩姵顫曟い鈺佹State==2.");
					onFail(roleid);
					return false;
				}
				Module.logger.info("闂傚倸鍊搁崐鎼佸磹閹间礁纾归柟闂寸绾惧綊鏌熼梻瀵割槮缁炬儳婀遍敓鐣屾嚀鐎氼參宕崇壕瀣ㄤ汗闁圭儤鍨归崐鐐烘偡濠婂啰绠荤�殿喗濞婇弫鍐磼濞戞艾骞楅梻渚�娼х换鍫ュ春閸曨垱鍊块柛鎾楀懐锛滈梺褰掑亰閸欏骸鈻撳鍫熺厸鐎癸拷閿熶粙宕伴弽顓犲祦鐎广儱顦介弫濠勭棯閹峰矂鍝烘慨锝咁樀濮婄粯鎷呮笟顖滃姼濡炪倖鍨堕崹褰掑箲閵忕姭鏀介悗锝庝海閹芥洟姊洪棃娴ュ牓寮插☉姘卞暗鐎广儱顦伴悡鏇㈡倶閻愭彃鈷旈柣鎿冨灠椤法鎲撮崟顒傤槹濠殿喖锕ュ钘夌暦椤愶箑绀嬫い鎺戭槹閿涗胶绱撻崒娆戣窗闁哥姵顨婇獮鎴﹀炊瑜滈崵鏇炩攽閻樺磭顣查柡鍛絻椤法鎹勯悮瀛樻暰濡炪們鍎茬换鍫濐潖濞差亜鎹舵い鎾楀懎濮奸梺璇插缁嬪牓寮查悩鑼殾濞村吋娼欑粻娑㈡煟濡わ拷閻楀啴骞忛搹鍦＝闁稿本鐟ч崝宥嗐亜椤撶偞宸濈紒顔款嚙椤繈顢橀悩娈垮晭濠电姰鍨煎▔娑㈩敄閸ヮ灐娲箻椤旂晫鍘遍梺鍐叉惈閸燁偅绂掓潏顭戞闁绘劕妯婇崕鏃堟煛娴ｇ鏆ｉ柡浣规崌閹墽浠︾粵瀣棥濠电娀娼ч崐鎼佸箟閿熺姵鍋傞柕澶嗘櫆閻撴盯鏌涢幇鈺佸濠㈣泛瀚妵鍕Ψ閵夘喗效闂侀潧娲ょ�氼垳绮诲☉銏犖ㄩ柨鏇嫹妞ゅ骏鎷�" + roleid + "]濠电姷鏁告慨鐑藉极閸涘﹥鍙忛柣鎴ｆ閺嬩線鏌涘☉姗堟敾闁告瑥绻橀弻锝夊箣閿濆棭妫勯梺鍝勵儎缁舵岸寮婚悢鍏尖拻閻庨潧澹婂Σ顔剧磼閻愵剙鍔ゆい顓犲厴瀵鏁愰崨鍌滃枎閳诲酣骞嗚椤斿嫮绱撻崒娆掑厡濠殿喗鎸抽幃妯侯潩鐠轰綍锕傛煕閺囥劌鏋ら柣銈忔嫹闂備礁婀遍崑鎾诲箚鐏炶娇娑㈠Χ閸モ晝锛濇繛鎾磋壘閿曘儳锟芥俺顫夌换婵嬫偨闂堟刀銏＄箾鐠囇呯暤闁诡噯绻濇俊鐑藉煛閸屾粌骞楅梻浣告惈閸燁偄霉閸岀偛鍚规繛鍡樺灦閸嬫牗鎱ㄥΟ澶稿惈缁炬崘妫勯湁闁挎繂鐗婇鐘绘偨椤栨稓銆掔紒杈ㄥ笧閿熸枻缍嗛崑鍕箔閹烘挶浜滈柡鍥崝锔撅拷瑙勬礈閸犳牠銆佸锟芥俊鎼佹晝閿熶粙顢旈崼鏇熲拺闁圭娴风粻鎾澄旈悩鍙夊暈缂佸倸绉归幃娆徢庨璺ㄧ泿闂備焦瀵ч弻銊╂倶濠靛棛鏆ら柛鈩冪♁閻撴瑦銇勯弮鍌滄憘婵炲牊妫冮弻宥囩磼濡纾抽悗瑙勬礀缂嶅﹪銆佸▎鎾村仼閻忕偛锟界喐瀚梻鍌氬�搁崐鐑芥嚄閸洍锟斤箓宕奸妷顔芥櫈闂佸憡绋戦悺銊╁疾濠靛鐓忓鑸电☉椤╊剟鏌嶉悷鎵㈤柍瑙勫灴閹晠宕ｆ径濠庢П闂備焦鎮堕崐鏇㈩敄婢跺娼栧┑鐘宠壘闁卞洭鏌ｉ弮锟芥禍浠嬫晸閼恒儱绗х紒杈ㄥ浮楠炲洭顢欓梻瀛橆潟闂備礁鎼惌澶屽緤妤ｅ啫绠氶柡鍐ㄧ墱閺佸秵绻濇繝鍌涘晽闁挎繂顦伴埛鎴︽煕濞戞﹫鏀婚悘蹇庡嵆閺岋綁鎮ら崒婊呮殼濡ょ姷鍋涢悧鎾翠繆閹间礁鐓涘ù锝勮閸熷洤鈹戦悙鑸靛涧缂佽弓绮欏畷銏狀煥閸繄顔嗙紓鍌欑劍椤洨绮绘ィ鍐ㄧ骇闁割偅绻傞埛鏃堟煙椤旂鍋㈤柡宀嬬秮閸╁嫰宕橀埡鍐ㄥ汲婵＄偑鍊ら崢鐓幟洪銏㈠祦闁搞儺鍓氶崑瀣煕椤愮姴鐏╂鐐茬墦濮婃椽鎮烽弶鎸庡�梺浼欑秵娴滎亜鐣风涵鍛汗闁圭儤鍨归崢娲⒑閸濆嫭宸濆┑顖涙尦楠炲繑顦版惔銏犳瀭闂佸憡娲﹂崜娆撍囬埡鍛拺闁硅偐鍋涙慨锟藉┑鐐差槹閻╊垶骞冩ィ鍐╁仾妞ゆ牗眉濮规姊洪崷顓炲妺缂佽鍟村鏌ヮ敂閸啿鎷洪梺鍛婄☉閿曪絿娆㈤柆宥嗙厱婵☆垰婀遍惌娆愩亜閵忥紕鎳囩�规洘甯￠幃娆戝垝鐟欏嫬顏烘繝鐢靛仩閹活亞寰婇崸妤�纾块柕鍫濐槸閸氬綊鏌ㄩ悢鍓佺煓闁哄矉缍�缁犳盯骞橀崜渚囧敹闂備胶顢婂▍鏇㈡晝閵忋倖鍋樻い鏃囨硶閻わ拷濠电偞鍨堕悷锕�鈻嶉姀銈嗏拺閻犳亽鍔屽▍鎰版煙閸戙倖瀚�" + useitemid + "],濠电姷鏁告慨鐑藉极閸涘﹥鍙忛柣鎴ｆ閺嬩線鏌涘☉姗堟敾闁告瑥绻橀弻锝夊箣閿濆棭妫勯梺鍝勵儎缁舵岸寮婚悢鍏尖拻閻庨潧澹婂Σ顔剧磼閹冣挃缂侇噮鍨抽幑銏犫槈閵忕姷顓哄┑鐐叉缁绘帡宕濋幘顔解拺閺夌偞澹嗛ˇ锔姐亜閹存繃顥㈠┑锛勬暬瀹曠喖顢涘槌栧晪闂佽崵濮惧▍锝夊磿閵堝鍊靛Δ锝呭暞閳锋垿鏌涘☉姗堝姛闁瑰啿鍟扮槐鎺旂磼濡搫顫戦梺璇茬箰閸熸潙顫忓ú顏勭閹艰揪绲块悾鐢告⒑閻熸澘鏆遍梺甯到椤曪綁骞栨担鑲澭冾熆鐠轰警鍎戦柛妯烘啞缁绘稒娼忛崜褍鍩屾繝銏㈡嚀閿曨亜鐣烽弴銏犵闁挎梻鏅崢鐢告⒑閸︻厾甯涢悽顖涱殜瀹曨垶鎮欓悜妯煎幍濡炪倖鐗楃粙鎺椝夐崼婵冩斀闁斥晛鍟崐鎰攽閿涘嫭鐒挎い锔芥尦閺屸剝寰勬径宀�鐓撳┑顔硷功缁垳绮悢鍏兼櫢闁芥ê顦介悞鐣屾喐閹寸偞娅犳繝闈涱儐閳锋垿鏌涘┑鍡楊仾闁革綀娅ｇ槐鎺楊敊閼恒儱纰嶉梺浼欑悼閸忔﹢鐛崶顒�绾ч柛褎顨嗛弳鍛節瀵伴攱婢橀敓鑺ユ崌閹虫宕奸弴鐐电厬闂佺硶鍓濈粙鎺楀煕閹寸姷纾藉ù锝堝亗閹寸姷鐭嗛柨鐔剁矙濮婅櫣绮欓崠鈥充紣濠电媴鎷烽梺顒�绉甸弲鎼佹煠閹帒鍔ら柛鐔哥叀閺岀喖宕欓妶鍡楊伓" + scenarioquestid + "],婵犵數濮烽弫鍛婃叏閻戣棄鏋侀柛娑橈攻閸欏繘鏌ｉ幋锝嗩棄闁哄绶氶弻娑樷槈濮楀牊鏁鹃梺鍛婄懃缁绘﹢寮婚敐澶婄闁挎繂妫Λ鍕⒑閸濆嫷鍎庣紒鑸靛哺瀵鎮㈤崗灏栨嫽闁诲酣娼ф竟濠偽ｉ鍓х＜闁诡垎鍐ｆ寖缂備緡鍣崹鎶藉箲閵忕姭妲堥柕蹇曞Х椤撴椽姊虹紒妯哄闁诲繑宀稿畷瀹狀槾缂佽鲸鎸婚幏鍛矙濞嗙偓娈洪梻浣侯焾椤戝啴宕愬┑鍡╁殨閻犲洦绁村Σ鍫ユ煏韫囨洖顫嶉柕濠忚礋娴滄粓鏌￠崘銊ワ拷鍝ユ暜閼哥偣浜滄い鎰枑濞呭洨绱掓潏銊﹀鞍缂佹鍠愮换婵嬪礃椤垳绱﹂梻鍌氬�风粈浣圭珶婵犲洤纾婚柛鈩冪☉缁愭鏌熼幑鎰【濠殿噮鍓熼弻銊╂偄閸撲胶鐓撳┑顔硷工椤嘲鐣烽幒鎴僵闁告鍎愰弶鍝ョ磽閸屾瑧顦︽い鎴濇閺侇噣鏁撻悩鍙夌�悗骞垮劚椤︻垳鐚惧澶嬬厱妞ゆ劑鍊曢弸鏃堟煕濮楋拷缁犳牕顫忓ú顏勪紶闁告洖鐏氭瓏婵犵數鍋涢ˇ鏉棵哄Ο鑲╃焿闁圭儤顨呴～鍛存煏閸繃顥犻柛姗嗕邯濮婅櫣鍖栭弴鐐测拤闂佹寧姘ㄧ槐鎺懳旀担鍝ョ懖闂侀潧娲ょ�氫即銆侀弴銏℃櫜闁搞儮鏅濋弶浠嬫⒒娴ｇ瓔鍤冮柛鐘愁殜閹兘鍩￠崨顐嫹娴ｈ倽鏃堝川椤旇姤顏熷┑鐐差嚟婵挳顢栭幇鏉挎瀬闁稿瞼鍋為悡鐘绘煕濠靛嫬鍔滈柡鍡忔櫇缁辨帡鍩ラ崨顔碱伓婵犵數濮烽弫鎼佸磻濞戙垺鍋嬮柛鈩冪♁閸婅埖绻濋棃娑卞剰闁告垹濮电换娑㈠箣濞嗗繒浠鹃梺缁樻尪閸庣敻寮婚敓鐘茬倞妞ゎ厼顑愭禍顏堝极閹剧粯鍤嶉柕澹懐鏆┑鐑囩到濞层倝鏁冮鍕殾濠靛倻顭堥崡鎶芥煟閹邦収鍟忛柛鐔锋搐閳规垿鎮欓懜闈涙锭缂備浇寮撶划娆撶嵁濡わ拷椤劑宕奸悢铚傛偅婵犵數鍋涘Ο濠冪濠靛鐓曢柟杈鹃檮閳锋帡鏌涢銈呮灁闁靛棙甯炵槐鎺楁偐闂堟稐妲愰梺鍝勬湰缁嬫帞鎹㈠┑瀣闁冲搫鍠氬Σ鍓佺磽閸屾瑧璐伴柛鐘崇墵閹囧箻瀹曞洦娈鹃梺缁樻尭鐎垫帡鎮㈤崱妯肩瘈闂傚牊绋掗ˉ鐘电磼婢跺銇濋柡灞稿墲閹峰懘鎮烽弶娆炬綒闁诲氦顫夊ú婊堝窗閺嶎厹锟戒礁顫濈捄鍝勭獩濡炪倖鎸鹃崐锝夊Χ閸涱亝鏂�闂佺粯顭堢亸娆徫涢崟顖涚厪闁割偅绻堥妤佺箾閸喓绠炴慨濠冩そ閹兘寮堕幐搴敤闂備胶鎳撻崵鏍箯閿燂拷.");
				fire.pb.mission.PCommitMajorMission taskproc=
						new fire.pb.mission.PCommitMajorMission(roleid, scenarioquestid, true, true);
				if (mkdb.Transaction.current() == null)
					taskproc.submit();
				else
					taskproc.call();
			}
			mkdb.Procedure p = new mkdb.Procedure() {
				@Override
				protected boolean process() {
					return fire.pb.item.Module.getInstance().unlockAndDelItem(roleid, useitemid);
				}
			};
			if (mkdb.Transaction.current() == null) {
				p.submit();
			} else {
				p.call();
			}
			return true;
		}
	}
//	private boolean checkAIBattle() {
//		MissionConfig conf = MissionManager.getInstance().getTaskConfig( scenarioquestid );
//		if ( conf == null ) {
//			return false;
//		}
//		if ( Helper.getTaskFinishRequireType( conf.activeInfo.missionType ) == TaskFinishRequire.AREA || 
//				Helper.getTaskExeType( conf.activeInfo.missionType ) == TaskExecuteTypes.USE ) {
//			if ( conf.aiInfo.aIID != 0 ) {
//				new TaskBattle( roleid, conf.aiInfo.aIID, 
//					new TaskAIBattleEndHandler( scenarioquestid, conf.aiInfo.battleResult ),
//					conf.scenarioInfo.animationID ).submit();
//				gnet.link.Onlines.getInstance().send(roleid, new SUseTaskItemFail());
//				return true;
//			}
//		}
//		return false;
//	}
//	private final class PCommitMajorMission extends fire.pb.mission.PCommitMajorMission {
//		private final long memid;
//		PCommitMajorMission( final long memid ) {
//			super(memid, scenarioquestid, new fire.pb.mission.NullCommitParam() );
//			this.memid = memid;
//		}
//		@Override
//		protected boolean taskProcess() {
////			fire.pb.mission.TaskScenarioColumn sml =
////				new fire.pb.mission.TaskScenarioColumn( memid, false );
//			if (roleid == memid) {
//				fire.pb.item.Module.getInstance().unlockAndDelItem( memid );
//			}
//			return super.taskProcess();
////			fire.pb.mission.TaskScenario task = sml.getTask( scenarioquestid );
////			
////			return sml.(scenarioquestid);
//				
//		}
//		
//	}

	// {{{ RPCGEN_DEFINE_BEGIN
	// {{{ DO NOT EDIT THIS
	public static final int PROTOCOL_TYPE = 739904;

	public int getType() {
		return 739904;
	}

	public long roleid;
	public int scenarioquestid;
	public int useitemid;

	public MScenarioQuestUseItemVerifyPosSucc() {
	}

	public MScenarioQuestUseItemVerifyPosSucc(long _roleid_, int _scenarioquestid_, int _useitemid_) {
		this.roleid = _roleid_;
		this.scenarioquestid = _scenarioquestid_;
		this.useitemid = _useitemid_;
	}

	public final boolean _validator_() {
		return true;
	}

	public OctetsStream marshal(OctetsStream _os_) {
		if (!_validator_()) {
			throw new VerifyError("validator failed");
		}
		_os_.marshal(roleid);
		_os_.marshal(scenarioquestid);
		_os_.marshal(useitemid);
		return _os_;
	}

	public OctetsStream unmarshal(OctetsStream _os_) throws MarshalException {
		roleid = _os_.unmarshal_long();
		scenarioquestid = _os_.unmarshal_int();
		useitemid = _os_.unmarshal_int();
		if (!_validator_()) {
			throw new VerifyError("validator failed");
		}
		return _os_;
	}

	public boolean equals(Object _o1_) {
		if (_o1_ == this) return true;
		if (_o1_ instanceof MScenarioQuestUseItemVerifyPosSucc) {
			MScenarioQuestUseItemVerifyPosSucc _o_ = (MScenarioQuestUseItemVerifyPosSucc)_o1_;
			if (roleid != _o_.roleid) return false;
			if (scenarioquestid != _o_.scenarioquestid) return false;
			if (useitemid != _o_.useitemid) return false;
			return true;
		}
		return false;
	}

	public int hashCode() {
		int _h_ = 0;
		_h_ += (int)roleid;
		_h_ += scenarioquestid;
		_h_ += useitemid;
		return _h_;
	}

	public String toString() {
		StringBuilder _sb_ = new StringBuilder();
		_sb_.append("(");
		_sb_.append(roleid).append(",");
		_sb_.append(scenarioquestid).append(",");
		_sb_.append(useitemid).append(",");
		_sb_.append(")");
		return _sb_.toString();
	}

	public int compareTo(MScenarioQuestUseItemVerifyPosSucc _o_) {
		if (_o_ == this) return 0;
		int _c_ = 0;
		_c_ = Long.signum(roleid - _o_.roleid);
		if (0 != _c_) return _c_;
		_c_ = scenarioquestid - _o_.scenarioquestid;
		if (0 != _c_) return _c_;
		_c_ = useitemid - _o_.useitemid;
		if (0 != _c_) return _c_;
		return _c_;
	}

	// DO NOT EDIT THIS }}}
	// RPCGEN_DEFINE_END }}}

}

